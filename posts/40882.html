<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>解放双手，每日强国 | Shio</title><meta name="keywords" content="学习强国"><meta name="author" content="Shio,muzhi567@qq.com"><meta name="copyright" content="Shio"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f2b94b"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="解放双手，每日强国"><meta name="application-name" content="解放双手，每日强国"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f2b94b"><meta property="og:type" content="article"><meta property="og:title" content="解放双手，每日强国"><meta property="og:url" content="https://zhshio.cn/posts/40882.html"><meta property="og:site_name" content="Shio"><meta property="og:description" content="手把手教你每日躺拿45分强国"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://www.toopic.cn/public/uploads/small/169124446876816912444684.jpg?_r_=a17d5a5d-d0d9-745e-6da4-ce292c21031f"><meta property="article:author" content="Shio"><meta property="article:tag" content="Shio,张帅,博客,一个有趣的博客,技术,Java,张,帅,后端,Spring,学习强国"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.toopic.cn/public/uploads/small/169124446876816912444684.jpg?_r_=a17d5a5d-d0d9-745e-6da4-ce292c21031f"><meta name="description" content="手把手教你每日躺拿45分强国"><link rel="shortcut icon" href="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311091058032.ico"><link rel="canonical" href="https://zhshio.cn/posts/40882"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="316AAC6F338B2BA69CD36EE8EB638425"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo.zhshio.cn/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🏃 脚踏实地行动派"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Shio","link":"链接: ","source":"来源: Shio","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Shio',
  title: '解放双手，每日强国',
  postAI: '',
  pageFillDescription: '解放双手每日强国, 一、安装油猴, 二、添加脚本, 三、脚本使用解放双手每日强国学习强国是好事但有些学校功利性的算各种学分大多数人以这种动机的学习显然更像是一种负担其实如果大家有余力还是推荐自己学习本教程全程傻瓜式操作适用于未使用过油猴和的小白脚本内容搬运自代码我会贴在文章末尾再次强调我只是搬运工如有侵权会立即删除一年前的博客了现在学习强国也做了很多改进亲测目前只有自动刷视频和文章是无风险支持自动刷题会被警告警告到一定次数会被封禁天一安装油猴已经安装过的可以跳过这里打开你的浏览器点击扩展点击获取下图选项获取扩展搜索框输入搜索该扩展并获取之后会有弹窗点添加扩展把目光聚焦到浏览器的右上方这时候可能还看不到安装上的之后步骤简称油猴因为添加扩展后默认设置是不可视的按下图顺序点击便可设置为工具栏可见了二添加脚本按下图操作会进入一个新的界面新的界面如下底下这些内容是可以编辑的首先把原本的内容删掉然后把从文章末尾的代码全选然后复制最后粘贴到这里保存脚本就新建成功了启用它三脚本使用进入学习强国网页版学习强国然后扫码用户登录这里就不截图演示了右上角的浮窗点开始学习之后什么都不用不做慢慢等待完成即可以后每天只需要重复最后两步就可以懒人式斩获分了代码如下代码比较长复制时可能会卡一下不学习何以强国有趣的学习强国油猴插件读文章看视频做习题问题反馈原作者荷包蛋现作者嵌入样式初始化页面提示进入主页面初始化主题初始化任务配置初始化设置设置字体初始化主页面初始化提示渲染面板渲染窗口页面提示进入文章选读页面初始化主题初始化设置设置字体最大阅读初始化子页面初始化提示处理文章页面提示进入视听学习页面初始化主题初始化设置设置字体最大视听初始化子页面初始化提示处理视频页面提示进入每日答题页面初始化主题初始化设置设置字体初始化子页面初始化提示创建答题按钮开始答题页面提示进入专项练习页面初始化主题初始化设置设置字体初始化子页面初始化提示创建答题按钮开始答题初始化初始化配置初始化配置初始化配置移动端清除缩放缩放比例初始化最大阅读时长初始化最大视听时长初始化主题色监听主题变化设置主题主题色渲染提示渲染答题按钮插入节点渲染面板面板插入节点渲染窗口窗口插入节点答案获取答案数据请求请求成功答案列表答案保存答案内容数据请求请求成功数据获取新闻数据随机获取重要新闻请求成功获取视频数据随机获取重要新闻请求成功专项练习数据链接获取专项练习请求成功格式化生成二维码推送请求成功用二维码登录推送请求成功签名推送请求成功安全检查推送请求成功推送推送参数体好友令牌推送请求成功用户获取用户信息请求成功获取总积分请求成功总分获取当天总积分请求成功当天总分获取任务列表请求成功进度和当天总分配置单次最大新闻数单次最大视频数二维码最大刷新次数二维码自动刷新间隔视频静音配置主页正则主页每日答题页面专项练习页面配置用户信息总分当天分数任务列表新闻数据视频数据专项练习列表文本服务器保存答案文本服务器获取答案推送生成二维码二维码登录签名安全检查二维码版本号任务类型设置类型进度类型当前订阅订阅收集依赖当前订阅订阅列表不存在订阅列表键订阅添加订阅键订阅键订阅添加订阅添加订阅通知订阅订阅列表键订阅通知订阅收集依赖当前订阅订阅列表不存在订阅列表键订阅添加订阅键订阅键订阅添加订阅添加订阅通知订阅订阅列表键订阅通知订阅只读键定义属性收集依赖旧数据数据变化设置新数据值通知依赖浅层创建解除顶层创建处理结果收集依赖只读旧值通知依赖数据变化通知依赖存在新建创建顶层创建顶层监听数据变化立刻执行收集依赖监听数据变化影响收集依赖监听影响收集依赖监听监听影响收集依赖监听创建元素节点挂载状态挂载状态订阅取消订阅懒得写创建元素前创建普通元素处理属性处理属性处理子元素收集挂载前收集挂载创建元素后创建元素挂载状态挂载状态订阅取消订阅懒得写创建元素前元素命名空间创建元素处理属性处理属性处理子元素收集挂载前收集挂载创建元素后处理属性属性设置属性处理属性属性存在属性设置处理普通属性处理事件选项处理属性处理完的事件绑定事件监听事件类型函数设置事件监听监听事件变化移除旧事件监听设置新事件监听普通函数设置事件监听特殊属性特殊普通属性值属性名函数命名空间属性命名空间属性值监听影响普通属性普通属性处理子元素注释元素监听元素变化插入注释元素插入元素注释元素插入注释元素异步替换元素处理过后注释监听影响新元素为空旧元素为空存在处理元素变化处理元素变化处理元素变化非处理元素变化注释异步替换注释异步替换元素普通元素插入元素普通元素插入元素元素变化创建文字节点创建元素前元素订阅变化创建元素后创建元素后挂载元素触发挂载前事件挂在后选择器异步选择器存在元素超时创建元素块打印日志打印错误打印信息打印颜色进度条高亮文本二维码图片创建模态框选项配置用户内容文本日期类型类型基础你好来自推送消息选项推送推送模态框推送消息提示创建随机点范围范围横坐标纵坐标生成随机路径最小水平增量最大垂直增量开始节点插入点横坐标纵坐标随机数字随机大写字母随机小写字母随机混合字符随机字符串生成器随机位置格式化日期时间数字格式化日期时间日期时间日期时间格式化时间时间时间已过时间已过工具函数设置当前日期过期日期设置获取获取当前所有截取变成数组循环每个将截取成两部分判断的是否相等删除存在防抖判断是否为移动端移动端小尺寸设备端等待时间延时暂停学习锁暂停暂停停止定时器学习等待结束学习等待加载链接函数布尔字符正则变量链接任务配置登录每日首次登录积分文章选读每有效阅读一篇文章积分上限分有效阅读文章累计分钟积分上限分每日上限积分视听学习每有效一个音频或观看一个视频积分上限分有效收听音频或观看视频累计分钟积分上限分每日上限积分每日答题每组答题每答对道积分每日上限积分设置总分当天分数用户信息进度答题暂停登录窗口定时刷新列表推送刷新次数窗口关闭页面开始登录最大选读时长最大视听时长运行其他任务主题色考试类型获取答题按钮答题按钮停止定时器处理滑动验证滑动验证创建提示等待滑动验证提高层级轨道滑块延时矩形范围矩形范围窗口范围内随机起点终点路径移动端开始触摸触摸滑动触摸结束开始触摸鼠标按下鼠标滑动鼠标抬起创建提示滑动验证完成定时器滑动验证滑动验证成功创建提示滑动验证成功滑动验证失败创建提示滑动验证失败处理选项选项按钮答案存在作答答案存在包含答案最短长度选项遍历选项文本无符号选项文本无符号答案包含答案最小长度选项有值最短长度选项与当前选项比较长度最小长度选项赋值存在选项选择随机处理单选选项按钮按钮存在选择随机处理多选选项按钮按钮存在选择处理填空所有填空答案存在填空数量和答案数量一致答案存在输入事件设置答案触发输入填空数量为和提示数量大于直接将所有答案整合填进去答案存在输入事件设置答案触发输入处理填空随机所有填空输入事件设置答案答案触发输入暂停锁学习暂停全局暂停暂停创建提示已暂停手动开启自动答题停止定时器答题等待结束创建提示已开启自动答题答题等待答题下一个按钮下一个文本保存答案先等等再开始做题暂停获取下一个按钮下一个文本结束再练一次再来一组查看解析点击提示所有提示答案获取题目的文本内容等待一段时间暂停选项按钮所有填空问题类型暂停题型分类作答填空题根据提示作答成功创建提示答案异常尝试网络题库获取正在获取答案尝试题库获取获取答案成功失败根据题库作答成功随机作答答案不存在随机作答创建提示答案不存在随机作答推送学习推送答题存在异常已暂停答题学习推送成功失败暂停提交答案多选题根据提示作答选项文本选项内容空格填空数量选项数量答案数量相同选项全文等于答案全文全选选项数量大于等于答案成功创建提示答案异常尝试网络题库获取正在获取答案尝试题库获取获取答案成功失败答案存在成功随机作答答案不存在随机作答创建提示答案不存在随机作答推送学习推送答题存在异常已暂停答题学习推送成功失败暂停提交答案单选题根据提示作答创建提示为成功可能的分隔符可能的答案答案存在可能答案是否正确尝试查找点击创建提示答案异常尝试网络题库获取正在获取答案尝试题库获取获取答案成功失败存在答案单答案单选项尝试查找点击多答案单选项选项意外拆分可能分隔符可能答案答案存在可能答案是否正确尝试查找点击随机作答答案不存在随机作答创建提示答案不存在随机作答推送学习推送答题存在异常已暂停答题学习推送成功失败暂停提交答案暂停获取下一个按钮下一个文本需要提交答案答案填空题单选题多选题带字母的选项从字符串中拿出答案答案存在答案正在上传答案上传答案上传答案成功失败重置确定确定确认等待一段时间暂停答案解析答题错误从字符串中拿出答案正在上传答案上传答案上传答案成功失败获取按钮下一个文本下一题完成交卷等待一段时间下一题滑动验证关闭任务窗口每日答题暂停正在每日答题创建提示正在每日答题链接等待任务窗口每日答题创建提示完成每日答题等待一段时间刷新分数数据刷新任务数据任务完成状况任务未完成继续每日答题创建提示任务未完成继续每日答题专项练习正在专项练习创建提示正在专项练习链接链接等待窗口任务专项练习创建提示完成专项练习同屏任务窗口不存在创建提示专项练习均已完成初始化总页数属性默认从第一页获取全部页属性等待查询专项练习列表获取总页数当前页数正在寻找的专项练习创建提示正在寻找的专项练习请求数据获取专项练习的列表遍历查询有没有没做过的开始答题已满分重新答题继续答题增加页码等待初始化主页面监听关闭关闭窗口初始化子页面设置窗口初始化窗口打开窗口设置等待元素打开设置标题等待页面加载发送窗口关闭窗口关闭窗口窗口显示关闭标题关闭等待窗口任务结束窗口关闭等待窗口加载打开新窗口关闭窗口关闭子窗口等待窗口关闭关闭任务窗口同屏任务非同屏任务关闭任务窗口同屏任务子窗口打开并等待任务结束同屏任务窗口存在显示窗体新窗口等待窗口关闭子页面任务二维码刷新定时器尝试登录生成二维码正在生成登录二维码生成登录二维码成功链接生成登录二维码失败验证登录二维码尝试用二维码登录二维码登录临时登录验证码二维码失效清除定时设置定时尝试二维码登录正在获取签名获取签名生成安全检查刷新登录二维码清除刷新每隔一段时间刷新刷新二维码是否超出次数超过最大重试次数登录失败重置刷新数隐藏二维码远程推送推送登录推送超过最大重试次数登录失败登录推送成功失败配置图片刷新二维码刷新登录二维码刷新次数累加获取二维码获取连接开始登录远程推送跳转链接或在浏览器打开学习强国推送登录推送扫一扫登录学习强国登录推送成功失败获取验证码验证成功尝试登录清除刷新二维码显示登录成功登录成功创建提示登录成功登录成功刷新用户信息刷新分数信息刷新任务信息远程推送登录推送学习强国登录成功当天积分分总积分分登录推送成功失败二维码失效登录二维码失效二维码失效刷新退出登录删除关闭窗口退出登录清除用户信息总分当天分数任务进度重置退出登录退出登录新闻视频处理文章系统正在维护中文章选读未找到文章提示未找到文章关闭页面处理视频视频播放按键设置是否静音正在尝试播放视频播放超时视频播放超时提示视频播放超时关闭页面能播放正在尝试播放视频尝试使用的方式播放尝试点击播放按钮播放已经播放视听学习未找到视频关闭页面读新闻或者看视频为新闻为视频文章选读章节最大字数预计时间秒后关闭页面视听学习视频预计时间秒后关闭页面随机第一次滚动时间第二次滚动时间窗口创建提示距离关闭页面还剩暂停锁视频排除反复设置设置播放状态第一次滚动滚动模拟滚动模拟滑动模拟点击第二次滚动滚动长度滚动模拟滚动模拟滑动模拟点击倒计时结束关闭任务窗口获取新闻列表需要学习的新闻数量剩余个新闻获取新闻索引最新新闻当前年份查找今年新闻新闻是否存在获取视频列表需要学习的视频数量剩余个视频获取视频索引最新视频当前年份查找今年视频新闻是否存在阅读文章获取文章观看文章任务关闭跳出循环暂停正在阅读第个新闻创建提示正在阅读第个新闻链接链接等待任务窗口文章选读清空链接创建提示完成阅读第个新闻等待一段时间刷新分数数据刷新任务数据任务完成跳出循环任务关闭跳出循环任务完成状况任务未完成继续阅读新闻创建提示任务未完成继续阅读新闻观看视频获取视频观看视频任务关闭跳出循环暂停正在观看第个视频创建提示正在观看第个视频链接链接等待任务窗口视听学习清空链接创建提示完成观看第个视频等待一段时间刷新分数数据刷新任务数据任务完成跳出循环任务关闭跳出循环任务完成状况任务未完成继续观看视频创建提示任务未完成继续观看看视频定时刷新定时器刷新定时任务清除定时刷新未登录剩余定时任务存在剩余任务已设置的定时任务提示已设置的定时任务时间刷新间隔定时刷新正在运行到达定时执行的定时任务提示执行的定时任务登录清除定时创建学习提示提前去除延迟文字显示延迟显示销毁倒计时结束提示恢复显示倒计时结束操作隐藏销毁计时器结束插入节点显示刷新用户信息未登录用户未登录已存在信息加载用户信息获取用户信息设置昵称设置头像加载用户信息失败刷新分数信息未登录用户未登录加载分数信息获取总分获取当天总分整数值设置分数加载分数信息失败刷新任务列表未登录用户未登录加载任务进度原始任务进度登录文章选读视听学习每日答题更新数据进度百分比分数完成状态重试倒计时倒计时回调倒计时结束分隔符文本存在存在匹配清除关闭选项恢复文本保留文本答题按钮开启自动答题关闭自动答题任务窗口最大化容器同屏任务遮罩窗口内容窗口控制标题隐藏隐藏隐藏窗口改变大小缩放关闭关闭关闭窗口窗口内容隐藏窗口同屏任务设置窗口显示关闭窗口登录登录按钮开始登录扫码登录窗口未开启定时展示二维码开始登录信息用户信息头像昵称退出按钮退出登录退出刷新用户信息分数详情分数显示分数信息总积分查看分数详情当天分数当天分数积分详情刷新分数信息设置普通项设置任务项任务处理任务设置变化开关设置创建提示打开关闭登录加载加载任务列表未完成任务全局暂停加载完毕任务完毕任务按钮学习创建提示开始学习暂停文章选读任务一文章选读创建提示任务一文章选读暂停看新闻任务一文章选读已完成视听学习任务二视听学习创建提示任务二视听学习暂停看视频任务二视听学习已完成每日答题任务三每日答题创建提示任务三每日答题暂停做每日答题任务三每日答题已完成暂停任务全局暂停继续任务全局暂停开始任务未完成任务开始任务学习同屏任务关闭窗口窗口不存在提示错误提示错误刷新任务已完成创建提示完成学习远程推送推送学习推送学习强国学习完成当天积分分总积分分学习推送成功失败已在等待自动答题加载完毕自动答题等待中创建提示即将自动开始任务等待倒计时结束再次查看是否开启创建提示自动开始任务开始任务取消等待创建提示已取消自动开始任务切换开关任务未完成等待中开始学习正在学习点击暂停继续学习已完成定时项目定时刷新未开启定时刷新索引删除元素存储刷新任务暂无定时任务时间输入小时分钟设置面板组件小时分钟版本信息主题预设强国红非凡洋红经典蓝活珊瑚橘紫外光色草木绿站粉知乎蓝存储最大文章时长创建提示最大文章时长已保存存储最大视听时长创建提示最大视听时长已保存存储我的用户去除空格创建提示用户已保存存储保存设置时间定时刷新未开启定时刷新时间格式不符合要求重复定时存在设置定时任务重复设置定时任务成功添加排序存储清空刷新任务刷新远程推送刷新定时任务定时任务打开刷新定时任务清除任务面板运行设置标签自动开始启动时自动开始任务在倒计时结束前自动开始可随时取消如果在自动开始前手动开始任务此次自动开始将取消同屏任务运行任务时所有任务均在当前页面以弹窗方式运行静默运行同屏任务时不显示任务弹窗静默运行定时刷新定时刷新页面重新进行任务此功能需要长时间占用浏览器运行设置标签随机作答无答案时随机选择或者填入答案不保证正确推送设置标签远程推送利用推送将登录二维码直接推送到微信公众号处理设置变化开关设置创建提示打开关闭任务显示面板显示登录信息分数任务部分任务运行部分运行答题部分答题推送部分推送提示部分提示专项练习已被移除如需使用请点击去完成按钮集合窗口窗口显示面板设置重置任务配置设置最大阅读最大观看主题色刷新页面任务按钮',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-10 13:13:49',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f2b94b')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311071525033.webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://zhshio.cn/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311091058032.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/zhshio/EasySpring" title="EasySpring"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202312101409146.png" alt="EasySpring"/><span class="back-menu-item-text">EasySpring</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/zhshio/Shio-TinyDB" title="Shio-TinyDB"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202312101413777.jpg" alt="Shio-TinyDB"/><span class="back-menu-item-text">Shio-TinyDB</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Shio</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150771.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150771.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150143.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150143.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AQS/" style="font-size: 1.05rem;">AQS<sup>1</sup></a><a href="/tags/ArrayLists/" style="font-size: 1.05rem;">ArrayLists<sup>1</sup></a><a href="/tags/CountDownLatch/" style="font-size: 1.05rem;">CountDownLatch<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem;">JAVA<sup>1</sup></a><a href="/tags/JUC/" style="font-size: 1.05rem;">JUC<sup>2</sup></a><a href="/tags/JVM/" style="font-size: 1.05rem;">JVM<sup>6</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>1</sup></a><a href="/tags/Java%E6%BA%90%E7%A0%81/" style="font-size: 1.05rem;">Java源码<sup>2</sup></a><a href="/tags/Jottings/" style="font-size: 1.05rem;">Jottings<sup>1</sup></a><a href="/tags/MQ/" style="font-size: 1.05rem;">MQ<sup>1</sup></a><a href="/tags/MYSQL/" style="font-size: 1.05rem;">MYSQL<sup>2</sup></a><a href="/tags/NIO/" style="font-size: 1.05rem;">NIO<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF/" style="font-size: 1.05rem;">代码模板<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">学习工具<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 1.05rem;">日常<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 1.05rem;">生活<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>41</sup></a><a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">编译原理<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">计算机基础<sup>3</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E/" style="font-size: 1.05rem;">设计模式之美<sup>2</sup></a><a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 1.05rem;">转载<sup>35</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 1.05rem;">项目<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">47</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/08/"><span class="card-archive-list-date">八月 2019</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7/" itemprop="url">日常工具</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学习工具</span></a><a class="article-meta__tags" href="/tags/%E6%97%A5%E5%B8%B8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>日常</span></a></span></div></div><h1 class="post-title" itemprop="name headline">解放双手，每日强国</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="1970-01-01T03:45:14.000Z" title="发表于 1970-01-01 11:45:14">1970-01-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-01-10T05:13:49.141Z" title="更新于 2024-01-10 13:13:49">2024-01-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">28.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>157分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="解放双手，每日强国"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为晋中"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>晋中</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://www.toopic.cn/public/uploads/small/169124446876816912444684.jpg?_r_=a17d5a5d-d0d9-745e-6da4-ce292c21031f"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://zhshio.cn/posts/40882.html"><header><a class="post-meta-categories" href="/categories/%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7/" itemprop="url">日常工具</a><a href="/tags/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/" tabindex="-1" itemprop="url">学习工具</a><a href="/tags/%E6%97%A5%E5%B8%B8/" tabindex="-1" itemprop="url">日常</a><h1 id="CrawlerTitle" itemprop="name headline">解放双手，每日强国</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Shio</span><time itemprop="dateCreated datePublished" datetime="1970-01-01T03:45:14.000Z" title="发表于 1970-01-01 11:45:14">1970-01-01</time><time itemprop="dateCreated datePublished" datetime="2024-01-10T05:13:49.141Z" title="更新于 2024-01-10 13:13:49">2024-01-10</time></header><h1>解放双手，每日强国</h1>
<p>​		学习强国是好事,但有些学校功利性的算各种学分,大多数人以这种动机的学习显然更像是一种负担,其实如果大家有余力还是推荐自己学习</p>
<p>​		<em>本教程全程傻瓜式操作，适用于未使用过油猴和GitHub的小白，脚本内容搬运自：<a target="_blank" rel="noopener" href="https://github.com/Xu22Web/tech-study-js/issues%EF%BC%88%E4%BB%A3%E7%A0%81%E6%88%91%E4%BC%9A%E8%B4%B4%E5%9C%A8%E6%96%87%E7%AB%A0%E6%9C%AB%E5%B0%BE%EF%BC%8C%E5%86%8D%E6%AC%A1%E5%BC%BA%E8%B0%83%E6%88%91%E5%8F%AA%E6%98%AF%E6%90%AC%E8%BF%90%E5%B7%A5%EF%BC%8C%E5%A6%82%E6%9C%89%E4%BE%B5%E6%9D%83%E4%BC%9A%E7%AB%8B%E5%8D%B3%E5%88%A0%E9%99%A4%EF%BC%89">https://github.com/Xu22Web/tech-study-js/issues（代码我会贴在文章末尾，再次强调我只是搬运工，如有侵权会立即删除）</a></em></p>
<p>​		一年前的博客了,现在学习强国也做了很多&quot;改进&quot;,亲测目前只有<strong>自动刷视频和文章是无风险支持</strong>(***warning !!!***自动刷题会被警告,警告到一定次数会被封禁7~30天)</p>
<h2 id="一、安装油猴">一、安装油猴</h2>
<p>​		<em>已经安装过的可以跳过这里</em></p>
<ol>
<li>打开你的edge浏览器，点击扩展</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131226862.jpg" alt="img"></p>
<ol start="2">
<li>点击获取下图选项获取扩展</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227984.jpg" alt="img"></p>
<ol start="3">
<li>搜索框输入“tempermonkey”，搜索该扩展并获取</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227875.jpg" alt="img"></p>
<ol start="4">
<li>之后会有弹窗，点“添加扩展”</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227120.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227430.jpg" alt="img"></p>
<ol start="5">
<li>把目光聚焦到浏览器的右上方</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227455.jpg" alt="img"></p>
<ol start="6">
<li>这时候可能还看不到安装上的Tempermonkey(之后步骤简称油猴)，因为添加扩展后，默认设置是不可视的</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227521.jpg" alt="img"></p>
<ol start="7">
<li>按下图顺序点击，便可设置为工具栏可见了</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227990.jpg" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227805.jpg" alt="img"></p>
<h2 id="二、添加脚本">二、添加脚本</h2>
<ol start="8">
<li>按下图操作，会进入一个新的界面</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227043.jpg" alt="img"></p>
<ol start="9">
<li>新的界面如下</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227747.png" alt="img"></p>
<ol start="10">
<li>底下这些内容是可以编辑的，首先把原本的内容删掉</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227861.png" alt="img"></p>
<ol start="11">
<li>然后把从<a target="_blank" rel="noopener" href="https://github.com/Xu22Web/tech-study-js/issues">https://github.com/Xu22Web/tech-study-js/issues</a> (文章末尾的代码)Ctrl+A(全选)，然后Ctrl+C（复制），最后Ctrl+V（粘贴）到这里</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227559.png" alt="img"></p>
<ol start="12">
<li>Ctrl+S（保存），脚本就新建成功了，启用它</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131301723.png" alt="img"></p>
<h2 id="三、脚本使用">三、脚本使用</h2>
<ol start="13">
<li>
<p>进入学习强国网页版，<a target="_blank" rel="noopener" href="https://www.xuexi.cn/">学习强国 (xuexi.cn)</a>，然后扫码用户登录（这里就不截图演示了）</p>
</li>
<li>
<p>右上角的浮窗点，开始学习，之后什么都不用不做，慢慢等待完成即可；以后每天只需要重复最后两步，就可以懒人式斩获25分了</p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202309042118286.png" alt="image-20230904211513385"></p>
<p>代码如下:</p>
<p>代码比较长,复制时可能会卡一下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name   不学习何以强国</span></span><br><span class="line"><span class="comment">// @namespace   http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version   1.7.0</span></span><br><span class="line"><span class="comment">// @description   有趣的 `学习强国` 油猴插件。读文章,看视频，做习题。问题反馈： https://github.com/Xu22Web/tech-study-js/issues 。</span></span><br><span class="line"><span class="comment">// @author   原作者：techxuexi 荷包蛋。现作者：Xu22Web</span></span><br><span class="line"><span class="comment">// @match   https://www.xuexi.cn/*</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-practice.html</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-weekly-detail.html?id=*</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-paper-detail.html?id=*</span></span><br><span class="line"><span class="comment">// @match   https://login.xuexi.cn/login/xuexiWeb?appid=dingoankubyrfkttorhpou&amp;goto=https%3A%2F%2Foa.xuexi.cn&amp;type=1&amp;state=ffdea2ded23f45ab%2FKQreTlDFe1Id3B7BVdaaYcTMp6lsTBB%2Fs3gGevuMKfvpbABDEl9ymG3bbOgtpSN&amp;check_login=https%3A%2F%2Fpc-api.xuexi.cn</span></span><br><span class="line"><span class="comment">// @require   https://cdn.jsdelivr.net/npm/blueimp-md5@2.9.0</span></span><br><span class="line"><span class="comment">// @run-at   document-start</span></span><br><span class="line"><span class="comment">// @grant   GM_addStyle</span></span><br><span class="line"><span class="comment">// @grant   GM_setValue</span></span><br><span class="line"><span class="comment">// @grant   GM_getValue</span></span><br><span class="line"><span class="comment">// @grant   GM_openInTab</span></span><br><span class="line"><span class="comment">// @grant   unsafeWindow</span></span><br><span class="line"><span class="comment">// @updateURL   https://raw.githubusercontent.com/Xu22Web/tech-study-js/master/tech-study.js</span></span><br><span class="line"><span class="comment">// @downloadURL   https://raw.githubusercontent.com/Xu22Web/tech-study-js/master/tech-study.js</span></span><br><span class="line"><span class="comment">// @supportURL   https://github.com/Xu22Web</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="string">&#x27;* &#123;  -webkit-tap-highlight-color: transparent;&#125;:root &#123;  --themeColor: #fa3333;  --scale: 1;  font-size: calc(10px * var(--scale));&#125;@media (min-height: 678px) and (max-height: 768px) &#123;  :root &#123;    --scale: 0.8;  &#125;&#125;@media (max-height: 667px) &#123;  :root &#123;    --scale: 0.75;  &#125;&#125;@keyframes fade &#123;  from &#123;    opacity: 0.8;  &#125;  to &#123;    opacity: 0.4;    background: #ccc;  &#125;&#125;.egg_icon &#123;  width: 1em;  height: 1em;  fill: currentColor;&#125;.egg_hr_wrap &#123;  position: relative;  display: flex;  justify-content: center;  color: #ccc;&#125;.egg_hr_wrap .egg_hr &#123;  position: absolute;  top: 50%;  transform: translateY(-50%);  background: currentColor;  height: 0.1rem;  width: 30%;&#125;.egg_hr_wrap .egg_hr:nth-of-type(1) &#123;  left: 0;&#125;.egg_hr_wrap .egg_hr:nth-last-of-type(1) &#123;  right: 0;&#125;.egg_hr_title &#123;  font-size: 1.2rem;&#125;.egg_exam_btn &#123;  transition: background-color 80ms;  outline: none;  border: none;  padding: 1.2rem 2rem;  border-radius: 1.2rem;  cursor: pointer;  font-size: 1.8rem;  font-weight: bold;  text-align: center;  color: #ffffff;  background: #666777;&#125;.egg_exam_btn.manual &#123;  background: #e3484b;&#125;.egg_panel_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_panel_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 99999;  width: 100%;  height: 100%;  color: #333;  font-size: 1.6rem;  pointer-events: none;&#125;.egg_panel &#123;  position: absolute;  top: 5rem;  left: 1rem;  padding: 1.2rem 2rem;  border-radius: 1rem;  background: #ffffffe6;  backdrop-filter: blur(1rem);  box-shadow: 0 0 0.1rem 0.1rem #f1f1f1;  transition: 80ms ease-out;  pointer-events: all;&#125;.egg_panel.hide &#123;  left: 0;  transform: translateX(-100%);&#125;.egg_panel_wrap.mobile .egg_panel &#123;  top: 1rem;&#125;@media (min-height: 678px) and (max-height: 768px) &#123;  .egg_panel &#123;    top: 2rem;  &#125;&#125;@media (max-height: 667px) &#123;  .egg_panel &#123;    top: 1rem;  &#125;&#125;.egg_panel button &#123;  outline: none;  border: none;  padding: 0;  cursor: pointer;  background: none;&#125;.egg_panel .egg_btns_wrap &#123;  position: absolute;  left: 100%;  top: 50%;  transform: translate(-50%, -50%);  transition: 80ms ease;  z-index: 9;&#125;.egg_panel.hide .egg_btns_wrap &#123;  left: 100%;  transform: translate(0, -50%);&#125;.egg_panel .egg_btns_wrap button &#123;  border-radius: 50%;  width: 3rem;  height: 3rem;  padding: 0;  overflow: hidden;  border: 0.2rem solid currentColor;  color: white;  display: grid;  place-items: center;  font-size: 1.8rem;&#125;.egg_panel.hide .egg_panel_show_btn &#123;  background: var(--themeColor);&#125;.egg_panel .egg_panel_show_btn &#123;  background: #ccc;&#125;.egg_panel .egg_frame_show_btn &#123;  background: var(--themeColor);  margin-bottom: 1rem;&#125;.egg_panel .egg_frame_show_btn.hide &#123;  display: none;&#125;.egg_panel .egg_settings_show_btn &#123;  background: #ccc;  margin-top: 1rem;&#125;.egg_panel .egg_settings_show_btn.active &#123;  background: var(--themeColor);&#125;.egg_panel .egg_settings_reset_btn &#123;  background: #ccc;  margin-top: 1rem;&#125;.egg_panel .egg_settings_reset_btn:active &#123;  background: var(--themeColor);&#125;.egg_login_item &#123;  display: flex;  justify-content: center;  align-items: center;  flex-direction: column;  padding: 0.5rem 0;&#125;.egg_login_item .egg_login_btn &#123;  font-size: 1.4rem;  border-radius: 1rem;  transition: 80ms ease;  color: white;  background: var(--themeColor);  padding: 0.8rem 2.4rem;&#125;.egg_login_item .egg_login_btn:active &#123;  opacity: 0.8;&#125;.egg_login_item .egg_login_img_wrap &#123;  height: 0;  border-radius: 1rem;  transition: height 80ms ease;  overflow: hidden;&#125;.egg_login_item .egg_login_img_wrap.active &#123;  padding: 0.8rem;  margin-top: 0.8rem;  height: auto;  background: white;&#125;.egg_login_img_wrap .egg_login_img &#123;  width: 15rem;  height: 15rem;&#125;.egg_info_item .egg_login_btn &#123;  font-size: 1.4rem;  border-radius: 1rem;  transition: 80ms ease;  color: white;&#125;.egg_info_item .egg_login_btn:active &#123;  opacity: 0.8;&#125;.egg_info_item .egg_login_btn &#123;  background: #ccc;  padding: 0.4rem 0.8rem;&#125;.egg_info_item &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_info_item .egg_userinfo &#123;  display: flex;  justify-content: center;  align-items: center;  padding: 0.5rem 0;&#125;.egg_userinfo .egg_avatar .egg_avatar_nick,.egg_userinfo .egg_avatar .egg_avatar_img &#123;  height: 5rem;  width: 5rem;  border-radius: 50%;  background: var(--themeColor);  display: flex;  justify-content: center;  align-items: center;  text-overflow: ellipsis;  overflow: hidden;  white-space: nowrap;  font-size: 2rem;  color: white;&#125;.egg_userinfo .egg_nick &#123;  padding-left: 0.5rem;  text-overflow: ellipsis;  overflow: hidden;  white-space: nowrap;  max-width: 10rem;&#125;.egg_score_item .egg_scoreinfo &#123;  display: flex;  justify-content: space-between;  align-items: center;  padding: 0.5rem 0;&#125;.egg_scoreinfo .egg_totalscore,.egg_scoreinfo .egg_todayscore &#123;  font-size: 1.2rem;  user-select: none;&#125;.egg_scoreinfo .egg_totalscore span,.egg_scoreinfo .egg_todayscore .egg_todayscore_btn span &#123;  padding-left: 0.2rem;&#125;.egg_scoreinfo .egg_totalscore span,.egg_todayscore .egg_todayscore_btn span,.egg_todayscore .egg_score_details span &#123;  color: var(--themeColor);  font-weight: bold;&#125;.egg_scoreinfo .egg_todayscore &#123;  position: relative;&#125;.egg_todayscore .egg_todayscore_btn &#123;  display: flex;  align-items: center;&#125;.egg_todayscore_btn .egg_icon &#123;  opacity: 0.3;&#125;.egg_todayscore .egg_score_details &#123;  position: absolute;  left: calc(100% + 1rem);  top: 0;  background: #fffffff2;  border-radius: 0.5rem;  opacity: 1;  width: 10rem;  box-shadow: 0 0 0.1rem 0.1rem #f1f1f1;  transition: 80ms ease;  z-index: 9;&#125;.egg_todayscore .egg_score_details.hide &#123;  visibility: hidden;  opacity: 0;  left: 100%;&#125;.egg_score_details .egg_score_title &#123;  border-bottom: 0.1rem solid #eee;  padding: 0.5rem 0.8rem;  display: flex;  align-items: center;&#125;.egg_score_details .egg_score_title .egg_icon &#123;  font-size: 1.4rem;&#125;.egg_score_details .egg_score_title .egg_score_title_text &#123;  font-weight: bold;  padding-left: 0.2rem;&#125;.egg_score_details .egg_score_item &#123;  display: flex;  align-items: center;  justify-content: space-between;  padding: 0.5rem 0.8rem;&#125;.egg_task_list &#123;  position: relative;&#125;.egg_task_item &#123;  user-select: none;  min-height: 3rem;  min-width: 18rem;  display: flex;  align-items: center;  justify-content: space-between;  padding: 0.5rem 0;&#125;.egg_task_item .egg_label_wrap &#123;  flex-grow: 1;  padding-right: 0.5rem;&#125;.egg_label_wrap .egg_task_title_wrap &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_task_title_wrap .egg_task_progress_wrap &#123;  display: flex;  align-items: center;  font-size: 1.4rem;  width: 3.5rem;&#125;.egg_task_progress_wrap .egg_task_current &#123;  color: var(--themeColor);&#125;.egg_task_progress_wrap .egg_task_max &#123;  color: #999;  font-size: 1.2rem;&#125;.egg_label_wrap .egg_progress &#123;  display: flex;  justify-content: space-between;  align-items: center;  padding-top: 0.8rem;&#125;.egg_progress .egg_track &#123;  background: #ccc;  height: 0.5rem;  border-radius: 1rem;  flex: 1 1 auto;  overflow: hidden;&#125;.egg_progress .egg_track .egg_bar &#123;  height: 0.5rem;  background: var(--themeColor);  border-radius: 1rem;  width: 0;  transition: width 0.5s;&#125;.egg_setting_item &#123;  min-height: 3rem;  min-width: 18rem;  display: flex;  align-items: center;  justify-content: space-between;  box-sizing: border-box;&#125;.egg_setting_item .egg_label_wrap &#123;  flex-grow: 1;&#125;.egg_detail &#123;  background: #ccc;  color: white;  border-radius: 10rem;  font-size: 1.2rem;  width: 1.6rem;  height: 1.6rem;  margin-left: 0.4rem;  display: inline-block;  text-align: center;  line-height: 1.6rem;  cursor: pointer;&#125;.egg_switch &#123;  cursor: pointer;  margin: 0;  outline: 0;  appearance: none;  -webkit-appearance: none;  -moz-appearance: none;  position: relative;  width: 4.2rem;  height: 2.2rem;  background: #ccc;  border-radius: 5rem;  transition: background 0.3s;  --border-padding: 0.5rem;  box-shadow: -0.1rem 0 0.1rem -0.1rem #999 inset,    0.1rem 0 0.1rem -0.1rem #999 inset;&#125;.egg_switch::after &#123;  content: \&#x27;\&#x27;;  display: inline-block;  width: 1.4rem;  height: 1.4rem;  border-radius: 50%;  background: #fff;  box-shadow: 0 0 0.2rem #999;  transition: left 0.4s;  position: absolute;  top: calc(50% - (1.4rem / 2));  position: absolute;  left: var(--border-padding);&#125;.egg_switch:checked &#123;  background: var(--themeColor);&#125;.egg_switch:disabled &#123;  opacity: 0.5;  background: #ccc;&#125;.egg_switch:checked::after &#123;  left: calc(100% - var(--border-padding) - 1.4rem);&#125;.egg_tip_list &#123;  font-size: 1.2rem;  max-width: 18rem;  line-height: 2rem;  color: var(--themeColor);&#125;.egg_tip_list .egg_tip_btn &#123;  padding: 0.2rem 0.4rem;  background: #f1f1f1;  color: #333;&#125;.egg_tip_list .egg_tip_btn:disabled &#123;  opacity: 0.5;  background: #ccc;&#125;.egg_study_item &#123;  display: flex;  justify-content: center;  padding-top: 0.5rem;&#125;.egg_study_item .egg_study_btn &#123;  background: var(--themeColor);  padding: 0.8rem 2.4rem;  font-size: 1.4rem;  border-radius: 1rem;  color: white;  transition: 80ms ease;&#125;.egg_study_item .egg_study_btn:not(.loading):active &#123;  opacity: 0.8;&#125;.egg_study_item .egg_study_btn.loading &#123;  animation: fade 2s ease infinite alternate;&#125;.egg_study_item .egg_study_btn:disabled &#123;  background: #ccc;&#125;.egg_tip_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 999999;  width: 100%;  height: 100%;  pointer-events: none;&#125;.egg_tip_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_tip_wrap .egg_tip &#123;  position: absolute;  bottom: 2rem;  left: 2rem;  padding: 1.2rem 1.4rem;  border: none;  border-radius: 1rem;  background: var(--themeColor);  color: white;  font-size: 1.4rem;  transition: 200ms ease;  opacity: 0;  transform: scale(0.9) translateY(1rem);&#125;.egg_tip_wrap .egg_tip.active &#123;  opacity: 1;  transform: scale(1) translateY(0);&#125;.egg_tip_wrap .egg_tip.active.delay &#123;  opacity: 0.5;&#125;.egg_tip_wrap .egg_tip .egg_countdown &#123;  display: inline-block;  color: var(--themeColor);  background: white;  border-radius: 0.5rem;  padding: 0.2rem 0.4rem;  font-weight: bold;  margin-left: 0.4rem;  font-size: 1.2rem;&#125;.egg_frame_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 999;  width: 100%;  height: 100%;  visibility: visible;&#125;.egg_frame_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_frame_wrap.hide &#123;  visibility: hidden;&#125;.egg_frame_wrap.hide .egg_frame_mask,.egg_frame_wrap.hide .egg_frame_content_wrap &#123;  opacity: 0;&#125;.egg_frame_wrap.hide .egg_frame_content_wrap &#123;  transform: scale(0);&#125;.egg_frame_mask &#123;  background: #00000030;  width: 100%;  height: 100%;  opacity: 1;  transition: 200ms ease;&#125;.egg_frame_content_wrap &#123;  position: absolute;  width: 80%;  height: 80%;  top: 10%;  left: 10%;  display: flex;  flex-direction: column;  transition: 200ms ease;  border-radius: 1rem;  background: #ffffffe6;  backdrop-filter: blur(1rem);  overflow: hidden;  transform: scale(1);&#125;.egg_frame_content_wrap.max &#123;  top: 0;  left: 0;  width: 100%;  height: 100%;  border-radius: 0;&#125;.egg_frame_content_wrap .egg_frame_controls_wrap &#123;  width: 100%;  display: flex;  justify-content: space-between;  align-items: center;  box-sizing: border-box;&#125;.egg_frame_controls_wrap .egg_frame_title &#123;  padding: 1rem 2rem;  font-size: 1.6rem;&#125;.egg_frame_controls .egg_frame_btn &#123;  outline: none;  border: none;  background: none;  padding: 1rem 2rem;  transition: 80ms ease;  cursor: pointer;  color: #333;  font-size: 1.8rem;&#125;.egg_frame_controls .egg_frame_btn:active &#123;  opacity: 0.8;&#125;.egg_frame_wrap .egg_frame_content &#123;  width: 100%;  flex-grow: 1;  border-top: 0.1rem solid #ccc;  min-height: 40rem;  min-width: 30rem;  background: white;&#125;.egg_frame_content .egg_frame &#123;  width: 100%;  height: 100%;  outline: none;  border: none;&#125;.egg_time_input &#123;  display: inline-flex;  align-items: center;  justify-content: center;&#125;.egg_time_input .egg_hour_wrap,.egg_time_input .egg_minute_wrap &#123;  width: 4rem;&#125;.egg_time_input .egg_separator &#123;  padding: 0 0.5rem;  font-size: 1.5rem;&#125;.egg_settings_item &#123;  position: absolute;  top: 0;  left: 0;  width: 100%;  height: 100%;  pointer-events: none;  overflow: hidden;  border-radius: 1rem;&#125;.egg_settings_item .egg_settings &#123;  display: inline-flex;  flex-direction: column;  font-size: 1.4rem;  background: white;  border-radius: 1rem;  overflow: hidden;  width: 100%;  height: 100%;  pointer-events: all;  transform: translateX(100%);  transition: transform 300ms ease;  padding-top: 1rem;&#125;.egg_settings_item .egg_settings.active &#123;  transform: translateX(0);&#125;.egg_settings .egg_settings_label &#123;  padding-bottom: 1rem;  user-select: none;&#125;.egg_settings_item .egg_settings_version_wrap &#123;  padding: 1rem 2rem 0 2rem;  display: flex;  align-items: center;  justify-content: space-between;&#125;.egg_settings_version_wrap .egg_settings_version &#123;  color: #999;  display: flex;  align-items: center;&#125;.egg_settings_version .egg_settings_version_detail &#123;  color: #24292f;  font-size: 1.6rem;  width: 1.6rem;  height: 1.6rem;  margin-left: 0.4rem;&#125;.egg_settings_item .egg_settings_theme_wrap &#123;  padding: 1rem 2rem 0 2rem;&#125;.egg_settings_theme_wrap .egg_settings_theme_colors &#123;  display: flex;  align-items: center;  justify-content: space-between;&#125;.egg_settings_theme_color_wrap .egg_settings_theme_color &#123;  border-radius: 50%;  width: 1.6rem;  height: 1.6rem;  background: currentColor;&#125;.egg_settings .egg_settings_read_time_wrap,.egg_settings .egg_settings_watch_time_wrap &#123;  padding: 1rem 2rem 0 2rem;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_settings_read_time_wrap .egg_settings_label,.egg_settings_watch_time_wrap .egg_settings_label &#123;  padding: 0.5rem 0;&#125;.egg_settings_read_time_wrap .egg_select,.egg_settings_watch_time_wrap .egg_select &#123;  width: 6rem;&#125;.egg_settings .egg_settings_token_wrap &#123;  padding: 1rem 2rem 0 2rem;&#125;.egg_settings_token_wrap .egg_settings_token_input &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 1rem;  background: white;  border-radius: 0.2rem;  width: 100%;  box-sizing: border-box;  color: #ccc;&#125;.egg_settings_token_wrap .egg_settings_token_input.active &#123;  color: #333;&#125;.egg_settings_token_input::placeholder &#123;  color: #ccc;&#125;.egg_settings .egg_settings_submit_btn_wrap &#123;  text-align: right;  padding-top: 1rem;  display: none;&#125;.egg_settings .egg_settings_submit_btn_wrap.active &#123;  display: block;&#125;.egg_settings_submit_btn_wrap .egg_settings_submit_btn &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.5rem 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  cursor: pointer;&#125;.egg_settings_submit_btn_wrap .egg_settings_submit_btn:active &#123;  background: #eee;&#125;.egg_schedule &#123;  height: 100%;  display: flex;  flex-direction: column;&#125;.egg_schedule_time_wrap &#123;  padding: 1rem 2rem;  border-bottom: 0.1rem solid #eee;&#125;.egg_schedule_time .egg_schedule_label &#123;  padding-bottom: 1rem;  user-select: none;&#125;.egg_schedule_time .egg_schedule_time_input_wrap &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_schedule_time_input_wrap .egg_schedule_add_btn &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.5rem 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  cursor: pointer;&#125;.egg_schedule_time_input_wrap .egg_schedule_add_btn:active &#123;  background: #eee;&#125;.egg_schedule_list &#123;  height: 100%;  overflow: auto;&#125;.egg_schedule_list .egg_schedule_item &#123;  display: flex;  justify-content: space-between;  padding: 0.5rem 1.5rem;  font-size: 1.4rem;  border-bottom: 0.1rem solid #eee;&#125;.egg_schedule_list::-webkit-scrollbar &#123;  width: 0.4rem;  background: white;  border-radius: 0.2rem;&#125;.egg_schedule_list::-webkit-scrollbar-thumb &#123;  background: #ccc;  border-radius: 0.2rem;&#125;.egg_schedule_detail_time_wrap &#123;  display: flex;  align-items: center;&#125;.egg_schedule_detail_time_wrap.inactive &#123;  color: #ccc;&#125;.egg_schedule_detail_time_wrap .egg_schedule_detail_icon &#123;  padding-right: 0.4rem;  display: flex;  color: #ccc;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn &#123;  outline: none;  padding: 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  font-size: 1.4rem;  cursor: pointer;  color: #ccc;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn:hover &#123;  color: #333;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn:active &#123;  color: #eee;&#125;.egg_schedule_list .egg_schedule_list_none &#123;  width: 100%;  height: 100%;  display: flex;  flex-direction: column;  justify-content: center;  align-items: center;  color: #ccc;&#125;.egg_schedule_list_none .egg_icon &#123;  font-size: 2.5rem;&#125;.egg_schedule_list_none_text &#123;  padding-top: 1rem;&#125;.egg_select &#123;  position: relative;&#125;.egg_select .egg_select_input &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.8rem;  text-align: center;  background: white;  border-radius: 0.2rem;  display: inline-block;  width: 100%;  box-sizing: border-box;&#125;.egg_select .egg_select_input::placeholder &#123;  color: #ccc;&#125;.egg_select_list &#123;  max-height: 12rem;  border-radius: 0 0 0.2rem 0.2rem;  box-shadow: 0 0.1rem 0.1rem 0.1rem #eee;  background: white;  user-select: none;  transition: 100ms ease;  scrollbar-width: thin;  overflow: auto;  opacity: 1;  z-index: 9;  width: 100%;  position: absolute;&#125;.egg_select_list.hide &#123;  opacity: 0;  visibility: hidden;&#125;.egg_select_list::-webkit-scrollbar &#123;  width: 0.4rem;  background: white;  border-radius: 0.2rem;&#125;.egg_select_list::-webkit-scrollbar-thumb &#123;  background: #ccc;  border-radius: 0.2rem;&#125;.egg_select_list .egg_select_item &#123;  padding: 0.6rem 1rem;  border-bottom: 0.1rem solid #eee;  cursor: pointer;  color: #333;  transition: 300ms ease;  text-align: center;&#125;.egg_select_list .egg_select_item.selected &#123;  font-weight: bold;  background: #f6f6f6;&#125;.egg_select_list .egg_select_item.active &#123;  background: #eee;&#125;.egg_select_list .egg_select_item:hover &#123;  background: #eee;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 嵌入样式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">GM_addStyle</span>(css);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href.<span class="title function_">match</span>(<span class="variable constant_">URL_CONFIG</span>.<span class="property">home</span>), <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化logo</span></span><br><span class="line">    <span class="title function_">initLogo</span>();</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入主页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化任务配置</span></span><br><span class="line">    <span class="title function_">initTaskConfig</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化主页面</span></span><br><span class="line">    <span class="title function_">initMainListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 渲染面板</span></span><br><span class="line">    <span class="title function_">renderPanel</span>();</span><br><span class="line">    <span class="comment">// 渲染窗口</span></span><br><span class="line">    <span class="title function_">renderFrame</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="title function_">GM_getValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入文章选读页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 最大阅读</span></span><br><span class="line">    <span class="title function_">initMaxRead</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 处理文章</span></span><br><span class="line">    <span class="title function_">handleNews</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="title function_">GM_getValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入视听学习页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 最大视听</span></span><br><span class="line">    <span class="title function_">initMaxWatch</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 处理视频</span></span><br><span class="line">    <span class="title function_">handleVideo</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="variable constant_">URL_CONFIG</span>.<span class="property">examPractice</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入每日答题页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 创建答题按钮</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">renderExamBtn</span>();</span><br><span class="line">    <span class="comment">// 开始答题</span></span><br><span class="line">    <span class="title function_">doingExam</span>(<span class="title class_">ExamType</span>.<span class="property">PRACTICE</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href.<span class="title function_">includes</span>(<span class="variable constant_">URL_CONFIG</span>.<span class="property">examPaper</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入专项练习页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 创建答题按钮</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">renderExamBtn</span>();</span><br><span class="line">    <span class="comment">// 开始答题</span></span><br><span class="line">    <span class="title function_">doingExam</span>(<span class="title class_">ExamType</span>.<span class="property">PAPER</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化logo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLogo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`%c tech-study.js %c <span class="subst">$&#123;version&#125;</span> `</span>, <span class="string">&#x27;background:dodgerblue;color:white;font-size:15px;border-radius:4px 0 0 4px;padding:2px 0;&#x27;</span>, <span class="string">&#x27;background:black;color:gold;font-size:15px;border-radius:0 4px 4px 0;padding:2px 0;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initTaskConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> configTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>));</span><br><span class="line">        <span class="keyword">if</span> (configTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(configTemp)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (configTemp.<span class="property">length</span> === taskConfig.<span class="property">length</span>) &#123;</span><br><span class="line">                taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task, i</span>) =&gt;</span> &#123;</span><br><span class="line">                    task.<span class="property">active</span> = configTemp[i].<span class="property">active</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initSettings</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> settingsTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;studySettings&#x27;</span>));</span><br><span class="line">        <span class="keyword">if</span> (settingsTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(settingsTemp)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (settingsTemp.<span class="property">length</span> === settings.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> settingsTemp) &#123;</span><br><span class="line">                    settings[i] = settingsTemp[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initFontSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 移动端</span></span><br><span class="line">    <span class="keyword">const</span> moblie = <span class="title function_">hasMobile</span>();</span><br><span class="line">    <span class="keyword">if</span> (moblie) &#123;</span><br><span class="line">        <span class="comment">// 清除缩放</span></span><br><span class="line">        <span class="keyword">const</span> meta = $$(<span class="string">&#x27;meta[name=viewport]&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (meta) &#123;</span><br><span class="line">            meta.<span class="property">content</span> = <span class="string">&#x27;initial-scale=0, user-scalable=yes&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 缩放比例</span></span><br><span class="line">        <span class="keyword">const</span> scale = ~~(<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">outerWidth</span>) || <span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--scale&#x27;</span>, <span class="title class_">String</span>(scale));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化最大阅读时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMaxRead</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> maxReadTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxRead&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (maxReadTemp) &#123;</span><br><span class="line">            maxRead.<span class="property">value</span> = maxReadTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化最大视听时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMaxWatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> maxWatchTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (maxWatchTemp) &#123;</span><br><span class="line">            maxWatch.<span class="property">value</span> = maxWatchTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化主题色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initThemeColor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 监听主题变化</span></span><br><span class="line">        <span class="title function_">watch</span>(themeColor, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置主题</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--themeColor&#x27;</span>, themeColor.<span class="property">value</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 主题色</span></span><br><span class="line">        <span class="keyword">const</span> themeColorTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;themeColor&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (themeColorTemp) &#123;</span><br><span class="line">            themeColor.<span class="property">value</span> = themeColorTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderTip</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tipWrap = <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_tip_wrap&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">mountElement</span>(tipWrap);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderExamBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> titles = <span class="keyword">await</span> $_(<span class="string">&#x27;.title&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (titles.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 插入节点</span></span><br><span class="line">        titles[<span class="number">0</span>].<span class="property">parentNode</span>?.<span class="title function_">insertBefore</span>(<span class="title class_">ExamBtn</span>().<span class="property">ele</span>, titles[<span class="number">0</span>].<span class="property">nextSibling</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染面板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderPanel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 面板</span></span><br><span class="line">    <span class="keyword">const</span> panel = <span class="title class_">Panel</span>();</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(panel);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 窗口</span></span><br><span class="line">    <span class="keyword">const</span> frame = <span class="title class_">Frame</span>();</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(frame);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 答案 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取答案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAnswer</span>(<span class="params">question</span>) &#123;</span><br><span class="line">    <span class="comment">// 数据</span></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">txt_name</span>: <span class="title function_">md5</span>(question),</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="comment">// 请求</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">answerSearch</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">const</span> &#123; data, status &#125; = result;</span><br><span class="line">            <span class="keyword">if</span> (status !== <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 答案列表</span></span><br><span class="line">                <span class="keyword">const</span> answerList = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data.<span class="property">txt_content</span>);</span><br><span class="line">                <span class="comment">// 答案</span></span><br><span class="line">                <span class="keyword">const</span> answers = answerList[<span class="number">0</span>].<span class="property">content</span>.<span class="title function_">split</span>(<span class="regexp">/[;\s]/</span>);</span><br><span class="line">                <span class="keyword">return</span> answers;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 保存答案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">saveAnswer</span>(<span class="params">question, answer</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 内容</span></span><br><span class="line">        <span class="keyword">const</span> content = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([&#123; <span class="attr">title</span>: <span class="title function_">md5</span>(question), <span class="attr">content</span>: answer &#125;]);</span><br><span class="line">        <span class="comment">// 数据</span></span><br><span class="line">        <span class="keyword">const</span> data = &#123;</span><br><span class="line">            <span class="attr">txt_name</span>: <span class="title function_">md5</span>(question),</span><br><span class="line">            <span class="attr">txt_content</span>: content,</span><br><span class="line">            <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">v_id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="comment">// 请求</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">answerSave</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 数据 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取新闻数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getNewsList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    <span class="keyword">const</span> randNum = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable constant_">API_CONFIG</span>.<span class="property">todayNews</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取重要新闻</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayNews</span>[randNum], &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取视频数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getVideoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    <span class="keyword">const</span> randNum = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable constant_">API_CONFIG</span>.<span class="property">todayVideos</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取重要新闻</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayVideos</span>[randNum], &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 专项练习数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getExamPaper</span>(<span class="params">pageNo</span>) &#123;</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;API_CONFIG.paperList&#125;</span>?pageSize=50&amp;pageNo=<span class="subst">$&#123;pageNo&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取专项练习</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">const</span> paperJson = <span class="built_in">decodeURIComponent</span>(<span class="built_in">escape</span>(<span class="variable language_">window</span>.<span class="title function_">atob</span>(data.<span class="property">data_str</span>.<span class="title function_">replace</span>(<span class="regexp">/-/g</span>, <span class="string">&#x27;+&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/_/g</span>, <span class="string">&#x27;/&#x27;</span>))));</span><br><span class="line">            <span class="comment">// JSON格式化</span></span><br><span class="line">            <span class="keyword">const</span> paper = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(paperJson);</span><br><span class="line">            <span class="keyword">return</span> paper;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateQRCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">generateQRCode</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> data.<span class="property">result</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用二维码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loginWithQRCode</span>(<span class="params">qrCode</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">            qrCode,</span><br><span class="line">            <span class="attr">goto</span>: <span class="string">&#x27;https://oa.xuexi.cn&#x27;</span>,</span><br><span class="line">            <span class="attr">pdmToken</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">loginWithQRCode</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded;charset=UTF-8&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 签名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getSign</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">sign</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">ok</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> data.<span class="property">data</span>.<span class="property">sign</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 安全检查</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">data</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">secureCheck</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;API_CONFIG.secureCheck&#125;</span>?<span class="subst">$&#123;params&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data.<span class="property">success</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 推送 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushPlus</span>(<span class="params">token, title, content, template, toToken</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 参数体</span></span><br><span class="line">        <span class="keyword">const</span> body = &#123;</span><br><span class="line">            token,</span><br><span class="line">            title,</span><br><span class="line">            content,</span><br><span class="line">            template,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 好友令牌</span></span><br><span class="line">        <span class="keyword">if</span> (toToken) &#123;</span><br><span class="line">            body.<span class="property">to</span> = toToken;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">push</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(body),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 用户 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">userInfo</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取总积分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTotalScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">totalScore</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; score &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取当天总积分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTodayScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayScore</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 当天总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; score &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取任务列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">taskList</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 进度和当天总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; taskProgress &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> taskProgress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* task·配置 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 单次最大新闻数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxNewsNum = <span class="number">6</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 单次最大视频数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxVideoNum = <span class="number">6</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码最大刷新次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxRefreshCount = <span class="number">10</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码自动刷新间隔</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> autoRefreshQRCodeInterval = <span class="number">100000</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频静音</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> muted = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> url配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">URL_CONFIG</span> = &#123;</span><br><span class="line">    <span class="comment">// 主页正则</span></span><br><span class="line">    <span class="attr">home</span>: <span class="regexp">/^https\:\/\/www\.xuexi\.cn(\/(index\.html)?)?$/</span>,</span><br><span class="line">    <span class="comment">// 主页</span></span><br><span class="line">    <span class="attr">homeOrigin</span>: <span class="string">&#x27;https://www.xuexi.cn&#x27;</span>,</span><br><span class="line">    <span class="comment">// 每日答题页面</span></span><br><span class="line">    <span class="attr">examPractice</span>: <span class="string">&#x27;https://pc.xuexi.cn/points/exam-practice.html&#x27;</span>,</span><br><span class="line">    <span class="comment">// 专项练习页面</span></span><br><span class="line">    <span class="attr">examPaper</span>: <span class="string">&#x27;https://pc.xuexi.cn/points/exam-paper-detail.html&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> api配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_CONFIG</span> = &#123;</span><br><span class="line">    <span class="comment">// 用户信息</span></span><br><span class="line">    <span class="attr">userInfo</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/open/api/user/info&#x27;</span>,</span><br><span class="line">    <span class="comment">// 总分</span></span><br><span class="line">    <span class="attr">totalScore</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/get&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当天分数</span></span><br><span class="line">    <span class="attr">todayScore</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/today/query&#x27;</span>,</span><br><span class="line">    <span class="comment">// 任务列表</span></span><br><span class="line">    <span class="attr">taskList</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/days/listScoreProgress?sence=score&amp;deviceType=2&#x27;</span>,</span><br><span class="line">    <span class="comment">// 新闻数据</span></span><br><span class="line">    <span class="attr">todayNews</span>: [</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/35il6fpn0ohq.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1ap1igfgdn2.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/vdppiu92n1.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/152mdtl3qn1.json&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 视频数据</span></span><br><span class="line">    <span class="attr">todayVideos</span>: [</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/525pi8vcj24p.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/11vku6vt6rgom.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/2qfjjjrprmdh.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/3o3ufqgl8rsn.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/591ht3bc22pi.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1742g60067k.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1novbsbi47k.json&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 专项练习列表</span></span><br><span class="line">    <span class="attr">paperList</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/api/exam/service/paper/pc/list&#x27;</span>,</span><br><span class="line">    <span class="comment">// 文本服务器保存答案</span></span><br><span class="line">    <span class="attr">answerSave</span>: <span class="string">&#x27;https://a6.qikekeji.com/txt/data/save&#x27;</span>,</span><br><span class="line">    <span class="comment">// 文本服务器获取答案</span></span><br><span class="line">    <span class="attr">answerSearch</span>: <span class="string">&#x27;https://a6.qikekeji.com/txt/data/detail&#x27;</span>,</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="attr">push</span>: <span class="string">&#x27;https://www.pushplus.plus/send&#x27;</span>,</span><br><span class="line">    <span class="comment">// 生成二维码</span></span><br><span class="line">    <span class="attr">generateQRCode</span>: <span class="string">&#x27;https://login.xuexi.cn/user/qrcode/generate&#x27;</span>,</span><br><span class="line">    <span class="comment">//二维码登录</span></span><br><span class="line">    <span class="attr">loginWithQRCode</span>: <span class="string">&#x27;https://login.xuexi.cn/login/login_with_qr&#x27;</span>,</span><br><span class="line">    <span class="comment">// 签名</span></span><br><span class="line">    <span class="attr">sign</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/open/api/sns/sign&#x27;</span>,</span><br><span class="line">    <span class="comment">// 安全检查</span></span><br><span class="line">    <span class="attr">secureCheck</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/login/secure_check&#x27;</span>,</span><br><span class="line">    <span class="comment">// 二维码</span></span><br><span class="line">    <span class="attr">qrcode</span>: <span class="string">&#x27;https://api.qrserver.com/v1/create-qr-code&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 版本号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> version = <span class="string">&#x27;1.7.0&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TaskType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">TaskType</span>) &#123;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;LOGIN&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;LOGIN&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;READ&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;READ&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;WATCH&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;WATCH&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;PRACTICE&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;PRACTICE&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">TaskType</span> || (<span class="title class_">TaskType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SettingType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">SettingType</span>) &#123;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;AUTO_START&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;AUTO_START&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SAME_TAB&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;SAME_TAB&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SILENT_RUN&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;SILENT_RUN&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SCHEDULE_RUN&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;SCHEDULE_RUN&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;RANDOM_EXAM&quot;</span>] = <span class="number">4</span>] = <span class="string">&quot;RANDOM_EXAM&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;REMOTE_PUSH&quot;</span>] = <span class="number">5</span>] = <span class="string">&quot;REMOTE_PUSH&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">SettingType</span> || (<span class="title class_">SettingType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 进度类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TaskStatusType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">TaskStatusType</span>) &#123;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;LOADING&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;LOADING&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;LOADED&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;LOADED&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;START&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;START&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;PAUSE&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;PAUSE&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;FINISH&quot;</span>] = <span class="number">4</span>] = <span class="string">&quot;FINISH&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">TaskStatusType</span> || (<span class="title class_">TaskStatusType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">// 当前订阅</span></span><br><span class="line"><span class="keyword">let</span> currentSub;</span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="keyword">const</span> subscription = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Proxy Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 收集 Ref 依赖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">trackRef</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当前订阅</span></span><br><span class="line">    <span class="keyword">if</span> (!currentSub) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">let</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="comment">// 不存在订阅列表</span></span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        subList = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        <span class="keyword">const</span> subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(<span class="string">&#x27;value&#x27;</span>, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(<span class="string">&#x27;value&#x27;</span>, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加订阅</span></span><br><span class="line">    subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 通知 Ref 订阅</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">terget</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">triggerRef</span>(<span class="params">target, newVal, oldVal</span>) &#123;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">const</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知订阅</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> subkeyList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fn <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="title function_">fn</span>(newVal, oldVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 收集依赖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">track</span> = (<span class="params">target, key</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当前订阅</span></span><br><span class="line">    <span class="keyword">if</span> (!currentSub) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// proxy</span></span><br><span class="line">    <span class="keyword">const</span> proxyTarget = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!proxyTarget) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">let</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="comment">// 不存在订阅列表</span></span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        subList = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        <span class="keyword">const</span> subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(key, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(key, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加订阅</span></span><br><span class="line">    subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 通知订阅</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">terget</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key, newVal, oldVal</span>) &#123;</span><br><span class="line">    <span class="comment">// proxy</span></span><br><span class="line">    <span class="keyword">const</span> proxyTarget = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!proxyTarget) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// proxyTarget 订阅列表</span></span><br><span class="line">    <span class="keyword">const</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知订阅</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> subkeyList) &#123;</span><br><span class="line">        <span class="title function_">fn</span>(newVal, oldVal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 只读键</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ReactiveFlags</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">ReactiveFlags</span>) &#123;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_REF&quot;</span>] = <span class="string">&quot;_isRef&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_SHALLOW&quot;</span>] = <span class="string">&quot;_isShallow&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_REACTIVE&quot;</span>] = <span class="string">&quot;_isReactive&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_READONLY&quot;</span>] = <span class="string">&quot;_isReadonly&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">ReactiveFlags</span> || (<span class="title class_">ReactiveFlags</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">Ref</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ref</span> &#123;</span><br><span class="line">    _isShallow = <span class="literal">false</span>;</span><br><span class="line">    _isRef = <span class="literal">true</span>;</span><br><span class="line">    _value;</span><br><span class="line">    value;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">val, shallow = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShallow</span> = shallow;</span><br><span class="line">        <span class="keyword">if</span> (val &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span> &amp;&amp; shallow) &#123;</span><br><span class="line">            <span class="keyword">const</span> reactiveVal = <span class="title function_">reactive</span>(val);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = reactiveVal;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = reactiveVal;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = val;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 定义属性</span></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, <span class="string">&#x27;value&#x27;</span>, &#123;</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 收集依赖</span></span><br><span class="line">                <span class="title function_">trackRef</span>(<span class="variable language_">this</span>);</span><br><span class="line">                <span class="keyword">return</span> _this.<span class="property">_value</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">                <span class="comment">// 旧数据</span></span><br><span class="line">                <span class="keyword">const</span> oldVal = <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">                <span class="comment">// 数据变化</span></span><br><span class="line">                <span class="keyword">if</span> (oldVal !== newVal) &#123;</span><br><span class="line">                    <span class="comment">// 设置新数据值</span></span><br><span class="line">                    _this.<span class="property">_value</span> = newVal;</span><br><span class="line">                    <span class="comment">// 通知依赖</span></span><br><span class="line">                    <span class="title function_">triggerRef</span>(<span class="variable language_">this</span>, newVal, oldVal);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">toJSON</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">ref</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isRef</span> = (<span class="params">v</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(v &amp;&amp; v[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REF</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 浅层 shallow</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isShallow</span> = (<span class="params">v</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(v &amp;&amp; v[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createRef</span> = (<span class="params">rawVal, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ref</span>(rawVal, shallow);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 解除 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">unref</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">isRef</span>(val) ? val.<span class="property">value</span> : val);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ref</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isRef</span>(value)</span><br><span class="line">        ? value</span><br><span class="line">        : <span class="title function_">createRef</span>(value, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">ref</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowRef</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isRef</span>(value)</span><br><span class="line">        ? value</span><br><span class="line">        : <span class="title function_">createRef</span>(value, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建处理 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isReadonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isShallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactiveHandlers</span> = (<span class="params">isReadonly, isShallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="title function_">createGetters</span>(isReadonly, isShallow),</span><br><span class="line">        <span class="attr">set</span>: <span class="title function_">createSetters</span>(isReadonly, isShallow),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">getters</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isReadonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isShallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createGetters</span> = (<span class="params">isReadonly, isShallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> !isReadonly;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> isReadonly;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> isShallow;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 结果</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">        <span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">            <span class="comment">// 收集依赖</span></span><br><span class="line">            <span class="title function_">track</span>(target, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isShallow) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(res)) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="property">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (res &amp;&amp; <span class="keyword">typeof</span> res === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res <span class="keyword">instanceof</span> <span class="title class_">Element</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> isReadonly ? <span class="title function_">readonly</span>(res) : <span class="title function_">reactive</span>(res);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">setters</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">readonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">shallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createSetters</span> = (<span class="params">readonly, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">target, key, newVal, receiver</span>) &#123;</span><br><span class="line">        <span class="comment">// 只读</span></span><br><span class="line">        <span class="keyword">if</span> (readonly) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 旧值</span></span><br><span class="line">        <span class="keyword">const</span> oldVal = target[key];</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(oldVal) &amp;&amp; <span class="title function_">isRef</span>(oldVal) &amp;&amp; !<span class="title function_">isRef</span>(newVal)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!shallow) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(oldVal) &amp;&amp; !<span class="title function_">isRef</span>(newVal)) &#123;</span><br><span class="line">                oldVal.<span class="property">value</span> = newVal;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newVal, receiver);</span><br><span class="line">        <span class="comment">// length</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) &amp;&amp; key === <span class="string">&#x27;length&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 通知依赖</span></span><br><span class="line">            <span class="title function_">trigger</span>(target, key, newVal, oldVal);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 数据变化</span></span><br><span class="line">        <span class="keyword">if</span> (oldVal !== newVal) &#123;</span><br><span class="line">            <span class="comment">// 通知依赖</span></span><br><span class="line">            <span class="title function_">trigger</span>(target, key, newVal, oldVal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> reactive object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactiveObj</span> = (<span class="params">target, isReadonly, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 存在 Proxy</span></span><br><span class="line">    <span class="keyword">const</span> existingProxy = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (existingProxy) &#123;</span><br><span class="line">        <span class="keyword">return</span> existingProxy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新建</span></span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, <span class="title function_">createReactiveHandlers</span>(isReadonly, shallow));</span><br><span class="line">    proxyMap.<span class="title function_">set</span>(target, proxy);</span><br><span class="line">    <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isReactive</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(val &amp;&amp; val[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowReactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isReadonly</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(val &amp;&amp; val[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 readonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReadonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 readonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowReadonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">proxy</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isProxy</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isReactive</span>(val) || <span class="title function_">isReadonly</span>(val);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactive</span>(target);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">readonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">readonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReadonly</span>(target);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听数据变化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">source</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watch</span> = (<span class="params">source, callback, immediate = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 立刻执行</span></span><br><span class="line">    immediate &amp;&amp; <span class="title function_">callback</span>(<span class="title function_">unref</span>(source), <span class="title function_">unref</span>(source));</span><br><span class="line">    <span class="comment">// array</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(source) &amp;&amp; source.<span class="title function_">every</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">isRef</span>(s))) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> source) &#123;</span><br><span class="line">            <span class="comment">// Proxy</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source[i])) &#123;</span><br><span class="line">                <span class="title function_">watch</span>(source[i], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = source.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">unref</span>(s));</span><br><span class="line">                    <span class="title function_">callback</span>(res, res);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> source.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">unref</span>(s)), callback);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// function</span></span><br><span class="line">    <span class="keyword">if</span> (source <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">        <span class="title function_">watch</span>(<span class="title function_">watchEffectRef</span>(source), <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">callback</span>(<span class="title function_">unref</span>(n), <span class="title function_">unref</span>(o));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Proxy</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">            currentSub = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(source, source);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// sub source</span></span><br><span class="line">            <span class="keyword">const</span> subSource = source[key];</span><br><span class="line">            currentSub = <span class="literal">undefined</span>;</span><br><span class="line">            <span class="title function_">watch</span>(subSource, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(source, source);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(source)) &#123;</span><br><span class="line">        <span class="comment">// Ref.value Proxy</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source.<span class="property">value</span>)) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(source.<span class="property">value</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(<span class="title function_">unref</span>(source), <span class="title function_">unref</span>(source));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        currentSub = callback;</span><br><span class="line">        <span class="comment">// 收集依赖</span></span><br><span class="line">        <span class="title function_">trackRef</span>(source);</span><br><span class="line">        currentSub = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听数据变化影响</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchEffect</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">    currentSub = callback;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">    currentSub = <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听影响 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">refVal</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchRef</span> = (<span class="params">source, callback</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="keyword">const</span> effectRes = <span class="title function_">shallowRef</span>(<span class="title function_">callback</span>());</span><br><span class="line">    <span class="comment">// 监听</span></span><br><span class="line">    <span class="title function_">watch</span>(source, <span class="function">() =&gt;</span> (effectRes.<span class="property">value</span> = <span class="title function_">unref</span>(<span class="title function_">callback</span>())));</span><br><span class="line">    <span class="keyword">return</span> effectRes;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听影响 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">refVal</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchEffectRef</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="keyword">const</span> effectRes = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="comment">// 监听</span></span><br><span class="line">    <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> (effectRes.<span class="property">value</span> = <span class="title function_">unref</span>(<span class="title function_">callback</span>())));</span><br><span class="line">    <span class="keyword">return</span> effectRes;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建元素节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eleName</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElementNode</span>(<span class="params">tagName, props, attrs, children, options</span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> beforemount = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> mounted = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; onMounted, beforeMount &#125; = e;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(beforemount, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (beforemount.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">beforeMount</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (onMounted) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(mounted, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mounted.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">unsubscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">//懒得写</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// 创建普通元素</span></span><br><span class="line">    <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tagName);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleProps</span>(ele, props);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleAttributes</span>(ele, attrs, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 处理子元素</span></span><br><span class="line">    <span class="title function_">handleChildren</span>(ele, children, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 收集挂载前</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectBeforeMount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        beforemount.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 收集挂载</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectOnMounted</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        mounted.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; ele, <span class="attr">beforeMount</span>: collectBeforeMount, <span class="attr">onMounted</span>: collectOnMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建svg元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">tagName</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNSElementNode</span>(<span class="params">tagName, props, attrs, children, options</span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> beforemount = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> mounted = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; onMounted, beforeMount &#125; = e;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(beforemount, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (beforemount.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">beforeMount</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (onMounted) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(mounted, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mounted.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">unsubscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">//懒得写</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// svg元素命名空间</span></span><br><span class="line">    <span class="keyword">const</span> ns = <span class="string">&#x27;http://www.w3.org/2000/svg&#x27;</span>;</span><br><span class="line">    <span class="comment">// 创建svg元素</span></span><br><span class="line">    <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(ns, tagName);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleProps</span>(ele, props);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleAttributes</span>(ele, attrs, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 处理子元素</span></span><br><span class="line">    <span class="title function_">handleChildren</span>(ele, children, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 收集挂载前</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectBeforeMount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        beforemount.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 收集挂载</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectOnMounted</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        mounted.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; ele, <span class="attr">beforeMount</span>: collectBeforeMount, <span class="attr">onMounted</span>: collectOnMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleProps</span>(<span class="params">ele, props</span>) &#123;</span><br><span class="line">    <span class="comment">// props属性设置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">        <span class="comment">// Ref 属性</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(props[key])) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = props[key];</span><br><span class="line">            <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> (ele[key] = refVal.<span class="property">value</span>));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ele[key] = props[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理svg属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAttributes</span>(<span class="params">ele, attrs, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// 属性存在</span></span><br><span class="line">    <span class="keyword">if</span> (attrs) &#123;</span><br><span class="line">        <span class="comment">// attrs属性设置</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> attrs) &#123;</span><br><span class="line">            <span class="comment">// 处理普通属性</span></span><br><span class="line">            <span class="title function_">handleAttribute</span>(ele, key, attrs[key], subscribe, unsubscribe);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理事件选项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleEventOptions</span>(<span class="params">option</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (option.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> options = &#123;</span><br><span class="line">            <span class="attr">capture</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;capture&#x27;</span>),</span><br><span class="line">            <span class="attr">once</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;once&#x27;</span>),</span><br><span class="line">            <span class="attr">passive</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;passive&#x27;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAttribute</span>(<span class="params">ele, key, value, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// 处理完的key</span></span><br><span class="line">    <span class="keyword">const</span> formatKey = key.<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="comment">// 事件绑定</span></span><br><span class="line">    <span class="keyword">if</span> (formatKey.<span class="title function_">startsWith</span>(<span class="string">&#x27;on&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 事件监听</span></span><br><span class="line">        <span class="keyword">const</span> [event] = formatKey.<span class="title function_">match</span>(<span class="regexp">/(?&lt;=on).*/</span>);</span><br><span class="line">        <span class="comment">// 事件类型</span></span><br><span class="line">        <span class="keyword">if</span> (event) &#123;</span><br><span class="line">            <span class="keyword">const</span> [eventType, ...option] = event.<span class="title function_">split</span>(<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> options = <span class="title function_">handleEventOptions</span>(option);</span><br><span class="line">            <span class="comment">// Ref 函数</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">const</span> refVal = value;</span><br><span class="line">                <span class="keyword">const</span> refListener = <span class="title function_">watchRef</span>(refVal, <span class="function">() =&gt;</span> refVal.<span class="property">value</span></span><br><span class="line">                    ? <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                        option.<span class="title function_">includes</span>(<span class="string">&#x27;prevent&#x27;</span>) &amp;&amp; e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                        option.<span class="title function_">includes</span>(<span class="string">&#x27;stop&#x27;</span>) &amp;&amp; e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                        <span class="keyword">const</span> callback = refVal.<span class="property">value</span>;</span><br><span class="line">                        <span class="title function_">callback</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    : <span class="literal">undefined</span>);</span><br><span class="line">                <span class="comment">// 设置事件监听</span></span><br><span class="line">                refListener.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                    ele.<span class="title function_">addEventListener</span>(eventType, refListener.<span class="property">value</span>, options);</span><br><span class="line">                <span class="comment">// 监听事件变化</span></span><br><span class="line">                <span class="title function_">watch</span>(refListener, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 移除旧事件监听</span></span><br><span class="line">                    oldVal &amp;&amp; ele.<span class="title function_">removeEventListener</span>(eventType, oldVal);</span><br><span class="line">                    <span class="comment">// 设置新事件监听</span></span><br><span class="line">                    newVal &amp;&amp; ele.<span class="title function_">addEventListener</span>(eventType, newVal, options);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 普通函数</span></span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置事件监听</span></span><br><span class="line">                ele.<span class="title function_">addEventListener</span>(eventType, value, options);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 特殊属性</span></span><br><span class="line">    <span class="keyword">const</span> specificAttrs = [<span class="string">&#x27;checked&#x27;</span>, <span class="string">&#x27;selected&#x27;</span>, <span class="string">&#x27;disabled&#x27;</span>, <span class="string">&#x27;enabled&#x27;</span>];</span><br><span class="line">    <span class="comment">// 特殊 key</span></span><br><span class="line">    <span class="keyword">if</span> (specificAttrs.<span class="title function_">includes</span>(formatKey)) &#123;</span><br><span class="line">        <span class="comment">// Ref</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = value;</span><br><span class="line">            <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (refVal.<span class="property">value</span>) &#123;</span><br><span class="line">                    ele.<span class="title function_">setAttribute</span>(formatKey, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    ele.<span class="title function_">removeAttribute</span>(formatKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 普通属性值</span></span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            ele.<span class="title function_">setAttribute</span>(formatKey, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ele.<span class="title function_">removeAttribute</span>(formatKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ref 属性名</span></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;ref&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// Ref</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = value;</span><br><span class="line">            subscribe &amp;&amp;</span><br><span class="line">                <span class="title function_">subscribe</span>(&#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        refVal.<span class="property">value</span> = ele;</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Ref 函数</span></span><br><span class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> refFn = value;</span><br><span class="line">            subscribe &amp;&amp;</span><br><span class="line">                <span class="title function_">subscribe</span>(&#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="title function_">refFn</span>(ele);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// xlink命名空间</span></span><br><span class="line">    <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&#x27;xlink:&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// xlink属性命名空间</span></span><br><span class="line">        <span class="keyword">const</span> attrNS = <span class="string">&#x27;http://www.w3.org/1999/xlink&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            ele.<span class="title function_">setAttributeNS</span>(attrNS, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ele.<span class="title function_">removeAttributeNS</span>(attrNS, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Ref 属性值</span></span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; <span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">        <span class="keyword">const</span> refVal = value;</span><br><span class="line">        <span class="comment">// 监听影响</span></span><br><span class="line">        <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            ele.<span class="title function_">setAttribute</span>(key, refVal.<span class="property">value</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 普通属性</span></span><br><span class="line">    <span class="keyword">if</span> (key) &#123;</span><br><span class="line">        <span class="comment">// 普通属性</span></span><br><span class="line">        ele.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理子元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChildren</span>(<span class="params">ele, children, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(children)) &#123;</span><br><span class="line">        <span class="comment">// 注释元素</span></span><br><span class="line">        <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 监听元素变化</span></span><br><span class="line">        <span class="title function_">watch</span>(children, <span class="keyword">async</span> (newEle, oldEle) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                    <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                        oldEleRes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                            unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                    oldEle.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                        unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                ele.<span class="title function_">replaceChildren</span>(comment);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (newEle) &#123;</span><br><span class="line">                <span class="keyword">if</span> (oldEle) &#123;</span><br><span class="line">                    <span class="comment">// Promise</span></span><br><span class="line">                    <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                        <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                            oldEleRes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                                unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// unPromise</span></span><br><span class="line">                    <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                        oldEle.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                            unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                    <span class="keyword">if</span> (newEleRes) &#123;</span><br><span class="line">                        <span class="keyword">const</span> eles = newEleRes.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                                subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">const</span> eles = newEle.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                        subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Promise</span></span><br><span class="line">        <span class="keyword">if</span> (children.<span class="property">value</span> <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// 插入注释元素</span></span><br><span class="line">            ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">            children.<span class="property">value</span>.<span class="title function_">then</span>(<span class="function">(<span class="params">childrenEle</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (childrenEle) &#123;</span><br><span class="line">                    <span class="keyword">const</span> eles = childrenEle.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                            subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// unPromise</span></span><br><span class="line">        <span class="keyword">if</span> (children.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> eles = children.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                    subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            ele.<span class="title function_">appendChild</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Promise</span></span><br><span class="line">    <span class="keyword">if</span> (children <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">        <span class="comment">// 注释元素</span></span><br><span class="line">        <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 插入注释元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">        <span class="comment">// 异步替换元素</span></span><br><span class="line">        children.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                    subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                &#125;</span><br><span class="line">                comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Array</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line">        <span class="comment">// 处理过后</span></span><br><span class="line">        <span class="keyword">const</span> resChildren = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> children) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[i];</span><br><span class="line">            <span class="comment">// Ref</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(child)) &#123;</span><br><span class="line">                <span class="comment">// 注释</span></span><br><span class="line">                <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="comment">// 监听影响</span></span><br><span class="line">                <span class="title function_">watch</span>(child, <span class="keyword">async</span> (newEle, oldEle) =&gt; &#123;</span><br><span class="line">                    <span class="comment">// 新元素为空</span></span><br><span class="line">                    <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                                <span class="title function_">handleChangeElement</span>(newEle, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 旧元素为空</span></span><br><span class="line">                    <span class="keyword">if</span> (newEle &amp;&amp; !oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="keyword">if</span> (newEleRes) &#123;</span><br><span class="line">                                <span class="title function_">handleChangeElement</span>(newEleRes, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 存在</span></span><br><span class="line">                    <span class="keyword">if</span> (newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span> &amp;&amp; oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEleRes, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span> &amp;&amp; !(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEleRes, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (!(newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &amp;&amp; oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEle, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 非 Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &amp;&amp; !(newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (child.<span class="property">value</span> <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="comment">// 注释</span></span><br><span class="line">                    resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                    <span class="comment">// 异步替换</span></span><br><span class="line">                    child.<span class="property">value</span>.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                            <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                            <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                                subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                            &#125;</span><br><span class="line">                            comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">if</span> (child.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; beforeMount, onMounted, ele &#125; = child.<span class="property">value</span>;</span><br><span class="line">                    resChildren[i] = &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Promise</span></span><br><span class="line">            <span class="keyword">if</span> (child <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                <span class="comment">// 注释</span></span><br><span class="line">                <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                <span class="comment">// 异步替换元素</span></span><br><span class="line">                child.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                            subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                        &#125;</span><br><span class="line">                        comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 普通元素</span></span><br><span class="line">            <span class="keyword">if</span> (child) &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; beforeMount, onMounted, ele &#125; = child;</span><br><span class="line">                resChildren[i] = &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> eles = resChildren.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 普通元素</span></span><br><span class="line">    <span class="keyword">if</span> (children) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = children;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(children);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(children.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 元素变化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">newEle</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">oldEle</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">comment</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChangeElement</span>(<span class="params">newEle, oldEle, comment, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = newEle;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(newEle);</span><br><span class="line">        &#125;</span><br><span class="line">        oldEle.<span class="property">ele</span>.<span class="title function_">replaceWith</span>(newEle.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newEle &amp;&amp; !oldEle) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = newEle;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(newEle);</span><br><span class="line">        &#125;</span><br><span class="line">        comment.<span class="title function_">replaceWith</span>(newEle.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">        unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(oldEle);</span><br><span class="line">        oldEle.<span class="property">ele</span>.<span class="title function_">replaceWith</span>(comment);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建文字节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createTextNode</span>(<span class="params">text, options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(text)) &#123;</span><br><span class="line">        <span class="comment">// ref</span></span><br><span class="line">        <span class="keyword">const</span> refVal = text;</span><br><span class="line">        <span class="comment">// 元素</span></span><br><span class="line">        <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 订阅变化</span></span><br><span class="line">        <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            ele.<span class="property">data</span> = refVal.<span class="property">value</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 创建元素后</span></span><br><span class="line">        onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">        <span class="keyword">return</span> &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">ele</span>: <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">String</span>(text)), beforeMount, onMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 挂载元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eleOptions</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">parent</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">eleOptions, parent = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ele, beforeMount, onMounted &#125; = eleOptions;</span><br><span class="line">    <span class="keyword">if</span> (ele) &#123;</span><br><span class="line">        <span class="comment">// 触发挂载前事件</span></span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">        parent.<span class="title function_">appendChild</span>(ele);</span><br><span class="line">        <span class="comment">// 挂在后</span></span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 选择器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">selector</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$$</span>(<span class="params">selector, parent = <span class="variable language_">document</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(parent.<span class="title function_">querySelectorAll</span>(selector));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 异步选择器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">selector</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$_</span>(<span class="params">selector, parent = <span class="variable language_">document</span>, timeout</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> selectors = <span class="title class_">Array</span>.<span class="title function_">from</span>(parent.<span class="title function_">querySelectorAll</span>(selector));</span><br><span class="line">            <span class="comment">// 存在元素</span></span><br><span class="line">            <span class="keyword">if</span> (selectors.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>(selectors);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 超时</span></span><br><span class="line">        <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>([]);</span><br><span class="line">            &#125;, timeout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建元素块</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eles</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElementBlock</span>(<span class="params">eles</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> eles) &#123;</span><br><span class="line">        fragment.<span class="title function_">appendChild</span>(eles[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fragment;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印日志</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;dodgerblue&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印错误</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;red&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;yellow&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印颜色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">color</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printColor</span>(<span class="params">color, ...text</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> textFormatted = text</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> (<span class="keyword">typeof</span> t === <span class="string">&#x27;object&#x27;</span> ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(t) : <span class="title class_">String</span>(t)))</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`%c[<span class="subst">$&#123;formatDateTime()&#125;</span>] %c<span class="subst">$&#123;textFormatted&#125;</span>`</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">`color: <span class="subst">$&#123;color&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> html进度条</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">title</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">percent</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getProgressHTML</span>(<span class="params">title, percent</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> progressHTML = <span class="string">`&lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">      justify-content: space-between;</span></span><br><span class="line"><span class="string">      padding: 1px 0;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;span&gt;<span class="subst">$&#123;title&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;span&gt;<span class="subst">$&#123;getHighlightHTML(percent)&#125;</span> %&lt;/span&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      background: white;</span></span><br><span class="line"><span class="string">      border-radius: 10px;</span></span><br><span class="line"><span class="string">      height: 10px;</span></span><br><span class="line"><span class="string">      border: 1px solid #eee;</span></span><br><span class="line"><span class="string">      flex-shrink: 1;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        background: linear-gradient(to left, #188fff80, #1890ff);</span></span><br><span class="line"><span class="string">        height: 100%;</span></span><br><span class="line"><span class="string">        width: <span class="subst">$&#123;percent&#125;</span>%;</span></span><br><span class="line"><span class="string">        border-radius: 10px;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span>;</span><br><span class="line">    <span class="keyword">return</span> progressHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> html高亮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getHighlightHTML</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> highlightHTML = <span class="string">`&lt;span style=&quot;color: #1890ff&quot;&gt;<span class="subst">$&#123;text&#125;</span>&lt;/span&gt;`</span>;</span><br><span class="line">    <span class="keyword">return</span> highlightHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">src</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getImgHTML</span>(<span class="params">src</span>) &#123;</span><br><span class="line">    <span class="comment">// 图片</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">     &lt;div style=&quot;padding: 10px 0&quot;&gt;</span></span><br><span class="line"><span class="string">     &lt;div</span></span><br><span class="line"><span class="string">       style=&quot;</span></span><br><span class="line"><span class="string">         display: flex;</span></span><br><span class="line"><span class="string">         justify-content: center;</span></span><br><span class="line"><span class="string">         align-items: center;</span></span><br><span class="line"><span class="string">         padding: 20px;</span></span><br><span class="line"><span class="string">         background: #f7f7f7;</span></span><br><span class="line"><span class="string">         border-radius: 10px;</span></span><br><span class="line"><span class="string">       &quot;</span></span><br><span class="line"><span class="string">     &gt;</span></span><br><span class="line"><span class="string">         &lt;img src=&quot;<span class="subst">$&#123;src&#125;</span>&quot; style=&quot;width:200px;height:200px;&quot; /&gt;</span></span><br><span class="line"><span class="string">       &lt;/div&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建模态框</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options 选项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createModal</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 配置</span></span><br><span class="line">    <span class="keyword">const</span> &#123; title, subTitle = <span class="string">&#x27;&#x27;</span>, to = <span class="string">&#x27;用户&#x27;</span>, content, type, <span class="keyword">from</span> = <span class="string">&#x27;tech-study.js&#x27;</span>, &#125; = options;</span><br><span class="line">    <span class="comment">// 内容文本</span></span><br><span class="line">    <span class="keyword">let</span> contentText = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(content)) &#123;</span><br><span class="line">        contentText = content.<span class="title function_">map</span>(<span class="function">(<span class="params">ct</span>) =&gt;</span> <span class="string">`&lt;div&gt;<span class="subst">$&#123;ct&#125;</span>&lt;/div&gt;`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        contentText = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 日期</span></span><br><span class="line">    <span class="keyword">const</span> dateTime = <span class="title function_">formatDateTime</span>();</span><br><span class="line">    <span class="comment">// 类型html</span></span><br><span class="line">    <span class="keyword">let</span> typeHTML = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (type &amp;&amp; type.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;info&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">       viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">       style=&quot;color: #1890ff; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">       fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">       aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">     &gt;</span></span><br><span class="line"><span class="string">       &lt;path</span></span><br><span class="line"><span class="string">         d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z&quot;</span></span><br><span class="line"><span class="string">       &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">     &lt;/svg&gt;`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;warn&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #faad14; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;success&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #52c41a; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;fail&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #ff4d4f; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 类型</span></span><br><span class="line">    <span class="keyword">const</span> typeWrap = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;span</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      padding-right: 5px;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      justify-content: center;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;typeHTML&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/span&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">    <span class="comment">// 基础html</span></span><br><span class="line">    <span class="keyword">const</span> baseHTML = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">  style=&quot;</span></span><br><span class="line"><span class="string">    padding: 5px;</span></span><br><span class="line"><span class="string">    display: flex;</span></span><br><span class="line"><span class="string">    justify-content: center;</span></span><br><span class="line"><span class="string">    align-items: center;</span></span><br><span class="line"><span class="string">  &quot;</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      background: #ffffff;</span></span><br><span class="line"><span class="string">      box-shadow: 1px 1px 8px -1px #dadada;</span></span><br><span class="line"><span class="string">      padding: 5px 10px;</span></span><br><span class="line"><span class="string">      border-radius: 5px;</span></span><br><span class="line"><span class="string">      width: 100%;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        justify-content: space-between;</span></span><br><span class="line"><span class="string">        padding: 5px;</span></span><br><span class="line"><span class="string">        border-bottom: 1px solid #eee;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;display: flex; justify-content: center; align-items: center&quot;&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;typeWrap&#125;</span></span></span><br><span class="line"><span class="string">        &lt;span style=&quot;padding-left: 5px; font-size: 18px&quot;&gt;<span class="subst">$&#123;title&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;font-size: 16px; color: #999&quot;&gt;<span class="subst">$&#123;subTitle&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div style=&quot;padding:10px 5px; font-size: 16px; min-height: 80px&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;getHighlightHTML(to)&#125;</span>, 你好!</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;line-height: 28px;&quot;&gt;<span class="subst">$&#123;contentText&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        padding: 5px;</span></span><br><span class="line"><span class="string">        border-top: 1px solid #eee;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        justify-content: space-between;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;color: #999&quot;&gt;<span class="subst">$&#123;dateTime&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;来自&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span style=&quot;color: #1890ff; padding-left: 1px&quot;&gt;<span class="subst">$&#123;<span class="keyword">from</span>&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">    <span class="keyword">return</span> baseHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushMessage</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 选项</span></span><br><span class="line">    <span class="keyword">const</span> &#123; title, content, template, fromToken, toToken &#125; = options;</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushPlus</span>(fromToken, title, content, template, toToken);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送模态框</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushModal</span>(<span class="params">options, fromToken, toToken</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> html = <span class="title function_">createModal</span>(options);</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushMessage</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;消息提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: html,</span><br><span class="line">        fromToken,</span><br><span class="line">        toToken,</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建随机点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bounds 范围</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRandomPoint</span>(<span class="params">bounds</span>) &#123;</span><br><span class="line">    <span class="comment">// 范围</span></span><br><span class="line">    <span class="keyword">const</span> &#123; x, y, width, height &#125; = bounds;</span><br><span class="line">    <span class="comment">// 横坐标</span></span><br><span class="line">    <span class="keyword">const</span> randX = x + <span class="title class_">Math</span>.<span class="title function_">random</span>() * width * <span class="number">0.5</span> + width * <span class="number">0.25</span>;</span><br><span class="line">    <span class="comment">// 纵坐标</span></span><br><span class="line">    <span class="keyword">const</span> randY = y + <span class="title class_">Math</span>.<span class="title function_">random</span>() * height * <span class="number">0.5</span> + height * <span class="number">0.25</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">x</span>: randX,</span><br><span class="line">        <span class="attr">y</span>: randY,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成随机路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">start</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">end</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">steps</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRandomPath</span>(<span class="params">start, end, steps</span>) &#123;</span><br><span class="line">    <span class="comment">// 最小水平增量</span></span><br><span class="line">    <span class="keyword">const</span> minDeltaX = (end.<span class="property">x</span> - start.<span class="property">x</span>) / steps;</span><br><span class="line">    <span class="comment">// 最大垂直增量</span></span><br><span class="line">    <span class="keyword">const</span> maxDeltaY = (end.<span class="property">y</span> - start.<span class="property">y</span>) / steps;</span><br><span class="line">    <span class="keyword">const</span> path = [];</span><br><span class="line">    <span class="comment">// 开始节点</span></span><br><span class="line">    path.<span class="title function_">push</span>(start);</span><br><span class="line">    <span class="comment">// 插入点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; steps; i++) &#123;</span><br><span class="line">        <span class="comment">// 横坐标</span></span><br><span class="line">        <span class="keyword">const</span> x = path[i].<span class="property">x</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span> + minDeltaX;</span><br><span class="line">        <span class="comment">// 纵坐标</span></span><br><span class="line">        <span class="keyword">const</span> y = path[i].<span class="property">y</span> +</span><br><span class="line">            <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span> * <span class="title class_">Math</span>.<span class="title function_">pow</span>(-<span class="number">1</span>, ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span> + <span class="number">1</span>)) +</span><br><span class="line">            maxDeltaY;</span><br><span class="line">        path.<span class="title function_">push</span>(&#123;</span><br><span class="line">            x,</span><br><span class="line">            y,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateNumAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>)).<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机大写字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateUpperAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">26</span>) + <span class="number">65</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机小写字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateLowerAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">26</span>) + <span class="number">97</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机混合字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">length</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateMix</span>(<span class="params">length = <span class="number">6</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机字符串</span></span><br><span class="line">    <span class="keyword">const</span> randomText = [];</span><br><span class="line">    <span class="comment">// 生成器</span></span><br><span class="line">    <span class="keyword">const</span> typeGenerator = [</span><br><span class="line">        generateNumAsChar,</span><br><span class="line">        generateUpperAsChar,</span><br><span class="line">        generateLowerAsChar,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">if</span> (length) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="comment">// 随机位置</span></span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * typeGenerator.<span class="property">length</span>);</span><br><span class="line">            randomText.<span class="title function_">push</span>(typeGenerator[randomIndex]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> randomText.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化日期时间数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">num</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDateNum</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> num &lt; <span class="number">10</span> ? <span class="string">`0<span class="subst">$&#123;num&#125;</span>`</span> : <span class="string">`<span class="subst">$&#123;num&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化日期时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatDateTime() -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatDateTime(new Date()) -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatDateTime(Date.now()) -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDateTime</span>(<span class="params">time = <span class="built_in">Date</span>.now()</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> d = date.<span class="title function_">getDate</span>();</span><br><span class="line">    <span class="keyword">const</span> m = date.<span class="title function_">getMonth</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> y = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="comment">// 日期</span></span><br><span class="line">    <span class="keyword">const</span> dateText = [y, m, d].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="comment">// 时间</span></span><br><span class="line">    <span class="keyword">const</span> timeText = [h, min, s].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">    <span class="comment">// 日期时间</span></span><br><span class="line">    <span class="keyword">const</span> dateTimeText = <span class="string">`<span class="subst">$&#123;dateText&#125;</span> <span class="subst">$&#123;timeText&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> dateTimeText;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatTime() -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatTime(new Date()) -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatTime(Date.now()) -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">formatTime</span> = (<span class="params">time = <span class="built_in">Date</span>.now()</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="comment">// 时间</span></span><br><span class="line">    <span class="keyword">const</span> timeText = [h, min, s].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> timeText;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间已过</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">hour</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">minute</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isLate</span>(<span class="params">&#123; hour, minute &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">return</span> h &gt; hour || (h === hour &amp;&amp; min &gt;= minute);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间已过</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">hour</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">minute</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isNow</span>(<span class="params">&#123; hour, minute &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">return</span> h === hour &amp;&amp; min === minute &amp;&amp; s === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 工具函数 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">expires</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">name, value, expires, domain</span>) &#123;</span><br><span class="line">    <span class="comment">// 当前日期</span></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="comment">// 过期日期</span></span><br><span class="line">    date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>() + expires);</span><br><span class="line">    <span class="comment">// 设置cookie</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;name&#125;</span>=<span class="subst">$&#123;value&#125;</span>;expires=<span class="subst">$&#123;date.toUTCString()&#125;</span>;path=/;domain=<span class="subst">$&#123;domain&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取当前所有cookie</span></span><br><span class="line">    <span class="keyword">const</span> strCookies = <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line">    <span class="comment">// 截取变成cookie数组</span></span><br><span class="line">    <span class="keyword">const</span> cookieText = strCookies.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 循环每个cookie</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> cookieText) &#123;</span><br><span class="line">        <span class="comment">// 将cookie截取成两部分</span></span><br><span class="line">        <span class="keyword">const</span> item = cookieText[i].<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="comment">// 判断cookie的name 是否相等</span></span><br><span class="line">        <span class="keyword">if</span> (item[<span class="number">0</span>].<span class="title function_">trim</span>() === name) &#123;</span><br><span class="line">            <span class="keyword">return</span> item[<span class="number">1</span>].<span class="title function_">trim</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 删除cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delCookie</span>(<span class="params">name, domain</span>) &#123;</span><br><span class="line">    <span class="comment">// 存在cookie</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">getCookie</span>(name);</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">setCookie</span>(name, <span class="string">&#x27;&#x27;</span>, -<span class="number">1</span>, domain);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 防抖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">delay</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 判断是否为移动端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasMobile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> isMobile = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (navigator.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i</span>)) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;移动端&#x27;</span>);</span><br><span class="line">        isMobile = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span> &lt; <span class="number">800</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;小尺寸设备端&#x27;</span>);</span><br><span class="line">        isMobile = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isMobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="comment">// 延时</span></span><br><span class="line">    <span class="keyword">let</span> timeDelay = <span class="title class_">Number</span>(time);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(timeDelay)) &#123;</span><br><span class="line">        timeDelay = <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timeDelay += <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">500</span> - <span class="number">250</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">        &#125;, timeDelay);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 暂停学习锁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">studyPauseLock</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">const</span> pauseStudy = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (pauseStudy) &#123;</span><br><span class="line">            <span class="keyword">const</span> doing = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 暂停</span></span><br><span class="line">                <span class="keyword">const</span> pauseStudy = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (!pauseStudy) &#123;</span><br><span class="line">                    <span class="comment">// 停止定时器</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(doing);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;学习等待结束!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;学习等待...&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 加载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">match</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">load</span>(<span class="params">match, callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> &#123; href &#125; = <span class="variable language_">window</span>.<span class="property">location</span>;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 函数</span></span><br><span class="line">        <span class="keyword">if</span> (match <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="title function_">match</span>(href) &amp;&amp; <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 布尔</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> match === <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">            match &amp;&amp; <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 字符正则</span></span><br><span class="line">        <span class="keyword">if</span> (href.<span class="title function_">match</span>(match)) &#123;</span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 变量 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> href = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> taskConfig = <span class="title function_">reactive</span>([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每日首次登录积1分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">LOGIN</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;文章选读&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每有效阅读一篇文章积1分，上限6分。有效阅读文章累计1分钟积1分，上限6分。每日上限积12分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">READ</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;视听学习&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每有效一个音频或观看一个视频积1分，上限6分。有效收听音频或观看视频累计1分钟积1分，上限6分。每日上限积12分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">WATCH</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;每日答题&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每组答题每答对1道积1分。每日上限积5分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> settings = <span class="title function_">reactive</span>([<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 总分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> totalScore = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 当天分数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> todayScore = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> userinfo = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">nick</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 进度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> taskStatus = <span class="title function_">ref</span>(<span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题暂停</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> examPause = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="title function_">ref</span>(!!<span class="title function_">getCookie</span>(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 窗口id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> id = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时刷新列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> scheduleList = <span class="title function_">shallowReactive</span>([]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> pushToken = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> refreshCount = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 窗口关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> frame = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">exist</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">closed</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">ele</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> page = <span class="title function_">ref</span>(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 开始登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> loginQRCodeShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 最大选读时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxRead = <span class="title function_">ref</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 最大视听时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxWatch = <span class="title function_">ref</span>(<span class="number">120</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 运行其他任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> running = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 主题色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> themeColor = <span class="title function_">ref</span>(<span class="string">&#x27;#fa3333&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>  考试类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ExamType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">ExamType</span>) &#123;</span><br><span class="line">    <span class="title class_">ExamType</span>[<span class="title class_">ExamType</span>[<span class="string">&quot;PRACTICE&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;PRACTICE&quot;</span>;</span><br><span class="line">    <span class="title class_">ExamType</span>[<span class="title class_">ExamType</span>[<span class="string">&quot;PAPER&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;PAPER&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">ExamType</span> || (<span class="title class_">ExamType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNextButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 答题按钮</span></span><br><span class="line">            <span class="keyword">const</span> nextAll = $$(<span class="string">&#x27;.ant-btn&#x27;</span>).<span class="title function_">filter</span>(<span class="function">(<span class="params">next</span>) =&gt;</span> next.<span class="property">innerText</span>);</span><br><span class="line">            <span class="keyword">if</span> (nextAll.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 停止定时器</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="keyword">if</span> (nextAll.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(nextAll[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">resolve</span>(nextAll[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理滑动验证</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSlideVerify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">async</span> (resolve) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 滑动验证</span></span><br><span class="line">        <span class="keyword">const</span> mask = $$(<span class="string">&#x27;#nc_mask&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (mask &amp;&amp; <span class="title function_">getComputedStyle</span>(mask).<span class="property">display</span> !== <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;等待滑动验证&#x27;</span>);</span><br><span class="line">            <span class="comment">// 提高层级</span></span><br><span class="line">            mask.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">&#x27;999&#x27;</span>;</span><br><span class="line">            <span class="comment">// 轨道</span></span><br><span class="line">            <span class="keyword">const</span> track = (<span class="keyword">await</span> $_(<span class="string">&#x27;.nc_scale&#x27;</span>, <span class="literal">undefined</span>, <span class="number">3000</span>))[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 滑块</span></span><br><span class="line">            <span class="keyword">const</span> slide = (<span class="keyword">await</span> $_(<span class="string">&#x27;.btn_slide&#x27;</span>, <span class="literal">undefined</span>, <span class="number">3000</span>))[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 延时</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">            <span class="comment">// 矩形范围</span></span><br><span class="line">            <span class="keyword">const</span> rectTrack = track.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">            <span class="comment">// 矩形范围</span></span><br><span class="line">            <span class="keyword">const</span> rectSlide = slide.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">            <span class="comment">// 窗口</span></span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">window</span> = unsafeWindow;</span><br><span class="line">            <span class="comment">// 范围内随机起点</span></span><br><span class="line">            <span class="keyword">const</span> start = <span class="title function_">createRandomPoint</span>(rectSlide);</span><br><span class="line">            <span class="comment">// 终点</span></span><br><span class="line">            <span class="keyword">const</span> end = &#123;</span><br><span class="line">                <span class="attr">x</span>: rectTrack.<span class="property">x</span> + rectTrack.<span class="property">width</span>,</span><br><span class="line">                <span class="attr">y</span>: rectTrack.<span class="property">y</span> + rectTrack.<span class="property">height</span> / <span class="number">2</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 路径</span></span><br><span class="line">            <span class="keyword">const</span> path = <span class="title function_">createRandomPath</span>(start, end, <span class="number">10</span>);</span><br><span class="line">            <span class="comment">// 移动端</span></span><br><span class="line">            <span class="keyword">const</span> mobile = <span class="title function_">hasMobile</span>();</span><br><span class="line">            <span class="keyword">if</span> (mobile) &#123;</span><br><span class="line">                slide.<span class="property">style</span>.<span class="property">touchAction</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                <span class="keyword">const</span> touchstartTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                    <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">target</span>: slide,</span><br><span class="line">                    <span class="attr">clientX</span>: path[<span class="number">0</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[<span class="number">0</span>].<span class="property">y</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> touchstartList = [touchstartTouch];</span><br><span class="line">                <span class="comment">// 开始触摸</span></span><br><span class="line">                <span class="keyword">const</span> touchstart = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchstart&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">targetTouches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">touches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">changedTouches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(touchstart);</span><br><span class="line">                <span class="comment">// 触摸滑动</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> path) &#123;</span><br><span class="line">                    <span class="keyword">const</span> touchmoveTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                        <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">target</span>: slide,</span><br><span class="line">                        <span class="attr">clientX</span>: path[i].<span class="property">x</span>,</span><br><span class="line">                        <span class="attr">clientY</span>: path[i].<span class="property">y</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">const</span> touchmoveList = [touchmoveTouch];</span><br><span class="line">                    <span class="keyword">const</span> touchmove = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchmove&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">targetTouches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">touches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">changedTouches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    slide.<span class="title function_">dispatchEvent</span>(touchmove);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">10</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">const</span> touchendTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                    <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">target</span>: slide,</span><br><span class="line">                    <span class="attr">clientX</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">y</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 触摸结束</span></span><br><span class="line">                <span class="keyword">const</span> touchendList = [touchendTouch];</span><br><span class="line">                <span class="comment">// 开始触摸</span></span><br><span class="line">                <span class="keyword">const</span> touchend = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchend&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">targetTouches</span>: [],</span><br><span class="line">                    <span class="attr">touches</span>: [],</span><br><span class="line">                    <span class="attr">changedTouches</span>: touchendList,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(touchend);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 鼠标按下</span></span><br><span class="line">                <span class="keyword">const</span> mousedown = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousedown&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">clientX</span>: path[<span class="number">0</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[<span class="number">0</span>].<span class="property">y</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(mousedown);</span><br><span class="line">                <span class="comment">// 鼠标滑动</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> path) &#123;</span><br><span class="line">                    <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">clientX</span>: path[i].<span class="property">x</span>,</span><br><span class="line">                        <span class="attr">clientY</span>: path[i].<span class="property">y</span>,</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    slide.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">10</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 鼠标抬起</span></span><br><span class="line">                <span class="keyword">const</span> mouseup = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mouseup&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">clientX</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">y</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(mouseup);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证完成!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 定时器</span></span><br><span class="line">            <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 滑动验证</span></span><br><span class="line">                <span class="keyword">const</span> mask = $$(<span class="string">&#x27;#nc_mask&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (!mask || <span class="title function_">getComputedStyle</span>(mask).<span class="property">display</span> === <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;滑动验证成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证成功!&#x27;</span>);</span><br><span class="line">                    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="literal">false</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;滑动验证失败!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证失败!&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理选项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChoiceBtn</span>(<span class="params">answers</span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 答案存在</span></span><br><span class="line">    <span class="keyword">if</span> (answers.<span class="property">length</span> &amp;&amp; allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 作答</span></span><br><span class="line">        <span class="keyword">return</span> answers.<span class="title function_">every</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 答案存在</span></span><br><span class="line">            <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 包含答案最短长度选项</span></span><br><span class="line">                <span class="keyword">let</span> minLengthChoice;</span><br><span class="line">                <span class="comment">// 遍历</span></span><br><span class="line">                allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> choiceText = choice.<span class="property">innerText</span>.<span class="title function_">trim</span>();</span><br><span class="line">                    <span class="comment">// 无符号选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> unsignedChoiceText = choiceText.<span class="title function_">replaceAll</span>(<span class="regexp">/[、，,。 ]/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 无符号答案</span></span><br><span class="line">                    <span class="keyword">const</span> unsignedAnswer = answer.<span class="title function_">replaceAll</span>(<span class="regexp">/[、，,。 ]/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 包含答案</span></span><br><span class="line">                    <span class="keyword">if</span> (choiceText === answer ||</span><br><span class="line">                        choiceText.<span class="title function_">includes</span>(answer) ||</span><br><span class="line">                        answer.<span class="title function_">includes</span>(choiceText) ||</span><br><span class="line">                        unsignedChoiceText.<span class="title function_">includes</span>(unsignedAnswer)) &#123;</span><br><span class="line">                        <span class="comment">// 最小长度选项有值</span></span><br><span class="line">                        <span class="keyword">if</span> (minLengthChoice) &#123;</span><br><span class="line">                            <span class="comment">// 最短长度选项与当前选项比较长度</span></span><br><span class="line">                            <span class="keyword">if</span> (minLengthChoice.<span class="property">innerText</span>.<span class="property">length</span> &gt; choiceText.<span class="property">length</span>) &#123;</span><br><span class="line">                                minLengthChoice = choice;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// 最小长度选项赋值</span></span><br><span class="line">                            minLengthChoice = choice;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 存在选项</span></span><br><span class="line">                <span class="keyword">if</span> (minLengthChoice) &#123;</span><br><span class="line">                    <span class="comment">// 选择</span></span><br><span class="line">                    <span class="keyword">if</span> (!minLengthChoice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                        minLengthChoice.<span class="title function_">click</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机处理单选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSingleChoiceRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 按钮存在</span></span><br><span class="line">    <span class="keyword">if</span> (allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * allBtns.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">const</span> randBtn = allBtns[index];</span><br><span class="line">        <span class="comment">// 选择</span></span><br><span class="line">        <span class="keyword">if</span> (!randBtn.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">            randBtn.<span class="title function_">click</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机处理多选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleMutiplyChoiceRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 按钮存在</span></span><br><span class="line">    <span class="keyword">if</span> (allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">allBtn</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 选择</span></span><br><span class="line">            <span class="keyword">if</span> (!allBtn.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                allBtn.<span class="title function_">click</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理填空</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBlankInput</span> = (<span class="params">answers</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 所有填空</span></span><br><span class="line">    <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;.blank&#x27;</span>);</span><br><span class="line">    <span class="comment">// 答案存在</span></span><br><span class="line">    <span class="keyword">if</span> (blanks.<span class="property">length</span> &amp;&amp; answers.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 填空数量和答案数量一致</span></span><br><span class="line">        <span class="keyword">if</span> (answers.<span class="property">length</span> === blanks.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> answers.<span class="title function_">every</span>(<span class="function">(<span class="params">answer, i</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 答案存在</span></span><br><span class="line">                <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 输入事件</span></span><br><span class="line">                    <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// 设置答案</span></span><br><span class="line">                    blanks[i].<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, answer);</span><br><span class="line">                    <span class="comment">// 触发输入input</span></span><br><span class="line">                    blanks[i].<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 填空数量为1和提示数量大于1</span></span><br><span class="line">        <span class="keyword">if</span> (blanks.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; answers.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 直接将所有答案整合填进去</span></span><br><span class="line">            <span class="keyword">const</span> answer = answers.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="comment">// 答案存在</span></span><br><span class="line">            <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 输入事件</span></span><br><span class="line">                <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 设置答案</span></span><br><span class="line">                blanks[<span class="number">0</span>].<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, answer);</span><br><span class="line">                <span class="comment">// 触发输入input</span></span><br><span class="line">                blanks[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理填空随机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleBlankInputRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 所有填空</span></span><br><span class="line">    <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;.blank&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (blanks.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 输入事件</span></span><br><span class="line">        <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        blanks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">blank</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置答案</span></span><br><span class="line">            blank.<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;答案&#x27;</span>);</span><br><span class="line">            <span class="comment">// 触发输入input</span></span><br><span class="line">            blank.<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 暂停锁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">examPauseLock</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 学习暂停</span></span><br><span class="line">        <span class="keyword">const</span> pauseStudy = (<span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 全局暂停</span></span><br><span class="line">        <span class="keyword">if</span> (pauseStudy) &#123;</span><br><span class="line">            examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">if</span> (examPause.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;已暂停, 手动开启自动答题! &#x27;</span>, <span class="number">10</span>);</span><br><span class="line">            <span class="keyword">const</span> doing = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!examPause.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="comment">// 停止定时器</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(doing);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答题等待结束!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;已开启, 自动答题!&#x27;</span>);</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;答题等待...&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doingExam</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="comment">// 下一个按钮</span></span><br><span class="line">    <span class="keyword">let</span> nextButton;</span><br><span class="line">    <span class="comment">// 下一个文本</span></span><br><span class="line">    <span class="keyword">let</span> nextText;</span><br><span class="line">    <span class="comment">// 保存答案</span></span><br><span class="line">    <span class="keyword">let</span> shouldSaveAnswer = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 先等等再开始做题</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2500</span>);</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 获取下一个按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 结束</span></span><br><span class="line">        <span class="keyword">const</span> finish = [<span class="string">&#x27;再练一次&#x27;</span>, <span class="string">&#x27;再来一组&#x27;</span>, <span class="string">&#x27;查看解析&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (finish.<span class="title function_">includes</span>(nextButton.<span class="property">innerText</span>)) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 点击提示</span></span><br><span class="line">        $$(<span class="string">&#x27;.tips&#x27;</span>)[<span class="number">0</span>]?.<span class="title function_">click</span>();</span><br><span class="line">        <span class="comment">// 所有提示</span></span><br><span class="line">        <span class="keyword">const</span> allTips = $$(<span class="string">&#x27;.line-feed font[color]&#x27;</span>);</span><br><span class="line">        <span class="comment">// 答案</span></span><br><span class="line">        <span class="keyword">const</span> answers = allTips.<span class="title function_">map</span>(<span class="function">(<span class="params">tip</span>) =&gt;</span> tip.<span class="property">innerText</span>.<span class="title function_">trim</span>());</span><br><span class="line">        <span class="comment">// 获取题目的文本内容</span></span><br><span class="line">        <span class="keyword">const</span> question = $$(<span class="string">&#x27;.q-body&#x27;</span>)[<span class="number">0</span>].<span class="property">innerText</span>;</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 选项按钮</span></span><br><span class="line">        <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">        <span class="comment">// 所有填空</span></span><br><span class="line">        <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;input[type=text][class=blank]&#x27;</span>);</span><br><span class="line">        <span class="comment">// 问题类型</span></span><br><span class="line">        <span class="keyword">const</span> questionType = ($$(<span class="string">&#x27;.q-header&#x27;</span>)[<span class="number">0</span>].<span class="property">innerText</span>.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 题型分类作答</span></span><br><span class="line">        <span class="keyword">switch</span> (questionType) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;填空题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleBlankInput</span>(answers);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 根据题库作答</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleBlankInput</span>(answersNetwork);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleBlankInputRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;多选题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> choicesText = allBtns.<span class="title function_">map</span>(<span class="function">(<span class="params">btn</span>) =&gt;</span> btn.<span class="property">innerText</span>);</span><br><span class="line">                    <span class="comment">// 选项内容</span></span><br><span class="line">                    <span class="keyword">const</span> choicesContent = choicesText</span><br><span class="line">                        .<span class="title function_">map</span>(<span class="function">(<span class="params">choiceText</span>) =&gt;</span> choiceText.<span class="title function_">split</span>(<span class="regexp">/[A-Z]./</span>)[<span class="number">1</span>].<span class="title function_">trim</span>())</span><br><span class="line">                        .<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 空格</span></span><br><span class="line">                    <span class="keyword">const</span> blanks = question.<span class="title function_">match</span>(<span class="regexp">/（）/g</span>);</span><br><span class="line">                    <span class="comment">// 填空数量、选项数量、答案数量相同 | 选项全文等于答案全文</span></span><br><span class="line">                    <span class="keyword">if</span> ((blanks &amp;&amp; allBtns.<span class="property">length</span> === blanks.<span class="property">length</span>) ||</span><br><span class="line">                        question === choicesContent ||</span><br><span class="line">                        allBtns.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="comment">// 全选</span></span><br><span class="line">                        allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!choice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                                choice.<span class="title function_">click</span>();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 选项数量大于等于答案</span></span><br><span class="line">                    <span class="keyword">if</span> (allBtns.<span class="property">length</span> &gt;= answers.<span class="property">length</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answers);</span><br><span class="line">                        <span class="comment">// 成功</span></span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 答案存在</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answersNetwork);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleMutiplyChoiceRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;单选题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示为1</span></span><br><span class="line">                    <span class="keyword">if</span> (answers.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answers);</span><br><span class="line">                        <span class="comment">// 成功</span></span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 可能的分隔符</span></span><br><span class="line">                        <span class="keyword">const</span> seperator = [</span><br><span class="line">                            <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;、&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                        ];</span><br><span class="line">                        <span class="comment">// 可能的答案</span></span><br><span class="line">                        <span class="keyword">const</span> answersLike = seperator</span><br><span class="line">                            .<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> answers.<span class="title function_">join</span>(s).<span class="title function_">trim</span>())</span><br><span class="line">                            .<span class="title function_">filter</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> answer.<span class="property">length</span>);</span><br><span class="line">                        <span class="comment">// 答案存在</span></span><br><span class="line">                        <span class="keyword">if</span> (answersLike.<span class="property">length</span>) &#123;</span><br><span class="line">                            <span class="comment">// 可能答案是否正确</span></span><br><span class="line">                            <span class="keyword">const</span> res = answersLike.<span class="title function_">some</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">                                <span class="comment">// 尝试查找点击</span></span><br><span class="line">                                <span class="keyword">return</span> <span class="title function_">handleChoiceBtn</span>([answer]);</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 存在答案</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 单答案单选项</span></span><br><span class="line">                    <span class="keyword">if</span> (answersNetwork.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// 尝试查找点击</span></span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answersNetwork);</span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 多答案单选项 选项意外拆分</span></span><br><span class="line">                        <span class="comment">// 可能分隔符</span></span><br><span class="line">                        <span class="keyword">const</span> seperator = [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27; &#x27;</span>];</span><br><span class="line">                        <span class="comment">// 可能答案</span></span><br><span class="line">                        <span class="keyword">const</span> answersLike = seperator.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> answers.<span class="title function_">join</span>(s));</span><br><span class="line">                        <span class="comment">// 答案存在</span></span><br><span class="line">                        <span class="keyword">if</span> (answersLike.<span class="title function_">every</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> answer.<span class="property">length</span>)) &#123;</span><br><span class="line">                            <span class="comment">// 可能答案是否正确</span></span><br><span class="line">                            <span class="keyword">const</span> res = answersLike.<span class="title function_">some</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">                                <span class="comment">// 尝试查找点击</span></span><br><span class="line">                                <span class="keyword">return</span> <span class="title function_">handleChoiceBtn</span>([answer]);</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleSingleChoiceRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 获取下一个按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 需要提交答案</span></span><br><span class="line">        <span class="keyword">if</span> (shouldSaveAnswer) &#123;</span><br><span class="line">            <span class="comment">// 答案</span></span><br><span class="line">            <span class="keyword">const</span> answers = [];</span><br><span class="line">            <span class="keyword">if</span> (questionType === <span class="string">&#x27;填空题&#x27;</span>) &#123;</span><br><span class="line">                blanks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">blank</span>) =&gt;</span> &#123;</span><br><span class="line">                    answers.<span class="title function_">push</span>(blank.<span class="property">value</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (questionType === <span class="string">&#x27;单选题&#x27;</span> || questionType === <span class="string">&#x27;多选题&#x27;</span>) &#123;</span><br><span class="line">                allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (choice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// 带字母的选项</span></span><br><span class="line">                        <span class="keyword">const</span> answerTemp = choice.<span class="property">innerText</span>;</span><br><span class="line">                        <span class="comment">// 从字符串中拿出答案</span></span><br><span class="line">                        <span class="keyword">const</span> [, answer] = answerTemp.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                            answers.<span class="title function_">push</span>(answer);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 答案</span></span><br><span class="line">            <span class="keyword">const</span> answer = answers.<span class="title function_">join</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">            <span class="comment">// 存在答案</span></span><br><span class="line">            <span class="keyword">if</span> (answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在上传答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 上传答案</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">saveAnswer</span>(question, answer);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`上传答案<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123; question, answer &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 重置</span></span><br><span class="line">            shouldSaveAnswer = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 确定</span></span><br><span class="line">        <span class="keyword">if</span> (nextText === <span class="string">&#x27;确定&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 确认</span></span><br><span class="line">            nextButton.<span class="title function_">click</span>();</span><br><span class="line">            <span class="comment">// 等待一段时间</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">            <span class="comment">// 暂停</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">            <span class="comment">// 答案解析</span></span><br><span class="line">            <span class="keyword">const</span> answerBox = $$(<span class="string">&#x27;.answer&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 答题错误</span></span><br><span class="line">            <span class="keyword">if</span> (answerBox) &#123;</span><br><span class="line">                <span class="keyword">const</span> answerTemp = answerBox.<span class="property">innerText</span>;</span><br><span class="line">                <span class="comment">// 从字符串中拿出答案</span></span><br><span class="line">                <span class="keyword">const</span> [, answerText] = answerTemp.<span class="title function_">split</span>(<span class="string">&#x27;：&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (answerText &amp;&amp; answerText.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> answer = answerText.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;正在上传答案...&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 上传答案</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">saveAnswer</span>(question, answer);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">`上传答案<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123; question, answer &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (nextText === <span class="string">&#x27;下一题&#x27;</span> || nextText === <span class="string">&#x27;完成&#x27;</span> || nextText === <span class="string">&#x27;交卷&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 等待一段时间</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2500</span>);</span><br><span class="line">            <span class="comment">// 下一题</span></span><br><span class="line">            nextButton.<span class="title function_">click</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 滑动验证</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">handleSlideVerify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭任务窗口</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 每日答题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doExamPractice</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 暂停</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在每日答题...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;正在每日答题&#x27;</span>);</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="variable constant_">URL_CONFIG</span>.<span class="property">examPractice</span>;</span><br><span class="line">    <span class="comment">// 等待任务窗口</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;每日答题&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;完成每日答题!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 等待一段时间</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">    <span class="comment">// 刷新分数数据</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">    <span class="comment">// 刷新任务数据</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">        !taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续每日答题!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续每日答题!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">doExamPractice</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 专项练习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doExamPaper</span>(<span class="params"></span>) &#123;</span><br><span class="line">    running.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在专项练习...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;正在专项练习&#x27;</span>);</span><br><span class="line">    <span class="comment">// id</span></span><br><span class="line">    <span class="keyword">const</span> examPaperId = <span class="keyword">await</span> <span class="title function_">findExamPaper</span>();</span><br><span class="line">    <span class="keyword">if</span> (examPaperId) &#123;</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;URL_CONFIG.examPaper&#125;</span>?id=<span class="subst">$&#123;examPaperId&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`链接: <span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line">        <span class="comment">// 等待窗口任务</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;专项练习&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;完成专项练习!&#x27;</span>);</span><br><span class="line">        running.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 同屏任务</span></span><br><span class="line">        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">            <span class="comment">// 窗口不存在</span></span><br><span class="line">            frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    running.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;专项练习均已完成!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化总页数属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">initExam</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 默认从第一页获取全部页属性</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getExamPaper</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="comment">// 等待</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> data.<span class="property">totalPageCount</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 查询专项练习列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">findExamPaper</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取总页数</span></span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> <span class="title function_">initExam</span>();</span><br><span class="line">    <span class="comment">// 当前页数</span></span><br><span class="line">    <span class="keyword">let</span> current = <span class="number">1</span>;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`正在寻找的专项练习...`</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">`正在寻找的专项练习...`</span>);</span><br><span class="line">    <span class="keyword">while</span> (current &lt;= total &amp;&amp; current) &#123;</span><br><span class="line">        <span class="comment">// 请求数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getExamPaper</span>(current);</span><br><span class="line">        <span class="keyword">if</span> (data) &#123;</span><br><span class="line">            <span class="comment">// 获取专项练习的列表</span></span><br><span class="line">            <span class="keyword">const</span> examPapers = data.<span class="property">list</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> examPapers) &#123;</span><br><span class="line">                <span class="comment">// 遍历查询有没有没做过的</span></span><br><span class="line">                <span class="keyword">if</span> (examPapers[i].<span class="property">status</span> !== <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="comment">// status： 1 开始答题, 2 已满分/重新答题, 3 继续答题</span></span><br><span class="line">                    <span class="keyword">return</span> examPapers[i].<span class="property">id</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 增加页码</span></span><br><span class="line">            current += <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 等待</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化主页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMainListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 监听关闭</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = msg;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">id</span> === id.<span class="property">value</span> &amp;&amp; data.<span class="property">closed</span>) &#123;</span><br><span class="line">            <span class="comment">// 关闭窗口</span></span><br><span class="line">            <span class="title function_">closeFrame</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化子页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initChildListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = msg;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">id</span> &amp;&amp; !data.<span class="property">closed</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置窗口id</span></span><br><span class="line">            id.<span class="property">value</span> = data.<span class="property">id</span>;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">`初始化窗口 ID: <span class="subst">$&#123;id.value&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开窗口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">url</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">openFrame</span>(<span class="params">url, title</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置 URL</span></span><br><span class="line">    frame.<span class="property">src</span> = url;</span><br><span class="line">    <span class="comment">// 等待元素</span></span><br><span class="line">    <span class="keyword">await</span> $_(<span class="string">&#x27;.egg_frame&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (frame.<span class="property">ele</span>) &#123;</span><br><span class="line">        <span class="comment">// id</span></span><br><span class="line">        id.<span class="property">value</span> = <span class="title function_">generateMix</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 打开</span></span><br><span class="line">        frame.<span class="property">closed</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 设置标题</span></span><br><span class="line">        frame.<span class="property">title</span> = title || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="comment">// 等待页面加载</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitFrameLoaded</span>(frame.<span class="property">ele</span>);</span><br><span class="line">        <span class="comment">// 发送窗口 ID</span></span><br><span class="line">        frame.<span class="property">ele</span>.<span class="property">contentWindow</span>?.<span class="title function_">postMessage</span>(&#123; <span class="attr">id</span>: id.<span class="property">value</span>, <span class="attr">closed</span>: <span class="literal">false</span> &#125;, url);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`关闭窗口 ID: <span class="subst">$&#123;id.value&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 窗口显示</span></span><br><span class="line">    frame.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 关闭</span></span><br><span class="line">    frame.<span class="property">closed</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 标题</span></span><br><span class="line">    frame.<span class="property">title</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// src</span></span><br><span class="line">    frame.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭 frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">parent</span>.<span class="title function_">postMessage</span>(&#123; <span class="attr">id</span>: id.<span class="property">value</span>, <span class="attr">closed</span>: <span class="literal">true</span> &#125;, <span class="variable constant_">URL_CONFIG</span>.<span class="property">homeOrigin</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待窗口任务结束</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">id</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitFrameClose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 窗口关闭</span></span><br><span class="line">            <span class="keyword">if</span> (frame.<span class="property">closed</span>) &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等待窗口加载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitFrameLoaded</span>(<span class="params">iframe</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        iframe.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开新窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openWin</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">GM_openInTab</span>(url, &#123;</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">insert</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">setParent</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    page.<span class="property">value</span> &amp;&amp; page.<span class="property">value</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭子窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">opener</span> = <span class="variable language_">window</span>;</span><br><span class="line">        <span class="keyword">const</span> win = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;_self&#x27;</span>);</span><br><span class="line">        win?.<span class="title function_">close</span>();</span><br><span class="line">        top?.<span class="title function_">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待窗口关闭</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">newPage</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitWinClose</span>(<span class="params">newPage</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        newPage.<span class="property">onclose</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭任务窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeTaskWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp; id.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">closeFrame</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 非同屏任务</span></span><br><span class="line">    <span class="title function_">closeWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭任务窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseTaskWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp; id.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">handleCloseFrame</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子窗口</span></span><br><span class="line">    <span class="title function_">handleCloseWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开并等待任务结束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">waitTaskWin</span>(<span class="params">url, title</span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">        <span class="comment">// 窗口存在</span></span><br><span class="line">        frame.<span class="property">exist</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 显示窗体</span></span><br><span class="line">        frame.<span class="property">show</span> = !settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>];</span><br><span class="line">        <span class="comment">// 新窗口</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">openFrame</span>(url, title);</span><br><span class="line">        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">            <span class="comment">// 等待窗口关闭</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">waitFrameClose</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子页面任务</span></span><br><span class="line">    page.<span class="property">value</span> = <span class="title function_">openWin</span>(url);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitWinClose</span>(page.<span class="property">value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码刷新定时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> refreshTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> tryLoginTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getQRCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在生成登录二维码...&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> qrCode = <span class="keyword">await</span> <span class="title function_">generateQRCode</span>();</span><br><span class="line">    <span class="keyword">if</span> (qrCode) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;生成登录二维码成功!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`https://login.xuexi.cn/login/qrcommit?showmenu=false&amp;code=<span class="subst">$&#123;qrCode&#125;</span>&amp;appId=dingoankubyrfkttorhpou`</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">code</span>: qrCode,</span><br><span class="line">            <span class="attr">src</span>: <span class="string">`<span class="subst">$&#123;API_CONFIG.qrcode&#125;</span>?data=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(url)&#125;</span>`</span>,</span><br><span class="line">            url,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;生成登录二维码失败!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 验证登录二维码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">code</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkQRCode</span>(<span class="params">code</span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;尝试用二维码登录...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 二维码登录</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">loginWithQRCode</span>(code);</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data, code, success &#125; = res;</span><br><span class="line">        <span class="comment">// 临时登录验证码</span></span><br><span class="line">        <span class="keyword">if</span> (success &amp;&amp; data) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 二维码失效</span></span><br><span class="line">        <span class="keyword">if</span> (code === <span class="string">&#x27;11019&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 清除定时</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(tryLoginTimer);</span><br><span class="line">        <span class="comment">// 设置定时</span></span><br><span class="line">        tryLoginTimer = <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="keyword">await</span> <span class="title function_">checkQRCode</span>(code));</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试二维码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">tryLogin</span>(<span class="params">checkCode</span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在获取签名...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取签名</span></span><br><span class="line">    <span class="keyword">const</span> sign = <span class="keyword">await</span> <span class="title function_">getSign</span>();</span><br><span class="line">    <span class="keyword">if</span> (sign) &#123;</span><br><span class="line">        <span class="comment">// 生成uuid</span></span><br><span class="line">        <span class="keyword">const</span> uuid = crypto.<span class="title function_">randomUUID</span>();</span><br><span class="line">        <span class="keyword">const</span> [, code] = checkCode.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> state = <span class="string">`<span class="subst">$&#123;sign&#125;</span><span class="subst">$&#123;uuid&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">// 安全检查</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">secureCheck</span>(&#123; code, state &#125;);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新登录二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除刷新</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(refreshTimer);</span><br><span class="line">    <span class="comment">// 每隔一段时间刷新</span></span><br><span class="line">    refreshTimer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 刷新二维码</span></span><br><span class="line">        <span class="title function_">handleLogin</span>();</span><br><span class="line">    &#125;, autoRefreshQRCodeInterval);</span><br><span class="line">    <span class="comment">// 是否超出次数</span></span><br><span class="line">    <span class="keyword">if</span> (refreshCount.<span class="property">value</span> &gt;= maxRefreshCount) &#123;</span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;超过最大重试次数, 登录失败!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 重置刷新数</span></span><br><span class="line">        refreshCount.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 隐藏二维码</span></span><br><span class="line">        loginQRCodeShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 远程推送</span></span><br><span class="line">        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">            <span class="comment">// 推送</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                <span class="attr">content</span>: <span class="string">&#x27;超过最大重试次数, 登录失败!&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">            &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 配置</span></span><br><span class="line">    <span class="keyword">const</span> imgWrap = $$(<span class="string">&#x27;.egg_login_img_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 图片</span></span><br><span class="line">    <span class="keyword">const</span> img = $$(<span class="string">&#x27;.egg_login_img&#x27;</span>, imgWrap)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (imgWrap &amp;&amp; img) &#123;</span><br><span class="line">        <span class="comment">// 刷新二维码</span></span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;刷新登录二维码!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 刷新次数累加</span></span><br><span class="line">        refreshCount.<span class="property">value</span>++;</span><br><span class="line">        <span class="comment">// 获取二维码</span></span><br><span class="line">        <span class="keyword">const</span> qrCode = <span class="keyword">await</span> <span class="title function_">getQRCode</span>();</span><br><span class="line">        <span class="keyword">if</span> (qrCode) &#123;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            <span class="keyword">const</span> &#123; src, code, url &#125; = qrCode;</span><br><span class="line">            <span class="comment">// src</span></span><br><span class="line">            img.<span class="property">src</span> = src;</span><br><span class="line">            <span class="comment">// 开始登录</span></span><br><span class="line">            loginQRCodeShow.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 远程推送</span></span><br><span class="line">            <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                <span class="comment">// img html</span></span><br><span class="line">                <span class="keyword">const</span> imgWrap = <span class="title function_">getImgHTML</span>(src);</span><br><span class="line">                <span class="comment">// 跳转链接</span></span><br><span class="line">                <span class="keyword">const</span> aWrap = <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;div&gt;</span></span><br><span class="line"><span class="string">      或在浏览器</span></span><br><span class="line"><span class="string">      &lt;a</span></span><br><span class="line"><span class="string">        href=&quot;dtxuexi://appclient/page/study_feeds?url=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(url)&#125;</span>&quot;</span></span><br><span class="line"><span class="string">        style=&quot;text-decoration: none&quot;</span></span><br><span class="line"><span class="string">        &gt;<span class="subst">$&#123;getHighlightHTML(<span class="string">&#x27;打开学习强国APP&#x27;</span>)&#125;</span>&lt;/a</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">                <span class="comment">// 推送</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                    <span class="attr">content</span>: [<span class="string">&#x27;扫一扫, 登录学习强国!&#x27;</span>, aWrap, imgWrap],</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">                &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取验证码</span></span><br><span class="line">            <span class="keyword">const</span> checkCode = <span class="keyword">await</span> <span class="title function_">checkQRCode</span>(code);</span><br><span class="line">            <span class="comment">// 验证成功</span></span><br><span class="line">            <span class="keyword">if</span> (checkCode) &#123;</span><br><span class="line">                <span class="comment">// 尝试登录</span></span><br><span class="line">                <span class="keyword">const</span> loginRes = <span class="keyword">await</span> <span class="title function_">tryLogin</span>(checkCode);</span><br><span class="line">                <span class="keyword">if</span> (loginRes) &#123;</span><br><span class="line">                    <span class="comment">// 清除刷新</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(refreshTimer);</span><br><span class="line">                    <span class="comment">// 二维码显示</span></span><br><span class="line">                    loginQRCodeShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">// 登录成功</span></span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;登录成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;登录成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 登录成功</span></span><br><span class="line">                    login.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 刷新用户信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshUserInfo</span>();</span><br><span class="line">                    <span class="comment">// 刷新分数信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">                    <span class="comment">// 刷新任务信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">                    <span class="comment">// 远程推送</span></span><br><span class="line">                    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                            <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                            <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                            <span class="attr">content</span>: [</span><br><span class="line">                                <span class="string">&#x27;学习强国, 登录成功!&#x27;</span>,</span><br><span class="line">                                <span class="string">`当天积分:  <span class="subst">$&#123;getHighlightHTML(todayScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                                <span class="string">`总积分: <span class="subst">$&#123;getHighlightHTML(totalScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                                ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">getProgressHTML</span>(task.<span class="property">title</span>, task.<span class="property">percent</span>)),</span><br><span class="line">                            ],</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                        &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 二维码失效</span></span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;登录二维码失效!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 二维码失效刷新</span></span><br><span class="line">            <span class="title function_">handleLogin</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 退出登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLogout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 删除token</span></span><br><span class="line">    <span class="title function_">delCookie</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;.xuexi.cn&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭窗口</span></span><br><span class="line">    <span class="title function_">closeFrame</span>();</span><br><span class="line">    frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    login.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 清除用户信息</span></span><br><span class="line">    userinfo.<span class="property">nick</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    userinfo.<span class="property">avatar</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 总分</span></span><br><span class="line">    totalScore.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 当天分数</span></span><br><span class="line">    todayScore.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 任务进度重置</span></span><br><span class="line">    taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> &#123;</span><br><span class="line">        task.<span class="property">percent</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span>;</span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;退出登录&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 新闻</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> news = [];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> videos = [];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// section</span></span><br><span class="line">    <span class="keyword">const</span> sections = <span class="keyword">await</span> $_(<span class="string">&#x27;section&#x27;</span>, <span class="literal">undefined</span>, <span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">const</span> section = sections[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (!(section &amp;&amp; section.<span class="property">innerText</span>.<span class="title function_">includes</span>(<span class="string">&#x27;系统正在维护中&#x27;</span>))) &#123;</span><br><span class="line">        <span class="comment">// 文章选读</span></span><br><span class="line">        <span class="title function_">reading</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;未找到文章!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;未找到文章!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭页面</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// videos</span></span><br><span class="line">    <span class="keyword">const</span> videos = <span class="keyword">await</span> $_(<span class="string">&#x27;video&#x27;</span>, <span class="literal">undefined</span>, <span class="number">10000</span>);</span><br><span class="line">    <span class="comment">// 视频</span></span><br><span class="line">    <span class="keyword">const</span> video = videos[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 播放按键</span></span><br><span class="line">    <span class="keyword">const</span> playBtn = $$(<span class="string">&#x27;.prism-play-btn&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (video &amp;&amp; playBtn) &#123;</span><br><span class="line">        <span class="comment">// 设置是否静音</span></span><br><span class="line">        video.<span class="property">muted</span> = muted;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;正在尝试播放视频...&#x27;</span>);</span><br><span class="line">        <span class="comment">// 播放超时</span></span><br><span class="line">        <span class="keyword">const</span> timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;视频播放超时!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;视频播放超时!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 关闭页面</span></span><br><span class="line">            <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">        &#125;, <span class="number">20000</span>);</span><br><span class="line">        <span class="comment">// 能播放</span></span><br><span class="line">        video.<span class="title function_">addEventListener</span>(<span class="string">&#x27;canplay&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;正在尝试播放视频...&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (video.<span class="property">paused</span>) &#123;</span><br><span class="line">                <span class="comment">// 尝试使用js的方式播放</span></span><br><span class="line">                video.<span class="title function_">play</span>();</span><br><span class="line">                <span class="keyword">if</span> (video.<span class="property">paused</span>) &#123;</span><br><span class="line">                    <span class="comment">// 尝试点击播放按钮播放</span></span><br><span class="line">                    playBtn.<span class="title function_">click</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已经播放</span></span><br><span class="line">            <span class="keyword">if</span> (!video.<span class="property">paused</span>) &#123;</span><br><span class="line">                <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">                <span class="comment">// 视听学习</span></span><br><span class="line">                <span class="title function_">reading</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;未找到视频!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭页面</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 读新闻或者看视频</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type :0为新闻,1为视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">reading</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> time = <span class="number">30</span>;</span><br><span class="line">    <span class="comment">// 文章选读</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 章节</span></span><br><span class="line">        <span class="keyword">const</span> sections = $$(<span class="string">&#x27;section&#x27;</span>);</span><br><span class="line">        <span class="comment">// 最大字数</span></span><br><span class="line">        <span class="keyword">const</span> maxTextCount = <span class="title class_">Math</span>.<span class="title function_">max</span>(...sections.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s.<span class="property">innerText</span>.<span class="property">length</span>), <span class="number">200</span>);</span><br><span class="line">        <span class="comment">// 预计时间</span></span><br><span class="line">        <span class="keyword">const</span> predictTime = ~~((<span class="number">60</span> * maxTextCount) / <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// min(predictTime,  maxWatch.value) 秒后关闭页面</span></span><br><span class="line">        time = <span class="title class_">Math</span>.<span class="title function_">min</span>(predictTime, maxRead.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 视听学习</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 视频</span></span><br><span class="line">        <span class="keyword">const</span> video = $$(<span class="string">&#x27;video&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 预计时间</span></span><br><span class="line">        <span class="keyword">const</span> predictTime = ~~video.<span class="property">duration</span>;</span><br><span class="line">        <span class="comment">// min(predictTime,  maxWatch.value) 秒后关闭页面</span></span><br><span class="line">        time = <span class="title class_">Math</span>.<span class="title function_">min</span>(predictTime, maxWatch.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    time = time - ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) + <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 第一次滚动时间</span></span><br><span class="line">    <span class="keyword">const</span> firstTime = time - (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>) + <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// 第二次滚动时间</span></span><br><span class="line">    <span class="keyword">const</span> secendTime = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>) + <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 窗口</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable language_">window</span> = unsafeWindow;</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="keyword">const</span> tip = <span class="title function_">createTip</span>(<span class="string">&#x27;距离关闭页面还剩&#x27;</span>, time, <span class="literal">true</span>, <span class="keyword">async</span> (time) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 暂停锁</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>(<span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 视频</span></span><br><span class="line">                <span class="keyword">const</span> video = $$(<span class="string">&#x27;video&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">// 排除反复设置</span></span><br><span class="line">                <span class="keyword">if</span> (video.<span class="property">paused</span> === !flag) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 设置播放状态</span></span><br><span class="line">                video[flag ? <span class="string">&#x27;play&#x27;</span> : <span class="string">&#x27;pause&#x27;</span>]();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 第一次滚动</span></span><br><span class="line">        <span class="keyword">if</span> (time === firstTime) &#123;</span><br><span class="line">            <span class="comment">// 滚动</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="number">400</span>);</span><br><span class="line">            <span class="comment">// 模拟滚动</span></span><br><span class="line">            <span class="keyword">const</span> scroll = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;scroll&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(scroll);</span><br><span class="line">            <span class="comment">// 模拟滑动</span></span><br><span class="line">            <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">            <span class="comment">// 模拟点击</span></span><br><span class="line">            <span class="keyword">const</span> click = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(click);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 第二次滚动</span></span><br><span class="line">        <span class="keyword">if</span> (time === secendTime) &#123;</span><br><span class="line">            <span class="comment">// 滚动长度</span></span><br><span class="line">            <span class="keyword">const</span> scrollLength = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollHeight</span> / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 滚动</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, scrollLength);</span><br><span class="line">            <span class="comment">// 模拟滚动</span></span><br><span class="line">            <span class="keyword">const</span> scroll = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;scroll&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(scroll);</span><br><span class="line">            <span class="comment">// 模拟滑动</span></span><br><span class="line">            <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">            <span class="comment">// 模拟点击</span></span><br><span class="line">            <span class="keyword">const</span> click = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(click);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 倒计时结束</span></span><br><span class="line">    <span class="keyword">await</span> tip.<span class="title function_">waitCountDown</span>();</span><br><span class="line">    <span class="comment">// 关闭任务窗口</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取新闻列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 需要学习的新闻数量</span></span><br><span class="line">    <span class="keyword">const</span> need = taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span> &lt; maxNewsNum</span><br><span class="line">        ? taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span></span><br><span class="line">        : maxNewsNum;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`剩余 <span class="subst">$&#123;need&#125;</span> 个新闻`</span>);</span><br><span class="line">    <span class="comment">// 获取新闻</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getNewsList</span>();</span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 索引</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 最新新闻</span></span><br><span class="line">        <span class="keyword">const</span> latestItems = data.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 当前年份</span></span><br><span class="line">        <span class="keyword">const</span> currentYear = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>().<span class="title function_">toString</span>();</span><br><span class="line">        <span class="comment">// 查找今年新闻</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; need) &#123;</span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * latestItems.<span class="property">length</span>);</span><br><span class="line">            <span class="comment">// 新闻</span></span><br><span class="line">            <span class="keyword">const</span> item = latestItems[randomIndex];</span><br><span class="line">            <span class="comment">// 是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">publishTime</span>.<span class="title function_">startsWith</span>(currentYear) &amp;&amp; item.<span class="property">type</span> === <span class="string">&#x27;tuwen&#x27;</span>) &#123;</span><br><span class="line">                news[i] = item;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        news = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取视频列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getVideos</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 需要学习的视频数量</span></span><br><span class="line">    <span class="keyword">const</span> need = taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span> &lt; maxVideoNum</span><br><span class="line">        ? taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span></span><br><span class="line">        : maxVideoNum;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`剩余 <span class="subst">$&#123;need&#125;</span> 个视频`</span>);</span><br><span class="line">    <span class="comment">// 获取视频</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getVideoList</span>();</span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 索引</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 最新视频</span></span><br><span class="line">        <span class="keyword">const</span> latestItems = data.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 当前年份</span></span><br><span class="line">        <span class="keyword">const</span> currentYear = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>().<span class="title function_">toString</span>();</span><br><span class="line">        <span class="comment">// 查找今年视频</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; need) &#123;</span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * latestItems.<span class="property">length</span>);</span><br><span class="line">            <span class="comment">// 新闻</span></span><br><span class="line">            <span class="keyword">const</span> item = latestItems[randomIndex];</span><br><span class="line">            <span class="comment">// 是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">publishTime</span>.<span class="title function_">startsWith</span>(currentYear) &amp;&amp;</span><br><span class="line">                (item.<span class="property">type</span> === <span class="string">&#x27;shipin&#x27;</span> || item.<span class="property">type</span> === <span class="string">&#x27;juji&#x27;</span>)) &#123;</span><br><span class="line">                videos[i] = item;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        videos = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 阅读文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取文章</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getNews</span>();</span><br><span class="line">    <span class="comment">// 观看文章</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> news) &#123;</span><br><span class="line">        <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`正在阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻...`</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`正在阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻`</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> &#123; url &#125; = news[i];</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>, url);</span><br><span class="line">        <span class="comment">// 等待任务窗口</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;文章选读&#x27;</span>);</span><br><span class="line">        <span class="comment">// 清空链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`完成阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻!`</span>);</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 刷新分数数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">        <span class="comment">// 刷新任务数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">        <span class="comment">// 任务完成跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp; taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">    <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp; !taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续阅读新闻!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续阅读新闻!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">readNews</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 观看视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">watchVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取视频</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getVideos</span>();</span><br><span class="line">    <span class="comment">// 观看视频</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> videos) &#123;</span><br><span class="line">        <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`正在观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频...`</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`正在观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频`</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> &#123; url &#125; = videos[i];</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>, url);</span><br><span class="line">        <span class="comment">// 等待任务窗口</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;视听学习&#x27;</span>);</span><br><span class="line">        <span class="comment">// 清空链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`完成观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频!`</span>);</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 刷新分数数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">        <span class="comment">// 刷新任务数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">        <span class="comment">// 任务完成跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">            taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">    <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp; !taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续观看视频!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续观看看视频!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">watchVideo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时刷新定时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> scheduleTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新定时任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshScheduleTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除定时刷新</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="comment">// 剩余定时任务</span></span><br><span class="line">        <span class="keyword">const</span> restList = scheduleList.<span class="title function_">filter</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> !<span class="title function_">isLate</span>(s));</span><br><span class="line">        <span class="comment">// 存在剩余任务</span></span><br><span class="line">        <span class="keyword">if</span> (restList.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> rest = restList[<span class="number">0</span>];</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">`已设置 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">            <span class="comment">// 提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`已设置 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">            <span class="comment">// 时间</span></span><br><span class="line">            <span class="keyword">let</span> time = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 刷新间隔</span></span><br><span class="line">            <span class="keyword">const</span> interval = <span class="number">10</span>;</span><br><span class="line">            scheduleTimer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!(time++ % interval)) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;定时刷新正在运行...&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 到达定时</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_">isNow</span>(rest)) &#123;</span><br><span class="line">                    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">`执行 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">                    <span class="comment">// 提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`执行 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">                    <span class="comment">// 登录</span></span><br><span class="line">                    <span class="title function_">handleLogin</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 清除定时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearScheduleTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建学习提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createTip</span>(<span class="params">text, delay = <span class="number">2</span>, countShow = <span class="literal">false</span>, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tipWrap = $$(<span class="string">&#x27;.egg_tip_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 提前去除</span></span><br><span class="line">    <span class="keyword">const</span> tips = $$(<span class="string">&#x27;.egg_tip&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (tips.<span class="property">length</span>) &#123;</span><br><span class="line">        tips.<span class="title function_">forEach</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="title function_">delay</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 延迟</span></span><br><span class="line">    <span class="keyword">const</span> delayCount = <span class="title function_">ref</span>(delay);</span><br><span class="line">    <span class="comment">// 文字</span></span><br><span class="line">    <span class="keyword">const</span> textContent = <span class="title function_">ref</span>(text);</span><br><span class="line">    <span class="comment">//显示</span></span><br><span class="line">    <span class="keyword">const</span> show = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 延迟显示</span></span><br><span class="line">    <span class="keyword">const</span> delayShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 销毁</span></span><br><span class="line">    <span class="keyword">let</span> destroyed = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 倒计时结束</span></span><br><span class="line">    <span class="keyword">let</span> done = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="keyword">const</span> tip = <span class="title class_">Tip</span>(&#123;</span><br><span class="line">        <span class="attr">text</span>: textContent,</span><br><span class="line">        <span class="attr">count</span>: delayCount,</span><br><span class="line">        show,</span><br><span class="line">        delayShow,</span><br><span class="line">        <span class="attr">countShow</span>: <span class="title function_">ref</span>(countShow),</span><br><span class="line">        <span class="attr">callback</span>: <span class="keyword">async</span> (count) =&gt; &#123;</span><br><span class="line">            callback &amp;&amp; (<span class="keyword">await</span> <span class="title function_">callback</span>(count));</span><br><span class="line">            <span class="comment">// 恢复显示</span></span><br><span class="line">            <span class="keyword">if</span> (delayShow.<span class="property">value</span> &amp;&amp; count === delay) &#123;</span><br><span class="line">                delayShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 倒计时结束</span></span><br><span class="line">            <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                done = <span class="literal">true</span>;</span><br><span class="line">                operate.<span class="title function_">destroy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 操作</span></span><br><span class="line">    <span class="keyword">const</span> operate = &#123;</span><br><span class="line">        <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                <span class="comment">// 隐藏</span></span><br><span class="line">                operate.<span class="title function_">hide</span>();</span><br><span class="line">                <span class="comment">// 销毁</span></span><br><span class="line">                destroyed = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        tip.<span class="property">ele</span>.<span class="title function_">remove</span>();</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">                    &#125;, <span class="number">300</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">hide</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                show.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        show.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">                    &#125;, <span class="number">300</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">setText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                textContent.<span class="property">value</span> = text;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">waitCountDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 计时器</span></span><br><span class="line">                <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 结束</span></span><br><span class="line">                    <span class="keyword">if</span> (done) &#123;</span><br><span class="line">                        <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">100</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">delay</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                delayShow.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                delayCount.<span class="property">value</span> += <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(tip.<span class="property">ele</span>, operate);</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(tip, tipWrap);</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    operate.<span class="title function_">show</span>();</span><br><span class="line">    <span class="keyword">return</span> operate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 已存在信息</span></span><br><span class="line">    <span class="keyword">if</span> (userinfo.<span class="property">nick</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载用户信息...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>();</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; avatarMediaUrl = <span class="string">&#x27;&#x27;</span>, <span class="attr">nick</span>: nickRes &#125; = res;</span><br><span class="line">        <span class="keyword">if</span> (nickRes) &#123;</span><br><span class="line">            <span class="comment">// 设置昵称</span></span><br><span class="line">            userinfo.<span class="property">nick</span> = nickRes;</span><br><span class="line">            <span class="comment">// 设置头像</span></span><br><span class="line">            userinfo.<span class="property">avatar</span> = avatarMediaUrl;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载用户信息失败!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新分数信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshScoreInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载分数信息...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取总分</span></span><br><span class="line">    <span class="keyword">const</span> totalScoreRes = <span class="keyword">await</span> <span class="title function_">getTotalScore</span>();</span><br><span class="line">    <span class="comment">// 获取当天总分</span></span><br><span class="line">    <span class="keyword">const</span> todayScoreRes = <span class="keyword">await</span> <span class="title function_">getTodayScore</span>();</span><br><span class="line">    <span class="comment">// 整数值</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(totalScoreRes) &amp;&amp; <span class="title class_">Number</span>.<span class="title function_">isInteger</span>(todayScoreRes)) &#123;</span><br><span class="line">        <span class="comment">// 设置分数</span></span><br><span class="line">        totalScore.<span class="property">value</span> = totalScoreRes;</span><br><span class="line">        todayScore.<span class="property">value</span> = todayScoreRes;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载分数信息失败!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新任务列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshTaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载任务进度...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 原始任务进度</span></span><br><span class="line">    <span class="keyword">const</span> taskProgress = <span class="keyword">await</span> <span class="title function_">getTaskList</span>();</span><br><span class="line">    <span class="keyword">if</span> (taskProgress) &#123;</span><br><span class="line">        <span class="comment">// 登录</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">2</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">2</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">2</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">2</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 文章选读</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">0</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">0</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">0</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">0</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 视听学习</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">1</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">1</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">1</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">1</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 每日答题</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">3</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">3</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">need</span> = taskProgress[<span class="number">3</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        <span class="comment">// 更新数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> taskConfig) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; currentScore, dayMaxScore &#125; = taskConfig[i];</span><br><span class="line">            <span class="comment">// 进度</span></span><br><span class="line">            <span class="keyword">const</span> rate = <span class="title class_">Number</span>(((<span class="number">100</span> * currentScore) / dayMaxScore).<span class="title function_">toFixed</span>(<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// 百分比</span></span><br><span class="line">            taskConfig[i].<span class="property">percent</span> = rate;</span><br><span class="line">            <span class="comment">// 分数</span></span><br><span class="line">            taskConfig[i].<span class="property">score</span> = currentScore;</span><br><span class="line">            <span class="comment">// 完成状态</span></span><br><span class="line">            taskConfig[i].<span class="property">status</span> = rate === <span class="number">100</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重试</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">    <span class="title function_">refreshTaskList</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Tip</span>(<span class="params">&#123; text, count, show, delayShow, countShow, callback, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchRef</span>([show, delayShow], <span class="function">() =&gt;</span> <span class="string">`egg_tip<span class="subst">$&#123;show.value ? (delayShow.value ? <span class="string">&#x27; active delay&#x27;</span> : <span class="string">&#x27; active&#x27;</span>) : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_text&#x27;</span>,</span><br><span class="line">        &#125;, <span class="title function_">createTextNode</span>(text)),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> countShow.<span class="property">value</span></span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_countdown&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;count.value&#125;</span>s`</span>)))</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">    ], &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 倒计时</span></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">countDown</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">                <span class="comment">// 倒计时回调</span></span><br><span class="line">                <span class="keyword">await</span> <span class="title function_">callback</span>(count.<span class="property">value</span>);</span><br><span class="line">                <span class="comment">// 倒计时结束</span></span><br><span class="line">                <span class="keyword">if</span> (!count.<span class="property">value</span>) &#123;</span><br><span class="line">                    show.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                count.<span class="property">value</span>--;</span><br><span class="line">                <span class="built_in">setTimeout</span>(countDown, <span class="number">1000</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">countDown</span>();</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分隔符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Hr</span>(<span class="params">&#123; text &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_hr_wrap&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr_title&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(text)),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr&#x27;</span> &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Select</span>(<span class="params">&#123; data, maxlength, placeholder = <span class="string">&#x27;&#x27;</span>, onchange, onblur, value, keep, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> selectData = <span class="title function_">reactive</span>(data.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (&#123; <span class="attr">selected</span>: <span class="literal">false</span>, <span class="attr">active</span>: <span class="literal">false</span>, <span class="attr">ele</span>: <span class="literal">undefined</span>, ...v &#125;)));</span><br><span class="line">    <span class="keyword">const</span> focus = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> input = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="keyword">const</span> list = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="keyword">const</span> valueRef = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    value &amp;&amp;</span><br><span class="line">        <span class="title function_">watch</span>(value, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> item = selectData.<span class="title function_">find</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">value</span> === value.<span class="property">value</span>);</span><br><span class="line">            valueRef.<span class="property">value</span> = item ? item.<span class="property">label</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">                selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (v.<span class="property">selected</span> = <span class="literal">false</span>));</span><br><span class="line">                list.<span class="property">value</span> &amp;&amp; (list.<span class="property">value</span>.<span class="property">scrollTop</span> = <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_select&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, &#123; <span class="attr">value</span>: valueRef &#125;, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_select_input&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">            placeholder,</span><br><span class="line">            maxlength,</span><br><span class="line">            <span class="attr">ref</span>: input,</span><br><span class="line">            <span class="title function_">onfocus</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    focus.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (input.<span class="property">value</span>.<span class="property">value</span> &amp;&amp; valueRef.<span class="property">value</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> index = selectData.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">label</span> === valueRef.<span class="property">value</span>);</span><br><span class="line">                        <span class="keyword">if</span> (index + <span class="number">1</span>) &#123;</span><br><span class="line">                            list.<span class="property">value</span>.<span class="property">scrollTop</span> = selectData[index].<span class="property">ele</span>?.<span class="property">offsetTop</span> || <span class="number">0</span>;</span><br><span class="line">                            selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (v.<span class="property">selected</span> = i === index));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">oninput</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; value &#125; = input.<span class="property">value</span>;</span><br><span class="line">                    <span class="comment">// 文本存在</span></span><br><span class="line">                    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">                        <span class="keyword">const</span> index = selectData.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">label</span>.<span class="title function_">includes</span>(value));</span><br><span class="line">                        <span class="comment">// 存在匹配</span></span><br><span class="line">                        <span class="keyword">if</span> (index + <span class="number">1</span>) &#123;</span><br><span class="line">                            list.<span class="property">value</span>.<span class="property">scrollTop</span> = selectData[index].<span class="property">ele</span>?.<span class="property">offsetTop</span> || <span class="number">0</span>;</span><br><span class="line">                            selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">                                v.<span class="property">active</span> = i === index;</span><br><span class="line">                                v.<span class="property">active</span> &amp;&amp;</span><br><span class="line">                                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                        v.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">                                    &#125;, <span class="number">300</span>);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 清除</span></span><br><span class="line">                    selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (v.<span class="property">active</span> = v.<span class="property">selected</span> = <span class="literal">false</span>));</span><br><span class="line">                    list.<span class="property">value</span>.<span class="property">scrollTop</span> = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onblur</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> item = selectData.<span class="title function_">find</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">selected</span>);</span><br><span class="line">                    <span class="comment">// 关闭选项</span></span><br><span class="line">                    <span class="keyword">if</span> (item || !input.<span class="property">value</span>.<span class="property">value</span>) &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            focus.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;, <span class="number">100</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 恢复文本</span></span><br><span class="line">                    <span class="keyword">if</span> (item &amp;&amp; input.<span class="property">value</span>.<span class="property">value</span> !== item.<span class="property">label</span>) &#123;</span><br><span class="line">                        input.<span class="property">value</span>.<span class="property">value</span> = item.<span class="property">label</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 保留文本</span></span><br><span class="line">                    <span class="keyword">if</span> (!item &amp;&amp; keep) &#123;</span><br><span class="line">                        input.<span class="property">value</span>.<span class="property">value</span> = valueRef.<span class="property">value</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    onblur &amp;&amp;</span><br><span class="line">                        <span class="title function_">onblur</span>(item ? &#123; <span class="attr">label</span>: item.<span class="property">label</span>, <span class="attr">value</span>: item.<span class="property">value</span> &#125; : <span class="literal">undefined</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_select_list<span class="subst">$&#123;focus.value ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">            <span class="attr">ref</span>: list,</span><br><span class="line">        &#125;, selectData.<span class="title function_">map</span>(<span class="function">(<span class="params">v, index</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [v.<span class="property">selected</span>, v.<span class="property">active</span>], <span class="function">() =&gt;</span> <span class="string">`egg_select_item<span class="subst">$&#123;v.selected ? <span class="string">&#x27; selected&#x27;</span> : v.active ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">            <span class="attr">ref</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> (v.<span class="property">ele</span> = e),</span><br><span class="line">            <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (valueRef.<span class="property">value</span> !== v.<span class="property">label</span>) &#123;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(&#123; <span class="attr">label</span>: v.<span class="property">label</span>, <span class="attr">value</span>: v.<span class="property">value</span> &#125;);</span><br><span class="line">                    selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">                        v.<span class="property">selected</span> = i === index;</span><br><span class="line">                        v.<span class="property">selected</span> &amp;&amp; (valueRef.<span class="property">value</span> = v.<span class="property">label</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                focus.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">        &#125;, <span class="title function_">createTextNode</span>(v.<span class="property">label</span>)))),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ExamBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_exam_btn<span class="subst">$&#123;examPause.value ? <span class="string">&#x27; manual&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">        <span class="attr">onclick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            examPause.<span class="property">value</span> = !examPause.<span class="property">value</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;examPause.value ? <span class="string">&#x27;开启自动答题&#x27;</span> : <span class="string">&#x27;关闭自动答题&#x27;</span>&#125;</span>`</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务窗口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Frame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 最大化</span></span><br><span class="line">    <span class="keyword">const</span> max = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 容器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_frame_wrap<span class="subst">$&#123;frame.show ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [login.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 同屏任务</span></span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span> &amp;&amp; settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                <span class="comment">// 遮罩</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_frame_mask&#x27;</span> &#125;),</span><br><span class="line">                <span class="comment">// 窗口内容</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_frame_content_wrap <span class="subst">$&#123;max.value ? <span class="string">&#x27; max&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="comment">// 窗口控制</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_frame_controls_wrap&#x27;</span> &#125;, [</span><br><span class="line">                        <span class="comment">// 标题</span></span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_frame_title&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_frame_controls&#x27;</span>,</span><br><span class="line">                        &#125;, [</span><br><span class="line">                            <span class="comment">// 隐藏</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;隐藏&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 隐藏窗口</span></span><br><span class="line">                                    frame.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M863.7 552.5H160.3c-10.6 0-19.2-8.6-19.2-19.2v-41.7c0-10.6 8.6-19.2 19.2-19.2h703.3c10.6 0 19.2 8.6 19.2 19.2v41.7c0 10.6-8.5 19.2-19.1 19.2z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                            <span class="comment">// 改变大小</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;缩放&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    max.<span class="property">value</span> = !max.<span class="property">value</span>;</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M609.52 584.92a35.309 35.309 0 0 1 24.98-10.36c9.37 0 18.36 3.73 24.98 10.36l189.29 189.22-0.07-114.3 0.57-6.35c3.25-17.98 19.7-30.5 37.9-28.85 18.2 1.65 32.12 16.92 32.09 35.2v200.23c-0.05 1.49-0.19 2.97-0.42 4.45l-0.21 1.13c-0.22 1.44-0.55 2.85-0.99 4.24l-0.57 1.62-0.56 1.41a34.163 34.163 0 0 1-7.62 11.36l2.12-2.4-0.14 0.14-0.92 1.06-1.06 1.2-0.57 0.57-0.56 0.57a36.378 36.378 0 0 1-16.23 8.39l-3.53 0.5-4.02 0.35h-199.6l-6.35-0.63c-16.73-3.06-28.9-17.63-28.93-34.64l0.56-6.35c3.07-16.76 17.67-28.93 34.71-28.92l114.29-0.14-189.07-189.1-4.09-4.94c-9.71-14.01-8.01-32.95 4.02-45.02z m-162.06 0c12.06 12.05 13.78 30.99 4.09 45.01l-4.09 4.94-189.15 189.08 114.3 0.14c17.04-0.01 31.65 12.17 34.71 28.92l0.57 6.35c-0.03 17.01-12.19 31.58-28.92 34.64l-6.35 0.63H173.09l-4.23-0.42-3.39-0.49a36.38 36.38 0 0 1-17.36-9.52l-1.06-1.13-0.98-1.13 0.98 1.06-1.97-2.26 0.85 1.06-0.42-0.56a35.137 35.137 0 0 1-3.74-5.64l-1.13-2.68a34.71 34.71 0 0 1-2.11-7.33l-0.28-1.13c-0.21-1.47-0.33-2.96-0.36-4.45V659.78c-0.03-18.28 13.89-33.55 32.09-35.2 18.2-1.65 34.65 10.87 37.9 28.85l0.57 6.35-0.07 114.36 189.29-189.22c13.77-13.77 36.11-13.77 49.88 0h-0.09z m-74.71-471.71l6.35 0.57c16.76 3.06 28.93 17.67 28.92 34.71l-0.63 6.35c-3.07 16.76-17.67 28.93-34.71 28.92l-114.3 0.14 189.15 189.08 4.09 4.94c10.26 15.02 7.42 35.37-6.55 47.01-13.98 11.63-34.51 10.74-47.42-2.07L208.29 233.71l0.07 114.3-0.57 6.35c-3.25 17.98-19.7 30.5-37.9 28.85-18.2-1.65-32.12-16.92-32.09-35.2V147.78c0-1.55 0.14-3.03 0.35-4.51l0.21-1.13c0.24-1.44 0.59-2.85 1.06-4.23a34.97 34.97 0 0 1 8.68-14.39l-2.12 2.4-0.42 0.57 1.55-1.84-0.99 1.06 0.92-0.98 2.26-2.33c3.04-2.73 6.52-4.92 10.3-6.49l2.82-1.06c3.45-1.07 7.04-1.62 10.65-1.62l-3.6 0.14h0.49l1.48-0.14h201.31z m512.91 0l1.41 0.14h0.42c2.43 0.29 4.84 0.79 7.19 1.48l2.82 1.06 2.61 1.2 3.04 1.76c2.09 1.33 4.03 2.89 5.78 4.66l1.13 1.2 0.78 0.98 0.21 0.14 0.49 0.64 2.33 3.17c2.35 3.83 3.98 8.07 4.8 12.49l0.21 1.13c0.21 1.48 0.35 2.96 0.35 4.44v200.37c-0.16 18.13-14.03 33.19-32.08 34.83-18.06 1.64-34.42-10.67-37.83-28.48l-0.57-6.35V233.65L659.54 422.87c-12.9 12.95-33.56 13.91-47.59 2.2-14.04-11.71-16.81-32.2-6.38-47.22l4.02-4.86 189.22-189.08-114.29-0.14c-17.06 0.04-31.71-12.14-34.78-28.92l-0.63-6.35c-0.01-17.04 12.16-31.65 28.93-34.71l6.35-0.57h201.27z m0 0&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                            <span class="comment">// 关闭</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 关闭窗口</span></span><br><span class="line">                                    <span class="title function_">closeFrame</span>();</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M453.44 512L161.472 220.032a41.408 41.408 0 0 1 58.56-58.56L512 453.44 803.968 161.472a41.408 41.408 0 0 1 58.56 58.56L570.56 512l291.968 291.968a41.408 41.408 0 0 1-58.56 58.56L512 570.56 220.032 862.528a41.408 41.408 0 0 1-58.56-58.56L453.44 512z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                    <span class="comment">// 窗口内容</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_frame_content&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> frame.<span class="property">src</span></span><br><span class="line">                        ? [</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;iframe&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame&#x27;</span>,</span><br><span class="line">                                <span class="attr">src</span>: frame.<span class="property">src</span>,</span><br><span class="line">                                <span class="title function_">ref</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">                                    frame.<span class="property">ele</span> = ele;</span><br><span class="line">                                &#125;,</span><br><span class="line">                            &#125;, <span class="literal">undefined</span>),</span><br><span class="line">                        ]</span><br><span class="line">                        : <span class="literal">undefined</span>)),</span><br><span class="line">                ], &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="comment">// 隐藏窗口</span></span><br><span class="line">                        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [</span><br><span class="line">                            taskStatus.<span class="property">value</span>,</span><br><span class="line">                            running.<span class="property">value</span>,</span><br><span class="line">                            settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>],</span><br><span class="line">                            settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>],</span><br><span class="line">                        ], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 同屏任务</span></span><br><span class="line">                            <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp;</span><br><span class="line">                                (taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span> ||</span><br><span class="line">                                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span> ||</span><br><span class="line">                                    running.<span class="property">value</span>)) &#123;</span><br><span class="line">                                <span class="comment">// 设置窗口显示</span></span><br><span class="line">                                frame.<span class="property">show</span> = !settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>];</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;),</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;), &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 关闭窗口</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [login.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]], <span class="function">() =&gt;</span> login.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] ? <span class="title function_">closeWin</span>() : <span class="title function_">closeFrame</span>()));</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> login.<span class="property">value</span></span><br><span class="line">            ? <span class="literal">undefined</span></span><br><span class="line">            : <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_login_item&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="comment">// 登录按钮</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                        <span class="comment">// 开始登录</span></span><br><span class="line">                        <span class="title function_">handleLogin</span>();</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;扫码登录&#x27;</span>)),</span><br><span class="line">                <span class="comment">// 窗口</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_login_img_wrap<span class="subst">$&#123;loginQRCodeShow.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;img&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_img&#x27;</span>,</span><br><span class="line">                &#125;)),</span><br><span class="line">            ], &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 未开启定时展示二维码</span></span><br><span class="line">                        <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                            <span class="comment">// 开始登录</span></span><br><span class="line">                            <span class="title function_">handleLogin</span>();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="literal">true</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">InfoItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_info_item&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="comment">// 用户信息</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_userinfo&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="comment">// 头像</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_avatar&#x27;</span> &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [</span><br><span class="line">                            userinfo.<span class="property">avatar</span></span><br><span class="line">                                ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;img&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">src</span>: userinfo.<span class="property">avatar</span>,</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_avatar_img&#x27;</span>,</span><br><span class="line">                                &#125;)</span><br><span class="line">                                : <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_avatar_nick&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> userinfo.<span class="property">nick</span>.<span class="title function_">substring</span>(<span class="number">1</span>, <span class="number">3</span>)))),</span><br><span class="line">                        ];</span><br><span class="line">                    &#125;)),</span><br><span class="line">                    <span class="comment">// 昵称</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_nick&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> userinfo.<span class="property">nick</span>))),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="comment">// 退出按钮</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 退出登录</span></span><br><span class="line">                        <span class="title function_">handleLogout</span>();</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;退出&#x27;</span>)),</span><br><span class="line">            ], &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="comment">// 刷新用户信息</span></span><br><span class="line">                    <span class="title function_">refreshUserInfo</span>();</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分数详情</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ScoreItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 分数显示</span></span><br><span class="line">            <span class="keyword">const</span> scoreShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">// 分数信息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_score_item&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_scoreinfo&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_totalscore&#x27;</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createTextNode</span>(<span class="string">&#x27;总积分&#x27;</span>),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="title function_">createTextNode</span>(totalScore)),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_todayscore&#x27;</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_todayscore_btn&#x27;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;查看分数详情&#x27;</span>,</span><br><span class="line">                        <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            scoreShow.<span class="property">value</span> = !scoreShow.<span class="property">value</span>;</span><br><span class="line">                        &#125;, <span class="number">300</span>),</span><br><span class="line">                        <span class="attr">onblur</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            scoreShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createTextNode</span>(<span class="string">&#x27;当天分数&#x27;</span>),</span><br><span class="line">                        <span class="comment">// 当天分数</span></span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="title function_">createTextNode</span>(todayScore)),</span><br><span class="line">                        <span class="comment">// icon</span></span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                        &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M332.16 883.84a40.96 40.96 0 0 0 58.24 0l338.56-343.04a40.96 40.96 0 0 0 0-58.24L390.4 140.16a40.96 40.96 0 0 0-58.24 58.24L640 512l-307.84 314.24a40.96 40.96 0 0 0 0 57.6z&#x27;</span>,</span><br><span class="line">                        &#125;)),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_score_details<span class="subst">$&#123;scoreShow.value ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                        &#125;, [</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_score_title&#x27;</span> &#125;, [</span><br><span class="line">                                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                                &#125;, [</span><br><span class="line">                                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                        <span class="attr">d</span>: <span class="string">&#x27;M314.81 304.01h415.86v58.91H314.81zM314.81 440.24h415.86v58.91H314.81z&#x27;</span>,</span><br><span class="line">                                    &#125;),</span><br><span class="line">                                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                        <span class="attr">d</span>: <span class="string">&#x27;M814.8 892.74h-8.64l-283.51-182-283.51 182h-8.64A69.85 69.85 0 0 1 160.72 823V188.22a69.85 69.85 0 0 1 69.77-69.77H814.8a69.85 69.85 0 0 1 69.77 69.77V823a69.85 69.85 0 0 1-69.77 69.74zM230.5 177.35a10.87 10.87 0 0 0-10.86 10.86V823a10.86 10.86 0 0 0 5 9.11l298.01-191.42 298.06 191.38a10.86 10.86 0 0 0 5-9.11V188.22a10.87 10.87 0 0 0-10.86-10.86z&#x27;</span>,</span><br><span class="line">                                    &#125;),</span><br><span class="line">                                ]),</span><br><span class="line">                                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_score_title_text&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;积分详情&#x27;</span>)),</span><br><span class="line">                            ]),</span><br><span class="line">                            ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_score_item&#x27;</span> &#125;, [</span><br><span class="line">                                <span class="title function_">createTextNode</span>(task.<span class="property">title</span>),</span><br><span class="line">                                <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_score_detail&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> task.<span class="property">score</span>))),</span><br><span class="line">                            ])),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                ]),</span><br><span class="line">            ]), &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="comment">// 刷新分数信息</span></span><br><span class="line">                    <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置普通项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NomalItem</span>(<span class="params">&#123; title, tip, checked, onchange, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_setting_item&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_label_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;label&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createTextNode</span>(title),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_detail&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: tip,</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;i&#x27;</span>)),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: tip,</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_switch&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">            checked,</span><br><span class="line">            onchange,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置任务项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskItem</span>(<span class="params">&#123; title, tip, checked, percent, currentScore, dayMaxScore, onchange, immutable, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_task_item&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_label_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title_wrap&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(title)),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_progress_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_task_current&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(currentScore)),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_task_max&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`/<span class="subst">$&#123;dayMaxScore.value&#125;</span>`</span>))),</span><br><span class="line">                ]),</span><br><span class="line">            ]),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_progress&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_track&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_bar&#x27;</span>,</span><br><span class="line">                    <span class="attr">style</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`width: <span class="subst">$&#123;percent.value&#125;</span>%;`</span>),</span><br><span class="line">                &#125;)),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: tip,</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_switch&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">            checked,</span><br><span class="line">            onchange,</span><br><span class="line">            <span class="attr">disabled</span>: immutable,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 处理任务设置变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleTaskChange</span> = (<span class="params">e, type, title</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 开关</span></span><br><span class="line">        <span class="keyword">const</span> &#123; checked &#125; = e.<span class="property">target</span>;</span><br><span class="line">        <span class="keyword">if</span> (taskConfig[type].<span class="property">active</span> !== checked) &#123;</span><br><span class="line">            taskConfig[type].<span class="property">active</span> = checked;</span><br><span class="line">            <span class="comment">// 设置</span></span><br><span class="line">            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(taskConfig));</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`<span class="subst">$&#123;title&#125;</span> <span class="subst">$&#123;checked ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 登录加载</span></span><br><span class="line">    <span class="title function_">watch</span>(login, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 加载任务列表</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">            <span class="comment">// 未完成任务</span></span><br><span class="line">            <span class="keyword">if</span> (taskConfig.<span class="title function_">some</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>)) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">                <span class="comment">// 加载完毕</span></span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 任务完毕</span></span><br><span class="line">            taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_task_list&#x27;</span>,</span><br><span class="line">    &#125;, taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> label.<span class="property">immutable</span></span><br><span class="line">        ? <span class="title class_">TaskItem</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">            <span class="attr">checked</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">active</span>),</span><br><span class="line">            <span class="attr">percent</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">percent</span>),</span><br><span class="line">            <span class="attr">currentScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">currentScore</span>),</span><br><span class="line">            <span class="attr">dayMaxScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">dayMaxScore</span>),</span><br><span class="line">            <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">handleTaskChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">            <span class="attr">immutable</span>: label.<span class="property">immutable</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        : <span class="title class_">TaskItem</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">            <span class="attr">checked</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">active</span>),</span><br><span class="line">            <span class="attr">percent</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">percent</span>),</span><br><span class="line">            <span class="attr">currentScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">currentScore</span>),</span><br><span class="line">            <span class="attr">dayMaxScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">dayMaxScore</span>),</span><br><span class="line">            <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">handleTaskChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">            <span class="attr">immutable</span>: label.<span class="property">immutable</span>,</span><br><span class="line">        &#125;)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 学习</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">study</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;开始学习!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 暂停</span></span><br><span class="line">                <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                <span class="comment">// 文章选读</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务一: 文章选读&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务一: 文章选读&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 看新闻</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">readNews</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务一: 文章选读已完成!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 视听学习</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务二: 视听学习&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务二: 视听学习&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 看视频</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">watchVideo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务二: 视听学习已完成!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 每日答题</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务三: 每日答题&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务三: 每日答题&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 做每日答题</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">doExamPractice</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务三: 每日答题已完成!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 暂停任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">pauseTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 继续任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">continueTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">START</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 开始任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">startTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 未完成任务</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig.<span class="title function_">some</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>)) &#123;</span><br><span class="line">                    <span class="comment">// 开始任务</span></span><br><span class="line">                    taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">START</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// 学习</span></span><br><span class="line">                        <span class="keyword">await</span> <span class="title function_">study</span>();</span><br><span class="line">                        <span class="comment">// 同屏任务</span></span><br><span class="line">                        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">                            <span class="comment">// 关闭窗口</span></span><br><span class="line">                            <span class="title function_">closeFrame</span>();</span><br><span class="line">                            <span class="comment">// 窗口不存在</span></span><br><span class="line">                            frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                            <span class="comment">// 提示</span></span><br><span class="line">                            <span class="title function_">createTip</span>(err.<span class="property">message</span>);</span><br><span class="line">                            <span class="comment">// 错误</span></span><br><span class="line">                            <span class="title function_">error</span>(err.<span class="property">message</span>);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(err);</span><br><span class="line">                        <span class="comment">// 错误</span></span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 刷新任务</span></span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;已完成&#x27;</span>);</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;完成学习!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 远程推送</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: [</span><br><span class="line">                            <span class="string">&#x27;学习强国, 学习完成!&#x27;</span>,</span><br><span class="line">                            <span class="string">`当天积分:  <span class="subst">$&#123;getHighlightHTML(todayScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                            <span class="string">`总积分: <span class="subst">$&#123;getHighlightHTML(totalScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                            ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">getProgressHTML</span>(task.<span class="property">title</span>, task.<span class="property">percent</span>)),</span><br><span class="line">                        ],</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已在等待</span></span><br><span class="line">            <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 自动答题</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [taskStatus.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>]], <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="comment">// 加载完毕</span></span><br><span class="line">                <span class="keyword">if</span> (!flag &amp;&amp; taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>) &#123;</span><br><span class="line">                    <span class="comment">// 自动答题</span></span><br><span class="line">                    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>]) &#123;</span><br><span class="line">                        <span class="comment">// 等待中</span></span><br><span class="line">                        flag = <span class="literal">true</span>;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="keyword">const</span> tip = <span class="title function_">createTip</span>(<span class="string">&#x27;即将自动开始任务&#x27;</span>, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line">                        <span class="comment">// 等待倒计时结束</span></span><br><span class="line">                        <span class="keyword">await</span> tip.<span class="title function_">waitCountDown</span>();</span><br><span class="line">                        <span class="comment">// 再次查看是否开启</span></span><br><span class="line">                        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>] &amp;&amp;</span><br><span class="line">                            taskStatus.<span class="property">value</span> !== <span class="title class_">TaskStatusType</span>.<span class="property">START</span>) &#123;</span><br><span class="line">                            <span class="comment">// 创建提示</span></span><br><span class="line">                            <span class="title function_">createTip</span>(<span class="string">&#x27;自动开始任务&#x27;</span>);</span><br><span class="line">                            <span class="comment">// 开始任务</span></span><br><span class="line">                            <span class="title function_">startTask</span>();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 取消等待</span></span><br><span class="line">                        flag = <span class="literal">false</span>;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;已取消自动开始任务!&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 切换开关任务未完成</span></span><br><span class="line">            taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [task.<span class="property">active</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>) &#123;</span><br><span class="line">                            taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_study_item&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_study_btn<span class="subst">$&#123;taskStatus.value === TaskStatusType.START ? <span class="string">&#x27; loading&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">disabled</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [running.<span class="property">value</span>, taskStatus.<span class="property">value</span>], <span class="function">() =&gt;</span> running.<span class="property">value</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>),</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span></span><br><span class="line">                    ? <span class="title function_">debounce</span>(startTask, <span class="number">300</span>)</span><br><span class="line">                    : taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span></span><br><span class="line">                        ? <span class="title function_">debounce</span>(pauseTask, <span class="number">300</span>)</span><br><span class="line">                        : taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span></span><br><span class="line">                            ? <span class="title function_">debounce</span>(continueTask, <span class="number">300</span>)</span><br><span class="line">                            : <span class="literal">undefined</span>),</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;taskStatus.value === TaskStatusType.LOADING</span></span></span><br><span class="line"><span class="subst"><span class="string">                ? <span class="string">&#x27;等待中&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                : taskStatus.value === TaskStatusType.LOADED</span></span></span><br><span class="line"><span class="subst"><span class="string">                    ? <span class="string">&#x27;开始学习&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    : taskStatus.value === TaskStatusType.START</span></span></span><br><span class="line"><span class="subst"><span class="string">                        ? <span class="string">&#x27;正在学习, 点击暂停&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                        : taskStatus.value === TaskStatusType.PAUSE</span></span></span><br><span class="line"><span class="subst"><span class="string">                            ? <span class="string">&#x27;继续学习&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                            : taskStatus.value === TaskStatusType.FINISH</span></span></span><br><span class="line"><span class="subst"><span class="string">                                ? <span class="string">&#x27;已完成&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                                : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时项目</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ScheduleList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list&#x27;</span> &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scheduleList.<span class="property">length</span></span><br><span class="line">            ? scheduleList.<span class="title function_">map</span>(<span class="function">(<span class="params">schedule</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_item&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">`egg_schedule_detail_time_wrap<span class="subst">$&#123;isLate(schedule) ? <span class="string">&#x27; inactive&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_icon&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M810.137703 213.860762c-164.388001-164.4187-431.887404-164.4187-596.277452 0-164.417677 164.388001-164.417677 431.889451 0 596.278475 164.390048 164.417677 431.890474 164.417677 596.277452 0C974.557426 645.750213 974.557426 378.248763 810.137703 213.860762zM767.347131 767.345596c-140.797723 140.829446-369.927237 140.797723-510.693238 0-140.828422-140.797723-140.828422-369.895515 0-510.708588 140.767024-140.783397 369.896538-140.813073 510.693238 0C908.14383 397.420405 908.14383 626.578572 767.347131 767.345596z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M721.450824 521.495258 515.404028 521.495258l0.028653-227.948619c0-15.124466-12.362562-27.458375-27.501354-27.458375s-27.443026 12.33391-27.443026 27.458375l0 235.115855c0 0.835018-1.013073 20.48659 12.094456 34.459836 8.331759 8.809643 20.038382 13.288654 35.148521 13.288654l213.720569 0.031722c15.140839 0 27.472702-12.304234 27.472702-27.474748C748.922503 533.887496 736.620315 521.584286 721.450824 521.495258z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ])),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_time&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(schedule.<span class="property">time</span>)),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_del_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_del_btn&#x27;</span>,</span><br><span class="line">                        <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 定时刷新</span></span><br><span class="line">                            <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                                <span class="title function_">createTip</span>(<span class="string">&#x27;未开启定时刷新!&#x27;</span>);</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// 索引</span></span><br><span class="line">                            <span class="keyword">const</span> index = scheduleList.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s === schedule);</span><br><span class="line">                            <span class="comment">// 删除元素</span></span><br><span class="line">                            scheduleList.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">                            <span class="comment">// 存储</span></span><br><span class="line">                            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(scheduleList));</span><br><span class="line">                            <span class="comment">// 刷新任务</span></span><br><span class="line">                            <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                        &#125;, <span class="number">300</span>),</span><br><span class="line">                    &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M896.22 896.22c14.262-14.263 11.263-40.449-6.583-58.295L230.473 178.76c-17.847-17.847-44.105-20.846-58.295-6.583-14.263 14.19-11.264 40.448 6.583 58.295l659.164 659.164c17.846 17.846 44.032 20.845 58.294 6.582&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M172.178 896.22c-14.263-14.263-11.264-40.449 6.583-58.295L837.925 178.76c17.846-17.847 44.032-20.846 58.294-6.583 14.263 14.19 11.264 40.448-6.582 58.295L230.4 889.637c-17.847 17.846-44.105 20.845-58.295 6.582&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ])),</span><br><span class="line">                ]),</span><br><span class="line">            ]))</span><br><span class="line">            : [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list_none&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M238.1 520.5c-17.6 0-31.9-14.3-31.9-31.9 0-17.6 14.3-31.9 31.9-31.9h293c17.6 0 31.9 14.3 31.9 31.9 0 17.6-14.3 31.9-31.9 31.9h-293zM238.1 733.6c-17.6 0-31.9-14.3-31.9-31.9s14.3-31.9 31.9-31.9h186.5c17.6 0 31.9 14.3 31.9 31.9s-14.3 31.9-31.9 31.9H238.1zM241.6 314.9c-17.6 0-31.9-14.3-31.9-31.9s14.3-31.9 31.9-31.9h426.1c17.6 0 31.9 14.3 31.9 31.9 0 17.5-14.3 31.7-31.8 31.9H241.6z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M160 926.6c-46.9 0-85.1-38.2-85.1-85.1V149.1c0-46.9 38.2-85.1 85.1-85.1h586c46.9 0 85.1 38.2 85.1 85.1v297.4c0 17.6-14.3 31.9-31.9 31.9-17.6 0-31.9-14.3-31.9-31.9V149.1c0-11.8-9.6-21.4-21.4-21.4H160c-11.8 0-21.4 9.6-21.4 21.4v692.4c0 11.8 9.6 21.4 21.4 21.4h304.5c17.5 0 31.8 14.2 31.9 31.8 0 17.6-14.3 31.8-31.9 31.8H160z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M917.2 959.9c-8.5 0-16.5-3.3-22.5-9.3l-78.5-78.5-5.3-0.5-0.6 0.4c-31.7 21.6-68.7 33-107 33-105.2 0-190.8-85.6-190.8-190.8s85.6-190.8 190.8-190.8c105.2 0 190.8 85.6 190.8 190.8 0 38.2-11.4 75.2-33 107l-0.4 0.6 0.5 5.3 78.5 78.5c6 6 9.3 14 9.3 22.5s-3.4 16.5-9.4 22.5c-5.9 6-13.9 9.3-22.4 9.3zM703.4 587c-70.1 0-127.2 57.1-127.2 127.2s57.1 127.2 127.2 127.2 127.2-57.1 127.2-127.2S773.6 587 703.4 587z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ]),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list_none_text&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;暂无定时任务&#x27;</span>)),</span><br><span class="line">                ]),</span><br><span class="line">            ];</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间输入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TimeInput</span>(<span class="params">&#123; hour, minute, onchange, &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// 小时</span></span><br><span class="line">    <span class="keyword">const</span> hours = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">24</span>).<span class="title function_">fill</span>(<span class="literal">undefined</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">value</span>: i,</span><br><span class="line">        <span class="attr">label</span>: <span class="title function_">formatDateNum</span>(i),</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="comment">// 分钟</span></span><br><span class="line">    <span class="keyword">const</span> minutes = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">60</span>).<span class="title function_">fill</span>(<span class="literal">undefined</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">value</span>: i,</span><br><span class="line">        <span class="attr">label</span>: <span class="title function_">formatDateNum</span>(i),</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">const</span> valueRef = <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> h = hours.<span class="title function_">find</span>(<span class="function">(<span class="params">h</span>) =&gt;</span> h.<span class="property">value</span> === hour.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">const</span> min = minutes.<span class="title function_">find</span>(<span class="function">(<span class="params">min</span>) =&gt;</span> min.<span class="property">value</span> === minute.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">hour</span>: h ? h.<span class="property">value</span> : -<span class="number">1</span>,</span><br><span class="line">            <span class="attr">minute</span>: min ? min.<span class="property">value</span> : -<span class="number">1</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_time_input&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hour_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: hours,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;00&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">value</span>: hour,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    valueRef.<span class="property">value</span>.<span class="property">hour</span> = value;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">onblur</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">                        valueRef.<span class="property">value</span>.<span class="property">hour</span> = -<span class="number">1</span>;</span><br><span class="line">                        onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_separator&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;:&#x27;</span>)),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_minute_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: minutes,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;00&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">value</span>: minute,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    valueRef.<span class="property">value</span>.<span class="property">minute</span> = value;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">onblur</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">                        valueRef.<span class="property">value</span>.<span class="property">minute</span> = -<span class="number">1</span>;</span><br><span class="line">                        onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置面板组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SettingsPanel</span>(<span class="params">&#123; show &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// token</span></span><br><span class="line">    <span class="keyword">let</span> token = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 小时</span></span><br><span class="line">    <span class="keyword">let</span> hour = <span class="title function_">ref</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 分钟</span></span><br><span class="line">    <span class="keyword">let</span> minute = <span class="title function_">ref</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_settings<span class="subst">$&#123;show.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;版本信息&#x27;</span>)),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createTextNode</span>(<span class="string">`v<span class="subst">$&#123;version&#125;</span>`</span>),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;a&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version_detail&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;GitHub Xu22Web/tech-study-js&#x27;</span>,</span><br><span class="line">                    <span class="attr">href</span>: <span class="string">&#x27;https://github.com/Xu22Web/tech-study-js&#x27;</span>,</span><br><span class="line">                &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 16 16&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z&#x27;</span>,</span><br><span class="line">                &#125;))),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;主题预设&#x27;</span>)),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_colors&#x27;</span> &#125;, [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#fa3333&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;强国红&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;XueXi Red&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#bb2649&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;非凡洋红&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Viva Magenta&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;18-1750&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#35548a&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;经典蓝&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Classic Blue&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;19-4052&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#f36f63&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;活珊瑚橘&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Living Coral&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;16-1546&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#6d5b97&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;紫外光色&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Ultra Violet&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;18-3838&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#86af49&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;草木绿&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Greenery&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;15-0343&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#fc8bab&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;B站粉&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Bilibili Pink&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#056de8&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;知乎蓝&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Zhihu Blue&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            ].<span class="title function_">map</span>(<span class="function">(<span class="params">color</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_color_wrap&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_color&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">style</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`color: <span class="subst">$&#123;color.value&#125;</span>;<span class="subst">$&#123;themeColor.value === color.value</span></span></span><br><span class="line"><span class="subst"><span class="string">                    ? <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    : <span class="string">` box-shadow: 0rem 0.4rem 0.1rem 0.1rem <span class="subst">$&#123;color.value&#125;</span>30;`</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: color.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (themeColor.<span class="property">value</span> !== color.<span class="property">value</span>) &#123;</span><br><span class="line">                        themeColor.<span class="property">value</span> = color.<span class="property">value</span>;</span><br><span class="line">                        <span class="comment">// 存储</span></span><br><span class="line">                        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;themeColor&#x27;</span>, themeColor.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;)))),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_settings_read_time_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;最大文章时长&#x27;</span>)),</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;40s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;60s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;80s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">value</span>: maxRead,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="attr">keep</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;最大文章时长 已保存!&#x27;</span>);</span><br><span class="line">                    maxRead.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="comment">// 存储</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxRead&#x27;</span>, value);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> maxReadTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxRead&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (maxReadTemp) &#123;</span><br><span class="line">                        maxRead.<span class="property">value</span> = maxReadTemp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_settings_watch_time_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;最大视听时长&#x27;</span>)),</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;40s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;60s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;80s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;120s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">120</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">value</span>: maxWatch,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;120s&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="attr">keep</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;最大视听时长 已保存!&#x27;</span>);</span><br><span class="line">                    maxWatch.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="comment">// 存储</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>, value);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> maxWatchTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (maxWatchTemp) &#123;</span><br><span class="line">                        maxWatch.<span class="property">value</span> = maxWatchTemp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]</span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token_wrap&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;我的 token&#x27;</span>)),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token_input&#x27;</span>,</span><br><span class="line">                        <span class="attr">placeholder</span>: <span class="string">&#x27;用户 token&#x27;</span>,</span><br><span class="line">                        <span class="attr">maxlength</span>: <span class="number">32</span>,</span><br><span class="line">                        <span class="attr">value</span>: pushToken.<span class="property">value</span>,</span><br><span class="line">                        <span class="attr">onfocus</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> input = e.<span class="property">target</span>;</span><br><span class="line">                            input.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                            <span class="keyword">const</span> btnWrap = $$(<span class="string">&#x27;.egg_settings_submit_btn_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                            btnWrap.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">onblur</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> input = e.<span class="property">target</span>;</span><br><span class="line">                            <span class="comment">// 去除空格</span></span><br><span class="line">                            <span class="keyword">const</span> value = input.<span class="property">value</span>.<span class="title function_">trim</span>();</span><br><span class="line">                            <span class="keyword">if</span> (<span class="regexp">/^[0-9a-z]&#123;32&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">                                token = value;</span><br><span class="line">                                input.<span class="property">value</span> = value;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                token = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            input.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> btnWrap = $$(<span class="string">&#x27;.egg_settings_submit_btn_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                                btnWrap.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                                input.<span class="property">value</span> = pushToken.<span class="property">value</span>;</span><br><span class="line">                            &#125;, <span class="number">200</span>);</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_submit_btn_wrap&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_settings_submit_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;用户 token 已保存!&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (token !== pushToken.<span class="property">value</span>) &#123;</span><br><span class="line">                            pushToken.<span class="property">value</span> = token;</span><br><span class="line">                            <span class="comment">// 存储</span></span><br><span class="line">                            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pushToken&#x27;</span>, token);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;保存&#x27;</span>))),</span><br><span class="line">            ])</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]</span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time&#x27;</span> &#125;, [</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;设置时间&#x27;</span>)),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time_input_wrap&#x27;</span> &#125;, [</span><br><span class="line">                            <span class="title class_">TimeInput</span>(&#123;</span><br><span class="line">                                hour,</span><br><span class="line">                                minute,</span><br><span class="line">                                <span class="title function_">onchange</span>(<span class="params">&#123; hour: h, minute: min &#125;</span>) &#123;</span><br><span class="line">                                    hour.<span class="property">value</span> = h;</span><br><span class="line">                                    minute.<span class="property">value</span> = min;</span><br><span class="line">                                &#125;,</span><br><span class="line">                            &#125;),</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_add_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 定时刷新</span></span><br><span class="line">                                    <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;未开启定时刷新!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">if</span> (hour.<span class="property">value</span> === -<span class="number">1</span> || minute.<span class="property">value</span> === -<span class="number">1</span>) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;时间格式不符合要求!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="comment">// 重复定时存在</span></span><br><span class="line">                                    <span class="keyword">const</span> exists = scheduleList.<span class="title function_">find</span>(<span class="function">(<span class="params">schedule</span>) =&gt;</span> schedule.<span class="property">hour</span> === hour.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                                        schedule.<span class="property">minute</span> === minute.<span class="property">value</span>);</span><br><span class="line">                                    <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;设置定时任务重复!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="title function_">createTip</span>(<span class="string">&#x27;设置定时任务成功!&#x27;</span>);</span><br><span class="line">                                    <span class="comment">// 添加</span></span><br><span class="line">                                    scheduleList.<span class="title function_">push</span>(&#123;</span><br><span class="line">                                        <span class="attr">hour</span>: hour.<span class="property">value</span>,</span><br><span class="line">                                        <span class="attr">minute</span>: minute.<span class="property">value</span>,</span><br><span class="line">                                        <span class="attr">time</span>: <span class="string">`<span class="subst">$&#123;formatDateNum(hour.value)&#125;</span>:<span class="subst">$&#123;formatDateNum(minute.value)&#125;</span>`</span>,</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                    <span class="comment">// 排序</span></span><br><span class="line">                                    scheduleList.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">hour</span> === b.<span class="property">hour</span></span><br><span class="line">                                        ? a.<span class="property">minute</span> - b.<span class="property">minute</span></span><br><span class="line">                                        : a.<span class="property">hour</span> - b.<span class="property">hour</span>);</span><br><span class="line">                                    <span class="comment">// 存储</span></span><br><span class="line">                                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(scheduleList));</span><br><span class="line">                                    <span class="comment">// 清空</span></span><br><span class="line">                                    hour.<span class="property">value</span> = -<span class="number">1</span>;</span><br><span class="line">                                    minute.<span class="property">value</span> = -<span class="number">1</span>;</span><br><span class="line">                                    <span class="keyword">const</span> inputs = $$(<span class="string">&#x27;.egg_time_input input&#x27;</span>);</span><br><span class="line">                                    inputs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> (i.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">                                    <span class="comment">// 刷新任务</span></span><br><span class="line">                                    <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M801.171 483.589H544V226.418c0-17.673-14.327-32-32-32s-32 14.327-32 32v257.171H222.83c-17.673 0-32 14.327-32 32s14.327 32 32 32H480v257.17c0 17.673 14.327 32 32 32s32-14.327 32-32v-257.17h257.171c17.673 0 32-14.327 32-32s-14.327-32-32-32z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title class_">ScheduleList</span>(),</span><br><span class="line">            ])</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">    ], &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 刷新token</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 远程推送</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> tokenTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pushToken&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (tokenTemp) &#123;</span><br><span class="line">                            pushToken.<span class="property">value</span> = tokenTemp;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 刷新定时任务</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 定时任务打开</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> scheduleTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>));</span><br><span class="line">                        <span class="keyword">if</span> (scheduleTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(scheduleTemp)) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> scheduleTemp) &#123;</span><br><span class="line">                                scheduleList[i] = scheduleTemp[i];</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">                    <span class="comment">// 刷新定时任务</span></span><br><span class="line">                    <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 清除任务</span></span><br><span class="line">                <span class="title function_">clearScheduleTask</span>();</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 面板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Panel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 运行设置标签</span></span><br><span class="line">    <span class="keyword">const</span> runLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;自动开始&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;启动时, 自动开始任务, 在倒计时结束前自动开始可随时取消; 如果在自动开始前手动开始任务, 此次自动开始将取消&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;同屏任务&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;运行任务时，所有任务均在当前页面以弹窗方式运行&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;静默运行&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;同屏任务时, 不显示任务弹窗静默运行&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;定时刷新&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;定时刷新页面，重新进行任务，此功能需要长时间占用浏览器&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 运行设置标签</span></span><br><span class="line">    <span class="keyword">const</span> examLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;随机作答&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;无答案时, 随机选择或者填入答案, 不保证正确&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 推送设置标签</span></span><br><span class="line">    <span class="keyword">const</span> pushLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;远程推送&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;利用 pushplus 推送, 将登录二维码直接推送到微信公众号&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 处理设置变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleSettingsChange</span> = (<span class="params">e, type, title</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 开关</span></span><br><span class="line">        <span class="keyword">const</span> &#123; checked &#125; = e.<span class="property">target</span>;</span><br><span class="line">        <span class="keyword">if</span> (settings[type] !== checked) &#123;</span><br><span class="line">            settings[type] = checked;</span><br><span class="line">            <span class="comment">// 设置</span></span><br><span class="line">            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;studySettings&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(settings));</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`<span class="subst">$&#123;title&#125;</span> <span class="subst">$&#123;checked ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 任务显示</span></span><br><span class="line">    <span class="keyword">const</span> scheduleShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 面板显示</span></span><br><span class="line">    <span class="keyword">const</span> panelShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">`egg_panel_wrap<span class="subst">$&#123;hasMobile() ? <span class="string">&#x27; mobile&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">    &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_panel<span class="subst">$&#123;panelShow.value ? <span class="string">&#x27; hide&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="comment">// 登录</span></span><br><span class="line">        <span class="title class_">LoginItem</span>(),</span><br><span class="line">        <span class="comment">// 信息</span></span><br><span class="line">        <span class="title class_">InfoItem</span>(),</span><br><span class="line">        <span class="comment">// 分数</span></span><br><span class="line">        <span class="title class_">ScoreItem</span>(),</span><br><span class="line">        <span class="comment">// 任务部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;任务&#x27;</span> &#125;),</span><br><span class="line">        <span class="title class_">TaskList</span>(),</span><br><span class="line">        <span class="comment">// 运行部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;运行&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_run_list&#x27;</span> &#125;, runLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 答题部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;答题&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_exam_list&#x27;</span> &#125;, examLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 推送部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;推送&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_push_list&#x27;</span> &#125;, pushLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 提示部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;提示&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_tip_list&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createTextNode</span>(<span class="string">&#x27;专项练习已被移除, 如需使用, 请点击&#x27;</span>),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_tip_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(doExamPaper, <span class="number">300</span>),</span><br><span class="line">                <span class="attr">disabled</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [running.<span class="property">value</span>, taskStatus.<span class="property">value</span>], <span class="function">() =&gt;</span> running.<span class="property">value</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span>),</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;去完成&#x27;</span>)),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="comment">// 按钮集合</span></span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_btns_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [frame.<span class="property">exist</span>, frame.<span class="property">show</span>], <span class="function">() =&gt;</span> <span class="string">`egg_frame_show_btn<span class="subst">$&#123;!frame.exist || frame.show ? <span class="string">&#x27; hide&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;窗口&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 窗口显示</span></span><br><span class="line">                    frame.<span class="property">show</span> = <span class="literal">true</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">d</span>: <span class="string">&#x27;M836.224 106.666667h-490.666667a85.589333 85.589333 0 0 0-85.333333 85.333333V256h-64a85.589333 85.589333 0 0 0-85.333333 85.333333v490.666667a85.589333 85.589333 0 0 0 85.333333 85.333333h490.666667a85.589333 85.589333 0 0 0 85.333333-85.333333V768h64a85.589333 85.589333 0 0 0 85.333333-85.333333V192a85.589333 85.589333 0 0 0-85.333333-85.333333z m-132.266667 725.333333a20.138667 20.138667 0 0 1-21.333333 21.333333h-490.666667a20.138667 20.138667 0 0 1-21.333333-21.333333V341.333333a20.138667 20.138667 0 0 1 21.333333-21.333333h494.933334a20.138667 20.138667 0 0 1 21.333333 21.333333v490.666667z m153.6-149.333333a20.138667 20.138667 0 0 1-21.333333 21.333333h-64V341.333333a85.589333 85.589333 0 0 0-85.333333-85.333333h-362.666667V192a20.138667 20.138667 0 0 1 21.333333-21.333333h490.666667a20.138667 20.138667 0 0 1 21.333333 21.333333z&#x27;</span>,</span><br><span class="line">            &#125;))),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_panel_show_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;面板&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    panelShow.<span class="property">value</span> = !panelShow.<span class="property">value</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">d</span>: <span class="string">&#x27;M332.16 883.84a40.96 40.96 0 0 0 58.24 0l338.56-343.04a40.96 40.96 0 0 0 0-58.24L390.4 140.16a40.96 40.96 0 0 0-58.24 58.24L640 512l-307.84 314.24a40.96 40.96 0 0 0 0 57.6z&#x27;</span>,</span><br><span class="line">            &#125;))),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_settings_show_btn<span class="subst">$&#123;scheduleShow.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;设置&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    scheduleShow.<span class="property">value</span> = !scheduleShow.<span class="property">value</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M7.25325 705.466473a503.508932 503.508932 0 0 0 75.26742 121.391295 95.499302 95.499302 0 0 0 93.211173 31.07039 168.59902 168.59902 0 0 1 114.526906 16.257763 148.487566 148.487566 0 0 1 71.052444 83.456515 91.163899 91.163899 0 0 0 75.989987 61.538643 578.053784 578.053784 0 0 0 148.969278 0A91.163899 91.163899 0 0 0 662.380873 957.642436a148.487566 148.487566 0 0 1 72.256723-83.456515 168.59902 168.59902 0 0 1 114.406478-16.257763 95.61973 95.61973 0 0 0 93.331601-31.07039 503.508932 503.508932 0 0 0 75.267419-121.391295 84.29951 84.29951 0 0 0-18.545892-94.897163 138.251197 138.251197 0 0 1 0-197.140426 84.29951 84.29951 0 0 0 18.545892-94.897163 503.508932 503.508932 0 0 0-75.869559-121.391295 95.499302 95.499302 0 0 0-93.211173-31.070391A168.59902 168.59902 0 0 1 734.637596 149.812272a148.848849 148.848849 0 0 1-72.256723-83.456515A91.163899 91.163899 0 0 0 586.631741 4.817115a581.907476 581.907476 0 0 0-148.969277 0A91.163899 91.163899 0 0 0 361.311193 66.355757a148.848849 148.848849 0 0 1-71.413728 83.456515 168.59902 168.59902 0 0 1-114.406478 16.257763 95.378874 95.378874 0 0 0-93.3316 31.070391A503.508932 503.508932 0 0 0 7.25325 318.531721a84.29951 84.29951 0 0 0 18.545893 94.897163 140.057615 140.057615 0 0 1 41.30676 98.509999 140.057615 140.057615 0 0 1-41.30676 98.630427A84.29951 84.29951 0 0 0 7.25325 705.466473z m929.462315-349.240828a219.901294 219.901294 0 0 0 0 312.028615c0.842995 0.842995 2.649413 3.010697 1.806418 5.057971a427.398517 427.398517 0 0 1-63.104205 101.520696 9.513802 9.513802 0 0 1-9.032091 2.167702 255.547944 255.547944 0 0 0-173.777418 24.928569 231.823653 231.823653 0 0 0-111.275354 130.302957 6.984817 6.984817 0 0 1-6.021394 4.937543 492.790851 492.790851 0 0 1-126.328837 0 6.984817 6.984817 0 0 1-6.021394-4.937543 231.823653 231.823653 0 0 0-111.275353-130.302957 255.668372 255.668372 0 0 0-120.427872-30.468252 258.919924 258.919924 0 0 0-52.747408 5.539683 9.513802 9.513802 0 0 1-9.03209-2.167702 427.398517 427.398517 0 0 1-63.104205-101.520696c-0.842995-2.047274 0.963423-4.214976 1.806418-5.057971a221.82814 221.82814 0 0 0 64.910623-156.556233 221.707712 221.707712 0 0 0-65.512762-155.713238c-0.842995-0.842995-2.649413-3.010697-1.806418-5.057971a427.398517 427.398517 0 0 1 63.104205-101.520696 9.393374 9.393374 0 0 1 8.911662-2.167701 255.7888 255.7888 0 0 0 173.897847-24.92857 231.823653 231.823653 0 0 0 111.275353-130.302957 6.984817 6.984817 0 0 1 6.021394-4.937543 492.790851 492.790851 0 0 1 126.328837 0 6.984817 6.984817 0 0 1 6.021394 4.937543 231.823653 231.823653 0 0 0 111.275354 130.302957 255.547944 255.547944 0 0 0 173.777418 24.92857 9.513802 9.513802 0 0 1 9.032091 2.167701 423.063113 423.063113 0 0 1 62.983777 101.520696c0.963423 2.047274-0.842995 4.214976-1.68599 5.057971z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M512.086889 305.766366a206.292944 206.292944 0 1 0 206.172516 206.172517 206.413372 206.413372 0 0 0-206.172516-206.172517z m123.197713 206.172517a123.197713 123.197713 0 1 1-123.197713-123.077285 123.318141 123.318141 0 0 1 123.197713 123.077285z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">            ])),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_reset_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;重置&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 任务配置</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 设置</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;studySettings&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 最大阅读</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxRead&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 最大观看</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 主题色</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;themeColor&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 刷新页面</span></span><br><span class="line">                    location.<span class="title function_">reload</span>();</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M943.8 484.1c-17.5-13.7-42.8-10.7-56.6 6.8-5.7 7.3-8.5 15.8-8.6 24.4h-0.4c-0.6 78.3-26.1 157-78 223.3-124.9 159.2-356 187.1-515.2 62.3-31.7-24.9-58.2-54-79.3-85.9h77.1c22.4 0 40.7-18.3 40.7-40.7v-3c0-22.4-18.3-40.7-40.7-40.7H105.5c-22.4 0-40.7 18.3-40.7 40.7v177.3c0 22.4 18.3 40.7 40.7 40.7h3c22.4 0 40.7-18.3 40.7-40.7v-73.1c24.2 33.3 53 63.1 86 89 47.6 37.3 101 64.2 158.9 79.9 55.9 15.2 113.5 19.3 171.2 12.3 57.7-7 112.7-24.7 163.3-52.8 52.5-29 98-67.9 135.3-115.4 37.3-47.6 64.2-101 79.9-158.9 10.2-37.6 15.4-76 15.6-114.6h-0.1c-0.3-11.6-5.5-23.1-15.5-30.9zM918.7 135.2h-3c-22.4 0-40.7 18.3-40.7 40.7V249c-24.2-33.3-53-63.1-86-89-47.6-37.3-101-64.2-158.9-79.9-55.9-15.2-113.5-19.3-171.2-12.3-57.7 7-112.7 24.7-163.3 52.8-52.5 29-98 67.9-135.3 115.4-37.3 47.5-64.2 101-79.9 158.8-10.2 37.6-15.4 76-15.6 114.6h0.1c0.2 11.7 5.5 23.2 15.4 30.9 17.5 13.7 42.8 10.7 56.6-6.8 5.7-7.3 8.5-15.8 8.6-24.4h0.4c0.6-78.3 26.1-157 78-223.3 124.9-159.2 356-187.1 515.2-62.3 31.7 24.9 58.2 54 79.3 85.9h-77.1c-22.4 0-40.7 18.3-40.7 40.7v3c0 22.4 18.3 40.7 40.7 40.7h177.3c22.4 0 40.7-18.3 40.7-40.7V175.8c0.1-22.3-18.2-40.6-40.6-40.6z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">            ])),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="comment">// 任务按钮</span></span><br><span class="line">        <span class="title class_">TaskBtn</span>(),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_item&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">SettingsPanel</span>(&#123; <span class="attr">show</span>: scheduleShow &#125;),</span><br><span class="line">        ]),</span><br><span class="line">    ]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311071529290.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311071529290.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Shio</div><div class="post-copyright__author_desc">大多数人到死都没有向尘世之外瞥一眼</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://zhshio.cn/posts/40882.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://zhshio.cn/posts/40882.html')">解放双手，每日强国</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150771.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150771.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150143.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311072150143.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://zhshio.cn/posts/40882.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=解放双手，每日强国&amp;url=https://zhshio.cn/posts/40882.html&amp;pic=https://www.toopic.cn/public/uploads/small/169124446876816912444684.jpg?_r_=a17d5a5d-d0d9-745e-6da4-ce292c21031f" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhshio.cn" target="_blank">Shio</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学习工具<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E6%97%A5%E5%B8%B8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>日常<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://www.toopic.cn/public/uploads/small/1710477894938171047789431.jpg?_r_=8de4c4fd-de0e-2aca-1882-9e685f1ab2f0" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/posts/26877.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/1642747775404164274777570.jpg?_r_=d155d71e-0788-00ad-80de-9c5d53b49076" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">论坛课设</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311071529290.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/03/03/317b790a902ec.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">后端, 算法, Java技术栈</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Shio</h1><div class="author-info__desc">大多数人到死都没有向尘世之外瞥一眼</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/zhshio" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311082256357.jpg) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">解放双手，每日强国</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%B2%B9%E7%8C%B4"><span class="toc-number">1.1.</span> <span class="toc-text">一、安装油猴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B7%BB%E5%8A%A0%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.</span> <span class="toc-text">二、添加脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">三、脚本使用</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/2.html" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/1710477894938171047789431.jpg?_r_=8de4c4fd-de0e-2aca-1882-9e685f1ab2f0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/posts/2.html" title="无题">无题</a><time datetime="2024-03-28T09:13:06.521Z" title="发表于 2024-03-28 17:13:06">2024-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/0.html" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/1710477855237171047785599.jpg?_r_=7b62d741-2090-3913-57ac-70310a8a05a7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/posts/0.html" title="无题">无题</a><time datetime="2024-03-25T06:25:41.433Z" title="发表于 2024-03-25 14:25:41">2024-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16107.html" title="项目进度记录"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/1695609028811169560902782.jpg?_r_=6ff3b388-3fdf-ac52-738c-874f0e2a292d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="项目进度记录"/></a><div class="content"><a class="title" href="/posts/16107.html" title="项目进度记录">项目进度记录</a><time datetime="2024-03-20T13:12:21.000Z" title="发表于 2024-03-20 21:12:21">2024-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6841.html" title="MySQL 枚举类型的选择"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/1695609002333169560900291.jpg?_r_=648d94b0-3ec9-56ba-15f6-fc40a830c042" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 枚举类型的选择"/></a><div class="content"><a class="title" href="/posts/6841.html" title="MySQL 枚举类型的选择">MySQL 枚举类型的选择</a><time datetime="2024-02-01T15:40:00.000Z" title="发表于 2024-02-01 23:40:00">2024-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6842.html" title="MySQL 语句执行顺序"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.toopic.cn/public/uploads/small/171022030441217102203042.jpg?_r_=7865ebdc-450a-7ae3-74b5-82fedf1bda41" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 语句执行顺序"/></a><div class="content"><a class="title" href="/posts/6842.html" title="MySQL 语句执行顺序">MySQL 语句执行顺序</a><time datetime="2024-02-01T15:40:00.000Z" title="发表于 2024-02-01 23:40:00">2024-02-01</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">74</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">16</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://zhshio.cn/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202311091058032.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/zhshio/EasySpring" title="EasySpring"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202312101409146.png" alt="EasySpring"/><span class="back-menu-item-text">EasySpring</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/zhshio/Shio-TinyDB" title="Shio-TinyDB"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202312101413777.jpg" alt="Shio-TinyDB"/><span class="back-menu-item-text">Shio-TinyDB</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AQS/" style="font-size: 0.88rem;">AQS<sup>1</sup></a><a href="/tags/ArrayLists/" style="font-size: 0.88rem;">ArrayLists<sup>1</sup></a><a href="/tags/CountDownLatch/" style="font-size: 0.88rem;">CountDownLatch<sup>1</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem;">JAVA<sup>1</sup></a><a href="/tags/JUC/" style="font-size: 0.88rem;">JUC<sup>2</sup></a><a href="/tags/JVM/" style="font-size: 0.88rem;">JVM<sup>6</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>1</sup></a><a href="/tags/Java%E6%BA%90%E7%A0%81/" style="font-size: 0.88rem;">Java源码<sup>2</sup></a><a href="/tags/Jottings/" style="font-size: 0.88rem;">Jottings<sup>1</sup></a><a href="/tags/MQ/" style="font-size: 0.88rem;">MQ<sup>1</sup></a><a href="/tags/MYSQL/" style="font-size: 0.88rem;">MYSQL<sup>2</sup></a><a href="/tags/NIO/" style="font-size: 0.88rem;">NIO<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF/" style="font-size: 0.88rem;">代码模板<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">学习工具<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 0.88rem;">日常<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 0.88rem;">生活<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>41</sup></a><a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">编译原理<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">计算机基础<sup>3</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E/" style="font-size: 0.88rem;">设计模式之美<sup>2</sup></a><a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 0.88rem;">转载<sup>35</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 0.88rem;">项目<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="1645775761" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/1645775761&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.9",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Shio 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://blog.zhshio.cn/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://blog.zhshio.cn/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>