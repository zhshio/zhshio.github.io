<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>双指针问题</title>
      <link href="/2023/11/08/%E5%8F%8C%E6%8C%87%E9%92%88%E2%80%94%E2%80%94%E5%AD%A6%E8%BF%87%E5%B0%B1%E4%BC%9A/"/>
      <url>/2023/11/08/%E5%8F%8C%E6%8C%87%E9%92%88%E2%80%94%E2%80%94%E5%AD%A6%E8%BF%87%E5%B0%B1%E4%BC%9A/</url>
      
        <content type="html"><![CDATA[<h1>双指针</h1><h4 id="27-移除元素"><a href="https://leetcode.cn/problems/remove-element/">27. 移除元素</a></h4><p>给你一个数组 <code>nums</code> 和一个值 <code>val</code>，你需要 <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">原地</a></strong> 移除所有数值等于 <code>val</code> 的元素，并返回移除后数组的新长度。</p><p>不要使用额外的数组空间，你必须仅使用 <code>O(1)</code> 额外空间并 <strong><a href="https://baike.baidu.com/item/%E5%8E%9F%E5%9C%B0%E7%AE%97%E6%B3%95">原地 </a>修改输入数组</strong>。</p><p>元素的顺序可以改变。你不需要考虑数组中超出新长度后面的元素。</p><p><strong>说明:</strong></p><p>为什么返回数值是整数，但输出的答案是数组呢?</p><p>请注意，输入数组是以**「引用」**方式传递的，这意味着在函数里修改输入数组对于调用者是可见的。</p><p>你可以想象内部操作如下:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// nums 是以“引用”方式传递的。也就是说，不对实参作任何拷贝</span><br><span class="line">int len = removeElement(nums, val);</span><br><span class="line"></span><br><span class="line">// 在函数里修改输入数组对于调用者是可见的。</span><br><span class="line">// 根据你的函数返回的长度, 它会打印出数组中 该长度范围内 的所有元素。</span><br><span class="line">for (int i = 0; i &lt; len; i++) &#123;</span><br><span class="line">    print(nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [3,2,2,3], val = 3</span><br><span class="line">输出：2, nums = [2,2]</span><br><span class="line">解释：函数应该返回新的长度 2, 并且 nums 中的前两个元素均为 2。你不需要考虑数组中超出新长度后面的元素。例如，函数返回的新长度为 2 ，而 nums = [2,2,3,3] 或 nums = [2,2,0,0]，也会被视作正确答案。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [0,1,2,2,3,0,4,2], val = 2</span><br><span class="line">输出：5, nums = [0,1,4,0,3]</span><br><span class="line">解释：函数应该返回新的长度 5, 并且 nums 中的前五个元素为 0, 1, 3, 0, 4。注意这五个元素可为任意顺序。你不需要考虑数组中超出新长度后面的元素。</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>0 &lt;= nums.length &lt;= 100</code></li><li><code>0 &lt;= nums[i] &lt;= 50</code></li><li><code>0 &lt;= val &lt;= 100</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="comment">//快指针寻找新数组中的元素，慢指针g</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="number">0</span>, slow = <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">       <span class="keyword">while</span> (fast != nums.length) &#123;</span><br><span class="line">           <span class="keyword">if</span> (nums[fast] != val) &#123;</span><br><span class="line">               nums[slow++] = nums[fast]; </span><br><span class="line">           &#125;</span><br><span class="line">           fast++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="977-有序数组的平方"><a href="https://leetcode.cn/problems/squares-of-a-sorted-array/">977. 有序数组的平方</a></h4><p><a href="https://leetcode.cn/problems/squares-of-a-sorted-array/#">思路</a></p><p>难度简单733</p><p>给你一个按 <strong>非递减顺序</strong> 排序的整数数组 <code>nums</code>，返回 <strong>每个数字的平方</strong> 组成的新数组，要求也按 <strong>非递减顺序</strong> 排序。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [-4,-1,0,3,10]</span><br><span class="line">输出：[0,1,9,16,100]</span><br><span class="line">解释：平方后，数组变为 [16,1,0,9,100]</span><br><span class="line">排序后，数组变为 [0,1,9,16,100]</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [-7,-3,2,3,11]</span><br><span class="line">输出：[4,9,9,49,121]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 104</code></li><li><code>-104 &lt;= nums[i] &lt;= 104</code></li><li><code>nums</code> 已按 <strong>非递减顺序</strong> 排序</li></ul><p><strong>进阶：</strong></p><ul><li>请你设计时间复杂度为 <code>O(n)</code> 的算法解决本问题</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortedSquares(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> , j = nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> result[] = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= j &amp;&amp; cur &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] * nums[i] &gt;= nums[j] * nums[j]) &#123;</span><br><span class="line">                result[cur--] = nums[i] * nums[i];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                result[cur--] = nums[j] * nums[j];</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] generateMatrix(<span class="type">int</span> n) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">line</span> <span class="operator">=</span> <span class="number">0</span>, column = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">boundary</span> <span class="operator">=</span> n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">stopValue</span> <span class="operator">=</span> n * n;</span><br><span class="line">        <span class="type">int</span>[][] matrix = <span class="keyword">new</span> <span class="title class_">int</span>[n][n];  </span><br><span class="line">        <span class="keyword">while</span> (value &lt; stopValue) &#123;</span><br><span class="line">            <span class="keyword">for</span> (; column &lt; boundary - <span class="number">1</span>; column++) &#123;</span><br><span class="line">                matrix[line][column] = value;</span><br><span class="line">                value++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (; line &lt; boundary - <span class="number">1</span>; line++) &#123;</span><br><span class="line">                matrix[line][column] = value;</span><br><span class="line">                value++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (; column &gt; n - boundary; column--) &#123;</span><br><span class="line">                matrix[line][column] = value;</span><br><span class="line">                value++; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (; line &gt; n - boundary; line--) &#123;</span><br><span class="line">                matrix[line][column] = value;</span><br><span class="line">                value++;</span><br><span class="line">            &#125;</span><br><span class="line">            column++;</span><br><span class="line">            line++;</span><br><span class="line">            boundary--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n % <span class="number">2</span> != <span class="number">0</span>) matrix[line][column] = value;</span><br><span class="line">        <span class="keyword">return</span> matrix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="203-移除链表元素"><a href="https://leetcode.cn/problems/remove-linked-list-elements/">203. 移除链表元素</a></h4><p>难度简单1174</p><p>给你一个链表的头节点 <code>head</code> 和一个整数 <code>val</code> ，请你删除链表中所有满足 <code>Node.val == val</code> 的节点，并返回 <strong>新的头节点</strong> 。</p><p><strong>示例 1：</strong></p><p><img src="https://assets.leetcode.com/uploads/2021/03/06/removelinked-list.jpg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = [1,2,6,3,4,5,6], val = 6</span><br><span class="line">输出：[1,2,3,4,5]</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = [], val = 1</span><br><span class="line">输出：[]</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = [7,7,7,7], val = 7</span><br><span class="line">输出：[]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li>列表中的节点数目在范围 <code>[0, 104]</code> 内</li><li><code>1 &lt;= Node.val &lt;= 50</code></li><li><code>0 &lt;= val &lt;= 50</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == head) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>,head);</span><br><span class="line">        <span class="type">ListNode</span>  <span class="variable">cur</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">while</span> (cur.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.next.val == val) &#123;</span><br><span class="line"></span><br><span class="line">                cur.next = cur.next.next;</span><br><span class="line">            &#125;<span class="keyword">else</span> cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="24-两两交换链表中的节点"><a href="https://leetcode.cn/problems/swap-nodes-in-pairs/">24. 两两交换链表中的节点</a></h4><p><a href="https://leetcode.cn/problems/swap-nodes-in-pairs/#">思路</a></p><p>难度中等1733</p><p>给你一个链表，两两交换其中相邻的节点，并返回交换后链表的头节点。你必须在不修改节点内部的值的情况下完成本题（即，只能进行节点交换）。</p><p><strong>示例 1：</strong></p><p><img src="https://assets.leetcode.com/uploads/2020/10/03/swap_ex1.jpg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = [1,2,3,4]</span><br><span class="line">输出：[2,1,4,3]</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = []</span><br><span class="line">输出：[]</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：head = [1]</span><br><span class="line">输出：[1]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li>链表中节点的数目在范围 <code>[0, 100]</code> 内</li><li><code>0 &lt;= Node.val &lt;= 100</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>,head);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> dummyHead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">null</span> != cur.next &amp;&amp; <span class="literal">null</span> != cur.next.next) &#123;</span><br><span class="line">            slow = cur.next;</span><br><span class="line">            fast = slow.next;</span><br><span class="line">            slow.next = fast.next;</span><br><span class="line">            fast.next = slow;</span><br><span class="line">            cur.next = fast;</span><br><span class="line">            cur = cur.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummyHead.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计原则与思想</title>
      <link href="/2023/11/08/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E6%80%9D%E6%83%B3%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
      <url>/2023/11/08/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E4%B8%8E%E6%80%9D%E6%83%B3%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h1>设计原则与思想: 面向对象</h1><h1>我们在讨论面向对象的时候,我们到底在谈论什么?</h1><h2 id="什么是面向对象编程和面向对象编程语言">什么是面向对象编程和面向对象编程语言?</h2><ul><li>面向对象编程是一种编程范式或编程风格, 它以类或对象作为组织代码的基本单元, 并将封装, 抽象, 继承, 多态四个特性,作为代码设计和实现的基石</li><li>面向对象编程语言是支持类或对象的语法机制, 并由现成的语法机制,能方便地实现面向对象编程四大特性(封装, 抽象, 继承, 多态)的编程语言</li></ul><h2 id="面向对象语言和面向对象编程语言之间地关系">面向对象语言和面向对象编程语言之间地关系</h2><ul><li><p>面向过程语言也可以实现面向对象编程</p></li><li><p>面向对象语言也会写出面向过程编程</p></li></ul><h2 id="如何判定一个编程语言是否面向对象编程语言">如何判定一个编程语言是否面向对象编程语言</h2><p>并没有严格地定义,面向对象语言要求宽泛,并不一定要求具有所有的四大特性, 只要某种编程语言支持类, 对象语法机制,那几本上就可以说这种编程语言是面向对象编程语言了</p><h2 id="什么是面向对象分析和面向对象设计">什么是面向对象分析和面向对象设计?</h2><p>OOA, OOD, OOP 软件开发流程</p><p>面向对象分析就是搞清楚做什么, 面向对象设计就是搞清楚怎么做,. 两个阶段地产出就是类的设计,包括程序被拆解为哪些类, 每个类有哪些属性方法,类与类之间如何交互等等</p><h1>封装, 抽象, 继承,多态可以解决哪些编程问题?]</h1><h2 id="封装特性">封装特性</h2><p>封装也叫信息隐藏或者数据访问保护. 类通过暴露有限的访问接口,授权外部仅能通过类提供的范式来访问内部信息或者数据.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Wallet</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> createTime;</span><br><span class="line">  <span class="keyword">private</span> BigDecimal balance;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> balanceLastModifiedTime;</span><br><span class="line">  <span class="comment">// ...省略其他属性...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Wallet</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.id = IdGenerator.getInstance().generate();</span><br><span class="line">     <span class="built_in">this</span>.createTime = System.currentTimeMillis();</span><br><span class="line">     <span class="built_in">this</span>.balance = BigDecimal.ZERO;</span><br><span class="line">     <span class="built_in">this</span>.balanceLastModifiedTime = System.currentTimeMillis();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注意：下面对get方法做了代码折叠，是为了减少代码所占文章的篇幅</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.id; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getCreateTime</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.createTime; &#125;</span><br><span class="line">  <span class="keyword">public</span> BigDecimal <span class="title function_">getBalance</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.balance; &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getBalanceLastModifiedTime</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.balanceLastModifiedTime;  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increaseBalance</span><span class="params">(BigDecimal increasedAmount)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (increasedAmount.compareTo(BigDecimal.ZERO) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidAmountException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.balance.add(increasedAmount);</span><br><span class="line">    <span class="built_in">this</span>.balanceLastModifiedTime = System.currentTimeMillis();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decreaseBalance</span><span class="params">(BigDecimal decreasedAmount)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (decreasedAmount.compareTo(BigDecimal.ZERO) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidAmountException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (decreasedAmount.compareTo(<span class="built_in">this</span>.balance) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientAmountException</span>(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.balance.subtract(decreasedAmount);</span><br><span class="line">    <span class="built_in">this</span>.balanceLastModifiedTime = System.currentTimeMillis();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它需要编程语言提供权限访问控制语法来支持, 例如Java中的public protected, public 关键字</p><p>封装:</p><ul><li>保护数据不被随意修改 ,提高代码的可维护性</li><li>仅暴露有限的必要接口,提高类的易用性(不需要调用者了解过多的细节) 冰箱的按钮多少,出错的概率</li></ul><h2 id="抽象特性">抽象特性</h2><p>抽象讲解如何隐藏方法的具体实现, 让使用者只需要关心方法提供了哪些功能, 不需要知道这些功能如何实现.</p><p>抽象通过接口类或者抽象类来实现, 但也不需要特殊的语法机制来支持,命名时也要有抽象思维,getAliyunPicture()    ---- &gt;    getPicture()</p><p>抽象存在的意义:</p><ul><li>提高代码的可扩展性,维护性,修改实现不需要改变定义,减少代码改动的范围</li><li>处理复杂系统的有效手段,能有效过滤不必关注的信息</li></ul><h2 id="继承特性">继承特性</h2><p>继承用来表示类之间的is-a关系,分为两种模式</p><ul><li>单继承</li><li>多继承</li></ul><p>为了实现继承这个特性,编程语言需要提供特殊的语法机制来支持</p><p>继承存在的意义:</p><ul><li>继承主要用来解决代码复用的问题(也可以用组合来实现),特定情况下用继承的is-关系非常符合人类的思维方式,从设计来说也有一种设计美感</li></ul><p>​过度使用继承时错误的,例如在阅读代码时过多层次会增加代码阅读负担, 同时继承的复用会导致子类和父类耦合过高,继承特性很受争议</p><h2 id="多态特性">多态特性</h2><p>三个语法机制实现多态</p><ul><li>语法要支持父类引用可以引用子类对象</li><li>语法要支持继承</li><li>语法要支持子类重写父类方法</li></ul><p>除了&quot;继承加方法重写&quot;还有接口类语法 ,  duck-typing语法(动态语言支持)</p><p>接口类语法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">  <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">  String <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">  String <span class="title function_">remove</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Array</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String[] data;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">remove</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="comment">//...省略其他方法...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> LinkedListNode head;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">remove</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">  <span class="comment">//...省略其他方法... </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(Iterator iterator)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">      System.out.println(iterator.next());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">arrayIterator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line">    print(arrayIterator);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">linkedListIterator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    print(linkedListIterator);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>duck-typing</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">record</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(“I write a log into file.”)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DB</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">record</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(“I insert data into db. ”)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">recorder</span>):</span><br><span class="line">    recorder.record()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>():</span><br><span class="line">    logger = Logger()</span><br><span class="line">    db = DB()</span><br><span class="line">    test(logger)</span><br><span class="line">    test(db)</span><br></pre></td></tr></table></figure><p>多态的意义:</p><ul><li>提高代码扩展性和复用性,很多设计模式, 设计原则, 编程技巧的代码实现基础</li></ul><h1>面向对象相比面向过程有哪些优势? 面向过程真的过时了吗?</h1><p>总有人拿面向对象语言写面向过程风格的代码</p><h2 id="什么是面向过程编程与面向过程编程语言">什么是面向过程编程与面向过程编程语言?</h2><p>面向对象定义</p><ul><li>面向对象过程编程是一种编程范式, 是以类和对象作为基本单元, 以封装, 抽象, 继承,多态为基石来设计和实现代码</li><li>面向对象编程语言是支持类和对象的语法机制,并有现成的语法机制, 能方便地实现面向对象编程地四大特性地编程语言</li></ul><p>面向过程定义</p><ul><li>面向过程编程也是一种编程范式,它以过程(方法, 函数, 操作)作为组织代码的基本单元, 以数据(成员变量, 属性)与方法相分离为最主要的特点.面向过程风格是一种流程化的编程风格,通过拼接一组顺序执行的方法来操作数据完成一项功能</li><li>面向过程编程语言,最大特点是不支持类和对象两个语法概念,不支持丰富的面向对象的编程特性,仅支持面向过程编程</li></ul><p>假设我们有一个记录了用户信息的文本文件users.txt,每行文本的格式是name&amp;age&amp;gender(比如，小王&amp;28&amp;男)。我们希望写一个程序，从users…txt文件中逐行读取用户信息，然后格式化成<br>name\tage\tgender(其中，\t是分隔符)这种文本格式，并且按照age从小到大排序之后，<br>重新写入到另一个文本文件formatted_.users…txt中,</p><p>用面向过程和面向对象两种编程风格，编写出来的代码有什么不同。</p><p>面向过程</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> name[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="type">char</span> gender[<span class="number">16</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> User <span class="title function_">parse_to_user</span><span class="params">(<span class="type">char</span>* text)</span> &#123;</span><br><span class="line">  <span class="comment">// 将text(“小王&amp;28&amp;男”)解析成结构体struct User</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* <span class="title function_">format_to_text</span><span class="params">(<span class="keyword">struct</span> User user)</span> &#123;</span><br><span class="line">  <span class="comment">// 将结构体struct User格式化成文本（&quot;小王\t28\t男&quot;）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sort_users_by_age</span><span class="params">(<span class="keyword">struct</span> User users[])</span> &#123;</span><br><span class="line">  <span class="comment">// 按照年龄从小到大排序users</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">format_user_file</span><span class="params">(<span class="type">char</span>* origin_file_path, <span class="type">char</span>* new_file_path)</span> &#123;</span><br><span class="line">  <span class="comment">// open files...</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">User</span> <span class="title">users</span>[1024];</span> <span class="comment">// 假设最大1024个用户</span></span><br><span class="line">  <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>) &#123; <span class="comment">// read until the file is empty</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">User</span> <span class="title">user</span> =</span> parse_to_user(line);</span><br><span class="line">    users[count++] = user;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  sort_users_by_age(users);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</span><br><span class="line">    <span class="type">char</span>* formatted_user_text = format_to_text(users[i]);</span><br><span class="line">    <span class="comment">// write to new file...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// close files...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">char</span>** args, <span class="type">int</span> argv)</span> &#123;</span><br><span class="line">  format_user_file(<span class="string">&quot;/home/zheng/user.txt&quot;</span>, <span class="string">&quot;/home/zheng/formatted_users.txt&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>面向对象</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> String gender;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, <span class="type">int</span> age, String gender)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.gender = gender;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> User <span class="title function_">praseFrom</span><span class="params">(String userInfoText)</span> &#123;</span><br><span class="line">    <span class="comment">// 将text(“小王&amp;28&amp;男”)解析成类User</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">formatToText</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 将类User格式化成文本（&quot;小王\t28\t男&quot;）</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFileFormatter</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">format</span><span class="params">(String userFile, String formattedUserFile)</span> &#123;</span><br><span class="line">    <span class="comment">// Open files...</span></span><br><span class="line">    <span class="type">List</span> <span class="variable">users</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123; <span class="comment">// read until file is empty </span></span><br><span class="line">      <span class="comment">// read from file into userText...</span></span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> User.parseFrom(userText);</span><br><span class="line">      users.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// sort users by age...</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; users.size(); ++i) &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">formattedUserText</span> <span class="operator">=</span> user.formatToText();</span><br><span class="line">      <span class="comment">// write to new file...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// close files...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">UserFileFormatter</span> <span class="variable">userFileFormatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserFileFormatter</span>();</span><br><span class="line">    userFileFormatter.format(<span class="string">&quot;/home/zheng/users.txt&quot;</span>, <span class="string">&quot;/home/zheng/formatted_users.txt&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="面向对象编程相比面向过程编程有哪些优势">面向对象编程相比面向过程编程有哪些优势</h2><ul><li><p>对于大规模程序的开发,程序的处理流程并非单一主线, 而是错综复杂的玩转结构.面向对象编程比起面向过程编程,更能应对这种复杂类型的程序开发</p></li><li><p>面向对象编程丰富的特性.利用这些特性编写出来的代码,更易扩展,易维护,易复用</p></li><li><p>编程语言和机器打交道的方式的演进规律中,我们可以总结出: 面向对象编程语言比面向过程编程语言,更加人性化,更加高级,更加智能</p></li></ul><h1>哪些代码设计看似是面向对象,实际是面向过程的?</h1><h2 id="滥用getter-setter方法">滥用<code>getter</code>,<code>setter</code>方法</h2><p>​违反封装特性,将面向对象编程风格退化为面向过程编程风格</p><p><strong>在设计类时尽量不要给属性定义setter方法, 除此之外,尽管getter方法相对于setter方法要安全,但是如果返回的是集合容器,也要防范集合内部数据被修改的危险</strong></p><h2 id="滥用全局变量-Constants-和全局方法-Utils">滥用全局变量(Constants)和全局方法(Utils)</h2><p>将数据和操作分离, 不是面向对象,但也有一定好处</p><h3 id="Utils改进策略"><code>Utils</code>改进策略</h3><p>​判定表标准:  在定义<code>Utils</code>类之前, 你要问一下自己,:</p><ul><li><p>**你真的需要单独定义这样一个<code>Utils</code>类吗? **</p></li><li><p><strong>是否可以把<code>Utils</code>类中地某些方法定义到其它类中呢?</strong></p></li></ul><p>​回答完这些问题,你还是觉得确实有必要去定义这样一个<code>Utils</code>类, 那么<strong>大胆地去定义它吧(不要为了面向对象, 随意抽象一个父类)</strong> ,因为在面向对象编程中, 我们也并不是完全排斥面向过程风格的代码.  只要能为我们写好代码,贡献力量,我们就可以适度地去使用</p><h3 id="Constants改进策略">Constants改进策略</h3><p>​当<code>Constants</code>类中包含很多常量定义的时候,依赖这个类的代码就会很多, 每次修改Constants类,都会导致依赖它的类文件重新编译,因此会浪费很多不必要的编译时间, 对于一个非常大的工程项目,编译一次救药花费几分钟,甚至几十分钟, 每次进行单元测试都会出发一次编译的过程,编译过程会影响我们的开发效率</p><p>改进<code>Constants</code>类 两种思路:</p><ul><li>将<code>Constants</code>拆分为功能更加单一的多个类</li><li>不单独设计<code>Constants</code>常量类,而是哪个类用到了某个常量,将常量定义到这个类中(让我想到了注解)</li></ul><p>​<strong><code>Constants</code>类, <code>Utils</code>类的设计问题</strong>, 对于这两种类的设计, 我们尽量能做到职责单一,定义一些细化到的类, 比如有<code>RedisConstatns</code>, <code>FileUtils</code>, 而不是定义一个大而全的<code>Constants</code>类, <code>Utils</code>类. 除此之外,如果能将这些类中的属性和方法, 划分归并到其他业务中,  那是最好不过的了, 能极大地提高类的内举行和代码地可复用性</p><h2 id="定义数据和方法分离的类">定义数据和方法分离的类</h2><pre><code>传统`MVC`结构分为`Model`层, `Controller`层, `View`层这三层</code></pre><p>​逻辑上分为 <code>Controller</code>层, <code>Service</code>层, <code>Repository</code>层</p><p>​数据上定义<code>VO</code>(View Object) <code>BO</code>(Business Object)  <code>Entity</code></p><p>这是典型的面向过程的编程风格</p><p>​这种开发模式叫做基于<code>贫血模型</code>的开发模型, 是我们现在非常常用的一种Web项目的开发模式.(日后会讲)</p><p>​面向对象编程比面向过程编程难一些,不经意就写成面向过程了</p><p>​我们在写一些微小程序时,或者一个数据处理相关的代码, 以算法为主, 数据为辅, 脚本是的面向过程编码风格就更加适合一些,而且面向过程本身就是面向对象的基础, 面向对象编程离不开基础的面向过程编程.</p><p>​不管使用面向对象还是面向过程哪种风格来写代码, 我们最终的目的还是写出易维护, 易读, 易复用, 易扩展的高质量代码. 只要能控制面向过程编程风格的一些弊端, 控制好它的副作用, 在掌握范围内为我们所用, 我们大可不避讳在面向对象编程中写面向过程风格的代码</p><p>优秀评论(笑死看不懂)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.用she实现自动化脚本做的服务编排，一般都是面向过程，一步一步的。而k8s的编排却是</span><br><span class="line">面向对象的，因为它为这个顺序流抽象出了很多角色，将原本一步一步的顺序操作转变成了多</span><br><span class="line">个角色间的轮转和交互。</span><br><span class="line">2.从接触ddd才走出javaer举面向对象旗，干面向过程勾当的局面。所谓为什么“充血模型”不流</span><br><span class="line">行，我认为不外呼两个。一，规范的领域模型对于底层基础架构来说并不友好（缺少stge</span><br><span class="line">t)，所以会导致规范的领域模型与现有基础架构不贴合，切很难开发出完全贴合的基础架</span><br><span class="line">构，进而引深出，合理的业务封装却阻碍关于复用通用抽象的矛盾。二，合理的业务封装，需</span><br><span class="line">要在战略上对业务先做合理的归类分割和抽象。而这个前置条件很少也不好达成。进而缺少前</span><br><span class="line">置设计封装出来的“充血模型”会有种四不像的味道，反而加剧了业务的复杂性，还不如“贫血</span><br><span class="line">模型”来得实用。事实上快节奏下，前置战略设计往往都是不足的，所以想构建优秀的“充血模</span><br><span class="line">型”架构，除了要对业务领域和领域设计有足够的认知，在重构手法和重构意愿上还要有一定</span><br><span class="line">讲究和追求，这样才能让项目以“充血模型”持续且良性的迭代。</span><br><span class="line">3.“充血模型”相对于“贫血模型”有什么好处？从我的经验来看，可读性其实可能“贫血模型”还好</span><br><span class="line">一点，这也可能有思维惯性的原因在里面。但从灵活和扩展性来说“充血模型”会优秀很多，因</span><br><span class="line">为好的“充血模型&quot;”往往意味着边界清晰（耦合低），功能内敛（高内聚）。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>接口vs抽象类的区别? 如何用普通的类模拟抽象类和接口?</h1><p>C++不支持抽象类, python不支持抽象类也不支持接口</p><h3 id="什么是抽象类和接口-区别在哪里">什么是抽象类和接口? 区别在哪里?</h3><p>典型的抽象类的使用场景(模板设计模式)</p><p>​<code>Logger</code>是一个记录日志的抽象类,<code>FileLogger</code>和<code>MessageQueueLogger</code>继承<code>Logger</code>, 分别实现两种不同的日志记录方式:  记录日志到文件中和记录日志到消息队列中.</p><p>​<code>FileLogger</code>和<code>MessageQueueLogger</code>两个子类服用了父类<code>Logger</code>中的<code>name</code>, <code>enabled</code>, <code>minPermittedLevel</code>属性和<code>log()</code>方法, 但因为这两个子类写日志的方式不同, 它们又各自重写了父类中的<code>doLog()</code>方法</p><p>抽象类:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> enabled;</span><br><span class="line">  <span class="keyword">private</span> Level minPermittedLevel;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Logger</span><span class="params">(String name, <span class="type">boolean</span> enabled, Level minPermittedLevel)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.enabled = enabled;</span><br><span class="line">    <span class="built_in">this</span>.minPermittedLevel = minPermittedLevel;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String message)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loggable</span> <span class="operator">=</span> enabled &amp;&amp; (minPermittedLevel.intValue() &lt;= level.intValue());</span><br><span class="line">    <span class="keyword">if</span> (!loggable) <span class="keyword">return</span>;</span><br><span class="line">    doLog(level, message);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">(Level level, String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象类的子类：输出日志到文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Writer fileWriter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">FileLogger</span><span class="params">(String name, <span class="type">boolean</span> enabled,</span></span><br><span class="line"><span class="params">    Level minPermittedLevel, String filepath)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name, enabled, minPermittedLevel);</span><br><span class="line">    <span class="built_in">this</span>.fileWriter = <span class="keyword">new</span> <span class="title class_">FileWriter</span>(filepath); </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到日志文件</span></span><br><span class="line">    fileWriter.write(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象类的子类: 输出日志到消息中间件(比如kafka)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageQueueLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MessageQueueClient msgQueueClient;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MessageQueueLogger</span><span class="params">(String name, <span class="type">boolean</span> enabled,</span></span><br><span class="line"><span class="params">    Level minPermittedLevel, MessageQueueClient msgQueueClient)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name, enabled, minPermittedLevel);</span><br><span class="line">    <span class="built_in">this</span>.msgQueueClient = msgQueueClient;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到消息中间件</span></span><br><span class="line">    msgQueueClient.send(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义接口:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(RpcRequest req)</span> <span class="keyword">throws</span> RpcException;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接口实现类：鉴权过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthencationFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(RpcRequest req)</span> <span class="keyword">throws</span> RpcException &#123;</span><br><span class="line">    <span class="comment">//...鉴权逻辑..</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接口实现类：限流过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(RpcRequest req)</span> <span class="keyword">throws</span> RpcException &#123;</span><br><span class="line">    <span class="comment">//...限流逻辑...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 过滤器使用Demo</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="comment">// filters.add(new AuthencationFilter());</span></span><br><span class="line">  <span class="comment">// filters.add(new RateLimitFilter());</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleRpcRequest</span><span class="params">(RpcRequest req)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (Filter filter : filters) &#123;</span><br><span class="line">        filter.doFilter(req);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(RpcException e) &#123;</span><br><span class="line">      <span class="comment">// ...处理过滤结果...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...省略其他处理逻辑...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​抽象类实际就是类, 只不过是一种特殊的类,这种类不能被实例化对象, 只能被子类继承. 继承关系是一种<code>is-a</code>关系来说, 接口表示一种 <code>has-a</code>关系, 表示具有某些功能, 对于接口, 有一种更加抽象的叫法,那就是协议(contract).</p><h3 id="抽象类和接口能解决什么编程问题">抽象类和接口能解决什么编程问题?</h3><p>抽象类是为了代码复用而生的</p><p>但普通类也可以实现代码复用, 那么抽象类有什么独特作用吗?</p><p>抽象类是 <code>is-a</code></p><p>接口时 <code>has-a</code></p><p>我们还是拿之前那个打印日志的例子来讲解。我们先对上面的代码做下改造。在改造之后的代<br>码中，<code>Logger</code>不再是抽象类，只是一个普通的父类，删除了<code>Logger</code>中<code>log()</code>、<code>doLog()</code>方法，<br>新增了<code>isLoggablet()</code>方法。<code>FileLogger</code>和<code>MessageQueueLogger</code>还是继承<code>Logger</code>父类，以达<br>到代码复用的目的。具体的代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类：非抽象类，就是普通的类. 删除了log(),doLog()，新增了isLoggable().</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> enabled;</span><br><span class="line">  <span class="keyword">private</span> Level minPermittedLevel;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Logger</span><span class="params">(String name, <span class="type">boolean</span> enabled, Level minPermittedLevel)</span> &#123;</span><br><span class="line">    <span class="comment">//...构造函数不变，代码省略...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isLoggable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loggable</span> <span class="operator">=</span> enabled &amp;&amp; (minPermittedLevel.intValue() &lt;= level.intValue());</span><br><span class="line">    <span class="keyword">return</span> loggable;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类：输出日志到文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Writer fileWriter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">FileLogger</span><span class="params">(String name, <span class="type">boolean</span> enabled,</span></span><br><span class="line"><span class="params">    Level minPermittedLevel, String filepath)</span> &#123;</span><br><span class="line">    <span class="comment">//...构造函数不变，代码省略...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLoggable()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到日志文件</span></span><br><span class="line">    fileWriter.write(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类: 输出日志到消息中间件(比如kafka)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageQueueLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MessageQueueClient msgQueueClient;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MessageQueueLogger</span><span class="params">(String name, <span class="type">boolean</span> enabled,</span></span><br><span class="line"><span class="params">    Level minPermittedLevel, MessageQueueClient msgQueueClient)</span> &#123;</span><br><span class="line">    <span class="comment">//...构造函数不变，代码省略...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLoggable()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到消息中间件</span></span><br><span class="line">    msgQueueClient.send(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个设计思路虽然达到了代码复用的目的，但是无法使用多态特性了。像下面这样编写代码，<br>就会出现编译错误，因为<code>Logger</code>中并没有定义<code>log()</code>方法。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileLogger</span>(<span class="string">&quot;access-log&quot;</span>, <span class="literal">true</span>, Level.WARN, <span class="string">&quot;/users/wangzheng/access.log&quot;</span>);</span><br><span class="line">logger.log(Level.ERROR, <span class="string">&quot;This is a test log message.&quot;</span>);</span><br></pre></td></tr></table></figure><p>你可能会说，这个问题解决起来很简单啊。我们在Logger父类中，定义一个空的<code>Iog()</code>方法，<br>让子类重写父类的<code>1og ()</code>方法，实现自己的记录日志的逻辑，不就可以了吗？</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="comment">// ...省略部分代码...</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String mesage)</span> &#123; <span class="comment">// do nothing... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="comment">// ...省略部分代码...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLoggable()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到日志文件</span></span><br><span class="line">    fileWriter.write(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageQueueLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="comment">// ...省略部分代码...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(Level level, String mesage)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isLoggable()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 格式化level和message,输出到消息中间件</span></span><br><span class="line">    msgQueueClient.send(...);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但它显然没有之前抽象类的实现思路优雅</p><ul><li>Logger中定义一个空的方法,可读性差</li><li>当创建一个新的子类继承Logger父类的时候, 我们又可能会忘记重新实现log()方法,之前的抽象类会强制子类重写<code>log()</code>方法</li><li>Logger可以被实例化,增加类被误用的风险</li></ul><p>其他语言即使不支持接口特性, 也可以模拟接口</p><h1>为什么基于接口而非实现编程? 有必要为每个类都定义接口吗?</h1>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式之美 </tag>
            
            <tag> 计算机基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之美导学</title>
      <link href="/2023/11/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%AD%A6/"/>
      <url>/2023/11/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<h1>为什么要学习设计模式?</h1><p><em>越早学习设计模式越好,有些东西早点知道,才能在日后一直发挥作用</em></p><p>在计算机基础中</p><ul><li><p>数据结构和算法研究如何高效实现</p></li><li><p>设计模式研究如何保证代码的可维护性</p></li></ul><p>总结</p><ul><li>应对面试中的设计模式相关问题</li><li>告别被别人吐槽的烂代码(talk is cheap, show me your code)</li><li>提高复杂代码的设计和开发能力</li><li>让读源码,学框架事半功倍</li><li>为职场发展做铺垫</li></ul><p>​</p><p>在日常开发中用过哪些设计模式?</p><p>使用代理模式进行共性话处理,比如AOP思想,将非业务功能和业务功能解耦</p><ul><li>事务的处理 @Translation</li><li>系统间上下文的传递ThreadLocal+ restTemplate#intercept等等</li></ul><p>使用工厂 + 策略</p><ul><li>不同优惠种类的计算</li><li>定制化功能的解耦</li></ul><p>观察者模式 : 这个模式的思想在很多中间件(mq, zookeeper, netty等等)可以看到银子</p><ul><li>通过领域事件解耦业务</li><li>理解eventloop, epoll等等</li><li>通过watch实现动态配置, HA等等</li></ul><p>职责链模式: pipeline思想</p><ul><li>filter</li><li>理解netty中的各种handler</li></ul><h1>从哪些维度评价代码质量的好坏?如何具备写高质量代码的能力?</h1><h2 id="如何评价代码质量的高低">如何评价代码质量的高低?</h2><p>代码质量高低的指标是从不同维度进行评价且具有很大的主观性</p><p>且指标之间并不独立,维度可能重合</p><p>而且评价很难量化,并非非黑即白</p><p>最常用的评价标准</p><ul><li><strong>可维护性</strong></li><li><strong>可读性</strong></li><li><strong>可扩展性</strong></li><li>灵活性</li><li>简介性</li><li>可复用性</li><li>可测试性</li></ul><h2 id="可维护性">可维护性</h2><p>维护代码事件远远大于编码时间</p><p>维护无外乎 修改bug, 修改老代码, 添加新代码</p><p>易维护是指在不破坏原有代码设计, 不引入新的bug的情况下, 能快速地修改或者添加代码</p><p>可维护性由人而定, 很主观</p><h2 id="可读性">可读性</h2><p><em>Google 内部甚至专门有个认证就叫作 Readability。只有拿到这个认证的工程师，才有资格在 code review 的时候，批准别人提交代码。</em></p><p>可见代码的可读性有多重要，毕竟，代码被阅读的次数远远超过被编写和执行的次数。</p><p>查看代码是否符合编码规范, 命名是否达意, 注释是否详尽, 函数是否长短合适, 模块划分是否清晰, 是否符合高内聚低耦合等等</p><p>code review是一个很好的测验代码可读性地手段. 如果同事可以轻松地读懂你写的代码,那说明你的代码可读性很好</p><h2 id="可扩展性">可扩展性</h2><p>代码是否易于扩展</p><p>代码预留一些功能扩展点,不会因为添加一个功能,改动大量的原始代码</p><p>“对修改关闭, 对扩展开放”</p><h2 id="灵活性">灵活性</h2><p>很抽象,不好下定义</p><p>举例场景可以被称为 代码写的灵活</p><ul><li>添加新的功能时, 原有代码已经预留好了扩展点, 不需要修改原代码,只需要在扩展点添加新的代码即可(扩展性)</li><li>实现一个功能,发现原有代码中,已经抽象出很多底层可复用的模块(可复用性)</li><li>使用某组接口时,这组接口可以应对各种使用场景,满足不同的的需求.(易用)</li></ul><h2 id="简洁性">简洁性</h2><p>KISS原则 “Keep it Simple , Stupid”</p><p>编程经验不足的程序员喜欢在项目中引入一些复杂的设计模式,认为这样才能体现出技术水平</p><p>真正的高手能云淡风轻的用最简单的方式解决最复杂的问题</p><h2 id="可复用性">可复用性</h2><p>尽量减少重复代码的编写,复用已有的代码</p><p>Don’t Reapeat your self</p><h2 id="可测试性">可测试性</h2><p>代码可测试性差,比较难写单元测试,那基本说明代码设计有问题</p><h2 id="如何写出高质量的代码">如何写出高质量的代码?</h2><p>如何写出易维护,易读, 易扩展,灵活, 简洁, 可复用, 可测试的代码?</p><p>需要掌握一些更加细化,更加能落地的编程方法论</p><p>面向对象的设计思想, 设计原则, 设计模式, 编码规范, 重构技巧</p><h1>面向对象,设计原则, 设计模式,编程规范, 重构,这五者之间的关系?</h1><p><strong>极客时间 设计模式之美 大纲,学习框架</strong></p><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202309160909847.png" alt="image-20230916090931099"></p><h2 id="面向对象">面向对象</h2><p>主流编程范式(面向过程, 面向对象, 函数式)中的主流.</p><p>面向对象具有丰富的特性(继承,封装.多态,抽象),可以实现很多复杂的设计思路,是很多设计原则,设计模式编码实现的基础</p><p>接下来需要掌握</p><ul><li>面向对象的四大特性 : 封装, 抽象, 继承, 多态</li><li>面向对象编程与面向过程编程的区别和联系</li><li>面向对象分析, 面向对象设计, 面向对象编程</li><li>接口类和抽象类的区别以及各自的应用场景</li><li>基于接口而非实现的编程设计思想</li><li>多用组合少用继承的设计思想</li><li>面向过程的贫血模式和面向对象的充血模型</li></ul><h2 id="设计原则">设计原则</h2><p>设计原则这里比较抽象,不能单纯的记忆,需要掌握其设计初衷,解决哪些编程问题,有那些应用场景</p><ul><li>SOLD原则-SRP 单一职责原则</li><li>SOLD原则-OCP 开闭原则</li><li>SOLD原则-LSP 里式替换原则</li><li>SOLD原则-ISP接口隔离原则</li><li>SOLD原则-DIP依赖倒置原则</li><li>DRY原则, KISS原则, YAGNI原则, LOD法则</li></ul><h2 id="设计模式">设计模式</h2><p>设计模式相较设计原则没那么抽象,难点在原了解他们都能解决哪些问题, 掌握典型的应用场景, 冰冻的不过度应用</p><p>23种经典设计模式,随着语言的严谨,一些设计模式(Singleton)随之过时,甚至成了反模式,一些内置在编程语言中(比如Iterator), 另外还有一些新模式的诞生(Monostate)</p><p>学习设计模式要有侧重点,对常用的设计模式,我们要多花时间理解掌握,对于不常用的只需要稍微了解即可</p><h3 id="创建型-5">创建型(5)</h3><p><strong>常用</strong>: <strong>单例, 工厂模式(工厂方法和抽象工厂), 建造者模式</strong></p><p>不常用: 原型模式</p><h3 id="结构型-7">结构型(7)</h3><p>常用: 代理模式, 桥接模式, 装饰器模式, 适配器模式</p><p>不常用: 门面模式, 组合模式, 享元模式</p><h3 id="行为型-11">行为型(11)</h3><p>常用: 观察者模式, 模板模式, 策略模式, 职责链模式,迭代器模式, 状态模式</p><p>不常用: 访问者模式, 备忘录模式, 命令模式, 解释器模式, 中介模式</p><h2 id="编码规范">编码规范</h2><p>主要解决的是代码可读性问题,相对设计原则, 设计模式, 更加具体,更加片中代码细节</p><p>是最起码要掌握的</p><p>比如 : 给变量,类,函数命名, 如何写代码注释, 函数不宜过长, 参数不能过多</p><p>已经有很多经典书籍了,没时间,看20条也够用</p><p>编码规范没有单独作为一个模块来讲解,而是放到重构中,重构分为大重构和小重构,小重构利用的知识点基本上就是编码规范</p><h2 id="代码重构">代码重构</h2><p>软件开发中,只要软件在不停的迭代,就没有一劳永逸的设计,随着需求的变化, 代码的不断堆砌,原有设计必然存在这样那样的问题,针对这些问题,我们需要进行代码重构,重构是软件开发中重要的一环, 持续重构是保证代码质量不下降的有效手段,能避免代码孵化到无可救药的地步</p><p>我们前面讲的面向对象, 设计原则, 设计模式 一个重要的应用场景就是在代码重构的时候, 虽然设计模式可以提高代码的可扩展性,但过度不恰当地使用,也会增加代码地复杂度, 影响代码地可读性, <strong>开发初期特别必须, 我们不要过度设计</strong>,应用复杂地设计模式.而是当代码出现问题时,在针对问题进行重构,避免前期地过度设计</p><ul><li>重构地目的(why), 对象(what), 时机(when), 方法(how) ;</li><li>保证重构不出错地技术手段, :  单元测试和代码的可测试性</li><li>两种不同规模的重构: 大重构(大规模高层次) 和 小重构(小规模低层次)</li></ul><h3 id="五者间的联系">五者间的联系</h3><ul><li><p>面向对象丰富的特性(继承, 封装, 多态, 抽象)可以实现很多复杂的设计思路, 是很多设计原则, 设计模式等编码实现的基础</p></li><li><p>设计原则是指导我们代码设计的一些经验总结, 对于某些场景下,是否应该应用某种设计模式,具有指导意义. 比如, &quot;开闭原则&quot;是很多设计模式(策略, 模板等)的指导原则</p></li><li><p>设计模式是针对软件开发中经常遇到的设计问题,总结出来的一套解决方案或者设计思想, 主要目的是提高代码的可扩展性. 设计原则比设计模式更抽象, 设计模式更加具体,更加可执行</p></li><li><p>编程方式主要解决的是代码的可读性问题. 它相较于设计原则, 设计模式,更加具体,更加偏重代码细节,更加能落地. 持续的小重构依赖的理论基础主要是编程规范</p></li><li><p>重构作为保持代码质量不下降的有效手段,利用的激素hi面向对象, 设计原则,设计模式,编码规范这些理论</p></li></ul><p>锐评</p><p><em>再好的理论,应用不到实际中也是白费,对于提升代码质量,最有效的是编码规范,其次才是设计原则,再次是代码重构, 最后才是面向对象和设计模式</em></p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机基础 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>回溯暴搜-排列组合问题全解</title>
      <link href="/2023/11/08/%E5%9B%9E%E6%BA%AF%E6%9A%B4%E6%90%9C-%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98%E5%85%A8%E8%A7%A3/"/>
      <url>/2023/11/08/%E5%9B%9E%E6%BA%AF%E6%9A%B4%E6%90%9C-%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98%E5%85%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="回溯算法模板">回溯算法模板</h2><p>本质上就是对一棵递归树进行选择和撤回,在合适的位置(前序和后续)进行选择和记录</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// 记录「路径」</span></span><br><span class="line">        LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 「路径」中的元素会被标记为 true，避免重复使用</span></span><br><span class="line">        <span class="type">boolean</span>[] used = <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">        </span><br><span class="line">        backtrack(nums, track, used);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 路径：记录在 track 中</span></span><br><span class="line">    <span class="comment">// 选择列表：nums 中不存在于 track 的那些元素（used[i] 为 false）</span></span><br><span class="line">    <span class="comment">// 结束条件：nums 中的元素全都在 track 中出现</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, LinkedList&lt;Integer&gt; track, <span class="type">boolean</span>[] used)</span> &#123;</span><br><span class="line">        <span class="comment">// 触发结束条件</span></span><br><span class="line">        <span class="keyword">if</span> (track.size() == nums.length) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>(track));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 排除不合法的选择</span></span><br><span class="line">            <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">                <span class="comment">// nums[i] 已经在 track 中，跳过</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 做选择</span></span><br><span class="line">            track.add(nums[i]);</span><br><span class="line">            used[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 进入下一层决策树</span></span><br><span class="line">            backtrack(nums, track, used);</span><br><span class="line">            <span class="comment">// 取消选择</span></span><br><span class="line">            track.removeLast();</span><br><span class="line">            used[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="排列组合的基本情况">排列组合的基本情况</h2><p>关键是如何在合适位置怎样的进行剪枝和记录</p><p>对于各种复杂的情况, 我们可以将问题分类成最基本的三类</p><ul><li><p>子集</p></li><li><p>组合</p></li><li><p>排列</p></li></ul><p>比如输入 <code>nums = [1,2,3]</code>，算法应该返回如下子集：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[ [],[1],[2],[3],[1,2],[1,3],[2,3],[1,2,3] ]</span><br></pre></td></tr></table></figure><p>子集问题是对每次选择进行记录所以在遍历决策树的前序位置将路径添加到结果集中</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 记录回溯算法的递归路径</span></span><br><span class="line">    LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主函数</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        backtrack(nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 回溯算法核心函数，遍历子集问题的回溯树</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 前序位置，每个节点的值都是一个子集</span></span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(track));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 回溯算法标准框架</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 做选择</span></span><br><span class="line">            track.addLast(nums[i]);</span><br><span class="line">            <span class="comment">// 通过 start 参数控制树枝的遍历，避免产生重复的子集</span></span><br><span class="line">            backtrack(nums, i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 撤销选择</span></span><br><span class="line">            track.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>组合问题</p><p>实际上就是在子集问题的基础上加一层判断,只有当子集中元素的个数等于组合数的长度时才记录</p><p>比如我们要组合 <code>nums = [1,2,3]</code>中的两个数</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[ [1,2],[1,3],[2,3] ]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 记录回溯算法的递归路径</span></span><br><span class="line">    LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主函数</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        backtrack(<span class="number">1</span>, n, k);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="comment">// base case</span></span><br><span class="line">        <span class="keyword">if</span> (k == track.size()) &#123;</span><br><span class="line">            <span class="comment">// 遍历到了第 k 层，收集当前节点的值</span></span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(track));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 回溯算法标准框架</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="comment">// 选择</span></span><br><span class="line">            track.addLast(i);</span><br><span class="line">            <span class="comment">// 通过 start 参数控制树枝的遍历，避免产生重复的子集</span></span><br><span class="line">            backtrack(i + <span class="number">1</span>, n, k);</span><br><span class="line">            <span class="comment">// 撤销选择</span></span><br><span class="line">            track.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>从最简单的子集问题推广到需要加判断条件和start的组合问题以及加判断条件和used数组的排列问题</p><h2 id="排列组合复杂情况">排列组合复杂情况</h2><p>对于回溯的排列组合问题上述元素均为无重复且不可复选的情况</p><p>实际可以分为三类</p><ul><li>无重复不可复选</li><li>有重复不可复选</li><li>无重复可复选</li></ul><p>有重复可复选的情况本质和无重复可复选一样(既然可复选,元素重不重复都一样,等价于无重复可复选)</p><p>无重复不可复选就是最基本的情况,上面已经讲过了</p><p>下面谈谈有重复不可复选的情况</p><p>子集问题</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// 先排序，让相同的元素靠在一起</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        backtrack(nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">        <span class="comment">// 前序位置，每个节点的值都是一个子集</span></span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(track));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 剪枝逻辑，值相同的相邻树枝，只遍历第一条</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; start &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            track.addLast(nums[i]);</span><br><span class="line">            backtrack(nums, i + <span class="number">1</span>);</span><br><span class="line">            track.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>组合</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// 先排序，让相同的元素靠在一起</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        backtrack(nums, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">         <span class="comment">// base case</span></span><br><span class="line">        <span class="keyword">if</span> (nums.length == track.size()) &#123;</span><br><span class="line">            <span class="comment">// 遍历到了第 k 层，收集当前节点的值</span></span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(track));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 剪枝逻辑，值相同的相邻树枝，只遍历第一条</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; start &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            track.addLast(nums[i]);</span><br><span class="line">            backtrack(nums, i + <span class="number">1</span>);</span><br><span class="line">            track.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>排列</p><p>假设输入为 <code>nums = [1,2,2']</code>，标准的全排列算法会得出如下答案：</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    [1,2,2&#x27;],[1,2&#x27;,2],</span><br><span class="line">    [2,1,2&#x27;],[2,2&#x27;,1],</span><br><span class="line">    [2&#x27;,1,2],[2&#x27;,2,1]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>显然，这个结果存在重复，比如 <code>[1,2,2']</code> 和 <code>[1,2',2]</code> 应该只被算作同一个排列，但被算作了两个不同的排列。</p><p>所以现在的关键在于，如何设计剪枝逻辑，把这种重复去除掉？</p><p><strong>答案是，保证相同元素在排列中的相对位置保持不变</strong>。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">boolean</span>[] used;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permuteUnique</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// 先排序，让相同的元素靠在一起</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        used = <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">        backtrack(nums);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (track.size() == nums.length) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>(track));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 新添加的剪枝逻辑，固定相同的元素在排列中的相对位置,保证同一层不出现相同的值</span></span><br><span class="line">           <span class="comment">//当出现重复元素时，比如输入 nums = [1,2,2&#x27;,2&#x27;&#x27;]，2&#x27; 只有在 2 已经被使用的情况下才会被选择，同理，`2&#x27;&#x27;` 只有在 2&#x27; 已经被使用的情况下才会被选择，这就保证了相同元素在排列中的相对位置保证固定</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>] &amp;&amp; !used[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="comment">// 如果前面的相邻相等元素没有用过，则跳过</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            track.add(nums[i]);</span><br><span class="line">            used[i] = <span class="literal">true</span>;</span><br><span class="line">            backtrack(nums);</span><br><span class="line">            track.removeLast();</span><br><span class="line">            used[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>当出现重复元素时，比如输入 <code>nums = [1,2,2',2'']</code>，<code>2'</code> 只有在 <code>2</code> 已经被使用的情况下才会被选择，同理，<code>2''</code> 只有在 <code>2'</code> 已经被使用的情况下才会被选择，这就保证了相同元素在排列中的相对位置保证固定</strong>。</p><p>这样的写法也可以,保证同一层不出现相同的值</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, LinkedList&lt;Integer&gt; track)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (track.size() == nums.length) &#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>(track));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录之前树枝上元素的值</span></span><br><span class="line">    <span class="comment">// 题目说 -10 &lt;= nums[i] &lt;= 10，所以初始化为特殊值</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">prevNum</span> <span class="operator">=</span> -<span class="number">666</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 排除不合法的选择</span></span><br><span class="line">        <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] == prevNum) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        track.add(nums[i]);</span><br><span class="line">        used[i] = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 记录这条树枝上的值</span></span><br><span class="line">        prevNum = nums[i];</span><br><span class="line"></span><br><span class="line">        backtrack(nums, track);</span><br><span class="line"></span><br><span class="line">        track.removeLast();</span><br><span class="line">        used[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红蓝二分法，边界判定不用愁</title>
      <link href="/2023/11/08/%E7%BA%A2%E8%93%9D%E4%BA%8C%E5%88%86%E6%B3%95%E2%80%94%E2%80%94%E4%B8%80%E7%A7%8D%E4%BA%8C%E5%88%86%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E6%A8%A1%E6%9D%BF%20-%20%E5%89%AF%E6%9C%AC/"/>
      <url>/2023/11/08/%E7%BA%A2%E8%93%9D%E4%BA%8C%E5%88%86%E6%B3%95%E2%80%94%E2%80%94%E4%B8%80%E7%A7%8D%E4%BA%8C%E5%88%86%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E6%A8%A1%E6%9D%BF%20-%20%E5%89%AF%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1>📕📘红蓝二分法 解题</h1><p>​</p><h2 id="🔍红蓝二分法讲解：">🔍红蓝二分法讲解：</h2><p><strong>特此声明：本文模板非原创，核心内容均转自B站 五点七边 ，本人主要进行简要介绍，相应题目代码展示，持续更新中……</strong></p><p>关于红蓝二分法，五点七边以给出很不错的讲解：</p><p><a href="https://www.bilibili.com/video/BV1d54y1q7k7/?spm_id_from=333.999.0.0&amp;vd_source=a2cdc337163157715ec6605c77937a77">二分查找为什么总是写错？_哔哩哔哩_bilibili</a></p><p><code>leetcode</code> 大佬讲解红蓝二分法</p><p><a href="https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array/solution/lan-hong-hua-fen-fa-dan-mo-ban-miao-sha-e7r40/">蓝红二分法单模板秒杀二分查找</a></p><h2 id="🌟二分的本质：">🌟二分的本质：</h2><p>​如果我们能够通过某种方式将一个区间<strong>划分成两个区间，左边区间满足某种特性；右边区间不满足某种特性</strong>。<br>​那么我们就能够通过二分法来寻找左区间的右边端点或者右区间的左边端点</p><p>​<strong>有单调性一定可以二分，但是二分不一定要有单调性</strong></p><p>​通常二分法的思路是通过二分<strong>不断缩小结果范围</strong>直到确认结果或者区间不存在</p><p>​而红蓝二分法则是<strong>逆向思路</strong>，通过<strong>不断扩大非结果区间的范围</strong>直到直到确认结果或者区间不存在</p><p>​</p><p>​通常二分法的思路对应的各种左闭右闭或者左闭右开往往面临繁琐的边界问题，虽然通过大量练习也能熟能生巧，但红蓝二分提供的简易思路可以摒弃复杂的边界问题，更加贴近二分的本质——<strong>循环不变量</strong></p><p>​大家写二分法经常写乱，主要是因为<strong>对区间的定义没有想清楚，区间的定义就是不变量</strong>。要在二分查找的过程中，保持不变量，就是在while寻找中每一次边界的处理都要坚持根据区间的定义来操作，这就是<strong>循环不变量</strong>规则。</p><p>红蓝二分模板：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">l = -<span class="number">1</span>, r = N;<span class="comment">//初始化，保证l和r不在搜索区间内部，保证循环不变量</span></span><br><span class="line"><span class="keyword">while</span> l + <span class="number">1</span> != <span class="type">r</span></span><br><span class="line">    <span class="variable">m</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>           <span class="comment">//此处预防越界，只是和(l + r) / 2写法不同</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">isBlue</span><span class="params">(m)</span>  <span class="comment">// isBlue()是抽象出来的用来判断特性的方法</span></span><br><span class="line">        l = m</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        r = m</span><br><span class="line"><span class="keyword">return</span> l or r<span class="comment">//因题而异        </span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><h2 id="❔二分题目总结">❔二分题目总结</h2><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202302282125488.png" alt="image-20230228210901759"></p><h3 id="完全有序">完全有序</h3><ul><li><em>梦开始的地方，基础的二分查找</em></li></ul><h4 id="⭐-704-二分查找">⭐ 704.<a href="https://leetcode.cn/problems/binary-search/">二分查找</a></h4><p><a href="https://leetcode.cn/problems/binary-search/">力扣题目链接(opens new window)</a></p><p>给定一个 n 个元素有序的（升序）整型数组 nums 和一个目标值 target  ，写一个函数搜索 nums 中的 target，如果目标值存在返回下标，否则返回 -1。</p><p>示例 1:</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">输入: nums = [-1,0,3,5,9,12], target = 9     </span><br><span class="line">输出: 4       </span><br><span class="line">解释: 9 出现在 nums 中并且下标为 4     </span><br></pre></td></tr></table></figure><p>1<br>2<br>3</p><p>示例 2:</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">输入: nums = [-1,0,3,5,9,12], target = 2     </span><br><span class="line">输出: -1        </span><br><span class="line">解释: 2 不存在 nums 中因此返回 -1        </span><br></pre></td></tr></table></figure><p>1<br>2<br>3</p><p>提示：</p><ul><li>你可以假设 nums 中的所有元素是不重复的。</li><li>n 将在 [1, 10000]之间。</li><li>nums 的每个元素都将在 [-9999, 9999]之间。</li></ul><p>红蓝二分法解法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="keyword">while</span>(l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[m] == target) <span class="keyword">return</span> m;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[m] &gt; target) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="35-搜索插入位置">35.<a href="https://leetcode.cn/problems/search-insert-position/">搜索插入位置</a></h4><ul><li><em>二分查找的变式，感受查找边界</em></li></ul><p>给定一个排序数组和一个目标值，在数组中找到目标值，并返回其索引。如果目标值不存在于数组中，返回它将会被按顺序插入的位置。</p><p>你可以假设数组中无重复元素。</p><p>示例 1:</p><ul><li>输入: [1,3,5,6], 5</li><li>输出: 2</li></ul><p>示例 2:</p><ul><li>输入: [1,3,5,6], 2</li><li>输出: 1</li></ul><p>示例 3:</p><ul><li>输入: [1,3,5,6], 7</li><li>输出: 4</li></ul><p>示例 4:</p><ul><li>输入: [1,3,5,6], 0</li><li>输出: 0</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[m] &gt;= target) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="⭐34-在排序数组中查找元素的第一个和最后一个位置">⭐<a href="https://leetcode.cn/problems/find-first-and-last-position-of-element-in-sorted-array/">34. 在排序数组中查找元素的第一个和最后一个位置</a></h4><ul><li>二分查找边界的复合，进一步感受边界</li></ul><p>给你一个按照非递减顺序排列的整数数组 <code>nums</code>，和一个目标值 <code>target</code>。请你找出给定目标值在数组中的开始位置和结束位置。</p><p>如果数组中不存在目标值 <code>target</code>，返回 <code>[-1, -1]</code>。</p><p>你必须设计并实现时间复杂度为 <code>O(log n)</code> 的算法解决此问题。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [5,7,7,8,8,10], target = 8</span><br><span class="line">输出：[3,4]</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [5,7,7,8,8,10], target = 6</span><br><span class="line">输出：[-1,-1]</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [], target = 0</span><br><span class="line">输出：[-1,-1]</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>0 &lt;= nums.length &lt;= 105</code></li><li><code>-109 &lt;= nums[i] &lt;= 109</code></li><li><code>nums</code> 是一个非递减数组</li><li><code>-109 &lt;= target &lt;= 109</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] searchRange(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span> result[] = &#123;getLeft(nums,target),getRight(nums,target)&#125;;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getLeft</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (nums[m] &gt;= target) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r == nums.length || nums[r] != target  ) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getRight</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (nums[m] &lt;= target) l = m;</span><br><span class="line">            <span class="keyword">else</span> r = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l == -<span class="number">1</span> || nums[l] != target) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="不完全有序">不完全有序</h3><p>(旋转排序数组系列)</p><ul><li>局部有序，注意循环不变量</li></ul><h4 id="⭐153-寻找旋转排序数组中的最小值">⭐<a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array/">153. 寻找旋转排序数组中的最小值</a></h4><p>已知一个长度为 <code>n</code> 的数组，预先按照升序排列，经由 <code>1</code> 到 <code>n</code> 次 <strong>旋转</strong> 后，得到输入数组。例如，原数组 <code>nums = [0,1,2,4,5,6,7]</code> 在变化后可能得到：</p><ul><li>若旋转 <code>4</code> 次，则可以得到 <code>[4,5,6,7,0,1,2]</code></li><li>若旋转 <code>7</code> 次，则可以得到 <code>[0,1,2,4,5,6,7]</code></li></ul><p>注意，数组 <code>[a[0], a[1], a[2], ..., a[n-1]]</code> <strong>旋转一次</strong> 的结果为数组 <code>[a[n-1], a[0], a[1], a[2], ..., a[n-2]]</code> 。</p><p>给你一个元素值 <strong>互不相同</strong> 的数组 <code>nums</code> ，它原来是一个升序排列的数组，并按上述情形进行了多次旋转。请你找出并返回数组中的 <strong>最小元素</strong> 。</p><p>你必须设计一个时间复杂度为 <code>O(log n)</code> 的算法解决此问题。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [3,4,5,1,2]</span><br><span class="line">输出：1</span><br><span class="line">解释：原数组为 [1,2,3,4,5] ，旋转 3 次得到输入数组。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [4,5,6,7,0,1,2]</span><br><span class="line">输出：0</span><br><span class="line">解释：原数组为 [0,1,2,4,5,6,7] ，旋转 4 次得到输入数组。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [11,13,15,17]</span><br><span class="line">输出：11</span><br><span class="line">解释：原数组为 [11,13,15,17] ，旋转 4 次得到输入数组。</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>n == nums.length</code></li><li><code>1 &lt;= n &lt;= 5000</code></li><li><code>-5000 &lt;= nums[i] &lt;= 5000</code></li><li><code>nums</code> 中的所有整数 <strong>互不相同</strong></li><li><code>nums</code> 原来是一个升序排序的数组，并进行了 <code>1</code> 至 <code>n</code> 次旋转</li></ul><p>解法一</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMin</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(nums[m] &lt;= nums[r - <span class="number">1</span>]) &#123;</span><br><span class="line">            r = m;</span><br><span class="line">            <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">                m = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (nums[m] &lt;= nums[r]) r = m;</span><br><span class="line">                <span class="keyword">else</span> l = m;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            l = m;</span><br><span class="line">            <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">                m = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (nums[m] &gt;= nums[l]) l = m;</span><br><span class="line">                <span class="keyword">else</span> r = m;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[r];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解法二、</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMin</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> l=-<span class="number">1</span>, r=n;</span><br><span class="line">        <span class="keyword">while</span> (l+<span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l+(r-l)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> r == n ? nums[n-<span class="number">1</span>] : nums[r];</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[r];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="⭐154-寻找旋转排序数组中的最小值-II"><a href="https://leetcode.cn/problems/find-minimum-in-rotated-sorted-array-ii/">⭐154. 寻找旋转排序数组中的最小值 II</a></h4><p>已知一个长度为 <code>n</code> 的数组，预先按照升序排列，经由 <code>1</code> 到 <code>n</code> 次 <strong>旋转</strong> 后，得到输入数组。例如，原数组 <code>nums = [0,1,4,4,5,6,7]</code> 在变化后可能得到：</p><ul><li>若旋转 <code>4</code> 次，则可以得到 <code>[4,5,6,7,0,1,4]</code></li><li>若旋转 <code>7</code> 次，则可以得到 <code>[0,1,4,4,5,6,7]</code></li></ul><p>注意，数组 <code>[a[0], a[1], a[2], ..., a[n-1]]</code> <strong>旋转一次</strong> 的结果为数组 <code>[a[n-1], a[0], a[1], a[2], ..., a[n-2]]</code> 。</p><p>给你一个可能存在 <strong>重复</strong> 元素值的数组 <code>nums</code> ，它原来是一个升序排列的数组，并按上述情形进行了多次旋转。请你找出并返回数组中的 <strong>最小元素</strong> 。</p><p>你必须尽可能减少整个过程的操作步骤。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [1,3,5]</span><br><span class="line">输出：1</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [2,2,2,0,1]</span><br><span class="line">输出：0</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>n == nums.length</code></li><li><code>1 &lt;= n &lt;= 5000</code></li><li><code>-5000 &lt;= nums[i] &lt;= 5000</code></li><li><code>nums</code> 原来是一个升序排序的数组，并进行了 <code>1</code> 至 <code>n</code> 次旋转</li></ul><p>**进阶：**这道题与 <a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/description/">寻找旋转排序数组中的最小值</a> 类似，但 <code>nums</code> 可能包含重复元素。允许重复会影响算法的时间复杂度吗？会如何影响，为什么？</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMin</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (nums[r] == nums[<span class="number">0</span>] &amp;&amp; r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> nums[r];</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        ++r;</span><br><span class="line">        n = r;</span><br><span class="line">        <span class="keyword">while</span> (l+<span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l+(r-l)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> r == n ? last : nums[r];</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[r];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="⭐33-搜索旋转排序数组">⭐<a href="https://leetcode.cn/problems/search-in-rotated-sorted-array/">33. 搜索旋转排序数组</a></h4><p>整数数组 <code>nums</code> 按升序排列，数组中的值 <strong>互不相同</strong> 。</p><p>在传递给函数之前，<code>nums</code> 在预先未知的某个下标 <code>k</code>（<code>0 &lt;= k &lt; nums.length</code>）上进行了 <strong>旋转</strong>，使数组变为 <code>[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]</code>（下标 <strong>从 0 开始</strong> 计数）。例如， <code>[0,1,2,4,5,6,7]</code> 在下标 <code>3</code> 处经旋转后可能变为 <code>[4,5,6,7,0,1,2]</code> 。</p><p>给你 <strong>旋转后</strong> 的数组 <code>nums</code> 和一个整数 <code>target</code> ，如果 <code>nums</code> 中存在这个目标值 <code>target</code> ，则返回它的下标，否则返回 <code>-1</code> 。</p><p>你必须设计一个时间复杂度为 <code>O(log n)</code> 的算法解决此问题。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [4,5,6,7,0,1,2], target = 0</span><br><span class="line">输出：4</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [4,5,6,7,0,1,2], target = 3</span><br><span class="line">输出：-1</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [1], target = 0</span><br><span class="line">输出：-1</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 5000</code></li><li><code>-104 &lt;= nums[i] &lt;= 104</code></li><li><code>nums</code> 中的每个值都 <strong>独一无二</strong></li><li>题目数据保证 <code>nums</code> 在预先未知的某个下标上进行了旋转</li><li><code>-104 &lt;= target &lt;= 104</code></li></ul><h4 id="⭐81-搜索旋转排序数组-II">⭐<a href="https://leetcode.cn/problems/search-in-rotated-sorted-array-ii/">81. 搜索旋转排序数组 II</a></h4><p>已知存在一个按非降序排列的整数数组 <code>nums</code> ，数组中的值不必互不相同。</p><p>在传递给函数之前，<code>nums</code> 在预先未知的某个下标 <code>k</code>（<code>0 &lt;= k &lt; nums.length</code>）上进行了 <strong>旋转</strong> ，使数组变为 <code>[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]</code>（下标 <strong>从 0 开始</strong> 计数）。例如， <code>[0,1,2,4,4,4,5,6,6,7]</code> 在下标 <code>5</code> 处经旋转后可能变为 <code>[4,5,6,6,7,0,1,2,4,4]</code> 。</p><p>给你 <strong>旋转后</strong> 的数组 <code>nums</code> 和一个整数 <code>target</code> ，请你编写一个函数来判断给定的目标值是否存在于数组中。如果 <code>nums</code> 中存在这个目标值 <code>target</code> ，则返回 <code>true</code> ，否则返回 <code>false</code> 。</p><p>你必须尽可能减少整个操作步骤。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [2,5,6,0,0,1,2], target = 0</span><br><span class="line">输出：true</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [2,5,6,0,0,1,2], target = 3</span><br><span class="line">输出：false</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 5000</code></li><li><code>-104 &lt;= nums[i] &lt;= 104</code></li><li>题目数据保证 <code>nums</code> 在预先未知的某个下标上进行了旋转</li><li><code>-104 &lt;= target &lt;= 104</code></li></ul><p><strong>进阶：</strong></p><ul><li>这是 <a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/description/">搜索旋转排序数组</a> 的延伸题目，本题中的 <code>nums</code> 可能包含重复元素。</li><li>这会影响到程序的时间复杂度吗？会有怎样的影响，为什么</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> findMin(nums);</span><br><span class="line">        System.out.println(t);</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = n;</span><br><span class="line">        <span class="keyword">if</span> (nums[t] &lt;= target &amp;&amp; target &lt;= nums[n - <span class="number">1</span>]) &#123;</span><br><span class="line">            l = t - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            r = t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (r + l) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[m] == target) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[m] &gt; target) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMin</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        n = nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (nums[r] == nums[<span class="number">0</span>] &amp;&amp; r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> nums[r];</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        ++r;</span><br><span class="line">        n = r;</span><br><span class="line">        <span class="keyword">while</span> (l+<span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l+(r-l)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> r == n ? last : nums[r];</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">                l = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="⭐162-寻找峰值">⭐<a href="https://leetcode.cn/problems/find-peak-element/">162. 寻找峰值</a></h4><p>峰值元素是指其值严格大于左右相邻值的元素。</p><p>给你一个整数数组 <code>nums</code>，找到峰值元素并返回其索引。数组可能包含多个峰值，在这种情况下，返回 <strong>任何一个峰值</strong> 所在位置即可。</p><p>你可以假设 <code>nums[-1] = nums[n] = -∞</code> 。</p><p>你必须实现时间复杂度为 <code>O(log n)</code> 的算法来解决此问题。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [1,2,3,1]</span><br><span class="line">输出：2</span><br><span class="line">解释：3 是峰值元素，你的函数应该返回其索引 2。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [1,2,1,3,5,6,4]</span><br><span class="line">输出：1 或 5 </span><br><span class="line">解释：你的函数可以返回索引 1，其峰值元素为 2；</span><br><span class="line">     或者返回索引 5， 其峰值元素为 6。</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 1000</code></li><li><code>-231 &lt;= nums[i] &lt;= 231 - 1</code></li><li>对于所有有效的 <code>i</code> 都有 <code>nums[i] != nums[i + 1]</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findPeakElement</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">           m = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">           <span class="keyword">if</span> (m &gt;= nums.length - <span class="number">1</span>) r = m;  </span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ( nums[m] &gt; nums[m+<span class="number">1</span>]) r = m;</span><br><span class="line">           <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二维数组">二维数组</h3><h4 id="⭐74-搜索二维矩阵">⭐<a href="https://leetcode.cn/problems/search-a-2d-matrix/">74. 搜索二维矩阵</a></h4><p>难度中等</p><p>编写一个高效的算法来判断 <code>m x n</code> 矩阵中，是否存在一个目标值。该矩阵具有如下特性：</p><ul><li>每行中的整数从左到右按升序排列。</li><li>每行的第一个整数大于前一行的最后一个整数。</li></ul><p><strong>示例 1：</strong></p><p><img src="%E7%BA%A2%E8%93%9D%E4%BA%8C%E5%88%86%E6%B3%95%E2%80%94%E2%80%94%E4%B8%80%E7%A7%8D%E4%BA%8C%E5%88%86%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E6%A8%A1%E6%9D%BF.assets/mat.jpg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：matrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 3</span><br><span class="line">输出：true</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><p><img src="%E7%BA%A2%E8%93%9D%E4%BA%8C%E5%88%86%E6%B3%95%E2%80%94%E2%80%94%E4%B8%80%E7%A7%8D%E4%BA%8C%E5%88%86%E6%B3%95%E7%9A%84%E9%80%9A%E7%94%A8%E6%A8%A1%E6%9D%BF.assets/mat2.jpg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：matrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 13</span><br><span class="line">输出：false</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>m == matrix.length</code></li><li><code>n == matrix[i].length</code></li><li><code>1 &lt;= m, n &lt;= 100</code></li><li><code>-104 &lt;= matrix[i][j], target &lt;= 104</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">searchMatrix</span><span class="params">(<span class="type">int</span>[][] matrix, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span>, r = matrix.length * matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> get(matrix,m);</span><br><span class="line">            <span class="keyword">if</span> (value == target) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (value &gt; target) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span>[][] matrix, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> matrix.length, n = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index / n, j = index % n;</span><br><span class="line">        <span class="keyword">return</span> matrix[i][j]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="其他">其他</h3><h4 id="367-有效的完全平方数"><a href="https://leetcode.cn/problems/valid-perfect-square/">367. 有效的完全平方数</a></h4><p>给你一个正整数 num 。如果 num 是一个完全平方数，则返回 true ，否则返回 false 。</p><p>完全平方数 是一个可以写成某个整数的平方的整数。换句话说，它可以写成某个整数和自身的乘积。</p><p>不能使用任何内置的库函数，如  sqrt 。</p><p>示例 1：</p><p>输入：num = 16<br>输出：true<br>解释：返回 true ，因为 4 * 4 = 16 且 4 是一个整数。<br>示例 2：</p><p>输入：num = 14<br>输出：false<br>解释：返回 false ，因为 3.742 * 3.742 = 14 但 3.742 不是一个整数。</p><p>提示：</p><p>1 &lt;= num &lt;= 231 - 1</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//直接暴力用大数了</span></span><br><span class="line"><span class="keyword">import</span> java.math.*;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPerfectSquare</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">l</span> <span class="operator">=</span>BigInteger.valueOf(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">r</span> <span class="operator">=</span>BigInteger.valueOf((num &gt;&gt; <span class="number">1</span>) + <span class="number">2</span>);</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">x</span> <span class="operator">=</span> BigInteger.valueOf(num);</span><br><span class="line">        BigInteger m;</span><br><span class="line">        <span class="keyword">while</span> (!l.add(BigInteger.ONE).equals(r)) &#123;</span><br><span class="line">            m = l.add(r).divide(BigInteger.TWO);</span><br><span class="line">            <span class="keyword">if</span> (m.multiply(m).equals(x)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (m.multiply(m).compareTo(x) == -<span class="number">1</span>) l = m;</span><br><span class="line">            <span class="keyword">else</span> r = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="69-x-的平方根"><a href="https://leetcode.cn/problems/sqrtx/">69. x 的平方根 </a></h4><p>给你一个非负整数 x ，计算并返回 x 的 算术平方根 。</p><p>由于返回类型是整数，结果只保留 整数部分 ，小数部分将被 舍去 。</p><p>注意：不允许使用任何内置指数函数和算符，例如 pow(x, 0.5) 或者 x ** 0.5 。</p><p>示例 1：</p><p>输入：x = 4<br>输出：2<br>示例 2：</p><p>输入：x = 8<br>输出：2<br>解释：8 的算术平方根是 2.82842…, 由于返回类型是整数，小数部分将被舍去。</p><p>提示：</p><p>0 &lt;= x &lt;= 231 - 1</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//暴力大数</span></span><br><span class="line"><span class="keyword">import</span> java.math.*;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mySqrt</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">l</span> <span class="operator">=</span> BigInteger.valueOf(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">r</span> <span class="operator">=</span> BigInteger.valueOf((x &gt;&gt; <span class="number">1</span>) + <span class="number">2</span>);</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">num</span> <span class="operator">=</span> BigInteger.valueOf(x); </span><br><span class="line">        <span class="keyword">while</span> (!l.add(BigInteger.ONE).equals(r)) &#123;</span><br><span class="line">            <span class="type">BigInteger</span> <span class="variable">m</span> <span class="operator">=</span> l.add(r).divide(BigInteger.TWO);</span><br><span class="line">            <span class="keyword">if</span> (m.multiply(m).compareTo(num) == <span class="number">1</span>) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l.intValue(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mySqrt</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">2</span> || x == <span class="number">3</span> || x == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//上面两行均是为了防止 m == 0的情况，而后面为什么要用x/m&lt;m 而不是 m*m&gt;x则是为了防止越界错误</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> -<span class="number">1</span> , r = (x &gt;&gt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (l + <span class="number">1</span> != r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> l + ((r - l)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (x / m &lt; m) r = m;</span><br><span class="line">            <span class="keyword">else</span> l = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MESI缓存一致性协议</title>
      <link href="/2023/11/08/MESI%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/"/>
      <url>/2023/11/08/MESI%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA NIO</title>
      <link href="/2023/11/08/JavaNIO/"/>
      <url>/2023/11/08/JavaNIO/</url>
      
        <content type="html"><![CDATA[<h1>Java NIO</h1><h2 id="Java-NIO概述">Java NIO概述</h2><h3 id="阻塞IO">阻塞IO</h3><p>在进行读取,写入时,在有可供读写数据到达之前会阻塞线程</p><p>通常, 服务器每个请求都会创建一个线程</p><p>即使使用线程池,但线程池也有着上限</p><h3 id="非阻塞IO">非阻塞IO</h3><p>基于Reactor工作方式,Selector中获取SelectionKey,找到具体的SelectableChannel,以获取客户端发来的数据,面向缓冲区,</p><h3 id="NIO概述">NIO概述</h3><p>三个核心组件</p><ul><li>Channel</li><li>Buffer</li><li>Selectors</li></ul><h2 id="Java-NIO-Channel">Java NIO (Channel)</h2><p>通道,全双工,多种数据源,用于在字节缓冲区与位于通道另一侧地的实体进行传输</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java源码 </tag>
            
            <tag> NIO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ArraysList源码分析</title>
      <link href="/2023/11/08/ArrayList%E6%BA%90%E7%A0%81/"/>
      <url>/2023/11/08/ArrayList%E6%BA%90%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1>ArrayList源码分析</h1>]]></content>
      
      
      <categories>
          
          <category> Java源码 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ArrayLists </tag>
            
            <tag> Java源码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用代码模板</title>
      <link href="/2023/11/08/ACWing%20%E6%8E%92%E5%BA%8F%E5%92%8C%E4%BA%8C%E5%88%86%E6%A8%A1%E6%9D%BF/"/>
      <url>/2023/11/08/ACWing%20%E6%8E%92%E5%BA%8F%E5%92%8C%E4%BA%8C%E5%88%86%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1>【Java版本】常用代码模板1——基础算法 + 模板题参考实现</h1><h3 id="一、快速排序算法模板-——-模板题-AcWing-785-快速排序">一、快速排序算法模板 —— <a href="https://www.acwing.com/problem/content/description/787/">模板题 AcWing 785. 快速排序</a></h3><p>快速排序本质上就是分治！</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static int[] quickSort(int[] arr, int left, int right) &#123;</span><br><span class="line">    // 递归终止条件，如果左边界大于等于右边界则认为递归结束</span><br><span class="line">    if (left &gt;= right) &#123;</span><br><span class="line">        return arr;</span><br><span class="line">    &#125;</span><br><span class="line">    // 设定一个分界值，这里是（left + right）/ 2</span><br><span class="line">    int p = arr[left + right &gt;&gt; 1];</span><br><span class="line">    // 左右提前预留一个位置</span><br><span class="line">    int i = left - 1;</span><br><span class="line">    int j = right + 1;</span><br><span class="line">    while (i &lt; j) &#123;</span><br><span class="line">        // 等效于do while</span><br><span class="line">        // 当数值小于分界值时持续遍历，直到找到第一个大于等于分界值的索引</span><br><span class="line">        // 如果是逆序则调整两个while循环</span><br><span class="line">        while (arr[++i] &lt; p)</span><br><span class="line">            ;</span><br><span class="line">        while (arr[--j] &gt; p)</span><br><span class="line">            ;</span><br><span class="line">        // 交换左右两侧不符合预期的数值</span><br><span class="line">        if (i &lt; j) &#123;</span><br><span class="line">            int temp = arr[i];</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">            arr[j] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 由于分界值取的是left + right &gt;&gt; 1，因此递归取的是left，j j + 1，right</span><br><span class="line">    quickSort(arr, left, j);</span><br><span class="line">    quickSort(arr, j + 1, right);</span><br><span class="line">    return arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/description/787/">模板题 AcWing 785. 快速排序</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.Scanner;</span><br><span class="line">import java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner in = new Scanner(System.in);</span><br><span class="line">        int n = in.nextInt();</span><br><span class="line">        // Java8</span><br><span class="line">        // IntStream.range等效于for循环</span><br><span class="line">        // toArray生成数组</span><br><span class="line">        int[] arr = IntStream.range(0, n).map(i -&gt; in.nextInt()).toArray();</span><br><span class="line">        int[] sortedArr = quickSort(arr, 0, n - 1);</span><br><span class="line">        IntStream.range(0, n).mapToObj(i -&gt; sortedArr[i] + &quot; &quot;).forEach(System.out::print);</span><br><span class="line">        /*</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            int a = in.nextInt();</span><br><span class="line">            arr[i] = a;</span><br><span class="line">        &#125;</span><br><span class="line">        int[] sortedArr = quickSort(arr, 0, n - 1);</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            System.out.print(sortedArr[i] + &quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        */</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int[] quickSort(int[] arr, int left, int right) &#123;</span><br><span class="line">        。。。。。。可参考上述实现</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二、归并排序算法模板-——-模板题-AcWing-787-归并排序">二、归并排序算法模板 —— <a href="https://www.acwing.com/problem/content/789/">模板题 AcWing 787. 归并排序</a></h3><p>归并排序本质上就是分治！</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static int[] mergeSort(int[] arr, int left, int right) &#123;</span><br><span class="line">    // 递归终止条件，如果左边界大于等于右边界则认为递归结束</span><br><span class="line">    if (left &gt;= right) &#123;</span><br><span class="line">        return arr;</span><br><span class="line">    &#125;</span><br><span class="line">    // 设定一个分界值，这里是（left + right）/ 2</span><br><span class="line">    int mid = left + right &gt;&gt; 1;</span><br><span class="line">    // 切割</span><br><span class="line">    arr = mergeSort(arr, left, mid);</span><br><span class="line">    arr = mergeSort(arr, mid + 1, right);/</span><br><span class="line">    // 归并，长度刚好是 left 到 right</span><br><span class="line">    int[] temp = new int[right - left + 1];</span><br><span class="line">    int i = left;</span><br><span class="line">    int j = mid + 1;</span><br><span class="line">    // 用来归并的索引</span><br><span class="line">    int k = 0;</span><br><span class="line">    while (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line">        // 如果是逆序则调整if条件</span><br><span class="line">        if (arr[i] &lt;= arr[j]) &#123;</span><br><span class="line">            temp[k++] = arr[i++];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            temp[k++] = arr[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while (i &lt;= mid) &#123;</span><br><span class="line">        temp[k++] = arr[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    while (j &lt;= right) &#123;</span><br><span class="line">        temp[k++] = arr[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    // 根据归并后的数组重新赋值排序后的数组</span><br><span class="line">    for (i = left, j = 0; i &lt;= right; i++, j++) &#123;</span><br><span class="line">        arr[i] = temp[j];</span><br><span class="line">    &#125;</span><br><span class="line">    return arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/789/">模板题 AcWing 787. 归并排序</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.Scanner;</span><br><span class="line">import java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner in = new Scanner(System.in);</span><br><span class="line">        int n = in.nextInt();</span><br><span class="line">        // Java8，可参考上面普通写法</span><br><span class="line">        int[] arr = IntStream.range(0, n).map(i -&gt; in.nextInt()).toArray();</span><br><span class="line">        int[] sortedArr = mergeSort(arr, 0, n - 1);</span><br><span class="line">        IntStream.range(0, n).mapToObj(i -&gt; sortedArr[i] + &quot; &quot;).forEach(System.out::print);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int[] mergeSort(int[] arr, int left, int right) &#123;</span><br><span class="line">        。。。。。。</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、整数二分算法模板-——-模板题-AcWing-789-数的范围">三、整数二分算法模板 —— <a href="https://www.acwing.com/problem/content/791/">模板题 AcWing 789. 数的范围</a></h3><p>两种模板，分别是 LBS，和 RBS</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 检查x是否满足某种性质  </span><br><span class="line">private static boolean check(int x) &#123;  </span><br><span class="line">   /* ... */  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">// 区间[left, right]被划分成[left, mid]和[mid + 1, right]时使用： </span><br><span class="line">// 或者称之为左二分查询，查找左侧第一个满足条件的数</span><br><span class="line">private static int leftBinarySearch(int[] arr, int left, int right) &#123;  </span><br><span class="line">   while (left &lt; right) &#123;  </span><br><span class="line">      int mid = arr[left + right &gt;&gt; 1];  </span><br><span class="line">      if (check(mid)) &#123;  </span><br><span class="line">         right = mid;    // check()判断mid是否满足性质  </span><br><span class="line">      &#125; else &#123;  </span><br><span class="line">         left = mid + 1;  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   return left;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">// 区间[left, right]被划分成[left, mid - 1]和[mid, right]时使用：  </span><br><span class="line">// 或者称之为右二分查询，查找右侧最后一个满足条件的数</span><br><span class="line">private static int rightBinarySearch(int[] arr, int left, int right) &#123;  </span><br><span class="line">   while (left &lt; right) &#123;  </span><br><span class="line">      int mid = arr[left + right + 1 &gt;&gt; 1];  </span><br><span class="line">      if (check(mid)) &#123;  </span><br><span class="line">         left = mid;    // check()判断mid是否满足性质  </span><br><span class="line">      &#125; else &#123;  </span><br><span class="line">         right = mid - 1;  // 有加必有减</span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   return left;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/791/">模板题 AcWing 789. 数的范围</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.Scanner;</span><br><span class="line">import java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner in = new Scanner(System.in);</span><br><span class="line">        int n = in.nextInt();</span><br><span class="line">        int q = in.nextInt();</span><br><span class="line">        int[] arr = IntStream.range(0, n).map(item -&gt; in.nextInt()).toArray();</span><br><span class="line">        while (q-- &gt; 0) &#123;</span><br><span class="line">            int k = in.nextInt();</span><br><span class="line">            int[] ans = binarySearch(arr, k);</span><br><span class="line">            IntStream.range(0, 2).mapToObj(item -&gt; ans[item] + &quot; &quot;).forEach(System.out::print);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int[] binarySearch(int[] arr, int target) &#123;</span><br><span class="line">        // 将返回值放到一个长度为2的数组中</span><br><span class="line">        int[] res = new int[2];</span><br><span class="line">        int n = arr.length;</span><br><span class="line">        int left = 0;</span><br><span class="line">        int right = n - 1;</span><br><span class="line">        // 先LBS，找到左边界</span><br><span class="line">        while (left &lt; right) &#123;</span><br><span class="line">            int mid = left + right &gt;&gt; 1;</span><br><span class="line">            if (arr[mid] &gt;= target) &#123;</span><br><span class="line">                right = mid;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                left = mid + 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // 如果没有找到，则默认-1 -1</span><br><span class="line">        if (arr[left] != target) &#123;</span><br><span class="line">            return new int[]&#123;-1, -1&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        res[0] = left;</span><br><span class="line">        left = 0;</span><br><span class="line">        right = n - 1;</span><br><span class="line">        // 再RBS，找到右边界</span><br><span class="line">        while (left &lt; right) &#123;</span><br><span class="line">            int mid = left + right + 1 &gt;&gt; 1;</span><br><span class="line">            if (arr[mid] &lt;= target) &#123;</span><br><span class="line">                left = mid;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                right = mid - 1; // 有加必有减</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res[1] = left;</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="四、浮点数二分算法模板-——-模板题-AcWing-790-数的三次方根">四、浮点数二分算法模板 —— <a href="https://www.acwing.com/problem/content/792/">模板题 AcWing 790. 数的三次方根</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 检查x是否满足某种性质  </span><br><span class="line">private static boolean check(double x) &#123;  </span><br><span class="line">   /* ... */  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">// eps 表示精度，取决于题目对精度的要求，默认负六次方</span><br><span class="line">private static double EPS = 1e-6;</span><br><span class="line"></span><br><span class="line">private static double floatBinarySearch(double left, double right) &#123;  </span><br><span class="line">   while (right - left &gt; EPS) &#123;  </span><br><span class="line">      double mid = (left + right) / 2;  </span><br><span class="line">      if (check(mid)) &#123;  </span><br><span class="line">         right = mid;  </span><br><span class="line">      &#125; else &#123;  </span><br><span class="line">         left = mid;  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   return left;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/792/">模板题 AcWing 790. 数的三次方根</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.Scanner;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      double x = in.nextDouble();  </span><br><span class="line">      Double left = -Double.MAX_VALUE;  </span><br><span class="line">      Double right = Double.MAX_VALUE;  </span><br><span class="line">      // 由于负六次方精度不够</span><br><span class="line">      while (right - left &gt; 1e-8) &#123;  </span><br><span class="line">         Double mid = (left + right) / 2;  </span><br><span class="line">         if (mid * mid * mid &gt;= x) &#123;  </span><br><span class="line">            right = mid;  </span><br><span class="line">         &#125; else &#123;  </span><br><span class="line">            left = mid;  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125; </span><br><span class="line">      // 注意格式化输出字符串</span><br><span class="line">      System.out.printf(&quot;%.6f&quot;, left);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="五、高精度加法-——-模板题-AcWing-791-高精度加法">五、高精度加法 —— <a href="https://www.acwing.com/problem/content/793/">模板题 AcWing 791. 高精度加法</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**  </span><br><span class="line"> * 大数据加法  </span><br><span class="line"> */  </span><br><span class="line">private static List&lt;Integer&gt; add(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">    // 默认A &gt; B，如果不满足则对调</span><br><span class="line">   if (A.size() &lt; B.size()) &#123;  </span><br><span class="line">      return add(B, A);  </span><br><span class="line">   &#125;  </span><br><span class="line">   int t = 0;  </span><br><span class="line">   List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">   for (int i = 0; i &lt; A.size(); i++) &#123;  </span><br><span class="line">      t += A.get(i);  </span><br><span class="line">      // 如果在B的范围内，则加B</span><br><span class="line">      if (i &lt; B.size()) &#123;  </span><br><span class="line">         t += B.get(i);  </span><br><span class="line">      &#125; </span><br><span class="line">      // C记录余数</span><br><span class="line">      C.add(t % 10);  </span><br><span class="line">      t /= 10;  </span><br><span class="line">   &#125;  </span><br><span class="line">   // 进位</span><br><span class="line">   if (t != 0) &#123;  </span><br><span class="line">      C.add(t);  </span><br><span class="line">   &#125;  </span><br><span class="line">   // 去掉开头的零</span><br><span class="line">   while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">      C.remove(C.size() - 1);  </span><br><span class="line">   &#125;  </span><br><span class="line">   return C;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/793/">模板题 AcWing 791. 高精度加法</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;  </span><br><span class="line">import java.io.IOException;  </span><br><span class="line">import java.io.InputStreamReader;  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.List;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">       // 由于数据量较大，使用BufferedReader读取数据</span><br><span class="line">       BufferedReader in = new BufferedReader(new InputStreamReader(System.in));  </span><br><span class="line">       String A = in.readLine();  </span><br><span class="line">       List&lt;Integer&gt; aList = new ArrayList&lt;&gt;();  </span><br><span class="line">       for (int i = A.length() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">          aList.add(A.charAt(i) - &#x27;0&#x27;);  </span><br><span class="line">       &#125;  </span><br><span class="line">       String B = in.readLine();  </span><br><span class="line">       List&lt;Integer&gt; bList = new ArrayList&lt;&gt;();  </span><br><span class="line">       for (int i = B.length() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">          bList.add(B.charAt(i) - &#x27;0&#x27;);  </span><br><span class="line">       &#125;  </span><br><span class="line">       List&lt;Integer&gt; cList = add(aList, bList);  </span><br><span class="line">       for (int i = cList.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">          System.out.print(cList.get(i));  </span><br><span class="line">       &#125;  </span><br><span class="line">       // 关闭资源</span><br><span class="line">       in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 大数据加法  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; add(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">      。。。。。。可参考上述实现</span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="六、高精度减法-——-模板题-AcWing-792-高精度减法">六、高精度减法 —— <a href="https://www.acwing.com/problem/content/794/">模板题 AcWing 792. 高精度减法</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static boolean compare(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">    // 优先比较数组长度，长度更大，数值更大</span><br><span class="line">   if (A.size() != B.size()) &#123;  </span><br><span class="line">      return A.size() &gt; B.size();  </span><br><span class="line">   &#125;  </span><br><span class="line">   for (int i = A.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">      if (A.get(i) == B.get(i)) &#123;  </span><br><span class="line">         continue;  </span><br><span class="line">      &#125;  </span><br><span class="line">      return A.get(i) &gt; B.get(i);  </span><br><span class="line">   &#125;  </span><br><span class="line">   return true;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">/**  </span><br><span class="line"> * 大数据减法  </span><br><span class="line"> */  </span><br><span class="line">private static List&lt;Integer&gt; subtract(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">   if (!compare(A, B)) &#123;  </span><br><span class="line">      System.out.print(&quot;-&quot;);  </span><br><span class="line">      return subtract(B, A);  </span><br><span class="line">   &#125;  </span><br><span class="line">   int t = 0;  </span><br><span class="line">   List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">   for (int i = 0; i &lt; A.size(); i++) &#123;  </span><br><span class="line">      t = A.get(i) - t;  </span><br><span class="line">      if (i &lt; B.size()) &#123;  </span><br><span class="line">         t -= B.get(i);  </span><br><span class="line">      &#125;  </span><br><span class="line">      C.add((t + 10) % 10);  </span><br><span class="line">      if (t &lt; 0) &#123;  </span><br><span class="line">         t = 1;  </span><br><span class="line">      &#125; else &#123;  </span><br><span class="line">         t = 0;  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">      C.remove(C.size() - 1);  </span><br><span class="line">   &#125;  </span><br><span class="line">   return C;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/794/">模板题 AcWing 792. 高精度减法</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;  </span><br><span class="line">import java.io.IOException;  </span><br><span class="line">import java.io.InputStreamReader;  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.List;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      BufferedReader in = new BufferedReader(new InputStreamReader(System.in));  </span><br><span class="line">      String s = in.readLine();  </span><br><span class="line">      List&lt;Integer&gt; A = getIntegerList(s);  </span><br><span class="line">      s = in.readLine();  </span><br><span class="line">      List&lt;Integer&gt; B = getIntegerList(s);  </span><br><span class="line">      List&lt;Integer&gt; C = subtract(A, B);  </span><br><span class="line">      for (int i = C.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         System.out.print(C.get(i));  </span><br><span class="line">      &#125;  </span><br><span class="line">      in.close();  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 由于是大数据，因此用BufferedReader读取 根据读取的字符串转换成集合  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; getIntegerList(String s) &#123;  </span><br><span class="line">      List&lt;Integer&gt; res = new ArrayList&lt;&gt;(s.length());  </span><br><span class="line">      for (int i = s.length() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         res.add(Character.getNumericValue(s.charAt(i)));  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static boolean compare(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">      if (A.size() != B.size()) &#123;  </span><br><span class="line">         return A.size() &gt; B.size();  </span><br><span class="line">      &#125;  </span><br><span class="line">      for (int i = A.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         if (A.get(i) == B.get(i)) &#123;  </span><br><span class="line">            continue;  </span><br><span class="line">         &#125;  </span><br><span class="line">         return A.get(i) &gt; B.get(i);  </span><br><span class="line">      &#125;  </span><br><span class="line">      return true;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 大数据减法  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; subtract(List&lt;Integer&gt; A, List&lt;Integer&gt; B) &#123;  </span><br><span class="line">      if (!compare(A, B)) &#123;  </span><br><span class="line">         System.out.print(&quot;-&quot;);  </span><br><span class="line">         return subtract(B, A);  </span><br><span class="line">      &#125;  </span><br><span class="line">      int t = 0;  </span><br><span class="line">      List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">      for (int i = 0; i &lt; A.size(); i++) &#123;  </span><br><span class="line">         t = A.get(i) - t;  </span><br><span class="line">         if (i &lt; B.size()) &#123;  </span><br><span class="line">            t -= B.get(i);  </span><br><span class="line">         &#125;  </span><br><span class="line">         C.add((t + 10) % 10);  </span><br><span class="line">         if (t &lt; 0) &#123;  </span><br><span class="line">            t = 1;  </span><br><span class="line">         &#125; else &#123;  </span><br><span class="line">            t = 0;  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">         C.remove(C.size() - 1);  </span><br><span class="line">      &#125;  </span><br><span class="line">      return C;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="七、高精度乘低精度-——-模板题-AcWing-793-高精度乘法">七、高精度乘低精度 —— <a href="https://www.acwing.com/problem/content/795/">模板题 AcWing 793. 高精度乘法</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**  </span><br><span class="line"> * 大数据乘法  </span><br><span class="line"> */  </span><br><span class="line">private static List&lt;Integer&gt; subtract(List&lt;Integer&gt; A, Integer b) &#123;  </span><br><span class="line">   List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">   if (b == 0) &#123;  </span><br><span class="line">      C.add(0);  </span><br><span class="line">      return C;  </span><br><span class="line">   &#125;  </span><br><span class="line">   int t = 0;  </span><br><span class="line">   for (int i = 0; i &lt; A.size(); i++) &#123;  </span><br><span class="line">      t += A.get(i) * b;  </span><br><span class="line">      C.add(t % 10);  </span><br><span class="line">      t /= 10;  </span><br><span class="line">   &#125;  </span><br><span class="line">   if (t != 0) &#123;  </span><br><span class="line">      C.add(t);  </span><br><span class="line">   &#125;  </span><br><span class="line">   while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">      C.remove(C.size() - 1);  </span><br><span class="line">   &#125;  </span><br><span class="line">   return C;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/795/">模板题 AcWing 793. 高精度乘法</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;  </span><br><span class="line">import java.io.IOException;  </span><br><span class="line">import java.io.InputStreamReader;  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.List;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      BufferedReader in = new BufferedReader(new InputStreamReader(System.in));  </span><br><span class="line">      String s = in.readLine();  </span><br><span class="line">      List&lt;Integer&gt; A = getIntegerList(s);  </span><br><span class="line">      Integer b = Integer.parseInt(in.readLine());  </span><br><span class="line">      List&lt;Integer&gt; C = subtract(A, b);  </span><br><span class="line">      for (int i = C.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         System.out.print(C.get(i));  </span><br><span class="line">      &#125;  </span><br><span class="line">      in.close();  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 由于是大数据，因此用BufferedReader读取 根据读取的字符串转换成集合  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; getIntegerList(String s) &#123;  </span><br><span class="line">      List&lt;Integer&gt; res = new ArrayList&lt;&gt;(s.length());  </span><br><span class="line">      for (int i = s.length() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         res.add(Character.getNumericValue(s.charAt(i)));  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 大数据乘法  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; subtract(List&lt;Integer&gt; A, Integer b) &#123;  </span><br><span class="line">      List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">      if (b == 0) &#123;  </span><br><span class="line">         C.add(0);  </span><br><span class="line">         return C;  </span><br><span class="line">      &#125;  </span><br><span class="line">      int t = 0;  </span><br><span class="line">      for (int i = 0; i &lt; A.size(); i++) &#123;  </span><br><span class="line">         t += A.get(i) * b;  </span><br><span class="line">         C.add(t % 10);  </span><br><span class="line">         t /= 10;  </span><br><span class="line">      &#125;  </span><br><span class="line">      if (t != 0) &#123;  </span><br><span class="line">         C.add(t);  </span><br><span class="line">      &#125;  </span><br><span class="line">      while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">         C.remove(C.size() - 1);  </span><br><span class="line">      &#125;  </span><br><span class="line">      return C;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="八、高精度除以低精度-——-模板题-AcWing-794-高精度除法">八、高精度除以低精度 —— <a href="https://www.acwing.com/problem/content/796/">模板题 AcWing 794. 高精度除法</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**  </span><br><span class="line"> * 大数据除法  </span><br><span class="line"> */  </span><br><span class="line">private static List&lt;Integer&gt; divide(List&lt;Integer&gt; A, Integer b) &#123;  </span><br><span class="line">   int t = 0;  </span><br><span class="line">   List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">   for (int i = A.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">      t = t * 10 + A.get(i);  </span><br><span class="line">      C.add(t / b);  </span><br><span class="line">      t %= b;  </span><br><span class="line">   &#125;  </span><br><span class="line">   Collections.reverse(C);  </span><br><span class="line">   while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">      C.remove(C.size() - 1);  </span><br><span class="line">   &#125;  </span><br><span class="line">   // 为了方便传递，放在了数组的最后一位，因此输出时需要从倒数第二位开始  </span><br><span class="line">   C.add(t);  </span><br><span class="line">   return C;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/796/">模板题 AcWing 794. 高精度除法</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.BufferedReader;  </span><br><span class="line">import java.io.IOException;  </span><br><span class="line">import java.io.InputStreamReader;  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.Collections;  </span><br><span class="line">import java.util.List;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      BufferedReader in = new BufferedReader(new InputStreamReader(System.in));  </span><br><span class="line">      String s = in.readLine();  </span><br><span class="line">      List&lt;Integer&gt; A = getIntegerList(s);  </span><br><span class="line">      Integer b = Integer.parseInt(in.readLine());  </span><br><span class="line">      List&lt;Integer&gt; C = divide(A, b);  </span><br><span class="line">      for (int i = C.size() - 2; i &gt;= 0; i--) &#123;  </span><br><span class="line">         System.out.print(C.get(i));  </span><br><span class="line">      &#125;  </span><br><span class="line">      System.out.println();  </span><br><span class="line">      System.out.print(C.get(C.size() - 1));  </span><br><span class="line">      in.close();  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 由于是大数据，因此用BufferedReader读取 根据读取的字符串转换成集合  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; getIntegerList(String s) &#123;  </span><br><span class="line">      List&lt;Integer&gt; res = new ArrayList&lt;&gt;(s.length());  </span><br><span class="line">      for (int i = s.length() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         res.add(Character.getNumericValue(s.charAt(i)));  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   /**  </span><br><span class="line">    * 大数据除法  </span><br><span class="line">    */  </span><br><span class="line">   private static List&lt;Integer&gt; divide(List&lt;Integer&gt; A, Integer b) &#123;  </span><br><span class="line">      int t = 0;  </span><br><span class="line">      List&lt;Integer&gt; C = new ArrayList&lt;&gt;();  </span><br><span class="line">      for (int i = A.size() - 1; i &gt;= 0; i--) &#123;  </span><br><span class="line">         t = t * 10 + A.get(i);  </span><br><span class="line">         C.add(t / b);  </span><br><span class="line">         t %= b;  </span><br><span class="line">      &#125;  </span><br><span class="line">      Collections.reverse(C);  </span><br><span class="line">      while (C.size() &gt; 1 &amp;&amp; C.get(C.size() - 1) == 0) &#123;  </span><br><span class="line">         C.remove(C.size() - 1);  </span><br><span class="line">      &#125;  </span><br><span class="line">      // 为了方便传递，放在了数组的最后一位，因此输出时需要从倒数第二位开始  </span><br><span class="line">      C.add(t);  </span><br><span class="line">      return C;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="九、一维前缀和-——-模板题-AcWing-795-前缀和">九、一维前缀和 —— <a href="https://www.acwing.com/problem/content/797/">模板题 AcWing 795. 前缀和</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S[i] = a[1] + a[2] + ... a[i]</span><br><span class="line">a[l] + ... + a[r] = S[r] - S[l - 1]</span><br><span class="line">private static final int N = 100010;</span><br><span class="line">private static final int[] a = new int[N + 5];</span><br><span class="line">private static final int[] s = new int[N + 5];</span><br><span class="line"></span><br><span class="line">private static void init(int n) &#123;  </span><br><span class="line">   for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">      s[i] = s[i - 1] + a[i];  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">private static int sumPrefix(int left, int right) &#123;  </span><br><span class="line">   return s[right] - s[left - 1];  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/797/">模板题 AcWing 795. 前缀和</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   private static final int N = 100010;  </span><br><span class="line">   private static final int[] a = new int[N + 5];  </span><br><span class="line">   private static final int[] s = new int[N + 5];  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         a[i] = in.nextInt();  </span><br><span class="line">      &#125;  </span><br><span class="line">      init(n);  </span><br><span class="line">      while (m-- &gt; 0) &#123;  </span><br><span class="line">         int l = in.nextInt();  </span><br><span class="line">         int r = in.nextInt();  </span><br><span class="line">         int res = sumPrefix(l, r);  </span><br><span class="line">         System.out.println(res);  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void init(int n) &#123;  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         s[i] = s[i - 1] + a[i];  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static int sumPrefix(int left, int right) &#123;  </span><br><span class="line">      return s[right] - s[left - 1];  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十、二维前缀和-——-模板题-AcWing-796-子矩阵的和">十、二维前缀和 —— <a href="https://www.acwing.com/problem/content/798/">模板题 AcWing 796. 子矩阵的和</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S[i, j] = 第 i 行 j 列格子左上部分所有元素的和</span><br><span class="line">以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵的和为：</span><br><span class="line">S[x2, y2] - S[x1-1, y2] - S[x2, y1-1] + S[x1-1, y1-1]</span><br><span class="line">private static final int N = 1010;  </span><br><span class="line">private static final int[][] a = new int[N + 5][N + 5];  </span><br><span class="line">private static final int[][] s = new int[N + 5][N + 5];</span><br><span class="line"></span><br><span class="line">private static void init(int n, int m) &#123;  </span><br><span class="line">   for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">      for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">         s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + a[i][j];  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">private static int sumPrefix(int x1, int y1, int x2, int y2) &#123;  </span><br><span class="line">   return s[x2][y2] - s[x2][y1 - 1] - s[x1 - 1][y2] + s[x1 - 1][y1 - 1];  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/798/">模板题 AcWing 796. 子矩阵的和</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   private static final int N = 1010;  </span><br><span class="line">   private static final int[][] a = new int[N + 5][N + 5];  </span><br><span class="line">   private static final int[][] s = new int[N + 5][N + 5];  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      int q = in.nextInt();  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">            a[i][j] = in.nextInt();  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      init(n, m);  </span><br><span class="line">      while (q-- &gt; 0) &#123;  </span><br><span class="line">         int x1 = in.nextInt();  </span><br><span class="line">         int y1 = in.nextInt();  </span><br><span class="line">         int x2 = in.nextInt();  </span><br><span class="line">         int y2 = in.nextInt();  </span><br><span class="line">         int res = sumPrefix(x1, y1, x2, y2);  </span><br><span class="line">         System.out.println(res);  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void init(int n, int m) &#123;  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">            s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + a[i][j];  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static int sumPrefix(int x1, int y1, int x2, int y2) &#123;  </span><br><span class="line">      return s[x2][y2] - s[x2][y1 - 1] - s[x1 - 1][y2] + s[x1 - 1][y1 - 1];  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十一、一维差分-——-模板题-AcWing-797-差分">十一、一维差分 —— <a href="https://www.acwing.com/problem/content/799/">模板题 AcWing 797. 差分</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">给区间[l, r]中的每个数加上 c：B[l] += c, B[r + 1] -= c</span><br><span class="line">private static final int N = 100010;  </span><br><span class="line">private static final int[] a = new int[N + 5];  </span><br><span class="line">private static final int[] b = new int[N + 5];</span><br><span class="line"></span><br><span class="line">private static void init(int n) &#123;  </span><br><span class="line">   for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">      b[i] = a[i] - a[i - 1];  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">private static void difference(int left, int right, int c) &#123;  </span><br><span class="line">   b[left] += c;  </span><br><span class="line">   b[right + 1] -= c;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/799/">模板题 AcWing 797. 差分</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.IntStream;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   private static final int N = 100010;  </span><br><span class="line">   private static final int[] a = new int[N + 5];  </span><br><span class="line">   private static final int[] b = new int[N + 5];  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      IntStream.rangeClosed(1, n).forEach(i -&gt; a[i] = in.nextInt());  </span><br><span class="line">      init(n);  </span><br><span class="line">      while (m-- &gt; 0) &#123;  </span><br><span class="line">         int left = in.nextInt();  </span><br><span class="line">         int right = in.nextInt();  </span><br><span class="line">         int c = in.nextInt();  </span><br><span class="line">         difference(left, right, c);  </span><br><span class="line">      &#125;  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">//       a[i] = a[i - 1] + b[i];  </span><br><span class="line">//       System.out.print(a[i] + &quot; &quot;);  </span><br><span class="line">         b[i] += b[i - 1];  </span><br><span class="line">         System.out.print(b[i] + &quot; &quot;);  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void init(int n) &#123;  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         b[i] = a[i] - a[i - 1];  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void difference(int left, int right, int c) &#123;  </span><br><span class="line">      b[left] += c;  </span><br><span class="line">      b[right + 1] -= c;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十二、二维差分-——-模板题-AcWing-798-差分矩阵">十二、二维差分 —— <a href="https://www.acwing.com/problem/content/800/">模板题 AcWing 798. 差分矩阵</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">给以(x1, y1)为左上角，(x2, y2)为右下角的子矩阵中的所有元素加上 c：</span><br><span class="line">S[x1, y1] += c, S[x2 + 1, y1] -= c, S[x1, y2 + 1] -= c, S[x2 + 1, y2 + 1] += c</span><br><span class="line">private static final int N = 1010;  </span><br><span class="line">private static final int[][] a = new int[N + 5][N + 5];  </span><br><span class="line">private static final int[][] s = new int[N + 5][N + 5];  </span><br><span class="line">private static final int[][] b = new int[N + 5][N + 5];</span><br><span class="line"></span><br><span class="line">private static void difference(int x1, int y1, int x2, int y2, int c) &#123;  </span><br><span class="line">   b[x1][y1] += c;  </span><br><span class="line">   b[x2 + 1][y1] -= c;  </span><br><span class="line">   b[x1][y2 + 1] -= c;  </span><br><span class="line">   b[x2 + 1][y2 + 1] += c;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">private static void sumPrefix(int n, int m) &#123;  </span><br><span class="line">   for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">      for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">         s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + b[i][j];  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/800/">模板题 AcWing 798. 差分矩阵</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   private static final int N = 1010;  </span><br><span class="line">   private static final int[][] a = new int[N + 5][N + 5];  </span><br><span class="line">   private static final int[][] s = new int[N + 5][N + 5];  </span><br><span class="line">   private static final int[][] b = new int[N + 5][N + 5];  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      int q = in.nextInt();  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">            a[i][j] = in.nextInt();  </span><br><span class="line">            difference(i, j, i, j, a[i][j]);  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      while (q-- &gt; 0) &#123;  </span><br><span class="line">         int x1 = in.nextInt();  </span><br><span class="line">         int y1 = in.nextInt();  </span><br><span class="line">         int x2 = in.nextInt();  </span><br><span class="line">         int y2 = in.nextInt();  </span><br><span class="line">         int c = in.nextInt();  </span><br><span class="line">         difference(x1, y1, x2, y2, c);  </span><br><span class="line">      &#125;  </span><br><span class="line">      sumPrefix(n, m);  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">            System.out.print(s[i][j] + &quot; &quot;);  </span><br><span class="line">         &#125;  </span><br><span class="line">         System.out.println();  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void difference(int x1, int y1, int x2, int y2, int c) &#123;  </span><br><span class="line">      b[x1][y1] += c;  </span><br><span class="line">      b[x2 + 1][y1] -= c;  </span><br><span class="line">      b[x1][y2 + 1] -= c;  </span><br><span class="line">      b[x2 + 1][y2 + 1] += c;  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static void sumPrefix(int n, int m) &#123;  </span><br><span class="line">      for (int i = 1; i &lt;= n; i++) &#123;  </span><br><span class="line">         for (int j = 1; j &lt;= m; j++) &#123;  </span><br><span class="line">            s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + b[i][j];  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十三、位运算-——-模板题-AcWing-801-二进制中-1-的个数">十三、位运算 —— <a href="https://www.acwing.com/problem/content/803/">模板题 AcWing 801. 二进制中 1 的个数</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static int countDigitOne(int x) &#123;  </span><br><span class="line">   int count = 0;  </span><br><span class="line">   for (int i = x; i != 0; i -= (i &amp; -i)) &#123;  </span><br><span class="line">      count++;  </span><br><span class="line">   &#125;  </span><br><span class="line">   return count;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/803/">模板题 AcWing 801. 二进制中 1 的个数</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.IntStream;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int[] a = new int[n + 5];  </span><br><span class="line">      IntStream.range(0, n).forEach(i -&gt; a[i] = in.nextInt());  </span><br><span class="line">      IntStream.range(0, n).mapToObj(i -&gt; countDigitOne(a[i]) + &quot; &quot;).forEach(System.out::print);  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static int countDigitOne(int x) &#123;  </span><br><span class="line">      int count = 0;  </span><br><span class="line">      for (int i = x; i != 0; i -= (i &amp; -i)) &#123;  </span><br><span class="line">         count++;  </span><br><span class="line">      &#125;  </span><br><span class="line">      return count;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十四、双指针算法-——-模板题-AcWIng-799-最长连续不重复子序列-，-AcWing-800-数组元素的目标和">十四、双指针算法 —— 模板题 <a href="https://www.acwing.com/problem/content/801/">AcWIng 799. 最长连续不重复子序列</a> ， <a href="https://www.acwing.com/problem/content/802/">AcWing 800. 数组元素的目标和</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for (int i = 0, j = 0; i &lt; n; i ++ ) &#123;</span><br><span class="line">    while (j &lt; i &amp;&amp; check(i, j)) &#123;</span><br><span class="line">        j ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    // 具体问题的逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模板题 <a href="https://www.acwing.com/problem/content/801/">AcWIng 799. 最长连续不重复子序列</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.HashMap;  </span><br><span class="line">import java.util.Map;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.IntStream;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int[] a = new int[n + 5];  </span><br><span class="line">      IntStream.range(0, n).forEach(i -&gt; a[i] = in.nextInt());  </span><br><span class="line">      int res = twoPoints(a, n);  </span><br><span class="line">      System.out.println(res);  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static int twoPoints(int[] a, int n) &#123;  </span><br><span class="line">      int res = 0;  </span><br><span class="line">      Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();  </span><br><span class="line">      int j = 0;  </span><br><span class="line">      for (int i = 0; i &lt; n; i++) &#123;  </span><br><span class="line">         map.put(a[i], map.getOrDefault(a[i], 0) + 1);  </span><br><span class="line">         while (j &lt; i &amp;&amp; map.get(a[i]) &gt; 1) &#123;  </span><br><span class="line">            map.put(a[j], map.getOrDefault(a[j], 0) - 1);  </span><br><span class="line">            j++;  </span><br><span class="line">         &#125;  </span><br><span class="line">         res = Math.max(res, i - j + 1);  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模板题 <a href="https://www.acwing.com/problem/content/802/">AcWing 800. 数组元素的目标和</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.io.IOException;  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.IntStream;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws IOException &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      int x = in.nextInt();  </span><br><span class="line">      int[] a = new int[n + 5];  </span><br><span class="line">      IntStream.range(0, n).forEach(i -&gt; a[i] = in.nextInt());  </span><br><span class="line">      int[] b = new int[m + 5];  </span><br><span class="line">      IntStream.range(0, m).forEach(i -&gt; b[i] = in.nextInt());  </span><br><span class="line">      List&lt;int[]&gt; res = twoPoints(a, n, b, m, x);  </span><br><span class="line">      res.forEach(item -&gt; System.out.println(item[0] + &quot; &quot; + item[1]));  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static List&lt;int[]&gt; twoPoints(int[] a, int n, int[] b, int m, int x) &#123;  </span><br><span class="line">      List&lt;int[]&gt; res = new ArrayList&lt;&gt;();  </span><br><span class="line">      for (int i = 0, j = m - 1; i &lt; n; i++) &#123;  </span><br><span class="line">         while (j &gt;= 0 &amp;&amp; a[i] + b[j] &gt; x) &#123;  </span><br><span class="line">            j--;  </span><br><span class="line">         &#125;  </span><br><span class="line">         if (j &gt;= 0 &amp;&amp; a[i] + b[j] == x) &#123;  </span><br><span class="line">            res.add(new int[]&#123;i, j&#125;);  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十五、离散化-——-模板题-AcWing-802-区间和">十五、离散化 —— <a href="https://www.acwing.com/problem/content/804/">模板题 AcWing 802. 区间和</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 去重 + 排序  </span><br><span class="line">List&lt;Integer&gt; distinctSorterAlls = alls.stream().distinct().sorted()  </span><br><span class="line">      .collect(Collectors.toList());  </span><br><span class="line"></span><br><span class="line">// 离散化映射，把离散化的下标映射到连续的数组下标 + 1for (int[] item : add) &#123;  </span><br><span class="line">   int index = Collections.binarySearch(distinctSorterAlls, item[0]) + 1;  </span><br><span class="line">   a[index] += item[1];  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">// 前缀和  </span><br><span class="line">for (int i = 1; i &lt;= distinctSorterAlls.size(); i++) &#123;  </span><br><span class="line">   s[i] = s[i - 1] + a[i];  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">// 离散化映射，把离散化的下标映射到连续的数组下标 + 1for (int[] item : query) &#123;  </span><br><span class="line">   int l = Collections.binarySearch(distinctSorterAlls, item[0]) + 1;  </span><br><span class="line">   int r = Collections.binarySearch(distinctSorterAlls, item[1]) + 1;  </span><br><span class="line">   System.out.println(s[r] - s[l - 1]);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/804/">模板题 AcWing 802. 区间和</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.Collections;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.Collectors;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   private static final int N = 300000;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int m = in.nextInt();  </span><br><span class="line">      List&lt;Integer&gt; alls = new ArrayList&lt;&gt;();  </span><br><span class="line">      int[] a = new int[N];  </span><br><span class="line">      int[] s = new int[N];  </span><br><span class="line">      List&lt;int[]&gt; add = new ArrayList&lt;&gt;();  </span><br><span class="line">      List&lt;int[]&gt; query = new ArrayList&lt;&gt;();  </span><br><span class="line">      for (int i = 0; i &lt; n; i++) &#123;  </span><br><span class="line">         int x = in.nextInt();  </span><br><span class="line">         int c = in.nextInt();  </span><br><span class="line">         add.add(new int[]&#123;x, c&#125;);  </span><br><span class="line">         alls.add(x);  </span><br><span class="line">      &#125;  </span><br><span class="line"></span><br><span class="line">      for (int i = 0; i &lt; m; i++) &#123;  </span><br><span class="line">         int l = in.nextInt();  </span><br><span class="line">         int r = in.nextInt();  </span><br><span class="line">         query.add(new int[]&#123;l, r&#125;);  </span><br><span class="line">         alls.add(l);  </span><br><span class="line">         alls.add(r);  </span><br><span class="line">      &#125;  </span><br><span class="line"></span><br><span class="line">      // 去重 + 排序  </span><br><span class="line">      List&lt;Integer&gt; distinctSorterAlls = alls.stream().distinct().sorted()  </span><br><span class="line">            .collect(Collectors.toList());  </span><br><span class="line"></span><br><span class="line">      // 离散化映射，把离散化的下标映射到连续的数组下标 + 1      for (int[] item : add) &#123;  </span><br><span class="line">         int index = Collections.binarySearch(distinctSorterAlls, item[0]) + 1;  </span><br><span class="line">         a[index] += item[1];  </span><br><span class="line">      &#125;  </span><br><span class="line"></span><br><span class="line">      // 前缀和  </span><br><span class="line">      for (int i = 1; i &lt;= distinctSorterAlls.size(); i++) &#123;  </span><br><span class="line">         s[i] = s[i - 1] + a[i];  </span><br><span class="line">      &#125;  </span><br><span class="line"></span><br><span class="line">      // 离散化映射，把离散化的下标映射到连续的数组下标 + 1      for (int[] item : query) &#123;  </span><br><span class="line">         int l = Collections.binarySearch(distinctSorterAlls, item[0]) + 1;  </span><br><span class="line">         int r = Collections.binarySearch(distinctSorterAlls, item[1]) + 1;  </span><br><span class="line">         System.out.println(s[r] - s[l - 1]);  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="十六、区间合并-——-模板题-AcWing-803-区间合并">十六、区间合并 —— <a href="https://www.acwing.com/problem/content/805/">模板题 AcWing 803. 区间合并</a></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private static int[][] merge(int[][] a) &#123;  </span><br><span class="line">   if (a == null || a.length == 0 || a[0].length == 0) &#123;  </span><br><span class="line">      return new int[0][2];  </span><br><span class="line">   &#125;  </span><br><span class="line">   Arrays.sort(a, Comparator.comparingInt(item -&gt; item[0]));  </span><br><span class="line">   List&lt;int[]&gt; res = new ArrayList&lt;&gt;();  </span><br><span class="line">   for (int[] arr : a) &#123;  </span><br><span class="line">      int left = arr[0];  </span><br><span class="line">      int right = arr[1];  </span><br><span class="line">      if (res.size() == 0 || res.get(res.size() - 1)[1] &lt; left) &#123;  </span><br><span class="line">         res.add(new int[]&#123;left, right&#125;);  </span><br><span class="line">      &#125; else &#123;  </span><br><span class="line">         int newRight = Math.max(res.get(res.size() - 1)[1], left);  </span><br><span class="line">         res.set(res.size() - 1, new int[]&#123;res.get(res.size() - 1)[0], newRight&#125;);  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">   return res.toArray(new int[res.size()][2]);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.acwing.com/problem/content/805/">模板题 AcWing 803. 区间合并</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.Arrays;  </span><br><span class="line">import java.util.Comparator;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">import java.util.Scanner;  </span><br><span class="line">import java.util.stream.IntStream;  </span><br><span class="line"></span><br><span class="line">public class Main &#123;  </span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;  </span><br><span class="line">      Scanner in = new Scanner(System.in);  </span><br><span class="line">      int n = in.nextInt();  </span><br><span class="line">      int[][] a = new int[n][2];  </span><br><span class="line">      IntStream.range(0, n).forEach(i -&gt; &#123;  </span><br><span class="line">         int l = in.nextInt();  </span><br><span class="line">         a[i][0] = l;  </span><br><span class="line">         int r = in.nextInt();  </span><br><span class="line">         a[i][1] = r;  </span><br><span class="line">      &#125;);  </span><br><span class="line">      int[][] res = merge(a);  </span><br><span class="line">      System.out.println(res.length);  </span><br><span class="line">   &#125;  </span><br><span class="line"></span><br><span class="line">   private static int[][] merge(int[][] a) &#123;  </span><br><span class="line">      if (a == null || a.length == 0 || a[0].length == 0) &#123;  </span><br><span class="line">         return new int[0][2];  </span><br><span class="line">      &#125;  </span><br><span class="line">      Arrays.sort(a, Comparator.comparingInt(item -&gt; item[0]));  </span><br><span class="line">      List&lt;int[]&gt; res = new ArrayList&lt;&gt;();  </span><br><span class="line">      for (int[] arr : a) &#123;  </span><br><span class="line">         int left = arr[0];  </span><br><span class="line">         int right = arr[1];  </span><br><span class="line">         if (res.size() == 0 || res.get(res.size() - 1)[1] &lt; left) &#123;  </span><br><span class="line">            res.add(new int[]&#123;left, right&#125;);  </span><br><span class="line">         &#125; else &#123;  </span><br><span class="line">            int newRight = Math.max(res.get(res.size() - 1)[1], right);  </span><br><span class="line">            res.set(res.size() - 1, new int[]&#123;res.get(res.size() - 1)[0], newRight&#125;);  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      return res.toArray(new int[res.size()][2]);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 代码模板 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解放双手，每日强国</title>
      <link href="/2023/11/08/%E5%AD%A6%E4%B9%A0%E5%BC%BA%E5%9B%BD%E6%87%92%E4%BA%BA%E5%BF%85%E5%A4%87/"/>
      <url>/2023/11/08/%E5%AD%A6%E4%B9%A0%E5%BC%BA%E5%9B%BD%E6%87%92%E4%BA%BA%E5%BF%85%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<h1>解放双手，每日强国</h1><p>​学习强国是好事,但有些学校功利性的算各种学分,大多数人以这种动机的学习显然更像是一种负担,其实如果大家有余力还是推荐自己学习</p><p>​<em>本教程全程傻瓜式操作，适用于未使用过油猴和GitHub的小白，脚本内容搬运自：<a href="https://github.com/Xu22Web/tech-study-js/issues%EF%BC%88%E4%BB%A3%E7%A0%81%E6%88%91%E4%BC%9A%E8%B4%B4%E5%9C%A8%E6%96%87%E7%AB%A0%E6%9C%AB%E5%B0%BE%EF%BC%8C%E5%86%8D%E6%AC%A1%E5%BC%BA%E8%B0%83%E6%88%91%E5%8F%AA%E6%98%AF%E6%90%AC%E8%BF%90%E5%B7%A5%EF%BC%8C%E5%A6%82%E6%9C%89%E4%BE%B5%E6%9D%83%E4%BC%9A%E7%AB%8B%E5%8D%B3%E5%88%A0%E9%99%A4%EF%BC%89">https://github.com/Xu22Web/tech-study-js/issues（代码我会贴在文章末尾，再次强调我只是搬运工，如有侵权会立即删除）</a></em></p><p>​一年前的博客了,现在学习强国也做了很多&quot;改进&quot;,亲测目前只有<strong>自动刷视频和文章是无风险支持</strong>(***warning !!!***自动刷题会被警告,警告到一定次数会被封禁7~30天)</p><h2 id="一、安装油猴">一、安装油猴</h2><p>​<em>已经安装过的可以跳过这里</em></p><ol><li>打开你的edge浏览器，点击扩展</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131226862.jpg" alt="img"></p><ol start="2"><li>点击获取下图选项获取扩展</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227984.jpg" alt="img"></p><ol start="3"><li>搜索框输入“tempermonkey”，搜索该扩展并获取</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227875.jpg" alt="img"></p><ol start="4"><li>之后会有弹窗，点“添加扩展”</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227120.jpg" alt="img"></p><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227430.jpg" alt="img"></p><ol start="5"><li>把目光聚焦到浏览器的右上方</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227455.jpg" alt="img"></p><ol start="6"><li>这时候可能还看不到安装上的Tempermonkey(之后步骤简称油猴)，因为添加扩展后，默认设置是不可视的</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227521.jpg" alt="img"></p><ol start="7"><li>按下图顺序点击，便可设置为工具栏可见了</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227990.jpg" alt="img"></p><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227805.jpg" alt="img"></p><h2 id="二、添加脚本">二、添加脚本</h2><ol start="8"><li>按下图操作，会进入一个新的界面</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227043.jpg" alt="img"></p><ol start="9"><li>新的界面如下</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227747.png" alt="img"></p><ol start="10"><li>底下这些内容是可以编辑的，首先把原本的内容删掉</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227861.png" alt="img"></p><ol start="11"><li>然后把从<a href="https://github.com/Xu22Web/tech-study-js/issues">https://github.com/Xu22Web/tech-study-js/issues</a> (文章末尾的代码)Ctrl+A(全选)，然后Ctrl+C（复制），最后Ctrl+V（粘贴）到这里</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131227559.png" alt="img"></p><ol start="12"><li>Ctrl+S（保存），脚本就新建成功了，启用它</li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202207131301723.png" alt="img"></p><h2 id="三、脚本使用">三、脚本使用</h2><ol start="13"><li><p>进入学习强国网页版，<a href="https://www.xuexi.cn/">学习强国 (xuexi.cn)</a>，然后扫码用户登录（这里就不截图演示了）</p></li><li><p>右上角的浮窗点，开始学习，之后什么都不用不做，慢慢等待完成即可；以后每天只需要重复最后两步，就可以懒人式斩获25分了</p></li></ol><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202309042118286.png" alt="image-20230904211513385"></p><p>代码如下:</p><p>代码比较长,复制时可能会卡一下</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name   不学习何以强国</span></span><br><span class="line"><span class="comment">// @namespace   http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version   1.7.0</span></span><br><span class="line"><span class="comment">// @description   有趣的 `学习强国` 油猴插件。读文章,看视频，做习题。问题反馈： https://github.com/Xu22Web/tech-study-js/issues 。</span></span><br><span class="line"><span class="comment">// @author   原作者：techxuexi 荷包蛋。现作者：Xu22Web</span></span><br><span class="line"><span class="comment">// @match   https://www.xuexi.cn/*</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-practice.html</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-weekly-detail.html?id=*</span></span><br><span class="line"><span class="comment">// @match   https://pc.xuexi.cn/points/exam-paper-detail.html?id=*</span></span><br><span class="line"><span class="comment">// @match   https://login.xuexi.cn/login/xuexiWeb?appid=dingoankubyrfkttorhpou&amp;goto=https%3A%2F%2Foa.xuexi.cn&amp;type=1&amp;state=ffdea2ded23f45ab%2FKQreTlDFe1Id3B7BVdaaYcTMp6lsTBB%2Fs3gGevuMKfvpbABDEl9ymG3bbOgtpSN&amp;check_login=https%3A%2F%2Fpc-api.xuexi.cn</span></span><br><span class="line"><span class="comment">// @require   https://cdn.jsdelivr.net/npm/blueimp-md5@2.9.0</span></span><br><span class="line"><span class="comment">// @run-at   document-start</span></span><br><span class="line"><span class="comment">// @grant   GM_addStyle</span></span><br><span class="line"><span class="comment">// @grant   GM_setValue</span></span><br><span class="line"><span class="comment">// @grant   GM_getValue</span></span><br><span class="line"><span class="comment">// @grant   GM_openInTab</span></span><br><span class="line"><span class="comment">// @grant   unsafeWindow</span></span><br><span class="line"><span class="comment">// @updateURL   https://raw.githubusercontent.com/Xu22Web/tech-study-js/master/tech-study.js</span></span><br><span class="line"><span class="comment">// @downloadURL   https://raw.githubusercontent.com/Xu22Web/tech-study-js/master/tech-study.js</span></span><br><span class="line"><span class="comment">// @supportURL   https://github.com/Xu22Web</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"><span class="keyword">const</span> css = <span class="string">&#x27;* &#123;  -webkit-tap-highlight-color: transparent;&#125;:root &#123;  --themeColor: #fa3333;  --scale: 1;  font-size: calc(10px * var(--scale));&#125;@media (min-height: 678px) and (max-height: 768px) &#123;  :root &#123;    --scale: 0.8;  &#125;&#125;@media (max-height: 667px) &#123;  :root &#123;    --scale: 0.75;  &#125;&#125;@keyframes fade &#123;  from &#123;    opacity: 0.8;  &#125;  to &#123;    opacity: 0.4;    background: #ccc;  &#125;&#125;.egg_icon &#123;  width: 1em;  height: 1em;  fill: currentColor;&#125;.egg_hr_wrap &#123;  position: relative;  display: flex;  justify-content: center;  color: #ccc;&#125;.egg_hr_wrap .egg_hr &#123;  position: absolute;  top: 50%;  transform: translateY(-50%);  background: currentColor;  height: 0.1rem;  width: 30%;&#125;.egg_hr_wrap .egg_hr:nth-of-type(1) &#123;  left: 0;&#125;.egg_hr_wrap .egg_hr:nth-last-of-type(1) &#123;  right: 0;&#125;.egg_hr_title &#123;  font-size: 1.2rem;&#125;.egg_exam_btn &#123;  transition: background-color 80ms;  outline: none;  border: none;  padding: 1.2rem 2rem;  border-radius: 1.2rem;  cursor: pointer;  font-size: 1.8rem;  font-weight: bold;  text-align: center;  color: #ffffff;  background: #666777;&#125;.egg_exam_btn.manual &#123;  background: #e3484b;&#125;.egg_panel_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_panel_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 99999;  width: 100%;  height: 100%;  color: #333;  font-size: 1.6rem;  pointer-events: none;&#125;.egg_panel &#123;  position: absolute;  top: 5rem;  left: 1rem;  padding: 1.2rem 2rem;  border-radius: 1rem;  background: #ffffffe6;  backdrop-filter: blur(1rem);  box-shadow: 0 0 0.1rem 0.1rem #f1f1f1;  transition: 80ms ease-out;  pointer-events: all;&#125;.egg_panel.hide &#123;  left: 0;  transform: translateX(-100%);&#125;.egg_panel_wrap.mobile .egg_panel &#123;  top: 1rem;&#125;@media (min-height: 678px) and (max-height: 768px) &#123;  .egg_panel &#123;    top: 2rem;  &#125;&#125;@media (max-height: 667px) &#123;  .egg_panel &#123;    top: 1rem;  &#125;&#125;.egg_panel button &#123;  outline: none;  border: none;  padding: 0;  cursor: pointer;  background: none;&#125;.egg_panel .egg_btns_wrap &#123;  position: absolute;  left: 100%;  top: 50%;  transform: translate(-50%, -50%);  transition: 80ms ease;  z-index: 9;&#125;.egg_panel.hide .egg_btns_wrap &#123;  left: 100%;  transform: translate(0, -50%);&#125;.egg_panel .egg_btns_wrap button &#123;  border-radius: 50%;  width: 3rem;  height: 3rem;  padding: 0;  overflow: hidden;  border: 0.2rem solid currentColor;  color: white;  display: grid;  place-items: center;  font-size: 1.8rem;&#125;.egg_panel.hide .egg_panel_show_btn &#123;  background: var(--themeColor);&#125;.egg_panel .egg_panel_show_btn &#123;  background: #ccc;&#125;.egg_panel .egg_frame_show_btn &#123;  background: var(--themeColor);  margin-bottom: 1rem;&#125;.egg_panel .egg_frame_show_btn.hide &#123;  display: none;&#125;.egg_panel .egg_settings_show_btn &#123;  background: #ccc;  margin-top: 1rem;&#125;.egg_panel .egg_settings_show_btn.active &#123;  background: var(--themeColor);&#125;.egg_panel .egg_settings_reset_btn &#123;  background: #ccc;  margin-top: 1rem;&#125;.egg_panel .egg_settings_reset_btn:active &#123;  background: var(--themeColor);&#125;.egg_login_item &#123;  display: flex;  justify-content: center;  align-items: center;  flex-direction: column;  padding: 0.5rem 0;&#125;.egg_login_item .egg_login_btn &#123;  font-size: 1.4rem;  border-radius: 1rem;  transition: 80ms ease;  color: white;  background: var(--themeColor);  padding: 0.8rem 2.4rem;&#125;.egg_login_item .egg_login_btn:active &#123;  opacity: 0.8;&#125;.egg_login_item .egg_login_img_wrap &#123;  height: 0;  border-radius: 1rem;  transition: height 80ms ease;  overflow: hidden;&#125;.egg_login_item .egg_login_img_wrap.active &#123;  padding: 0.8rem;  margin-top: 0.8rem;  height: auto;  background: white;&#125;.egg_login_img_wrap .egg_login_img &#123;  width: 15rem;  height: 15rem;&#125;.egg_info_item .egg_login_btn &#123;  font-size: 1.4rem;  border-radius: 1rem;  transition: 80ms ease;  color: white;&#125;.egg_info_item .egg_login_btn:active &#123;  opacity: 0.8;&#125;.egg_info_item .egg_login_btn &#123;  background: #ccc;  padding: 0.4rem 0.8rem;&#125;.egg_info_item &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_info_item .egg_userinfo &#123;  display: flex;  justify-content: center;  align-items: center;  padding: 0.5rem 0;&#125;.egg_userinfo .egg_avatar .egg_avatar_nick,.egg_userinfo .egg_avatar .egg_avatar_img &#123;  height: 5rem;  width: 5rem;  border-radius: 50%;  background: var(--themeColor);  display: flex;  justify-content: center;  align-items: center;  text-overflow: ellipsis;  overflow: hidden;  white-space: nowrap;  font-size: 2rem;  color: white;&#125;.egg_userinfo .egg_nick &#123;  padding-left: 0.5rem;  text-overflow: ellipsis;  overflow: hidden;  white-space: nowrap;  max-width: 10rem;&#125;.egg_score_item .egg_scoreinfo &#123;  display: flex;  justify-content: space-between;  align-items: center;  padding: 0.5rem 0;&#125;.egg_scoreinfo .egg_totalscore,.egg_scoreinfo .egg_todayscore &#123;  font-size: 1.2rem;  user-select: none;&#125;.egg_scoreinfo .egg_totalscore span,.egg_scoreinfo .egg_todayscore .egg_todayscore_btn span &#123;  padding-left: 0.2rem;&#125;.egg_scoreinfo .egg_totalscore span,.egg_todayscore .egg_todayscore_btn span,.egg_todayscore .egg_score_details span &#123;  color: var(--themeColor);  font-weight: bold;&#125;.egg_scoreinfo .egg_todayscore &#123;  position: relative;&#125;.egg_todayscore .egg_todayscore_btn &#123;  display: flex;  align-items: center;&#125;.egg_todayscore_btn .egg_icon &#123;  opacity: 0.3;&#125;.egg_todayscore .egg_score_details &#123;  position: absolute;  left: calc(100% + 1rem);  top: 0;  background: #fffffff2;  border-radius: 0.5rem;  opacity: 1;  width: 10rem;  box-shadow: 0 0 0.1rem 0.1rem #f1f1f1;  transition: 80ms ease;  z-index: 9;&#125;.egg_todayscore .egg_score_details.hide &#123;  visibility: hidden;  opacity: 0;  left: 100%;&#125;.egg_score_details .egg_score_title &#123;  border-bottom: 0.1rem solid #eee;  padding: 0.5rem 0.8rem;  display: flex;  align-items: center;&#125;.egg_score_details .egg_score_title .egg_icon &#123;  font-size: 1.4rem;&#125;.egg_score_details .egg_score_title .egg_score_title_text &#123;  font-weight: bold;  padding-left: 0.2rem;&#125;.egg_score_details .egg_score_item &#123;  display: flex;  align-items: center;  justify-content: space-between;  padding: 0.5rem 0.8rem;&#125;.egg_task_list &#123;  position: relative;&#125;.egg_task_item &#123;  user-select: none;  min-height: 3rem;  min-width: 18rem;  display: flex;  align-items: center;  justify-content: space-between;  padding: 0.5rem 0;&#125;.egg_task_item .egg_label_wrap &#123;  flex-grow: 1;  padding-right: 0.5rem;&#125;.egg_label_wrap .egg_task_title_wrap &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_task_title_wrap .egg_task_progress_wrap &#123;  display: flex;  align-items: center;  font-size: 1.4rem;  width: 3.5rem;&#125;.egg_task_progress_wrap .egg_task_current &#123;  color: var(--themeColor);&#125;.egg_task_progress_wrap .egg_task_max &#123;  color: #999;  font-size: 1.2rem;&#125;.egg_label_wrap .egg_progress &#123;  display: flex;  justify-content: space-between;  align-items: center;  padding-top: 0.8rem;&#125;.egg_progress .egg_track &#123;  background: #ccc;  height: 0.5rem;  border-radius: 1rem;  flex: 1 1 auto;  overflow: hidden;&#125;.egg_progress .egg_track .egg_bar &#123;  height: 0.5rem;  background: var(--themeColor);  border-radius: 1rem;  width: 0;  transition: width 0.5s;&#125;.egg_setting_item &#123;  min-height: 3rem;  min-width: 18rem;  display: flex;  align-items: center;  justify-content: space-between;  box-sizing: border-box;&#125;.egg_setting_item .egg_label_wrap &#123;  flex-grow: 1;&#125;.egg_detail &#123;  background: #ccc;  color: white;  border-radius: 10rem;  font-size: 1.2rem;  width: 1.6rem;  height: 1.6rem;  margin-left: 0.4rem;  display: inline-block;  text-align: center;  line-height: 1.6rem;  cursor: pointer;&#125;.egg_switch &#123;  cursor: pointer;  margin: 0;  outline: 0;  appearance: none;  -webkit-appearance: none;  -moz-appearance: none;  position: relative;  width: 4.2rem;  height: 2.2rem;  background: #ccc;  border-radius: 5rem;  transition: background 0.3s;  --border-padding: 0.5rem;  box-shadow: -0.1rem 0 0.1rem -0.1rem #999 inset,    0.1rem 0 0.1rem -0.1rem #999 inset;&#125;.egg_switch::after &#123;  content: \&#x27;\&#x27;;  display: inline-block;  width: 1.4rem;  height: 1.4rem;  border-radius: 50%;  background: #fff;  box-shadow: 0 0 0.2rem #999;  transition: left 0.4s;  position: absolute;  top: calc(50% - (1.4rem / 2));  position: absolute;  left: var(--border-padding);&#125;.egg_switch:checked &#123;  background: var(--themeColor);&#125;.egg_switch:disabled &#123;  opacity: 0.5;  background: #ccc;&#125;.egg_switch:checked::after &#123;  left: calc(100% - var(--border-padding) - 1.4rem);&#125;.egg_tip_list &#123;  font-size: 1.2rem;  max-width: 18rem;  line-height: 2rem;  color: var(--themeColor);&#125;.egg_tip_list .egg_tip_btn &#123;  padding: 0.2rem 0.4rem;  background: #f1f1f1;  color: #333;&#125;.egg_tip_list .egg_tip_btn:disabled &#123;  opacity: 0.5;  background: #ccc;&#125;.egg_study_item &#123;  display: flex;  justify-content: center;  padding-top: 0.5rem;&#125;.egg_study_item .egg_study_btn &#123;  background: var(--themeColor);  padding: 0.8rem 2.4rem;  font-size: 1.4rem;  border-radius: 1rem;  color: white;  transition: 80ms ease;&#125;.egg_study_item .egg_study_btn:not(.loading):active &#123;  opacity: 0.8;&#125;.egg_study_item .egg_study_btn.loading &#123;  animation: fade 2s ease infinite alternate;&#125;.egg_study_item .egg_study_btn:disabled &#123;  background: #ccc;&#125;.egg_tip_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 999999;  width: 100%;  height: 100%;  pointer-events: none;&#125;.egg_tip_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_tip_wrap .egg_tip &#123;  position: absolute;  bottom: 2rem;  left: 2rem;  padding: 1.2rem 1.4rem;  border: none;  border-radius: 1rem;  background: var(--themeColor);  color: white;  font-size: 1.4rem;  transition: 200ms ease;  opacity: 0;  transform: scale(0.9) translateY(1rem);&#125;.egg_tip_wrap .egg_tip.active &#123;  opacity: 1;  transform: scale(1) translateY(0);&#125;.egg_tip_wrap .egg_tip.active.delay &#123;  opacity: 0.5;&#125;.egg_tip_wrap .egg_tip .egg_countdown &#123;  display: inline-block;  color: var(--themeColor);  background: white;  border-radius: 0.5rem;  padding: 0.2rem 0.4rem;  font-weight: bold;  margin-left: 0.4rem;  font-size: 1.2rem;&#125;.egg_frame_wrap &#123;  position: fixed;  left: 0;  top: 0;  z-index: 999;  width: 100%;  height: 100%;  visibility: visible;&#125;.egg_frame_wrap * &#123;  padding: 0;  margin: 0;  box-sizing: border-box;  outline: none;  border: none;&#125;.egg_frame_wrap.hide &#123;  visibility: hidden;&#125;.egg_frame_wrap.hide .egg_frame_mask,.egg_frame_wrap.hide .egg_frame_content_wrap &#123;  opacity: 0;&#125;.egg_frame_wrap.hide .egg_frame_content_wrap &#123;  transform: scale(0);&#125;.egg_frame_mask &#123;  background: #00000030;  width: 100%;  height: 100%;  opacity: 1;  transition: 200ms ease;&#125;.egg_frame_content_wrap &#123;  position: absolute;  width: 80%;  height: 80%;  top: 10%;  left: 10%;  display: flex;  flex-direction: column;  transition: 200ms ease;  border-radius: 1rem;  background: #ffffffe6;  backdrop-filter: blur(1rem);  overflow: hidden;  transform: scale(1);&#125;.egg_frame_content_wrap.max &#123;  top: 0;  left: 0;  width: 100%;  height: 100%;  border-radius: 0;&#125;.egg_frame_content_wrap .egg_frame_controls_wrap &#123;  width: 100%;  display: flex;  justify-content: space-between;  align-items: center;  box-sizing: border-box;&#125;.egg_frame_controls_wrap .egg_frame_title &#123;  padding: 1rem 2rem;  font-size: 1.6rem;&#125;.egg_frame_controls .egg_frame_btn &#123;  outline: none;  border: none;  background: none;  padding: 1rem 2rem;  transition: 80ms ease;  cursor: pointer;  color: #333;  font-size: 1.8rem;&#125;.egg_frame_controls .egg_frame_btn:active &#123;  opacity: 0.8;&#125;.egg_frame_wrap .egg_frame_content &#123;  width: 100%;  flex-grow: 1;  border-top: 0.1rem solid #ccc;  min-height: 40rem;  min-width: 30rem;  background: white;&#125;.egg_frame_content .egg_frame &#123;  width: 100%;  height: 100%;  outline: none;  border: none;&#125;.egg_time_input &#123;  display: inline-flex;  align-items: center;  justify-content: center;&#125;.egg_time_input .egg_hour_wrap,.egg_time_input .egg_minute_wrap &#123;  width: 4rem;&#125;.egg_time_input .egg_separator &#123;  padding: 0 0.5rem;  font-size: 1.5rem;&#125;.egg_settings_item &#123;  position: absolute;  top: 0;  left: 0;  width: 100%;  height: 100%;  pointer-events: none;  overflow: hidden;  border-radius: 1rem;&#125;.egg_settings_item .egg_settings &#123;  display: inline-flex;  flex-direction: column;  font-size: 1.4rem;  background: white;  border-radius: 1rem;  overflow: hidden;  width: 100%;  height: 100%;  pointer-events: all;  transform: translateX(100%);  transition: transform 300ms ease;  padding-top: 1rem;&#125;.egg_settings_item .egg_settings.active &#123;  transform: translateX(0);&#125;.egg_settings .egg_settings_label &#123;  padding-bottom: 1rem;  user-select: none;&#125;.egg_settings_item .egg_settings_version_wrap &#123;  padding: 1rem 2rem 0 2rem;  display: flex;  align-items: center;  justify-content: space-between;&#125;.egg_settings_version_wrap .egg_settings_version &#123;  color: #999;  display: flex;  align-items: center;&#125;.egg_settings_version .egg_settings_version_detail &#123;  color: #24292f;  font-size: 1.6rem;  width: 1.6rem;  height: 1.6rem;  margin-left: 0.4rem;&#125;.egg_settings_item .egg_settings_theme_wrap &#123;  padding: 1rem 2rem 0 2rem;&#125;.egg_settings_theme_wrap .egg_settings_theme_colors &#123;  display: flex;  align-items: center;  justify-content: space-between;&#125;.egg_settings_theme_color_wrap .egg_settings_theme_color &#123;  border-radius: 50%;  width: 1.6rem;  height: 1.6rem;  background: currentColor;&#125;.egg_settings .egg_settings_read_time_wrap,.egg_settings .egg_settings_watch_time_wrap &#123;  padding: 1rem 2rem 0 2rem;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_settings_read_time_wrap .egg_settings_label,.egg_settings_watch_time_wrap .egg_settings_label &#123;  padding: 0.5rem 0;&#125;.egg_settings_read_time_wrap .egg_select,.egg_settings_watch_time_wrap .egg_select &#123;  width: 6rem;&#125;.egg_settings .egg_settings_token_wrap &#123;  padding: 1rem 2rem 0 2rem;&#125;.egg_settings_token_wrap .egg_settings_token_input &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 1rem;  background: white;  border-radius: 0.2rem;  width: 100%;  box-sizing: border-box;  color: #ccc;&#125;.egg_settings_token_wrap .egg_settings_token_input.active &#123;  color: #333;&#125;.egg_settings_token_input::placeholder &#123;  color: #ccc;&#125;.egg_settings .egg_settings_submit_btn_wrap &#123;  text-align: right;  padding-top: 1rem;  display: none;&#125;.egg_settings .egg_settings_submit_btn_wrap.active &#123;  display: block;&#125;.egg_settings_submit_btn_wrap .egg_settings_submit_btn &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.5rem 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  cursor: pointer;&#125;.egg_settings_submit_btn_wrap .egg_settings_submit_btn:active &#123;  background: #eee;&#125;.egg_schedule &#123;  height: 100%;  display: flex;  flex-direction: column;&#125;.egg_schedule_time_wrap &#123;  padding: 1rem 2rem;  border-bottom: 0.1rem solid #eee;&#125;.egg_schedule_time .egg_schedule_label &#123;  padding-bottom: 1rem;  user-select: none;&#125;.egg_schedule_time .egg_schedule_time_input_wrap &#123;  display: flex;  justify-content: space-between;  align-items: center;&#125;.egg_schedule_time_input_wrap .egg_schedule_add_btn &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.5rem 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  cursor: pointer;&#125;.egg_schedule_time_input_wrap .egg_schedule_add_btn:active &#123;  background: #eee;&#125;.egg_schedule_list &#123;  height: 100%;  overflow: auto;&#125;.egg_schedule_list .egg_schedule_item &#123;  display: flex;  justify-content: space-between;  padding: 0.5rem 1.5rem;  font-size: 1.4rem;  border-bottom: 0.1rem solid #eee;&#125;.egg_schedule_list::-webkit-scrollbar &#123;  width: 0.4rem;  background: white;  border-radius: 0.2rem;&#125;.egg_schedule_list::-webkit-scrollbar-thumb &#123;  background: #ccc;  border-radius: 0.2rem;&#125;.egg_schedule_detail_time_wrap &#123;  display: flex;  align-items: center;&#125;.egg_schedule_detail_time_wrap.inactive &#123;  color: #ccc;&#125;.egg_schedule_detail_time_wrap .egg_schedule_detail_icon &#123;  padding-right: 0.4rem;  display: flex;  color: #ccc;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn &#123;  outline: none;  padding: 1rem;  text-align: center;  background: white;  border-radius: 0.2rem;  font-size: 1.4rem;  cursor: pointer;  color: #ccc;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn:hover &#123;  color: #333;&#125;.egg_schedule_detail_del_wrap .egg_schedule_del_btn:active &#123;  color: #eee;&#125;.egg_schedule_list .egg_schedule_list_none &#123;  width: 100%;  height: 100%;  display: flex;  flex-direction: column;  justify-content: center;  align-items: center;  color: #ccc;&#125;.egg_schedule_list_none .egg_icon &#123;  font-size: 2.5rem;&#125;.egg_schedule_list_none_text &#123;  padding-top: 1rem;&#125;.egg_select &#123;  position: relative;&#125;.egg_select .egg_select_input &#123;  outline: none;  border: 0.1rem solid #eee;  padding: 0.8rem;  text-align: center;  background: white;  border-radius: 0.2rem;  display: inline-block;  width: 100%;  box-sizing: border-box;&#125;.egg_select .egg_select_input::placeholder &#123;  color: #ccc;&#125;.egg_select_list &#123;  max-height: 12rem;  border-radius: 0 0 0.2rem 0.2rem;  box-shadow: 0 0.1rem 0.1rem 0.1rem #eee;  background: white;  user-select: none;  transition: 100ms ease;  scrollbar-width: thin;  overflow: auto;  opacity: 1;  z-index: 9;  width: 100%;  position: absolute;&#125;.egg_select_list.hide &#123;  opacity: 0;  visibility: hidden;&#125;.egg_select_list::-webkit-scrollbar &#123;  width: 0.4rem;  background: white;  border-radius: 0.2rem;&#125;.egg_select_list::-webkit-scrollbar-thumb &#123;  background: #ccc;  border-radius: 0.2rem;&#125;.egg_select_list .egg_select_item &#123;  padding: 0.6rem 1rem;  border-bottom: 0.1rem solid #eee;  cursor: pointer;  color: #333;  transition: 300ms ease;  text-align: center;&#125;.egg_select_list .egg_select_item.selected &#123;  font-weight: bold;  background: #f6f6f6;&#125;.egg_select_list .egg_select_item.active &#123;  background: #eee;&#125;.egg_select_list .egg_select_item:hover &#123;  background: #eee;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 嵌入样式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">GM_addStyle</span>(css);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href.<span class="title function_">match</span>(<span class="variable constant_">URL_CONFIG</span>.<span class="property">home</span>), <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化logo</span></span><br><span class="line">    <span class="title function_">initLogo</span>();</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入主页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化任务配置</span></span><br><span class="line">    <span class="title function_">initTaskConfig</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化主页面</span></span><br><span class="line">    <span class="title function_">initMainListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 渲染面板</span></span><br><span class="line">    <span class="title function_">renderPanel</span>();</span><br><span class="line">    <span class="comment">// 渲染窗口</span></span><br><span class="line">    <span class="title function_">renderFrame</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="title function_">GM_getValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入文章选读页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 最大阅读</span></span><br><span class="line">    <span class="title function_">initMaxRead</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 处理文章</span></span><br><span class="line">    <span class="title function_">handleNews</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="title function_">GM_getValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入视听学习页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 最大视听</span></span><br><span class="line">    <span class="title function_">initMaxWatch</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 处理视频</span></span><br><span class="line">    <span class="title function_">handleVideo</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href === <span class="variable constant_">URL_CONFIG</span>.<span class="property">examPractice</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入每日答题页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 创建答题按钮</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">renderExamBtn</span>();</span><br><span class="line">    <span class="comment">// 开始答题</span></span><br><span class="line">    <span class="title function_">doingExam</span>(<span class="title class_">ExamType</span>.<span class="property">PRACTICE</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">load</span>(<span class="function">(<span class="params">href</span>) =&gt;</span> href.<span class="title function_">includes</span>(<span class="variable constant_">URL_CONFIG</span>.<span class="property">examPaper</span>), <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 页面提示</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;进入专项练习页面!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 初始化主题</span></span><br><span class="line">    <span class="title function_">initThemeColor</span>();</span><br><span class="line">    <span class="comment">// 初始化设置</span></span><br><span class="line">    <span class="title function_">initSettings</span>();</span><br><span class="line">    <span class="comment">// 设置字体</span></span><br><span class="line">    <span class="title function_">initFontSize</span>();</span><br><span class="line">    <span class="comment">// 初始化子页面</span></span><br><span class="line">    <span class="title function_">initChildListener</span>();</span><br><span class="line">    <span class="comment">// 初始化提示</span></span><br><span class="line">    <span class="title function_">renderTip</span>();</span><br><span class="line">    <span class="comment">// 创建答题按钮</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">renderExamBtn</span>();</span><br><span class="line">    <span class="comment">// 开始答题</span></span><br><span class="line">    <span class="title function_">doingExam</span>(<span class="title class_">ExamType</span>.<span class="property">PAPER</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化logo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLogo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`%c tech-study.js %c <span class="subst">$&#123;version&#125;</span> `</span>, <span class="string">&#x27;background:dodgerblue;color:white;font-size:15px;border-radius:4px 0 0 4px;padding:2px 0;&#x27;</span>, <span class="string">&#x27;background:black;color:gold;font-size:15px;border-radius:0 4px 4px 0;padding:2px 0;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initTaskConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> configTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>));</span><br><span class="line">        <span class="keyword">if</span> (configTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(configTemp)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (configTemp.<span class="property">length</span> === taskConfig.<span class="property">length</span>) &#123;</span><br><span class="line">                taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task, i</span>) =&gt;</span> &#123;</span><br><span class="line">                    task.<span class="property">active</span> = configTemp[i].<span class="property">active</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initSettings</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> settingsTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;studySettings&#x27;</span>));</span><br><span class="line">        <span class="keyword">if</span> (settingsTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(settingsTemp)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (settingsTemp.<span class="property">length</span> === settings.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> settingsTemp) &#123;</span><br><span class="line">                    settings[i] = settingsTemp[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initFontSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 移动端</span></span><br><span class="line">    <span class="keyword">const</span> moblie = <span class="title function_">hasMobile</span>();</span><br><span class="line">    <span class="keyword">if</span> (moblie) &#123;</span><br><span class="line">        <span class="comment">// 清除缩放</span></span><br><span class="line">        <span class="keyword">const</span> meta = $$(<span class="string">&#x27;meta[name=viewport]&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (meta) &#123;</span><br><span class="line">            meta.<span class="property">content</span> = <span class="string">&#x27;initial-scale=0, user-scalable=yes&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 缩放比例</span></span><br><span class="line">        <span class="keyword">const</span> scale = ~~(<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">outerWidth</span>) || <span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--scale&#x27;</span>, <span class="title class_">String</span>(scale));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化最大阅读时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMaxRead</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> maxReadTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxRead&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (maxReadTemp) &#123;</span><br><span class="line">            maxRead.<span class="property">value</span> = maxReadTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化最大视听时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMaxWatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> maxWatchTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (maxWatchTemp) &#123;</span><br><span class="line">            maxWatch.<span class="property">value</span> = maxWatchTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化主题色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initThemeColor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 监听主题变化</span></span><br><span class="line">        <span class="title function_">watch</span>(themeColor, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置主题</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--themeColor&#x27;</span>, themeColor.<span class="property">value</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 主题色</span></span><br><span class="line">        <span class="keyword">const</span> themeColorTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;themeColor&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (themeColorTemp) &#123;</span><br><span class="line">            themeColor.<span class="property">value</span> = themeColorTemp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderTip</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tipWrap = <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_tip_wrap&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">mountElement</span>(tipWrap);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderExamBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> titles = <span class="keyword">await</span> $_(<span class="string">&#x27;.title&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (titles.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 插入节点</span></span><br><span class="line">        titles[<span class="number">0</span>].<span class="property">parentNode</span>?.<span class="title function_">insertBefore</span>(<span class="title class_">ExamBtn</span>().<span class="property">ele</span>, titles[<span class="number">0</span>].<span class="property">nextSibling</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染面板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderPanel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 面板</span></span><br><span class="line">    <span class="keyword">const</span> panel = <span class="title class_">Panel</span>();</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(panel);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 渲染窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 窗口</span></span><br><span class="line">    <span class="keyword">const</span> frame = <span class="title class_">Frame</span>();</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(frame);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 答案 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取答案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAnswer</span>(<span class="params">question</span>) &#123;</span><br><span class="line">    <span class="comment">// 数据</span></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">txt_name</span>: <span class="title function_">md5</span>(question),</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="comment">// 请求</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">answerSearch</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">const</span> &#123; data, status &#125; = result;</span><br><span class="line">            <span class="keyword">if</span> (status !== <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 答案列表</span></span><br><span class="line">                <span class="keyword">const</span> answerList = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data.<span class="property">txt_content</span>);</span><br><span class="line">                <span class="comment">// 答案</span></span><br><span class="line">                <span class="keyword">const</span> answers = answerList[<span class="number">0</span>].<span class="property">content</span>.<span class="title function_">split</span>(<span class="regexp">/[;\s]/</span>);</span><br><span class="line">                <span class="keyword">return</span> answers;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 保存答案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">saveAnswer</span>(<span class="params">question, answer</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 内容</span></span><br><span class="line">        <span class="keyword">const</span> content = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([&#123; <span class="attr">title</span>: <span class="title function_">md5</span>(question), <span class="attr">content</span>: answer &#125;]);</span><br><span class="line">        <span class="comment">// 数据</span></span><br><span class="line">        <span class="keyword">const</span> data = &#123;</span><br><span class="line">            <span class="attr">txt_name</span>: <span class="title function_">md5</span>(question),</span><br><span class="line">            <span class="attr">txt_content</span>: content,</span><br><span class="line">            <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="attr">v_id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="comment">// 请求</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">answerSave</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 数据 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取新闻数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getNewsList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    <span class="keyword">const</span> randNum = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable constant_">API_CONFIG</span>.<span class="property">todayNews</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取重要新闻</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayNews</span>[randNum], &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取视频数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getVideoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    <span class="keyword">const</span> randNum = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable constant_">API_CONFIG</span>.<span class="property">todayVideos</span>.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取重要新闻</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayVideos</span>[randNum], &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 专项练习数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getExamPaper</span>(<span class="params">pageNo</span>) &#123;</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;API_CONFIG.paperList&#125;</span>?pageSize=50&amp;pageNo=<span class="subst">$&#123;pageNo&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取专项练习</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">const</span> paperJson = <span class="built_in">decodeURIComponent</span>(<span class="built_in">escape</span>(<span class="variable language_">window</span>.<span class="title function_">atob</span>(data.<span class="property">data_str</span>.<span class="title function_">replace</span>(<span class="regexp">/-/g</span>, <span class="string">&#x27;+&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/_/g</span>, <span class="string">&#x27;/&#x27;</span>))));</span><br><span class="line">            <span class="comment">// JSON格式化</span></span><br><span class="line">            <span class="keyword">const</span> paper = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(paperJson);</span><br><span class="line">            <span class="keyword">return</span> paper;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateQRCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">generateQRCode</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> data.<span class="property">result</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用二维码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loginWithQRCode</span>(<span class="params">qrCode</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(&#123;</span><br><span class="line">            qrCode,</span><br><span class="line">            <span class="attr">goto</span>: <span class="string">&#x27;https://oa.xuexi.cn&#x27;</span>,</span><br><span class="line">            <span class="attr">pdmToken</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">loginWithQRCode</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded;charset=UTF-8&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 签名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getSign</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">sign</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">ok</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> data.<span class="property">data</span>.<span class="property">sign</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 安全检查</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">data</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">secureCheck</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data);</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;API_CONFIG.secureCheck&#125;</span>?<span class="subst">$&#123;params&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data.<span class="property">success</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 推送 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushPlus</span>(<span class="params">token, title, content, template, toToken</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 参数体</span></span><br><span class="line">        <span class="keyword">const</span> body = &#123;</span><br><span class="line">            token,</span><br><span class="line">            title,</span><br><span class="line">            content,</span><br><span class="line">            template,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 好友令牌</span></span><br><span class="line">        <span class="keyword">if</span> (toToken) &#123;</span><br><span class="line">            body.<span class="property">to</span> = toToken;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 推送</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">push</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(body),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 用户 API */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">userInfo</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取总积分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTotalScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">totalScore</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; score &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取当天总积分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTodayScore</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">todayScore</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 当天总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; score &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取任务列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable constant_">API_CONFIG</span>.<span class="property">taskList</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">            <span class="comment">// 进度和当天总分</span></span><br><span class="line">            <span class="keyword">const</span> &#123; taskProgress &#125; = data;</span><br><span class="line">            <span class="keyword">return</span> taskProgress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* task·配置 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 单次最大新闻数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxNewsNum = <span class="number">6</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 单次最大视频数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxVideoNum = <span class="number">6</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码最大刷新次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxRefreshCount = <span class="number">10</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码自动刷新间隔</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> autoRefreshQRCodeInterval = <span class="number">100000</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频静音</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> muted = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> url配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">URL_CONFIG</span> = &#123;</span><br><span class="line">    <span class="comment">// 主页正则</span></span><br><span class="line">    <span class="attr">home</span>: <span class="regexp">/^https\:\/\/www\.xuexi\.cn(\/(index\.html)?)?$/</span>,</span><br><span class="line">    <span class="comment">// 主页</span></span><br><span class="line">    <span class="attr">homeOrigin</span>: <span class="string">&#x27;https://www.xuexi.cn&#x27;</span>,</span><br><span class="line">    <span class="comment">// 每日答题页面</span></span><br><span class="line">    <span class="attr">examPractice</span>: <span class="string">&#x27;https://pc.xuexi.cn/points/exam-practice.html&#x27;</span>,</span><br><span class="line">    <span class="comment">// 专项练习页面</span></span><br><span class="line">    <span class="attr">examPaper</span>: <span class="string">&#x27;https://pc.xuexi.cn/points/exam-paper-detail.html&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> api配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_CONFIG</span> = &#123;</span><br><span class="line">    <span class="comment">// 用户信息</span></span><br><span class="line">    <span class="attr">userInfo</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/open/api/user/info&#x27;</span>,</span><br><span class="line">    <span class="comment">// 总分</span></span><br><span class="line">    <span class="attr">totalScore</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/get&#x27;</span>,</span><br><span class="line">    <span class="comment">// 当天分数</span></span><br><span class="line">    <span class="attr">todayScore</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/today/query&#x27;</span>,</span><br><span class="line">    <span class="comment">// 任务列表</span></span><br><span class="line">    <span class="attr">taskList</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/delegate/score/days/listScoreProgress?sence=score&amp;deviceType=2&#x27;</span>,</span><br><span class="line">    <span class="comment">// 新闻数据</span></span><br><span class="line">    <span class="attr">todayNews</span>: [</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/35il6fpn0ohq.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1ap1igfgdn2.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/vdppiu92n1.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/152mdtl3qn1.json&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 视频数据</span></span><br><span class="line">    <span class="attr">todayVideos</span>: [</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/525pi8vcj24p.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/11vku6vt6rgom.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/2qfjjjrprmdh.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/3o3ufqgl8rsn.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/591ht3bc22pi.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1742g60067k.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://www.xuexi.cn/lgdata/1novbsbi47k.json&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 专项练习列表</span></span><br><span class="line">    <span class="attr">paperList</span>: <span class="string">&#x27;https://pc-proxy-api.xuexi.cn/api/exam/service/paper/pc/list&#x27;</span>,</span><br><span class="line">    <span class="comment">// 文本服务器保存答案</span></span><br><span class="line">    <span class="attr">answerSave</span>: <span class="string">&#x27;https://a6.qikekeji.com/txt/data/save&#x27;</span>,</span><br><span class="line">    <span class="comment">// 文本服务器获取答案</span></span><br><span class="line">    <span class="attr">answerSearch</span>: <span class="string">&#x27;https://a6.qikekeji.com/txt/data/detail&#x27;</span>,</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="attr">push</span>: <span class="string">&#x27;https://www.pushplus.plus/send&#x27;</span>,</span><br><span class="line">    <span class="comment">// 生成二维码</span></span><br><span class="line">    <span class="attr">generateQRCode</span>: <span class="string">&#x27;https://login.xuexi.cn/user/qrcode/generate&#x27;</span>,</span><br><span class="line">    <span class="comment">//二维码登录</span></span><br><span class="line">    <span class="attr">loginWithQRCode</span>: <span class="string">&#x27;https://login.xuexi.cn/login/login_with_qr&#x27;</span>,</span><br><span class="line">    <span class="comment">// 签名</span></span><br><span class="line">    <span class="attr">sign</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/open/api/sns/sign&#x27;</span>,</span><br><span class="line">    <span class="comment">// 安全检查</span></span><br><span class="line">    <span class="attr">secureCheck</span>: <span class="string">&#x27;https://pc-api.xuexi.cn/login/secure_check&#x27;</span>,</span><br><span class="line">    <span class="comment">// 二维码</span></span><br><span class="line">    <span class="attr">qrcode</span>: <span class="string">&#x27;https://api.qrserver.com/v1/create-qr-code&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 版本号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> version = <span class="string">&#x27;1.7.0&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TaskType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">TaskType</span>) &#123;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;LOGIN&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;LOGIN&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;READ&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;READ&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;WATCH&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;WATCH&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskType</span>[<span class="title class_">TaskType</span>[<span class="string">&quot;PRACTICE&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;PRACTICE&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">TaskType</span> || (<span class="title class_">TaskType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SettingType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">SettingType</span>) &#123;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;AUTO_START&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;AUTO_START&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SAME_TAB&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;SAME_TAB&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SILENT_RUN&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;SILENT_RUN&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;SCHEDULE_RUN&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;SCHEDULE_RUN&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;RANDOM_EXAM&quot;</span>] = <span class="number">4</span>] = <span class="string">&quot;RANDOM_EXAM&quot;</span>;</span><br><span class="line">    <span class="title class_">SettingType</span>[<span class="title class_">SettingType</span>[<span class="string">&quot;REMOTE_PUSH&quot;</span>] = <span class="number">5</span>] = <span class="string">&quot;REMOTE_PUSH&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">SettingType</span> || (<span class="title class_">SettingType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 进度类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TaskStatusType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">TaskStatusType</span>) &#123;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;LOADING&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;LOADING&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;LOADED&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;LOADED&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;START&quot;</span>] = <span class="number">2</span>] = <span class="string">&quot;START&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;PAUSE&quot;</span>] = <span class="number">3</span>] = <span class="string">&quot;PAUSE&quot;</span>;</span><br><span class="line">    <span class="title class_">TaskStatusType</span>[<span class="title class_">TaskStatusType</span>[<span class="string">&quot;FINISH&quot;</span>] = <span class="number">4</span>] = <span class="string">&quot;FINISH&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">TaskStatusType</span> || (<span class="title class_">TaskStatusType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">// 当前订阅</span></span><br><span class="line"><span class="keyword">let</span> currentSub;</span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="keyword">const</span> subscription = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Proxy Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> proxyMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 收集 Ref 依赖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">trackRef</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当前订阅</span></span><br><span class="line">    <span class="keyword">if</span> (!currentSub) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">let</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="comment">// 不存在订阅列表</span></span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        subList = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        <span class="keyword">const</span> subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(<span class="string">&#x27;value&#x27;</span>, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(<span class="string">&#x27;value&#x27;</span>, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加订阅</span></span><br><span class="line">    subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 通知 Ref 订阅</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">terget</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">triggerRef</span>(<span class="params">target, newVal, oldVal</span>) &#123;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">const</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(<span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知订阅</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> subkeyList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fn <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="title function_">fn</span>(newVal, oldVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 收集依赖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">track</span> = (<span class="params">target, key</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 当前订阅</span></span><br><span class="line">    <span class="keyword">if</span> (!currentSub) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// proxy</span></span><br><span class="line">    <span class="keyword">const</span> proxyTarget = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!proxyTarget) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// target 订阅列表</span></span><br><span class="line">    <span class="keyword">let</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="comment">// 不存在订阅列表</span></span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        subList = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        <span class="keyword">const</span> subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(key, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="comment">// 键订阅</span></span><br><span class="line">        subkeyList = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="comment">// 添加订阅</span></span><br><span class="line">        subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">        subList.<span class="title function_">set</span>(key, subkeyList);</span><br><span class="line">        subscription.<span class="title function_">set</span>(target, subList);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加订阅</span></span><br><span class="line">    subkeyList.<span class="title function_">add</span>(currentSub);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 通知订阅</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">terget</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key, newVal, oldVal</span>) &#123;</span><br><span class="line">    <span class="comment">// proxy</span></span><br><span class="line">    <span class="keyword">const</span> proxyTarget = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!proxyTarget) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// proxyTarget 订阅列表</span></span><br><span class="line">    <span class="keyword">const</span> subList = subscription.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (!subList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 键订阅</span></span><br><span class="line">    <span class="keyword">let</span> subkeyList = subList.<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (!subkeyList) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通知订阅</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> subkeyList) &#123;</span><br><span class="line">        <span class="title function_">fn</span>(newVal, oldVal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 只读键</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ReactiveFlags</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">ReactiveFlags</span>) &#123;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_REF&quot;</span>] = <span class="string">&quot;_isRef&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_SHALLOW&quot;</span>] = <span class="string">&quot;_isShallow&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_REACTIVE&quot;</span>] = <span class="string">&quot;_isReactive&quot;</span>;</span><br><span class="line">    <span class="title class_">ReactiveFlags</span>[<span class="string">&quot;IS_READONLY&quot;</span>] = <span class="string">&quot;_isReadonly&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">ReactiveFlags</span> || (<span class="title class_">ReactiveFlags</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">Ref</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ref</span> &#123;</span><br><span class="line">    _isShallow = <span class="literal">false</span>;</span><br><span class="line">    _isRef = <span class="literal">true</span>;</span><br><span class="line">    _value;</span><br><span class="line">    value;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">val, shallow = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_isShallow</span> = shallow;</span><br><span class="line">        <span class="keyword">if</span> (val &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span> &amp;&amp; shallow) &#123;</span><br><span class="line">            <span class="keyword">const</span> reactiveVal = <span class="title function_">reactive</span>(val);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = reactiveVal;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = reactiveVal;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = val;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 定义属性</span></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, <span class="string">&#x27;value&#x27;</span>, &#123;</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 收集依赖</span></span><br><span class="line">                <span class="title function_">trackRef</span>(<span class="variable language_">this</span>);</span><br><span class="line">                <span class="keyword">return</span> _this.<span class="property">_value</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">                <span class="comment">// 旧数据</span></span><br><span class="line">                <span class="keyword">const</span> oldVal = <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">                <span class="comment">// 数据变化</span></span><br><span class="line">                <span class="keyword">if</span> (oldVal !== newVal) &#123;</span><br><span class="line">                    <span class="comment">// 设置新数据值</span></span><br><span class="line">                    _this.<span class="property">_value</span> = newVal;</span><br><span class="line">                    <span class="comment">// 通知依赖</span></span><br><span class="line">                    <span class="title function_">triggerRef</span>(<span class="variable language_">this</span>, newVal, oldVal);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">toJSON</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">ref</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isRef</span> = (<span class="params">v</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(v &amp;&amp; v[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REF</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 浅层 shallow</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isShallow</span> = (<span class="params">v</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(v &amp;&amp; v[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createRef</span> = (<span class="params">rawVal, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ref</span>(rawVal, shallow);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 解除 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">unref</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">isRef</span>(val) ? val.<span class="property">value</span> : val);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">v</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ref</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isRef</span>(value)</span><br><span class="line">        ? value</span><br><span class="line">        : <span class="title function_">createRef</span>(value, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">ref</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowRef</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isRef</span>(value)</span><br><span class="line">        ? value</span><br><span class="line">        : <span class="title function_">createRef</span>(value, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建处理 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isReadonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isShallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactiveHandlers</span> = (<span class="params">isReadonly, isShallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="title function_">createGetters</span>(isReadonly, isShallow),</span><br><span class="line">        <span class="attr">set</span>: <span class="title function_">createSetters</span>(isReadonly, isShallow),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">getters</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isReadonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">isShallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createGetters</span> = (<span class="params">isReadonly, isShallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">target, key, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> !isReadonly;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> isReadonly;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> isShallow;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 结果</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">        <span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">            <span class="comment">// 收集依赖</span></span><br><span class="line">            <span class="title function_">track</span>(target, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isShallow) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(res)) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="property">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (res &amp;&amp; <span class="keyword">typeof</span> res === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res <span class="keyword">instanceof</span> <span class="title class_">Element</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> isReadonly ? <span class="title function_">readonly</span>(res) : <span class="title function_">reactive</span>(res);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">setters</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">readonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">shallow</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createSetters</span> = (<span class="params">readonly, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">target, key, newVal, receiver</span>) &#123;</span><br><span class="line">        <span class="comment">// 只读</span></span><br><span class="line">        <span class="keyword">if</span> (readonly) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 旧值</span></span><br><span class="line">        <span class="keyword">const</span> oldVal = target[key];</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(oldVal) &amp;&amp; <span class="title function_">isRef</span>(oldVal) &amp;&amp; !<span class="title function_">isRef</span>(newVal)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!shallow) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(oldVal) &amp;&amp; !<span class="title function_">isRef</span>(newVal)) &#123;</span><br><span class="line">                oldVal.<span class="property">value</span> = newVal;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newVal, receiver);</span><br><span class="line">        <span class="comment">// length</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) &amp;&amp; key === <span class="string">&#x27;length&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 通知依赖</span></span><br><span class="line">            <span class="title function_">trigger</span>(target, key, newVal, oldVal);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 数据变化</span></span><br><span class="line">        <span class="keyword">if</span> (oldVal !== newVal) &#123;</span><br><span class="line">            <span class="comment">// 通知依赖</span></span><br><span class="line">            <span class="title function_">trigger</span>(target, key, newVal, oldVal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> reactive object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactiveObj</span> = (<span class="params">target, isReadonly, shallow</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 存在 Proxy</span></span><br><span class="line">    <span class="keyword">const</span> existingProxy = proxyMap.<span class="title function_">get</span>(target);</span><br><span class="line">    <span class="keyword">if</span> (existingProxy) &#123;</span><br><span class="line">        <span class="keyword">return</span> existingProxy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新建</span></span><br><span class="line">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, <span class="title function_">createReactiveHandlers</span>(isReadonly, shallow));</span><br><span class="line">    proxyMap.<span class="title function_">set</span>(target, proxy);</span><br><span class="line">    <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isReactive</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(val &amp;&amp; val[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 reactive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowReactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isReadonly</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> !!(val &amp;&amp; val[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建 readonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createReadonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 顶层 readonly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowReadonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactiveObj</span>(target, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">proxy</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">val</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isProxy</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isReactive</span>(val) || <span class="title function_">isReadonly</span>(val);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">reactive</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reactive</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReactive</span>(target);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> <span class="variable">readonly</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">readonly</span> = (<span class="params">target</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createReadonly</span>(target);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听数据变化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">source</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watch</span> = (<span class="params">source, callback, immediate = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 立刻执行</span></span><br><span class="line">    immediate &amp;&amp; <span class="title function_">callback</span>(<span class="title function_">unref</span>(source), <span class="title function_">unref</span>(source));</span><br><span class="line">    <span class="comment">// array</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(source) &amp;&amp; source.<span class="title function_">every</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">isRef</span>(s))) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> source) &#123;</span><br><span class="line">            <span class="comment">// Proxy</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source[i])) &#123;</span><br><span class="line">                <span class="title function_">watch</span>(source[i], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = source.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">unref</span>(s));</span><br><span class="line">                    <span class="title function_">callback</span>(res, res);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> source.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> <span class="title function_">unref</span>(s)), callback);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// function</span></span><br><span class="line">    <span class="keyword">if</span> (source <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">        <span class="title function_">watch</span>(<span class="title function_">watchEffectRef</span>(source), <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">callback</span>(<span class="title function_">unref</span>(n), <span class="title function_">unref</span>(o));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Proxy</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">            currentSub = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(source, source);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// sub source</span></span><br><span class="line">            <span class="keyword">const</span> subSource = source[key];</span><br><span class="line">            currentSub = <span class="literal">undefined</span>;</span><br><span class="line">            <span class="title function_">watch</span>(subSource, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(source, source);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(source)) &#123;</span><br><span class="line">        <span class="comment">// Ref.value Proxy</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isProxy</span>(source.<span class="property">value</span>)) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(source.<span class="property">value</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">callback</span>(<span class="title function_">unref</span>(source), <span class="title function_">unref</span>(source));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        currentSub = callback;</span><br><span class="line">        <span class="comment">// 收集依赖</span></span><br><span class="line">        <span class="title function_">trackRef</span>(source);</span><br><span class="line">        currentSub = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听数据变化影响</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchEffect</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">    currentSub = callback;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">    currentSub = <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听影响 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">refVal</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchRef</span> = (<span class="params">source, callback</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="keyword">const</span> effectRes = <span class="title function_">shallowRef</span>(<span class="title function_">callback</span>());</span><br><span class="line">    <span class="comment">// 监听</span></span><br><span class="line">    <span class="title function_">watch</span>(source, <span class="function">() =&gt;</span> (effectRes.<span class="property">value</span> = <span class="title function_">unref</span>(<span class="title function_">callback</span>())));</span><br><span class="line">    <span class="keyword">return</span> effectRes;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 监听影响 ref</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">refVal</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchEffectRef</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 收集依赖</span></span><br><span class="line">    <span class="keyword">const</span> effectRes = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="comment">// 监听</span></span><br><span class="line">    <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> (effectRes.<span class="property">value</span> = <span class="title function_">unref</span>(<span class="title function_">callback</span>())));</span><br><span class="line">    <span class="keyword">return</span> effectRes;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建元素节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eleName</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElementNode</span>(<span class="params">tagName, props, attrs, children, options</span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> beforemount = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> mounted = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; onMounted, beforeMount &#125; = e;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(beforemount, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (beforemount.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">beforeMount</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (onMounted) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(mounted, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mounted.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">unsubscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">//懒得写</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// 创建普通元素</span></span><br><span class="line">    <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tagName);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleProps</span>(ele, props);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleAttributes</span>(ele, attrs, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 处理子元素</span></span><br><span class="line">    <span class="title function_">handleChildren</span>(ele, children, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 收集挂载前</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectBeforeMount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        beforemount.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 收集挂载</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectOnMounted</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        mounted.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; ele, <span class="attr">beforeMount</span>: collectBeforeMount, <span class="attr">onMounted</span>: collectOnMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建svg元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">tagName</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createNSElementNode</span>(<span class="params">tagName, props, attrs, children, options</span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> beforemount = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 挂载状态</span></span><br><span class="line">    <span class="keyword">let</span> mounted = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; onMounted, beforeMount &#125; = e;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(beforemount, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (beforemount.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">beforeMount</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (onMounted) &#123;</span><br><span class="line">            <span class="title function_">watch</span>(mounted, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mounted.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 取消订阅</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">unsubscribe</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">//懒得写</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// svg元素命名空间</span></span><br><span class="line">    <span class="keyword">const</span> ns = <span class="string">&#x27;http://www.w3.org/2000/svg&#x27;</span>;</span><br><span class="line">    <span class="comment">// 创建svg元素</span></span><br><span class="line">    <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(ns, tagName);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleProps</span>(ele, props);</span><br><span class="line">    <span class="comment">// 处理属性</span></span><br><span class="line">    <span class="title function_">handleAttributes</span>(ele, attrs, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 处理子元素</span></span><br><span class="line">    <span class="title function_">handleChildren</span>(ele, children, subscribe, unsubscribe);</span><br><span class="line">    <span class="comment">// 收集挂载前</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectBeforeMount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        beforemount.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 收集挂载</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">collectOnMounted</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        mounted.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; ele, <span class="attr">beforeMount</span>: collectBeforeMount, <span class="attr">onMounted</span>: collectOnMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleProps</span>(<span class="params">ele, props</span>) &#123;</span><br><span class="line">    <span class="comment">// props属性设置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">        <span class="comment">// Ref 属性</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(props[key])) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = props[key];</span><br><span class="line">            <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> (ele[key] = refVal.<span class="property">value</span>));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ele[key] = props[key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理svg属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">attrs</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAttributes</span>(<span class="params">ele, attrs, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// 属性存在</span></span><br><span class="line">    <span class="keyword">if</span> (attrs) &#123;</span><br><span class="line">        <span class="comment">// attrs属性设置</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> attrs) &#123;</span><br><span class="line">            <span class="comment">// 处理普通属性</span></span><br><span class="line">            <span class="title function_">handleAttribute</span>(ele, key, attrs[key], subscribe, unsubscribe);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理事件选项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleEventOptions</span>(<span class="params">option</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (option.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> options = &#123;</span><br><span class="line">            <span class="attr">capture</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;capture&#x27;</span>),</span><br><span class="line">            <span class="attr">once</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;once&#x27;</span>),</span><br><span class="line">            <span class="attr">passive</span>: option.<span class="title function_">includes</span>(<span class="string">&#x27;passive&#x27;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleAttribute</span>(<span class="params">ele, key, value, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// 处理完的key</span></span><br><span class="line">    <span class="keyword">const</span> formatKey = key.<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="comment">// 事件绑定</span></span><br><span class="line">    <span class="keyword">if</span> (formatKey.<span class="title function_">startsWith</span>(<span class="string">&#x27;on&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 事件监听</span></span><br><span class="line">        <span class="keyword">const</span> [event] = formatKey.<span class="title function_">match</span>(<span class="regexp">/(?&lt;=on).*/</span>);</span><br><span class="line">        <span class="comment">// 事件类型</span></span><br><span class="line">        <span class="keyword">if</span> (event) &#123;</span><br><span class="line">            <span class="keyword">const</span> [eventType, ...option] = event.<span class="title function_">split</span>(<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> options = <span class="title function_">handleEventOptions</span>(option);</span><br><span class="line">            <span class="comment">// Ref 函数</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">const</span> refVal = value;</span><br><span class="line">                <span class="keyword">const</span> refListener = <span class="title function_">watchRef</span>(refVal, <span class="function">() =&gt;</span> refVal.<span class="property">value</span></span><br><span class="line">                    ? <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                        option.<span class="title function_">includes</span>(<span class="string">&#x27;prevent&#x27;</span>) &amp;&amp; e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                        option.<span class="title function_">includes</span>(<span class="string">&#x27;stop&#x27;</span>) &amp;&amp; e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                        <span class="keyword">const</span> callback = refVal.<span class="property">value</span>;</span><br><span class="line">                        <span class="title function_">callback</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    : <span class="literal">undefined</span>);</span><br><span class="line">                <span class="comment">// 设置事件监听</span></span><br><span class="line">                refListener.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                    ele.<span class="title function_">addEventListener</span>(eventType, refListener.<span class="property">value</span>, options);</span><br><span class="line">                <span class="comment">// 监听事件变化</span></span><br><span class="line">                <span class="title function_">watch</span>(refListener, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 移除旧事件监听</span></span><br><span class="line">                    oldVal &amp;&amp; ele.<span class="title function_">removeEventListener</span>(eventType, oldVal);</span><br><span class="line">                    <span class="comment">// 设置新事件监听</span></span><br><span class="line">                    newVal &amp;&amp; ele.<span class="title function_">addEventListener</span>(eventType, newVal, options);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 普通函数</span></span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置事件监听</span></span><br><span class="line">                ele.<span class="title function_">addEventListener</span>(eventType, value, options);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 特殊属性</span></span><br><span class="line">    <span class="keyword">const</span> specificAttrs = [<span class="string">&#x27;checked&#x27;</span>, <span class="string">&#x27;selected&#x27;</span>, <span class="string">&#x27;disabled&#x27;</span>, <span class="string">&#x27;enabled&#x27;</span>];</span><br><span class="line">    <span class="comment">// 特殊 key</span></span><br><span class="line">    <span class="keyword">if</span> (specificAttrs.<span class="title function_">includes</span>(formatKey)) &#123;</span><br><span class="line">        <span class="comment">// Ref</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = value;</span><br><span class="line">            <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (refVal.<span class="property">value</span>) &#123;</span><br><span class="line">                    ele.<span class="title function_">setAttribute</span>(formatKey, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    ele.<span class="title function_">removeAttribute</span>(formatKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 普通属性值</span></span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            ele.<span class="title function_">setAttribute</span>(formatKey, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ele.<span class="title function_">removeAttribute</span>(formatKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ref 属性名</span></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;ref&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// Ref</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">const</span> refVal = value;</span><br><span class="line">            subscribe &amp;&amp;</span><br><span class="line">                <span class="title function_">subscribe</span>(&#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        refVal.<span class="property">value</span> = ele;</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Ref 函数</span></span><br><span class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> refFn = value;</span><br><span class="line">            subscribe &amp;&amp;</span><br><span class="line">                <span class="title function_">subscribe</span>(&#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="title function_">refFn</span>(ele);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// xlink命名空间</span></span><br><span class="line">    <span class="keyword">if</span> (key.<span class="title function_">startsWith</span>(<span class="string">&#x27;xlink:&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// xlink属性命名空间</span></span><br><span class="line">        <span class="keyword">const</span> attrNS = <span class="string">&#x27;http://www.w3.org/1999/xlink&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            ele.<span class="title function_">setAttributeNS</span>(attrNS, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ele.<span class="title function_">removeAttributeNS</span>(attrNS, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Ref 属性值</span></span><br><span class="line">    <span class="keyword">if</span> (key &amp;&amp; <span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">        <span class="keyword">const</span> refVal = value;</span><br><span class="line">        <span class="comment">// 监听影响</span></span><br><span class="line">        <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            ele.<span class="title function_">setAttribute</span>(key, refVal.<span class="property">value</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 普通属性</span></span><br><span class="line">    <span class="keyword">if</span> (key) &#123;</span><br><span class="line">        <span class="comment">// 普通属性</span></span><br><span class="line">        ele.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理子元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">ele</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">children</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChildren</span>(<span class="params">ele, children, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(children)) &#123;</span><br><span class="line">        <span class="comment">// 注释元素</span></span><br><span class="line">        <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 监听元素变化</span></span><br><span class="line">        <span class="title function_">watch</span>(children, <span class="keyword">async</span> (newEle, oldEle) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                    <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                        oldEleRes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                            unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                    oldEle.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                        unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                ele.<span class="title function_">replaceChildren</span>(comment);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (newEle) &#123;</span><br><span class="line">                <span class="keyword">if</span> (oldEle) &#123;</span><br><span class="line">                    <span class="comment">// Promise</span></span><br><span class="line">                    <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                        <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                            oldEleRes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                                unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// unPromise</span></span><br><span class="line">                    <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                        oldEle.<span class="title function_">forEach</span>(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">                            unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(ele);</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                    <span class="keyword">if</span> (newEleRes) &#123;</span><br><span class="line">                        <span class="keyword">const</span> eles = newEleRes.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                                subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">const</span> eles = newEle.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                        subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Promise</span></span><br><span class="line">        <span class="keyword">if</span> (children.<span class="property">value</span> <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// 插入注释元素</span></span><br><span class="line">            ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">            children.<span class="property">value</span>.<span class="title function_">then</span>(<span class="function">(<span class="params">childrenEle</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (childrenEle) &#123;</span><br><span class="line">                    <span class="keyword">const</span> eles = childrenEle.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                            subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    ele.<span class="title function_">replaceChildren</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// unPromise</span></span><br><span class="line">        <span class="keyword">if</span> (children.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> eles = children.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                    subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            ele.<span class="title function_">appendChild</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Promise</span></span><br><span class="line">    <span class="keyword">if</span> (children <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">        <span class="comment">// 注释元素</span></span><br><span class="line">        <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 插入注释元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(comment);</span><br><span class="line">        <span class="comment">// 异步替换元素</span></span><br><span class="line">        children.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                    subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                &#125;</span><br><span class="line">                comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Array</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line">        <span class="comment">// 处理过后</span></span><br><span class="line">        <span class="keyword">const</span> resChildren = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> children) &#123;</span><br><span class="line">            <span class="keyword">const</span> child = children[i];</span><br><span class="line">            <span class="comment">// Ref</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(child)) &#123;</span><br><span class="line">                <span class="comment">// 注释</span></span><br><span class="line">                <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="comment">// 监听影响</span></span><br><span class="line">                <span class="title function_">watch</span>(child, <span class="keyword">async</span> (newEle, oldEle) =&gt; &#123;</span><br><span class="line">                    <span class="comment">// 新元素为空</span></span><br><span class="line">                    <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="keyword">if</span> (oldEleRes) &#123;</span><br><span class="line">                                <span class="title function_">handleChangeElement</span>(newEle, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 旧元素为空</span></span><br><span class="line">                    <span class="keyword">if</span> (newEle &amp;&amp; !oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="keyword">if</span> (newEleRes) &#123;</span><br><span class="line">                                <span class="title function_">handleChangeElement</span>(newEleRes, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 存在</span></span><br><span class="line">                    <span class="keyword">if</span> (newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span> &amp;&amp; oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEleRes, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span> &amp;&amp; !(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                            <span class="keyword">const</span> newEleRes = <span class="keyword">await</span> newEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEleRes, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (!(newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &amp;&amp; oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> oldEleRes = <span class="keyword">await</span> oldEle;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEle, oldEleRes, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 非 Promise</span></span><br><span class="line">                        <span class="keyword">if</span> (!(oldEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &amp;&amp; !(newEle <span class="keyword">instanceof</span> <span class="title class_">Promise</span>)) &#123;</span><br><span class="line">                            <span class="comment">// 处理元素变化</span></span><br><span class="line">                            <span class="title function_">handleChangeElement</span>(newEle, oldEle, comment, subscribe, unsubscribe);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// Promise</span></span><br><span class="line">                <span class="keyword">if</span> (child.<span class="property">value</span> <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                    <span class="comment">// 注释</span></span><br><span class="line">                    resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                    <span class="comment">// 异步替换</span></span><br><span class="line">                    child.<span class="property">value</span>.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                            <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                            <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                                subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                            &#125;</span><br><span class="line">                            comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// unPromise</span></span><br><span class="line">                <span class="keyword">if</span> (child.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; beforeMount, onMounted, ele &#125; = child.<span class="property">value</span>;</span><br><span class="line">                    resChildren[i] = &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Promise</span></span><br><span class="line">            <span class="keyword">if</span> (child <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">                <span class="comment">// 注释</span></span><br><span class="line">                <span class="keyword">const</span> comment = <span class="variable language_">document</span>.<span class="title function_">createComment</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                resChildren[i] = &#123; <span class="attr">ele</span>: comment &#125;;</span><br><span class="line">                <span class="comment">// 异步替换元素</span></span><br><span class="line">                child.<span class="title function_">then</span>(<span class="function">(<span class="params">childEle</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (childEle) &#123;</span><br><span class="line">                        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = childEle;</span><br><span class="line">                        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">                            subscribe &amp;&amp; <span class="title function_">subscribe</span>(childEle);</span><br><span class="line">                        &#125;</span><br><span class="line">                        comment.<span class="title function_">replaceWith</span>(childEle.<span class="property">ele</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 普通元素</span></span><br><span class="line">            <span class="keyword">if</span> (child) &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; beforeMount, onMounted, ele &#125; = child;</span><br><span class="line">                resChildren[i] = &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> eles = resChildren.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (v.<span class="property">beforeMount</span> || v.<span class="property">onMounted</span>) &#123;</span><br><span class="line">                subscribe &amp;&amp; <span class="title function_">subscribe</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> v.<span class="property">ele</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(<span class="title function_">createElementBlock</span>(eles));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 普通元素</span></span><br><span class="line">    <span class="keyword">if</span> (children) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = children;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(children);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 插入元素</span></span><br><span class="line">        ele.<span class="title function_">appendChild</span>(children.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 元素变化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">newEle</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">oldEle</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">comment</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChangeElement</span>(<span class="params">newEle, oldEle, comment, subscribe, unsubscribe</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = newEle;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(newEle);</span><br><span class="line">        &#125;</span><br><span class="line">        oldEle.<span class="property">ele</span>.<span class="title function_">replaceWith</span>(newEle.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newEle &amp;&amp; !oldEle) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; beforeMount, onMounted &#125; = newEle;</span><br><span class="line">        <span class="keyword">if</span> (beforeMount || onMounted) &#123;</span><br><span class="line">            subscribe &amp;&amp; <span class="title function_">subscribe</span>(newEle);</span><br><span class="line">        &#125;</span><br><span class="line">        comment.<span class="title function_">replaceWith</span>(newEle.<span class="property">ele</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!newEle &amp;&amp; oldEle) &#123;</span><br><span class="line">        unsubscribe &amp;&amp; <span class="title function_">unsubscribe</span>(oldEle);</span><br><span class="line">        oldEle.<span class="property">ele</span>.<span class="title function_">replaceWith</span>(comment);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建文字节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createTextNode</span>(<span class="params">text, options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; onCreated, beforeCreat, onMounted, beforeMount &#125; = options || &#123;&#125;;</span><br><span class="line">    <span class="comment">// 创建元素前</span></span><br><span class="line">    beforeCreat &amp;&amp; <span class="title function_">beforeCreat</span>();</span><br><span class="line">    <span class="comment">// Ref</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(text)) &#123;</span><br><span class="line">        <span class="comment">// ref</span></span><br><span class="line">        <span class="keyword">const</span> refVal = text;</span><br><span class="line">        <span class="comment">// 元素</span></span><br><span class="line">        <span class="keyword">const</span> ele = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 订阅变化</span></span><br><span class="line">        <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            ele.<span class="property">data</span> = refVal.<span class="property">value</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 创建元素后</span></span><br><span class="line">        onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">        <span class="keyword">return</span> &#123; ele, beforeMount, onMounted &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建元素后</span></span><br><span class="line">    onCreated &amp;&amp; <span class="title function_">onCreated</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">ele</span>: <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">String</span>(text)), beforeMount, onMounted &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 挂载元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eleOptions</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">parent</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">eleOptions, parent = <span class="variable language_">document</span>.body</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ele, beforeMount, onMounted &#125; = eleOptions;</span><br><span class="line">    <span class="keyword">if</span> (ele) &#123;</span><br><span class="line">        <span class="comment">// 触发挂载前事件</span></span><br><span class="line">        beforeMount &amp;&amp; <span class="title function_">beforeMount</span>();</span><br><span class="line">        parent.<span class="title function_">appendChild</span>(ele);</span><br><span class="line">        <span class="comment">// 挂在后</span></span><br><span class="line">        onMounted &amp;&amp; <span class="title function_">onMounted</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 选择器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">selector</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$$</span>(<span class="params">selector, parent = <span class="variable language_">document</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(parent.<span class="title function_">querySelectorAll</span>(selector));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 异步选择器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">selector</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$_</span>(<span class="params">selector, parent = <span class="variable language_">document</span>, timeout</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> selectors = <span class="title class_">Array</span>.<span class="title function_">from</span>(parent.<span class="title function_">querySelectorAll</span>(selector));</span><br><span class="line">            <span class="comment">// 存在元素</span></span><br><span class="line">            <span class="keyword">if</span> (selectors.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>(selectors);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 超时</span></span><br><span class="line">        <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>([]);</span><br><span class="line">            &#125;, timeout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建元素块</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">eles</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElementBlock</span>(<span class="params">eles</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> eles) &#123;</span><br><span class="line">        fragment.<span class="title function_">appendChild</span>(eles[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fragment;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印日志</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;dodgerblue&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印错误</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;red&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">info</span>(<span class="params">...text</span>) &#123;</span><br><span class="line">    <span class="title function_">printColor</span>(<span class="string">&#x27;yellow&#x27;</span>, ...text);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打印颜色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">color</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printColor</span>(<span class="params">color, ...text</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> textFormatted = text</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> (<span class="keyword">typeof</span> t === <span class="string">&#x27;object&#x27;</span> ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(t) : <span class="title class_">String</span>(t)))</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`%c[<span class="subst">$&#123;formatDateTime()&#125;</span>] %c<span class="subst">$&#123;textFormatted&#125;</span>`</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">`color: <span class="subst">$&#123;color&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> html进度条</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">title</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">percent</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getProgressHTML</span>(<span class="params">title, percent</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> progressHTML = <span class="string">`&lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">      justify-content: space-between;</span></span><br><span class="line"><span class="string">      padding: 1px 0;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;span&gt;<span class="subst">$&#123;title&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;span&gt;<span class="subst">$&#123;getHighlightHTML(percent)&#125;</span> %&lt;/span&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      background: white;</span></span><br><span class="line"><span class="string">      border-radius: 10px;</span></span><br><span class="line"><span class="string">      height: 10px;</span></span><br><span class="line"><span class="string">      border: 1px solid #eee;</span></span><br><span class="line"><span class="string">      flex-shrink: 1;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        background: linear-gradient(to left, #188fff80, #1890ff);</span></span><br><span class="line"><span class="string">        height: 100%;</span></span><br><span class="line"><span class="string">        width: <span class="subst">$&#123;percent&#125;</span>%;</span></span><br><span class="line"><span class="string">        border-radius: 10px;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span>;</span><br><span class="line">    <span class="keyword">return</span> progressHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> html高亮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">text</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getHighlightHTML</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> highlightHTML = <span class="string">`&lt;span style=&quot;color: #1890ff&quot;&gt;<span class="subst">$&#123;text&#125;</span>&lt;/span&gt;`</span>;</span><br><span class="line">    <span class="keyword">return</span> highlightHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">src</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getImgHTML</span>(<span class="params">src</span>) &#123;</span><br><span class="line">    <span class="comment">// 图片</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">     &lt;div style=&quot;padding: 10px 0&quot;&gt;</span></span><br><span class="line"><span class="string">     &lt;div</span></span><br><span class="line"><span class="string">       style=&quot;</span></span><br><span class="line"><span class="string">         display: flex;</span></span><br><span class="line"><span class="string">         justify-content: center;</span></span><br><span class="line"><span class="string">         align-items: center;</span></span><br><span class="line"><span class="string">         padding: 20px;</span></span><br><span class="line"><span class="string">         background: #f7f7f7;</span></span><br><span class="line"><span class="string">         border-radius: 10px;</span></span><br><span class="line"><span class="string">       &quot;</span></span><br><span class="line"><span class="string">     &gt;</span></span><br><span class="line"><span class="string">         &lt;img src=&quot;<span class="subst">$&#123;src&#125;</span>&quot; style=&quot;width:200px;height:200px;&quot; /&gt;</span></span><br><span class="line"><span class="string">       &lt;/div&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建模态框</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options 选项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createModal</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 配置</span></span><br><span class="line">    <span class="keyword">const</span> &#123; title, subTitle = <span class="string">&#x27;&#x27;</span>, to = <span class="string">&#x27;用户&#x27;</span>, content, type, <span class="keyword">from</span> = <span class="string">&#x27;tech-study.js&#x27;</span>, &#125; = options;</span><br><span class="line">    <span class="comment">// 内容文本</span></span><br><span class="line">    <span class="keyword">let</span> contentText = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(content)) &#123;</span><br><span class="line">        contentText = content.<span class="title function_">map</span>(<span class="function">(<span class="params">ct</span>) =&gt;</span> <span class="string">`&lt;div&gt;<span class="subst">$&#123;ct&#125;</span>&lt;/div&gt;`</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        contentText = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 日期</span></span><br><span class="line">    <span class="keyword">const</span> dateTime = <span class="title function_">formatDateTime</span>();</span><br><span class="line">    <span class="comment">// 类型html</span></span><br><span class="line">    <span class="keyword">let</span> typeHTML = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (type &amp;&amp; type.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;info&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">       viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">       style=&quot;color: #1890ff; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">       fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">       aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">     &gt;</span></span><br><span class="line"><span class="string">       &lt;path</span></span><br><span class="line"><span class="string">         d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z&quot;</span></span><br><span class="line"><span class="string">       &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">     &lt;/svg&gt;`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;warn&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #faad14; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;success&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #52c41a; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;fail&#x27;</span>) &#123;</span><br><span class="line">            typeHTML = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;svg</span></span><br><span class="line"><span class="string">        viewBox=&quot;64 64 896 896&quot;</span></span><br><span class="line"><span class="string">        style=&quot;color: #ff4d4f; width: 18px; height: 18px&quot;</span></span><br><span class="line"><span class="string">        fill=&quot;currentColor&quot;</span></span><br><span class="line"><span class="string">        aria-hidden=&quot;true&quot;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        &lt;path</span></span><br><span class="line"><span class="string">          d=&quot;M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z&quot;</span></span><br><span class="line"><span class="string">        &gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">      &lt;/svg&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 类型</span></span><br><span class="line">    <span class="keyword">const</span> typeWrap = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;span</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      padding-right: 5px;</span></span><br><span class="line"><span class="string">      display: flex;</span></span><br><span class="line"><span class="string">      justify-content: center;</span></span><br><span class="line"><span class="string">      align-items: center;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;typeHTML&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/span&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">    <span class="comment">// 基础html</span></span><br><span class="line">    <span class="keyword">const</span> baseHTML = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">  style=&quot;</span></span><br><span class="line"><span class="string">    padding: 5px;</span></span><br><span class="line"><span class="string">    display: flex;</span></span><br><span class="line"><span class="string">    justify-content: center;</span></span><br><span class="line"><span class="string">    align-items: center;</span></span><br><span class="line"><span class="string">  &quot;</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">  &lt;div</span></span><br><span class="line"><span class="string">    style=&quot;</span></span><br><span class="line"><span class="string">      background: #ffffff;</span></span><br><span class="line"><span class="string">      box-shadow: 1px 1px 8px -1px #dadada;</span></span><br><span class="line"><span class="string">      padding: 5px 10px;</span></span><br><span class="line"><span class="string">      border-radius: 5px;</span></span><br><span class="line"><span class="string">      width: 100%;</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string">  &gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        justify-content: space-between;</span></span><br><span class="line"><span class="string">        padding: 5px;</span></span><br><span class="line"><span class="string">        border-bottom: 1px solid #eee;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;display: flex; justify-content: center; align-items: center&quot;&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;typeWrap&#125;</span></span></span><br><span class="line"><span class="string">        &lt;span style=&quot;padding-left: 5px; font-size: 18px&quot;&gt;<span class="subst">$&#123;title&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;font-size: 16px; color: #999&quot;&gt;<span class="subst">$&#123;subTitle&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div style=&quot;padding:10px 5px; font-size: 16px; min-height: 80px&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;getHighlightHTML(to)&#125;</span>, 你好!</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;line-height: 28px;&quot;&gt;<span class="subst">$&#123;contentText&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div</span></span><br><span class="line"><span class="string">      style=&quot;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        padding: 5px;</span></span><br><span class="line"><span class="string">        border-top: 1px solid #eee;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        justify-content: space-between;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">      &quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">      &lt;div style=&quot;color: #999&quot;&gt;<span class="subst">$&#123;dateTime&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;来自&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span style=&quot;color: #1890ff; padding-left: 1px&quot;&gt;<span class="subst">$&#123;<span class="keyword">from</span>&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">    <span class="keyword">return</span> baseHTML;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushMessage</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 选项</span></span><br><span class="line">    <span class="keyword">const</span> &#123; title, content, template, fromToken, toToken &#125; = options;</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushPlus</span>(fromToken, title, content, template, toToken);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送模态框</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">pushModal</span>(<span class="params">options, fromToken, toToken</span>) &#123;</span><br><span class="line">    <span class="comment">// html</span></span><br><span class="line">    <span class="keyword">const</span> html = <span class="title function_">createModal</span>(options);</span><br><span class="line">    <span class="comment">// 推送</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushMessage</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;消息提示&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: html,</span><br><span class="line">        fromToken,</span><br><span class="line">        toToken,</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建随机点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bounds 范围</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRandomPoint</span>(<span class="params">bounds</span>) &#123;</span><br><span class="line">    <span class="comment">// 范围</span></span><br><span class="line">    <span class="keyword">const</span> &#123; x, y, width, height &#125; = bounds;</span><br><span class="line">    <span class="comment">// 横坐标</span></span><br><span class="line">    <span class="keyword">const</span> randX = x + <span class="title class_">Math</span>.<span class="title function_">random</span>() * width * <span class="number">0.5</span> + width * <span class="number">0.25</span>;</span><br><span class="line">    <span class="comment">// 纵坐标</span></span><br><span class="line">    <span class="keyword">const</span> randY = y + <span class="title class_">Math</span>.<span class="title function_">random</span>() * height * <span class="number">0.5</span> + height * <span class="number">0.25</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">x</span>: randX,</span><br><span class="line">        <span class="attr">y</span>: randY,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成随机路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">start</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">end</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">steps</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRandomPath</span>(<span class="params">start, end, steps</span>) &#123;</span><br><span class="line">    <span class="comment">// 最小水平增量</span></span><br><span class="line">    <span class="keyword">const</span> minDeltaX = (end.<span class="property">x</span> - start.<span class="property">x</span>) / steps;</span><br><span class="line">    <span class="comment">// 最大垂直增量</span></span><br><span class="line">    <span class="keyword">const</span> maxDeltaY = (end.<span class="property">y</span> - start.<span class="property">y</span>) / steps;</span><br><span class="line">    <span class="keyword">const</span> path = [];</span><br><span class="line">    <span class="comment">// 开始节点</span></span><br><span class="line">    path.<span class="title function_">push</span>(start);</span><br><span class="line">    <span class="comment">// 插入点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; steps; i++) &#123;</span><br><span class="line">        <span class="comment">// 横坐标</span></span><br><span class="line">        <span class="keyword">const</span> x = path[i].<span class="property">x</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span> + minDeltaX;</span><br><span class="line">        <span class="comment">// 纵坐标</span></span><br><span class="line">        <span class="keyword">const</span> y = path[i].<span class="property">y</span> +</span><br><span class="line">            <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span> * <span class="title class_">Math</span>.<span class="title function_">pow</span>(-<span class="number">1</span>, ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span> + <span class="number">1</span>)) +</span><br><span class="line">            maxDeltaY;</span><br><span class="line">        path.<span class="title function_">push</span>(&#123;</span><br><span class="line">            x,</span><br><span class="line">            y,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateNumAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>)).<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机大写字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateUpperAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">26</span>) + <span class="number">65</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机小写字母</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateLowerAsChar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">26</span>) + <span class="number">97</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机混合字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">length</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateMix</span>(<span class="params">length = <span class="number">6</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 随机字符串</span></span><br><span class="line">    <span class="keyword">const</span> randomText = [];</span><br><span class="line">    <span class="comment">// 生成器</span></span><br><span class="line">    <span class="keyword">const</span> typeGenerator = [</span><br><span class="line">        generateNumAsChar,</span><br><span class="line">        generateUpperAsChar,</span><br><span class="line">        generateLowerAsChar,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">if</span> (length) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="comment">// 随机位置</span></span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * typeGenerator.<span class="property">length</span>);</span><br><span class="line">            randomText.<span class="title function_">push</span>(typeGenerator[randomIndex]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> randomText.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化日期时间数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">num</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDateNum</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> num &lt; <span class="number">10</span> ? <span class="string">`0<span class="subst">$&#123;num&#125;</span>`</span> : <span class="string">`<span class="subst">$&#123;num&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化日期时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatDateTime() -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatDateTime(new Date()) -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatDateTime(Date.now()) -&gt; &quot;2022-09-01 08:00:00&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatDateTime</span>(<span class="params">time = <span class="built_in">Date</span>.now()</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> d = date.<span class="title function_">getDate</span>();</span><br><span class="line">    <span class="keyword">const</span> m = date.<span class="title function_">getMonth</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> y = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="comment">// 日期</span></span><br><span class="line">    <span class="keyword">const</span> dateText = [y, m, d].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="comment">// 时间</span></span><br><span class="line">    <span class="keyword">const</span> timeText = [h, min, s].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">    <span class="comment">// 日期时间</span></span><br><span class="line">    <span class="keyword">const</span> dateTimeText = <span class="string">`<span class="subst">$&#123;dateText&#125;</span> <span class="subst">$&#123;timeText&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> dateTimeText;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 格式化时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatTime() -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatTime(new Date()) -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> * formatTime(Date.now()) -&gt; &quot;08:00:00&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">formatTime</span> = (<span class="params">time = <span class="built_in">Date</span>.now()</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="comment">// 时间</span></span><br><span class="line">    <span class="keyword">const</span> timeText = [h, min, s].<span class="title function_">map</span>(formatDateNum).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> timeText;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间已过</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">hour</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">minute</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isLate</span>(<span class="params">&#123; hour, minute &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">return</span> h &gt; hour || (h === hour &amp;&amp; min &gt;= minute);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间已过</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">hour</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">minute</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isNow</span>(<span class="params">&#123; hour, minute &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> h = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> min = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> s = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">return</span> h === hour &amp;&amp; min === minute &amp;&amp; s === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 工具函数 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">expires</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">name, value, expires, domain</span>) &#123;</span><br><span class="line">    <span class="comment">// 当前日期</span></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="comment">// 过期日期</span></span><br><span class="line">    date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>() + expires);</span><br><span class="line">    <span class="comment">// 设置cookie</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;name&#125;</span>=<span class="subst">$&#123;value&#125;</span>;expires=<span class="subst">$&#123;date.toUTCString()&#125;</span>;path=/;domain=<span class="subst">$&#123;domain&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取当前所有cookie</span></span><br><span class="line">    <span class="keyword">const</span> strCookies = <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line">    <span class="comment">// 截取变成cookie数组</span></span><br><span class="line">    <span class="keyword">const</span> cookieText = strCookies.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 循环每个cookie</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> cookieText) &#123;</span><br><span class="line">        <span class="comment">// 将cookie截取成两部分</span></span><br><span class="line">        <span class="keyword">const</span> item = cookieText[i].<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="comment">// 判断cookie的name 是否相等</span></span><br><span class="line">        <span class="keyword">if</span> (item[<span class="number">0</span>].<span class="title function_">trim</span>() === name) &#123;</span><br><span class="line">            <span class="keyword">return</span> item[<span class="number">1</span>].<span class="title function_">trim</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 删除cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delCookie</span>(<span class="params">name, domain</span>) &#123;</span><br><span class="line">    <span class="comment">// 存在cookie</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">getCookie</span>(name);</span><br><span class="line">    <span class="keyword">if</span> (value !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">setCookie</span>(name, <span class="string">&#x27;&#x27;</span>, -<span class="number">1</span>, domain);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 防抖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">delay</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 判断是否为移动端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasMobile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> isMobile = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (navigator.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i</span>)) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;移动端&#x27;</span>);</span><br><span class="line">        isMobile = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span> &lt; <span class="number">800</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;小尺寸设备端&#x27;</span>);</span><br><span class="line">        isMobile = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isMobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">time</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="comment">// 延时</span></span><br><span class="line">    <span class="keyword">let</span> timeDelay = <span class="title class_">Number</span>(time);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(timeDelay)) &#123;</span><br><span class="line">        timeDelay = <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timeDelay += <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">500</span> - <span class="number">250</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">        &#125;, timeDelay);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 暂停学习锁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">studyPauseLock</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">const</span> pauseStudy = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (pauseStudy) &#123;</span><br><span class="line">            <span class="keyword">const</span> doing = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 暂停</span></span><br><span class="line">                <span class="keyword">const</span> pauseStudy = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (!pauseStudy) &#123;</span><br><span class="line">                    <span class="comment">// 停止定时器</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(doing);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;学习等待结束!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;学习等待...&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 加载</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">match</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">callback</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">load</span>(<span class="params">match, callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> &#123; href &#125; = <span class="variable language_">window</span>.<span class="property">location</span>;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 函数</span></span><br><span class="line">        <span class="keyword">if</span> (match <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">            <span class="title function_">match</span>(href) &amp;&amp; <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 布尔</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> match === <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">            match &amp;&amp; <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 字符正则</span></span><br><span class="line">        <span class="keyword">if</span> (href.<span class="title function_">match</span>(match)) &#123;</span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 变量 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> href = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> taskConfig = <span class="title function_">reactive</span>([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每日首次登录积1分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">LOGIN</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;文章选读&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每有效阅读一篇文章积1分，上限6分。有效阅读文章累计1分钟积1分，上限6分。每日上限积12分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">READ</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;视听学习&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每有效一个音频或观看一个视频积1分，上限6分。有效收听音频或观看视频累计1分钟积1分，上限6分。每日上限积12分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">WATCH</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;每日答题&#x27;</span>,</span><br><span class="line">        <span class="attr">currentScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">dayMaxScore</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">need</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">status</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">tip</span>: <span class="string">&#x27;每组答题每答对1道积1分。每日上限积5分。&#x27;</span>,</span><br><span class="line">        <span class="attr">percent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">score</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">immutable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> settings = <span class="title function_">reactive</span>([<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 总分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> totalScore = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 当天分数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> todayScore = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> userinfo = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">nick</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 进度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> taskStatus = <span class="title function_">ref</span>(<span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题暂停</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> examPause = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="title function_">ref</span>(!!<span class="title function_">getCookie</span>(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 窗口id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> id = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时刷新列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> scheduleList = <span class="title function_">shallowReactive</span>([]);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 推送token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> pushToken = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新次数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> refreshCount = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 窗口关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> frame = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">show</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">exist</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">closed</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">ele</span>: <span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">src</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> page = <span class="title function_">ref</span>(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 开始登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> loginQRCodeShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 最大选读时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxRead = <span class="title function_">ref</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 最大视听时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> maxWatch = <span class="title function_">ref</span>(<span class="number">120</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 运行其他任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> running = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 主题色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> themeColor = <span class="title function_">ref</span>(<span class="string">&#x27;#fa3333&#x27;</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>  考试类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ExamType</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">ExamType</span>) &#123;</span><br><span class="line">    <span class="title class_">ExamType</span>[<span class="title class_">ExamType</span>[<span class="string">&quot;PRACTICE&quot;</span>] = <span class="number">0</span>] = <span class="string">&quot;PRACTICE&quot;</span>;</span><br><span class="line">    <span class="title class_">ExamType</span>[<span class="title class_">ExamType</span>[<span class="string">&quot;PAPER&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;PAPER&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">ExamType</span> || (<span class="title class_">ExamType</span> = &#123;&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNextButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 答题按钮</span></span><br><span class="line">            <span class="keyword">const</span> nextAll = $$(<span class="string">&#x27;.ant-btn&#x27;</span>).<span class="title function_">filter</span>(<span class="function">(<span class="params">next</span>) =&gt;</span> next.<span class="property">innerText</span>);</span><br><span class="line">            <span class="keyword">if</span> (nextAll.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 停止定时器</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="keyword">if</span> (nextAll.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(nextAll[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">resolve</span>(nextAll[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理滑动验证</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSlideVerify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">async</span> (resolve) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 滑动验证</span></span><br><span class="line">        <span class="keyword">const</span> mask = $$(<span class="string">&#x27;#nc_mask&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (mask &amp;&amp; <span class="title function_">getComputedStyle</span>(mask).<span class="property">display</span> !== <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;等待滑动验证&#x27;</span>);</span><br><span class="line">            <span class="comment">// 提高层级</span></span><br><span class="line">            mask.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">&#x27;999&#x27;</span>;</span><br><span class="line">            <span class="comment">// 轨道</span></span><br><span class="line">            <span class="keyword">const</span> track = (<span class="keyword">await</span> $_(<span class="string">&#x27;.nc_scale&#x27;</span>, <span class="literal">undefined</span>, <span class="number">3000</span>))[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 滑块</span></span><br><span class="line">            <span class="keyword">const</span> slide = (<span class="keyword">await</span> $_(<span class="string">&#x27;.btn_slide&#x27;</span>, <span class="literal">undefined</span>, <span class="number">3000</span>))[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 延时</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">            <span class="comment">// 矩形范围</span></span><br><span class="line">            <span class="keyword">const</span> rectTrack = track.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">            <span class="comment">// 矩形范围</span></span><br><span class="line">            <span class="keyword">const</span> rectSlide = slide.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">            <span class="comment">// 窗口</span></span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">window</span> = unsafeWindow;</span><br><span class="line">            <span class="comment">// 范围内随机起点</span></span><br><span class="line">            <span class="keyword">const</span> start = <span class="title function_">createRandomPoint</span>(rectSlide);</span><br><span class="line">            <span class="comment">// 终点</span></span><br><span class="line">            <span class="keyword">const</span> end = &#123;</span><br><span class="line">                <span class="attr">x</span>: rectTrack.<span class="property">x</span> + rectTrack.<span class="property">width</span>,</span><br><span class="line">                <span class="attr">y</span>: rectTrack.<span class="property">y</span> + rectTrack.<span class="property">height</span> / <span class="number">2</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 路径</span></span><br><span class="line">            <span class="keyword">const</span> path = <span class="title function_">createRandomPath</span>(start, end, <span class="number">10</span>);</span><br><span class="line">            <span class="comment">// 移动端</span></span><br><span class="line">            <span class="keyword">const</span> mobile = <span class="title function_">hasMobile</span>();</span><br><span class="line">            <span class="keyword">if</span> (mobile) &#123;</span><br><span class="line">                slide.<span class="property">style</span>.<span class="property">touchAction</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                <span class="keyword">const</span> touchstartTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                    <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">target</span>: slide,</span><br><span class="line">                    <span class="attr">clientX</span>: path[<span class="number">0</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[<span class="number">0</span>].<span class="property">y</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> touchstartList = [touchstartTouch];</span><br><span class="line">                <span class="comment">// 开始触摸</span></span><br><span class="line">                <span class="keyword">const</span> touchstart = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchstart&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">targetTouches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">touches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">changedTouches</span>: touchstartList,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(touchstart);</span><br><span class="line">                <span class="comment">// 触摸滑动</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> path) &#123;</span><br><span class="line">                    <span class="keyword">const</span> touchmoveTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                        <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">target</span>: slide,</span><br><span class="line">                        <span class="attr">clientX</span>: path[i].<span class="property">x</span>,</span><br><span class="line">                        <span class="attr">clientY</span>: path[i].<span class="property">y</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">const</span> touchmoveList = [touchmoveTouch];</span><br><span class="line">                    <span class="keyword">const</span> touchmove = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchmove&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">targetTouches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">touches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">changedTouches</span>: touchmoveList,</span><br><span class="line">                        <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    slide.<span class="title function_">dispatchEvent</span>(touchmove);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">10</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">const</span> touchendTouch = <span class="keyword">new</span> <span class="title class_">Touch</span>(&#123;</span><br><span class="line">                    <span class="attr">identifier</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">target</span>: slide,</span><br><span class="line">                    <span class="attr">clientX</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">y</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 触摸结束</span></span><br><span class="line">                <span class="keyword">const</span> touchendList = [touchendTouch];</span><br><span class="line">                <span class="comment">// 开始触摸</span></span><br><span class="line">                <span class="keyword">const</span> touchend = <span class="keyword">new</span> <span class="title class_">TouchEvent</span>(<span class="string">&#x27;touchend&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">targetTouches</span>: [],</span><br><span class="line">                    <span class="attr">touches</span>: [],</span><br><span class="line">                    <span class="attr">changedTouches</span>: touchendList,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(touchend);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 鼠标按下</span></span><br><span class="line">                <span class="keyword">const</span> mousedown = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousedown&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">clientX</span>: path[<span class="number">0</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[<span class="number">0</span>].<span class="property">y</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(mousedown);</span><br><span class="line">                <span class="comment">// 鼠标滑动</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> path) &#123;</span><br><span class="line">                    <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">clientX</span>: path[i].<span class="property">x</span>,</span><br><span class="line">                        <span class="attr">clientY</span>: path[i].<span class="property">y</span>,</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    slide.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">10</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 鼠标抬起</span></span><br><span class="line">                <span class="keyword">const</span> mouseup = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mouseup&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">clientX</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">x</span>,</span><br><span class="line">                    <span class="attr">clientY</span>: path[path.<span class="property">length</span> - <span class="number">1</span>].<span class="property">y</span>,</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">view</span>: <span class="variable language_">window</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                slide.<span class="title function_">dispatchEvent</span>(mouseup);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证完成!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 定时器</span></span><br><span class="line">            <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 滑动验证</span></span><br><span class="line">                <span class="keyword">const</span> mask = $$(<span class="string">&#x27;#nc_mask&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (!mask || <span class="title function_">getComputedStyle</span>(mask).<span class="property">display</span> === <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;滑动验证成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证成功!&#x27;</span>);</span><br><span class="line">                    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="literal">false</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;滑动验证失败!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;滑动验证失败!&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理选项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleChoiceBtn</span>(<span class="params">answers</span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 答案存在</span></span><br><span class="line">    <span class="keyword">if</span> (answers.<span class="property">length</span> &amp;&amp; allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 作答</span></span><br><span class="line">        <span class="keyword">return</span> answers.<span class="title function_">every</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 答案存在</span></span><br><span class="line">            <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 包含答案最短长度选项</span></span><br><span class="line">                <span class="keyword">let</span> minLengthChoice;</span><br><span class="line">                <span class="comment">// 遍历</span></span><br><span class="line">                allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> choiceText = choice.<span class="property">innerText</span>.<span class="title function_">trim</span>();</span><br><span class="line">                    <span class="comment">// 无符号选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> unsignedChoiceText = choiceText.<span class="title function_">replaceAll</span>(<span class="regexp">/[、，,。 ]/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 无符号答案</span></span><br><span class="line">                    <span class="keyword">const</span> unsignedAnswer = answer.<span class="title function_">replaceAll</span>(<span class="regexp">/[、，,。 ]/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 包含答案</span></span><br><span class="line">                    <span class="keyword">if</span> (choiceText === answer ||</span><br><span class="line">                        choiceText.<span class="title function_">includes</span>(answer) ||</span><br><span class="line">                        answer.<span class="title function_">includes</span>(choiceText) ||</span><br><span class="line">                        unsignedChoiceText.<span class="title function_">includes</span>(unsignedAnswer)) &#123;</span><br><span class="line">                        <span class="comment">// 最小长度选项有值</span></span><br><span class="line">                        <span class="keyword">if</span> (minLengthChoice) &#123;</span><br><span class="line">                            <span class="comment">// 最短长度选项与当前选项比较长度</span></span><br><span class="line">                            <span class="keyword">if</span> (minLengthChoice.<span class="property">innerText</span>.<span class="property">length</span> &gt; choiceText.<span class="property">length</span>) &#123;</span><br><span class="line">                                minLengthChoice = choice;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// 最小长度选项赋值</span></span><br><span class="line">                            minLengthChoice = choice;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 存在选项</span></span><br><span class="line">                <span class="keyword">if</span> (minLengthChoice) &#123;</span><br><span class="line">                    <span class="comment">// 选择</span></span><br><span class="line">                    <span class="keyword">if</span> (!minLengthChoice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                        minLengthChoice.<span class="title function_">click</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机处理单选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSingleChoiceRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 按钮存在</span></span><br><span class="line">    <span class="keyword">if</span> (allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * allBtns.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">const</span> randBtn = allBtns[index];</span><br><span class="line">        <span class="comment">// 选择</span></span><br><span class="line">        <span class="keyword">if</span> (!randBtn.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">            randBtn.<span class="title function_">click</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 随机处理多选</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleMutiplyChoiceRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 选项按钮</span></span><br><span class="line">    <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">    <span class="comment">// 按钮存在</span></span><br><span class="line">    <span class="keyword">if</span> (allBtns.<span class="property">length</span>) &#123;</span><br><span class="line">        allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">allBtn</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 选择</span></span><br><span class="line">            <span class="keyword">if</span> (!allBtn.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                allBtn.<span class="title function_">click</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理填空</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBlankInput</span> = (<span class="params">answers</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 所有填空</span></span><br><span class="line">    <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;.blank&#x27;</span>);</span><br><span class="line">    <span class="comment">// 答案存在</span></span><br><span class="line">    <span class="keyword">if</span> (blanks.<span class="property">length</span> &amp;&amp; answers.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 填空数量和答案数量一致</span></span><br><span class="line">        <span class="keyword">if</span> (answers.<span class="property">length</span> === blanks.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> answers.<span class="title function_">every</span>(<span class="function">(<span class="params">answer, i</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 答案存在</span></span><br><span class="line">                <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 输入事件</span></span><br><span class="line">                    <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">                        <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// 设置答案</span></span><br><span class="line">                    blanks[i].<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, answer);</span><br><span class="line">                    <span class="comment">// 触发输入input</span></span><br><span class="line">                    blanks[i].<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 填空数量为1和提示数量大于1</span></span><br><span class="line">        <span class="keyword">if</span> (blanks.<span class="property">length</span> === <span class="number">1</span> &amp;&amp; answers.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 直接将所有答案整合填进去</span></span><br><span class="line">            <span class="keyword">const</span> answer = answers.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="comment">// 答案存在</span></span><br><span class="line">            <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="comment">// 输入事件</span></span><br><span class="line">                <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 设置答案</span></span><br><span class="line">                blanks[<span class="number">0</span>].<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, answer);</span><br><span class="line">                <span class="comment">// 触发输入input</span></span><br><span class="line">                blanks[<span class="number">0</span>].<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理填空随机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleBlankInputRand</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 所有填空</span></span><br><span class="line">    <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;.blank&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (blanks.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 输入事件</span></span><br><span class="line">        <span class="keyword">const</span> inputEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        blanks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">blank</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置答案</span></span><br><span class="line">            blank.<span class="title function_">setAttribute</span>(<span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;答案&#x27;</span>);</span><br><span class="line">            <span class="comment">// 触发输入input</span></span><br><span class="line">            blank.<span class="title function_">dispatchEvent</span>(inputEvent);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 暂停锁</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">examPauseLock</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 学习暂停</span></span><br><span class="line">        <span class="keyword">const</span> pauseStudy = (<span class="title function_">GM_getValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>) || <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 全局暂停</span></span><br><span class="line">        <span class="keyword">if</span> (pauseStudy) &#123;</span><br><span class="line">            examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">if</span> (examPause.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;已暂停, 手动开启自动答题! &#x27;</span>, <span class="number">10</span>);</span><br><span class="line">            <span class="keyword">const</span> doing = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!examPause.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="comment">// 停止定时器</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(doing);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答题等待结束!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;已开启, 自动答题!&#x27;</span>);</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (callback &amp;&amp; callback <span class="keyword">instanceof</span> <span class="title class_">Function</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;答题等待...&#x27;</span>);</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doingExam</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="comment">// 下一个按钮</span></span><br><span class="line">    <span class="keyword">let</span> nextButton;</span><br><span class="line">    <span class="comment">// 下一个文本</span></span><br><span class="line">    <span class="keyword">let</span> nextText;</span><br><span class="line">    <span class="comment">// 保存答案</span></span><br><span class="line">    <span class="keyword">let</span> shouldSaveAnswer = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 先等等再开始做题</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2500</span>);</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 获取下一个按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 结束</span></span><br><span class="line">        <span class="keyword">const</span> finish = [<span class="string">&#x27;再练一次&#x27;</span>, <span class="string">&#x27;再来一组&#x27;</span>, <span class="string">&#x27;查看解析&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (finish.<span class="title function_">includes</span>(nextButton.<span class="property">innerText</span>)) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 点击提示</span></span><br><span class="line">        $$(<span class="string">&#x27;.tips&#x27;</span>)[<span class="number">0</span>]?.<span class="title function_">click</span>();</span><br><span class="line">        <span class="comment">// 所有提示</span></span><br><span class="line">        <span class="keyword">const</span> allTips = $$(<span class="string">&#x27;.line-feed font[color]&#x27;</span>);</span><br><span class="line">        <span class="comment">// 答案</span></span><br><span class="line">        <span class="keyword">const</span> answers = allTips.<span class="title function_">map</span>(<span class="function">(<span class="params">tip</span>) =&gt;</span> tip.<span class="property">innerText</span>.<span class="title function_">trim</span>());</span><br><span class="line">        <span class="comment">// 获取题目的文本内容</span></span><br><span class="line">        <span class="keyword">const</span> question = $$(<span class="string">&#x27;.q-body&#x27;</span>)[<span class="number">0</span>].<span class="property">innerText</span>;</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 选项按钮</span></span><br><span class="line">        <span class="keyword">const</span> allBtns = $$(<span class="string">&#x27;.q-answer&#x27;</span>);</span><br><span class="line">        <span class="comment">// 所有填空</span></span><br><span class="line">        <span class="keyword">const</span> blanks = $$(<span class="string">&#x27;input[type=text][class=blank]&#x27;</span>);</span><br><span class="line">        <span class="comment">// 问题类型</span></span><br><span class="line">        <span class="keyword">const</span> questionType = ($$(<span class="string">&#x27;.q-header&#x27;</span>)[<span class="number">0</span>].<span class="property">innerText</span>.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 题型分类作答</span></span><br><span class="line">        <span class="keyword">switch</span> (questionType) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;填空题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleBlankInput</span>(answers);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 根据题库作答</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleBlankInput</span>(answersNetwork);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleBlankInputRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;多选题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 选项文本</span></span><br><span class="line">                    <span class="keyword">const</span> choicesText = allBtns.<span class="title function_">map</span>(<span class="function">(<span class="params">btn</span>) =&gt;</span> btn.<span class="property">innerText</span>);</span><br><span class="line">                    <span class="comment">// 选项内容</span></span><br><span class="line">                    <span class="keyword">const</span> choicesContent = choicesText</span><br><span class="line">                        .<span class="title function_">map</span>(<span class="function">(<span class="params">choiceText</span>) =&gt;</span> choiceText.<span class="title function_">split</span>(<span class="regexp">/[A-Z]./</span>)[<span class="number">1</span>].<span class="title function_">trim</span>())</span><br><span class="line">                        .<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 空格</span></span><br><span class="line">                    <span class="keyword">const</span> blanks = question.<span class="title function_">match</span>(<span class="regexp">/（）/g</span>);</span><br><span class="line">                    <span class="comment">// 填空数量、选项数量、答案数量相同 | 选项全文等于答案全文</span></span><br><span class="line">                    <span class="keyword">if</span> ((blanks &amp;&amp; allBtns.<span class="property">length</span> === blanks.<span class="property">length</span>) ||</span><br><span class="line">                        question === choicesContent ||</span><br><span class="line">                        allBtns.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="comment">// 全选</span></span><br><span class="line">                        allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!choice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                                choice.<span class="title function_">click</span>();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 选项数量大于等于答案</span></span><br><span class="line">                    <span class="keyword">if</span> (allBtns.<span class="property">length</span> &gt;= answers.<span class="property">length</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answers);</span><br><span class="line">                        <span class="comment">// 成功</span></span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 答案存在</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answersNetwork);</span><br><span class="line">                    <span class="comment">// 成功</span></span><br><span class="line">                    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleMutiplyChoiceRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;单选题&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// 根据提示作答</span></span><br><span class="line">                <span class="keyword">if</span> (answers.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示为1</span></span><br><span class="line">                    <span class="keyword">if</span> (answers.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answers);</span><br><span class="line">                        <span class="comment">// 成功</span></span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 可能的分隔符</span></span><br><span class="line">                        <span class="keyword">const</span> seperator = [</span><br><span class="line">                            <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;、&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                        ];</span><br><span class="line">                        <span class="comment">// 可能的答案</span></span><br><span class="line">                        <span class="keyword">const</span> answersLike = seperator</span><br><span class="line">                            .<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> answers.<span class="title function_">join</span>(s).<span class="title function_">trim</span>())</span><br><span class="line">                            .<span class="title function_">filter</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> answer.<span class="property">length</span>);</span><br><span class="line">                        <span class="comment">// 答案存在</span></span><br><span class="line">                        <span class="keyword">if</span> (answersLike.<span class="property">length</span>) &#123;</span><br><span class="line">                            <span class="comment">// 可能答案是否正确</span></span><br><span class="line">                            <span class="keyword">const</span> res = answersLike.<span class="title function_">some</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">                                <span class="comment">// 尝试查找点击</span></span><br><span class="line">                                <span class="keyword">return</span> <span class="title function_">handleChoiceBtn</span>([answer]);</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;答案异常, 尝试网络题库获取!&#x27;</span>);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在获取答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 尝试题库获取</span></span><br><span class="line">                <span class="keyword">const</span> answersNetwork = <span class="keyword">await</span> <span class="title function_">getAnswer</span>(question);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`获取答案<span class="subst">$&#123;answersNetwork.length ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123;</span><br><span class="line">                    question,</span><br><span class="line">                    answersNetwork,</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 存在答案</span></span><br><span class="line">                <span class="keyword">if</span> (answersNetwork.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="comment">// 单答案单选项</span></span><br><span class="line">                    <span class="keyword">if</span> (answersNetwork.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// 尝试查找点击</span></span><br><span class="line">                        <span class="keyword">const</span> res = <span class="title function_">handleChoiceBtn</span>(answersNetwork);</span><br><span class="line">                        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 多答案单选项 选项意外拆分</span></span><br><span class="line">                        <span class="comment">// 可能分隔符</span></span><br><span class="line">                        <span class="keyword">const</span> seperator = [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27; &#x27;</span>];</span><br><span class="line">                        <span class="comment">// 可能答案</span></span><br><span class="line">                        <span class="keyword">const</span> answersLike = seperator.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> answers.<span class="title function_">join</span>(s));</span><br><span class="line">                        <span class="comment">// 答案存在</span></span><br><span class="line">                        <span class="keyword">if</span> (answersLike.<span class="title function_">every</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> answer.<span class="property">length</span>)) &#123;</span><br><span class="line">                            <span class="comment">// 可能答案是否正确</span></span><br><span class="line">                            <span class="keyword">const</span> res = answersLike.<span class="title function_">some</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">                                <span class="comment">// 尝试查找点击</span></span><br><span class="line">                                <span class="keyword">return</span> <span class="title function_">handleChoiceBtn</span>([answer]);</span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 随机作答</span></span><br><span class="line">                <span class="keyword">if</span> (type === <span class="title class_">ExamType</span>.<span class="property">PRACTICE</span> || settings[<span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>]) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;答案不存在, 随机作答!&#x27;</span>);</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handleSingleChoiceRand</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: <span class="string">&#x27;答题存在异常, 已暂停答题!&#x27;</span>,</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    examPause.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 提交答案</span></span><br><span class="line">                    shouldSaveAnswer = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">        <span class="comment">// 获取下一个按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 需要提交答案</span></span><br><span class="line">        <span class="keyword">if</span> (shouldSaveAnswer) &#123;</span><br><span class="line">            <span class="comment">// 答案</span></span><br><span class="line">            <span class="keyword">const</span> answers = [];</span><br><span class="line">            <span class="keyword">if</span> (questionType === <span class="string">&#x27;填空题&#x27;</span>) &#123;</span><br><span class="line">                blanks.<span class="title function_">forEach</span>(<span class="function">(<span class="params">blank</span>) =&gt;</span> &#123;</span><br><span class="line">                    answers.<span class="title function_">push</span>(blank.<span class="property">value</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (questionType === <span class="string">&#x27;单选题&#x27;</span> || questionType === <span class="string">&#x27;多选题&#x27;</span>) &#123;</span><br><span class="line">                allBtns.<span class="title function_">forEach</span>(<span class="function">(<span class="params">choice</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (choice.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;chosen&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// 带字母的选项</span></span><br><span class="line">                        <span class="keyword">const</span> answerTemp = choice.<span class="property">innerText</span>;</span><br><span class="line">                        <span class="comment">// 从字符串中拿出答案</span></span><br><span class="line">                        <span class="keyword">const</span> [, answer] = answerTemp.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (answer &amp;&amp; answer.<span class="property">length</span>) &#123;</span><br><span class="line">                            answers.<span class="title function_">push</span>(answer);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 答案</span></span><br><span class="line">            <span class="keyword">const</span> answer = answers.<span class="title function_">join</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">            <span class="comment">// 存在答案</span></span><br><span class="line">            <span class="keyword">if</span> (answer.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;正在上传答案...&#x27;</span>);</span><br><span class="line">                <span class="comment">// 上传答案</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">saveAnswer</span>(question, answer);</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">`上传答案<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123; question, answer &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 重置</span></span><br><span class="line">            shouldSaveAnswer = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 确定</span></span><br><span class="line">        <span class="keyword">if</span> (nextText === <span class="string">&#x27;确定&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 确认</span></span><br><span class="line">            nextButton.<span class="title function_">click</span>();</span><br><span class="line">            <span class="comment">// 等待一段时间</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">            <span class="comment">// 暂停</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">examPauseLock</span>();</span><br><span class="line">            <span class="comment">// 答案解析</span></span><br><span class="line">            <span class="keyword">const</span> answerBox = $$(<span class="string">&#x27;.answer&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 答题错误</span></span><br><span class="line">            <span class="keyword">if</span> (answerBox) &#123;</span><br><span class="line">                <span class="keyword">const</span> answerTemp = answerBox.<span class="property">innerText</span>;</span><br><span class="line">                <span class="comment">// 从字符串中拿出答案</span></span><br><span class="line">                <span class="keyword">const</span> [, answerText] = answerTemp.<span class="title function_">split</span>(<span class="string">&#x27;：&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (answerText &amp;&amp; answerText.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> answer = answerText.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;正在上传答案...&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 上传答案</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">saveAnswer</span>(question, answer);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">`上传答案<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>, &#123; question, answer &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取按钮</span></span><br><span class="line">        nextButton = <span class="keyword">await</span> <span class="title function_">getNextButton</span>();</span><br><span class="line">        <span class="comment">// 下一个文本</span></span><br><span class="line">        nextText = nextButton.<span class="property">innerText</span>.<span class="title function_">replaceAll</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (nextText === <span class="string">&#x27;下一题&#x27;</span> || nextText === <span class="string">&#x27;完成&#x27;</span> || nextText === <span class="string">&#x27;交卷&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 等待一段时间</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2500</span>);</span><br><span class="line">            <span class="comment">// 下一题</span></span><br><span class="line">            nextButton.<span class="title function_">click</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 滑动验证</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">handleSlideVerify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭任务窗口</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 每日答题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doExamPractice</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 暂停</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在每日答题...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;正在每日答题&#x27;</span>);</span><br><span class="line">    <span class="comment">// 链接</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="variable constant_">URL_CONFIG</span>.<span class="property">examPractice</span>;</span><br><span class="line">    <span class="comment">// 等待任务窗口</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;每日答题&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;完成每日答题!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 等待一段时间</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">    <span class="comment">// 刷新分数数据</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">    <span class="comment">// 刷新任务数据</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">        !taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续每日答题!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续每日答题!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">doExamPractice</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 专项练习</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doExamPaper</span>(<span class="params"></span>) &#123;</span><br><span class="line">    running.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在专项练习...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;正在专项练习&#x27;</span>);</span><br><span class="line">    <span class="comment">// id</span></span><br><span class="line">    <span class="keyword">const</span> examPaperId = <span class="keyword">await</span> <span class="title function_">findExamPaper</span>();</span><br><span class="line">    <span class="keyword">if</span> (examPaperId) &#123;</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;URL_CONFIG.examPaper&#125;</span>?id=<span class="subst">$&#123;examPaperId&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`链接: <span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line">        <span class="comment">// 等待窗口任务</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;专项练习&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;完成专项练习!&#x27;</span>);</span><br><span class="line">        running.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 同屏任务</span></span><br><span class="line">        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">            <span class="comment">// 窗口不存在</span></span><br><span class="line">            frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    running.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;专项练习均已完成!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化总页数属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">initExam</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 默认从第一页获取全部页属性</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getExamPaper</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="comment">// 等待</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> data.<span class="property">totalPageCount</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 查询专项练习列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">findExamPaper</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取总页数</span></span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> <span class="title function_">initExam</span>();</span><br><span class="line">    <span class="comment">// 当前页数</span></span><br><span class="line">    <span class="keyword">let</span> current = <span class="number">1</span>;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`正在寻找的专项练习...`</span>);</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">`正在寻找的专项练习...`</span>);</span><br><span class="line">    <span class="keyword">while</span> (current &lt;= total &amp;&amp; current) &#123;</span><br><span class="line">        <span class="comment">// 请求数据</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getExamPaper</span>(current);</span><br><span class="line">        <span class="keyword">if</span> (data) &#123;</span><br><span class="line">            <span class="comment">// 获取专项练习的列表</span></span><br><span class="line">            <span class="keyword">const</span> examPapers = data.<span class="property">list</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> examPapers) &#123;</span><br><span class="line">                <span class="comment">// 遍历查询有没有没做过的</span></span><br><span class="line">                <span class="keyword">if</span> (examPapers[i].<span class="property">status</span> !== <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="comment">// status： 1 开始答题, 2 已满分/重新答题, 3 继续答题</span></span><br><span class="line">                    <span class="keyword">return</span> examPapers[i].<span class="property">id</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 增加页码</span></span><br><span class="line">            current += <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 等待</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">3000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化主页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMainListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 监听关闭</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = msg;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">id</span> === id.<span class="property">value</span> &amp;&amp; data.<span class="property">closed</span>) &#123;</span><br><span class="line">            <span class="comment">// 关闭窗口</span></span><br><span class="line">            <span class="title function_">closeFrame</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 初始化子页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initChildListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = msg;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">id</span> &amp;&amp; !data.<span class="property">closed</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置窗口id</span></span><br><span class="line">            id.<span class="property">value</span> = data.<span class="property">id</span>;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">`初始化窗口 ID: <span class="subst">$&#123;id.value&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开窗口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">url</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">openFrame</span>(<span class="params">url, title</span>) &#123;</span><br><span class="line">    <span class="comment">// 设置 URL</span></span><br><span class="line">    frame.<span class="property">src</span> = url;</span><br><span class="line">    <span class="comment">// 等待元素</span></span><br><span class="line">    <span class="keyword">await</span> $_(<span class="string">&#x27;.egg_frame&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (frame.<span class="property">ele</span>) &#123;</span><br><span class="line">        <span class="comment">// id</span></span><br><span class="line">        id.<span class="property">value</span> = <span class="title function_">generateMix</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 打开</span></span><br><span class="line">        frame.<span class="property">closed</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 设置标题</span></span><br><span class="line">        frame.<span class="property">title</span> = title || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="comment">// 等待页面加载</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitFrameLoaded</span>(frame.<span class="property">ele</span>);</span><br><span class="line">        <span class="comment">// 发送窗口 ID</span></span><br><span class="line">        frame.<span class="property">ele</span>.<span class="property">contentWindow</span>?.<span class="title function_">postMessage</span>(&#123; <span class="attr">id</span>: id.<span class="property">value</span>, <span class="attr">closed</span>: <span class="literal">false</span> &#125;, url);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`关闭窗口 ID: <span class="subst">$&#123;id.value&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 窗口显示</span></span><br><span class="line">    frame.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 关闭</span></span><br><span class="line">    frame.<span class="property">closed</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 标题</span></span><br><span class="line">    frame.<span class="property">title</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// src</span></span><br><span class="line">    frame.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭 frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">parent</span>.<span class="title function_">postMessage</span>(&#123; <span class="attr">id</span>: id.<span class="property">value</span>, <span class="attr">closed</span>: <span class="literal">true</span> &#125;, <span class="variable constant_">URL_CONFIG</span>.<span class="property">homeOrigin</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待窗口任务结束</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">id</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitFrameClose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 窗口关闭</span></span><br><span class="line">            <span class="keyword">if</span> (frame.<span class="property">closed</span>) &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等待窗口加载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitFrameLoaded</span>(<span class="params">iframe</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        iframe.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开新窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openWin</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">GM_openInTab</span>(url, &#123;</span><br><span class="line">        <span class="attr">active</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">insert</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">setParent</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    page.<span class="property">value</span> &amp;&amp; page.<span class="property">value</span>.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭子窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">opener</span> = <span class="variable language_">window</span>;</span><br><span class="line">        <span class="keyword">const</span> win = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;_self&#x27;</span>);</span><br><span class="line">        win?.<span class="title function_">close</span>();</span><br><span class="line">        top?.<span class="title function_">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 等待窗口关闭</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">newPage</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">waitWinClose</span>(<span class="params">newPage</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        newPage.<span class="property">onclose</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭任务窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeTaskWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp; id.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">closeFrame</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 非同屏任务</span></span><br><span class="line">    <span class="title function_">closeWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 关闭任务窗口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCloseTaskWin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp; id.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="title function_">handleCloseFrame</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子窗口</span></span><br><span class="line">    <span class="title function_">handleCloseWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 打开并等待任务结束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">waitTaskWin</span>(<span class="params">url, title</span>) &#123;</span><br><span class="line">    <span class="comment">// 同屏任务</span></span><br><span class="line">    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">        <span class="comment">// 窗口存在</span></span><br><span class="line">        frame.<span class="property">exist</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// 显示窗体</span></span><br><span class="line">        frame.<span class="property">show</span> = !settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>];</span><br><span class="line">        <span class="comment">// 新窗口</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">openFrame</span>(url, title);</span><br><span class="line">        <span class="keyword">if</span> (res) &#123;</span><br><span class="line">            <span class="comment">// 等待窗口关闭</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">waitFrameClose</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 子页面任务</span></span><br><span class="line">    page.<span class="property">value</span> = <span class="title function_">openWin</span>(url);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitWinClose</span>(page.<span class="property">value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 二维码刷新定时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> refreshTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> tryLoginTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getQRCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在生成登录二维码...&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> qrCode = <span class="keyword">await</span> <span class="title function_">generateQRCode</span>();</span><br><span class="line">    <span class="keyword">if</span> (qrCode) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;生成登录二维码成功!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`https://login.xuexi.cn/login/qrcommit?showmenu=false&amp;code=<span class="subst">$&#123;qrCode&#125;</span>&amp;appId=dingoankubyrfkttorhpou`</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">code</span>: qrCode,</span><br><span class="line">            <span class="attr">src</span>: <span class="string">`<span class="subst">$&#123;API_CONFIG.qrcode&#125;</span>?data=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(url)&#125;</span>`</span>,</span><br><span class="line">            url,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;生成登录二维码失败!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 验证登录二维码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">code</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkQRCode</span>(<span class="params">code</span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;尝试用二维码登录...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 二维码登录</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">loginWithQRCode</span>(code);</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data, code, success &#125; = res;</span><br><span class="line">        <span class="comment">// 临时登录验证码</span></span><br><span class="line">        <span class="keyword">if</span> (success &amp;&amp; data) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 二维码失效</span></span><br><span class="line">        <span class="keyword">if</span> (code === <span class="string">&#x27;11019&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 清除定时</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(tryLoginTimer);</span><br><span class="line">        <span class="comment">// 设置定时</span></span><br><span class="line">        tryLoginTimer = <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="keyword">await</span> <span class="title function_">checkQRCode</span>(code));</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试二维码登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">tryLogin</span>(<span class="params">checkCode</span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;正在获取签名...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取签名</span></span><br><span class="line">    <span class="keyword">const</span> sign = <span class="keyword">await</span> <span class="title function_">getSign</span>();</span><br><span class="line">    <span class="keyword">if</span> (sign) &#123;</span><br><span class="line">        <span class="comment">// 生成uuid</span></span><br><span class="line">        <span class="keyword">const</span> uuid = crypto.<span class="title function_">randomUUID</span>();</span><br><span class="line">        <span class="keyword">const</span> [, code] = checkCode.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> state = <span class="string">`<span class="subst">$&#123;sign&#125;</span><span class="subst">$&#123;uuid&#125;</span>`</span>;</span><br><span class="line">        <span class="comment">// 安全检查</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">secureCheck</span>(&#123; code, state &#125;);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新登录二维码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除刷新</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(refreshTimer);</span><br><span class="line">    <span class="comment">// 每隔一段时间刷新</span></span><br><span class="line">    refreshTimer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 刷新二维码</span></span><br><span class="line">        <span class="title function_">handleLogin</span>();</span><br><span class="line">    &#125;, autoRefreshQRCodeInterval);</span><br><span class="line">    <span class="comment">// 是否超出次数</span></span><br><span class="line">    <span class="keyword">if</span> (refreshCount.<span class="property">value</span> &gt;= maxRefreshCount) &#123;</span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;超过最大重试次数, 登录失败!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 重置刷新数</span></span><br><span class="line">        refreshCount.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 隐藏二维码</span></span><br><span class="line">        loginQRCodeShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 远程推送</span></span><br><span class="line">        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">            <span class="comment">// 推送</span></span><br><span class="line">            <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                <span class="attr">content</span>: <span class="string">&#x27;超过最大重试次数, 登录失败!&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">            &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 配置</span></span><br><span class="line">    <span class="keyword">const</span> imgWrap = $$(<span class="string">&#x27;.egg_login_img_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 图片</span></span><br><span class="line">    <span class="keyword">const</span> img = $$(<span class="string">&#x27;.egg_login_img&#x27;</span>, imgWrap)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (imgWrap &amp;&amp; img) &#123;</span><br><span class="line">        <span class="comment">// 刷新二维码</span></span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;刷新登录二维码!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 刷新次数累加</span></span><br><span class="line">        refreshCount.<span class="property">value</span>++;</span><br><span class="line">        <span class="comment">// 获取二维码</span></span><br><span class="line">        <span class="keyword">const</span> qrCode = <span class="keyword">await</span> <span class="title function_">getQRCode</span>();</span><br><span class="line">        <span class="keyword">if</span> (qrCode) &#123;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            <span class="keyword">const</span> &#123; src, code, url &#125; = qrCode;</span><br><span class="line">            <span class="comment">// src</span></span><br><span class="line">            img.<span class="property">src</span> = src;</span><br><span class="line">            <span class="comment">// 开始登录</span></span><br><span class="line">            loginQRCodeShow.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 远程推送</span></span><br><span class="line">            <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                <span class="comment">// img html</span></span><br><span class="line">                <span class="keyword">const</span> imgWrap = <span class="title function_">getImgHTML</span>(src);</span><br><span class="line">                <span class="comment">// 跳转链接</span></span><br><span class="line">                <span class="keyword">const</span> aWrap = <span class="string">`</span></span><br><span class="line"><span class="string">   &lt;div&gt;</span></span><br><span class="line"><span class="string">      或在浏览器</span></span><br><span class="line"><span class="string">      &lt;a</span></span><br><span class="line"><span class="string">        href=&quot;dtxuexi://appclient/page/study_feeds?url=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(url)&#125;</span>&quot;</span></span><br><span class="line"><span class="string">        style=&quot;text-decoration: none&quot;</span></span><br><span class="line"><span class="string">        &gt;<span class="subst">$&#123;getHighlightHTML(<span class="string">&#x27;打开学习强国APP&#x27;</span>)&#125;</span>&lt;/a</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">                <span class="comment">// 推送</span></span><br><span class="line">                <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                    <span class="attr">content</span>: [<span class="string">&#x27;扫一扫, 登录学习强国!&#x27;</span>, aWrap, imgWrap],</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">                &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取验证码</span></span><br><span class="line">            <span class="keyword">const</span> checkCode = <span class="keyword">await</span> <span class="title function_">checkQRCode</span>(code);</span><br><span class="line">            <span class="comment">// 验证成功</span></span><br><span class="line">            <span class="keyword">if</span> (checkCode) &#123;</span><br><span class="line">                <span class="comment">// 尝试登录</span></span><br><span class="line">                <span class="keyword">const</span> loginRes = <span class="keyword">await</span> <span class="title function_">tryLogin</span>(checkCode);</span><br><span class="line">                <span class="keyword">if</span> (loginRes) &#123;</span><br><span class="line">                    <span class="comment">// 清除刷新</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(refreshTimer);</span><br><span class="line">                    <span class="comment">// 二维码显示</span></span><br><span class="line">                    loginQRCodeShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">// 登录成功</span></span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;登录成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;登录成功!&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 登录成功</span></span><br><span class="line">                    login.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 刷新用户信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshUserInfo</span>();</span><br><span class="line">                    <span class="comment">// 刷新分数信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">                    <span class="comment">// 刷新任务信息</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">                    <span class="comment">// 远程推送</span></span><br><span class="line">                    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                            <span class="attr">title</span>: <span class="string">&#x27;登录推送&#x27;</span>,</span><br><span class="line">                            <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                            <span class="attr">content</span>: [</span><br><span class="line">                                <span class="string">&#x27;学习强国, 登录成功!&#x27;</span>,</span><br><span class="line">                                <span class="string">`当天积分:  <span class="subst">$&#123;getHighlightHTML(todayScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                                <span class="string">`总积分: <span class="subst">$&#123;getHighlightHTML(totalScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                                ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">getProgressHTML</span>(task.<span class="property">title</span>, task.<span class="property">percent</span>)),</span><br><span class="line">                            ],</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                        &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">`登录推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 二维码失效</span></span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;登录二维码失效!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 二维码失效刷新</span></span><br><span class="line">            <span class="title function_">handleLogin</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 退出登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleLogout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 删除token</span></span><br><span class="line">    <span class="title function_">delCookie</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;.xuexi.cn&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭窗口</span></span><br><span class="line">    <span class="title function_">closeFrame</span>();</span><br><span class="line">    frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    login.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 清除用户信息</span></span><br><span class="line">    userinfo.<span class="property">nick</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    userinfo.<span class="property">avatar</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 总分</span></span><br><span class="line">    totalScore.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 当天分数</span></span><br><span class="line">    todayScore.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 任务进度重置</span></span><br><span class="line">    taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> &#123;</span><br><span class="line">        task.<span class="property">percent</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span>;</span><br><span class="line">    <span class="comment">// 退出登录</span></span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;退出登录&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 新闻</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> news = [];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> videos = [];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// section</span></span><br><span class="line">    <span class="keyword">const</span> sections = <span class="keyword">await</span> $_(<span class="string">&#x27;section&#x27;</span>, <span class="literal">undefined</span>, <span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">const</span> section = sections[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (!(section &amp;&amp; section.<span class="property">innerText</span>.<span class="title function_">includes</span>(<span class="string">&#x27;系统正在维护中&#x27;</span>))) &#123;</span><br><span class="line">        <span class="comment">// 文章选读</span></span><br><span class="line">        <span class="title function_">reading</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;未找到文章!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="title function_">createTip</span>(<span class="string">&#x27;未找到文章!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭页面</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 处理视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handleVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// videos</span></span><br><span class="line">    <span class="keyword">const</span> videos = <span class="keyword">await</span> $_(<span class="string">&#x27;video&#x27;</span>, <span class="literal">undefined</span>, <span class="number">10000</span>);</span><br><span class="line">    <span class="comment">// 视频</span></span><br><span class="line">    <span class="keyword">const</span> video = videos[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 播放按键</span></span><br><span class="line">    <span class="keyword">const</span> playBtn = $$(<span class="string">&#x27;.prism-play-btn&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (video &amp;&amp; playBtn) &#123;</span><br><span class="line">        <span class="comment">// 设置是否静音</span></span><br><span class="line">        video.<span class="property">muted</span> = muted;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;正在尝试播放视频...&#x27;</span>);</span><br><span class="line">        <span class="comment">// 播放超时</span></span><br><span class="line">        <span class="keyword">const</span> timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;视频播放超时!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">&#x27;视频播放超时!&#x27;</span>);</span><br><span class="line">            <span class="comment">// 关闭页面</span></span><br><span class="line">            <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">        &#125;, <span class="number">20000</span>);</span><br><span class="line">        <span class="comment">// 能播放</span></span><br><span class="line">        video.<span class="title function_">addEventListener</span>(<span class="string">&#x27;canplay&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">&#x27;正在尝试播放视频...&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (video.<span class="property">paused</span>) &#123;</span><br><span class="line">                <span class="comment">// 尝试使用js的方式播放</span></span><br><span class="line">                video.<span class="title function_">play</span>();</span><br><span class="line">                <span class="keyword">if</span> (video.<span class="property">paused</span>) &#123;</span><br><span class="line">                    <span class="comment">// 尝试点击播放按钮播放</span></span><br><span class="line">                    playBtn.<span class="title function_">click</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已经播放</span></span><br><span class="line">            <span class="keyword">if</span> (!video.<span class="property">paused</span>) &#123;</span><br><span class="line">                <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">                <span class="comment">// 视听学习</span></span><br><span class="line">                <span class="title function_">reading</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;未找到视频!&#x27;</span>);</span><br><span class="line">    <span class="comment">// 关闭页面</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 读新闻或者看视频</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type :0为新闻,1为视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">reading</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> time = <span class="number">30</span>;</span><br><span class="line">    <span class="comment">// 文章选读</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 章节</span></span><br><span class="line">        <span class="keyword">const</span> sections = $$(<span class="string">&#x27;section&#x27;</span>);</span><br><span class="line">        <span class="comment">// 最大字数</span></span><br><span class="line">        <span class="keyword">const</span> maxTextCount = <span class="title class_">Math</span>.<span class="title function_">max</span>(...sections.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s.<span class="property">innerText</span>.<span class="property">length</span>), <span class="number">200</span>);</span><br><span class="line">        <span class="comment">// 预计时间</span></span><br><span class="line">        <span class="keyword">const</span> predictTime = ~~((<span class="number">60</span> * maxTextCount) / <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// min(predictTime,  maxWatch.value) 秒后关闭页面</span></span><br><span class="line">        time = <span class="title class_">Math</span>.<span class="title function_">min</span>(predictTime, maxRead.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 视听学习</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 视频</span></span><br><span class="line">        <span class="keyword">const</span> video = $$(<span class="string">&#x27;video&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 预计时间</span></span><br><span class="line">        <span class="keyword">const</span> predictTime = ~~video.<span class="property">duration</span>;</span><br><span class="line">        <span class="comment">// min(predictTime,  maxWatch.value) 秒后关闭页面</span></span><br><span class="line">        time = <span class="title class_">Math</span>.<span class="title function_">min</span>(predictTime, maxWatch.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 随机</span></span><br><span class="line">    time = time - ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) + <span class="number">5</span>;</span><br><span class="line">    <span class="comment">// 第一次滚动时间</span></span><br><span class="line">    <span class="keyword">const</span> firstTime = time - (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>) + <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// 第二次滚动时间</span></span><br><span class="line">    <span class="keyword">const</span> secendTime = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>) + <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 窗口</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable language_">window</span> = unsafeWindow;</span><br><span class="line">    <span class="comment">// 创建提示</span></span><br><span class="line">    <span class="keyword">const</span> tip = <span class="title function_">createTip</span>(<span class="string">&#x27;距离关闭页面还剩&#x27;</span>, time, <span class="literal">true</span>, <span class="keyword">async</span> (time) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 暂停锁</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>(<span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 视频</span></span><br><span class="line">                <span class="keyword">const</span> video = $$(<span class="string">&#x27;video&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">// 排除反复设置</span></span><br><span class="line">                <span class="keyword">if</span> (video.<span class="property">paused</span> === !flag) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 设置播放状态</span></span><br><span class="line">                video[flag ? <span class="string">&#x27;play&#x27;</span> : <span class="string">&#x27;pause&#x27;</span>]();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 第一次滚动</span></span><br><span class="line">        <span class="keyword">if</span> (time === firstTime) &#123;</span><br><span class="line">            <span class="comment">// 滚动</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="number">400</span>);</span><br><span class="line">            <span class="comment">// 模拟滚动</span></span><br><span class="line">            <span class="keyword">const</span> scroll = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;scroll&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(scroll);</span><br><span class="line">            <span class="comment">// 模拟滑动</span></span><br><span class="line">            <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">            <span class="comment">// 模拟点击</span></span><br><span class="line">            <span class="keyword">const</span> click = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(click);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 第二次滚动</span></span><br><span class="line">        <span class="keyword">if</span> (time === secendTime) &#123;</span><br><span class="line">            <span class="comment">// 滚动长度</span></span><br><span class="line">            <span class="keyword">const</span> scrollLength = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollHeight</span> / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 滚动</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, scrollLength);</span><br><span class="line">            <span class="comment">// 模拟滚动</span></span><br><span class="line">            <span class="keyword">const</span> scroll = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;scroll&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(scroll);</span><br><span class="line">            <span class="comment">// 模拟滑动</span></span><br><span class="line">            <span class="keyword">const</span> mousemove = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;mousemove&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(mousemove);</span><br><span class="line">            <span class="comment">// 模拟点击</span></span><br><span class="line">            <span class="keyword">const</span> click = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">bubbles</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(click);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 倒计时结束</span></span><br><span class="line">    <span class="keyword">await</span> tip.<span class="title function_">waitCountDown</span>();</span><br><span class="line">    <span class="comment">// 关闭任务窗口</span></span><br><span class="line">    <span class="title function_">handleCloseTaskWin</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取新闻列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 需要学习的新闻数量</span></span><br><span class="line">    <span class="keyword">const</span> need = taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span> &lt; maxNewsNum</span><br><span class="line">        ? taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span></span><br><span class="line">        : maxNewsNum;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`剩余 <span class="subst">$&#123;need&#125;</span> 个新闻`</span>);</span><br><span class="line">    <span class="comment">// 获取新闻</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getNewsList</span>();</span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 索引</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 最新新闻</span></span><br><span class="line">        <span class="keyword">const</span> latestItems = data.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 当前年份</span></span><br><span class="line">        <span class="keyword">const</span> currentYear = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>().<span class="title function_">toString</span>();</span><br><span class="line">        <span class="comment">// 查找今年新闻</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; need) &#123;</span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * latestItems.<span class="property">length</span>);</span><br><span class="line">            <span class="comment">// 新闻</span></span><br><span class="line">            <span class="keyword">const</span> item = latestItems[randomIndex];</span><br><span class="line">            <span class="comment">// 是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">publishTime</span>.<span class="title function_">startsWith</span>(currentYear) &amp;&amp; item.<span class="property">type</span> === <span class="string">&#x27;tuwen&#x27;</span>) &#123;</span><br><span class="line">                news[i] = item;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        news = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 获取视频列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getVideos</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 需要学习的视频数量</span></span><br><span class="line">    <span class="keyword">const</span> need = taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span> &lt; maxVideoNum</span><br><span class="line">        ? taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span></span><br><span class="line">        : maxVideoNum;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">`剩余 <span class="subst">$&#123;need&#125;</span> 个视频`</span>);</span><br><span class="line">    <span class="comment">// 获取视频</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getVideoList</span>();</span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="comment">// 索引</span></span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 最新视频</span></span><br><span class="line">        <span class="keyword">const</span> latestItems = data.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 当前年份</span></span><br><span class="line">        <span class="keyword">const</span> currentYear = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>().<span class="title function_">toString</span>();</span><br><span class="line">        <span class="comment">// 查找今年视频</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; need) &#123;</span><br><span class="line">            <span class="keyword">const</span> randomIndex = ~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * latestItems.<span class="property">length</span>);</span><br><span class="line">            <span class="comment">// 新闻</span></span><br><span class="line">            <span class="keyword">const</span> item = latestItems[randomIndex];</span><br><span class="line">            <span class="comment">// 是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">publishTime</span>.<span class="title function_">startsWith</span>(currentYear) &amp;&amp;</span><br><span class="line">                (item.<span class="property">type</span> === <span class="string">&#x27;shipin&#x27;</span> || item.<span class="property">type</span> === <span class="string">&#x27;juji&#x27;</span>)) &#123;</span><br><span class="line">                videos[i] = item;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        videos = [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 阅读文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取文章</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getNews</span>();</span><br><span class="line">    <span class="comment">// 观看文章</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> news) &#123;</span><br><span class="line">        <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`正在阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻...`</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`正在阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻`</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> &#123; url &#125; = news[i];</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>, url);</span><br><span class="line">        <span class="comment">// 等待任务窗口</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;文章选读&#x27;</span>);</span><br><span class="line">        <span class="comment">// 清空链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;readingUrl&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`完成阅读第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个新闻!`</span>);</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 刷新分数数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">        <span class="comment">// 刷新任务数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">        <span class="comment">// 任务完成跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp; taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">    <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp; !taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续阅读新闻!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续阅读新闻!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">readNews</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 观看视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">watchVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取视频</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">getVideos</span>();</span><br><span class="line">    <span class="comment">// 观看视频</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> videos) &#123;</span><br><span class="line">        <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 暂停</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">`正在观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频...`</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`正在观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频`</span>);</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="keyword">const</span> &#123; url &#125; = videos[i];</span><br><span class="line">        <span class="comment">// 链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>, url);</span><br><span class="line">        <span class="comment">// 等待任务窗口</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">waitTaskWin</span>(url, <span class="string">&#x27;视听学习&#x27;</span>);</span><br><span class="line">        <span class="comment">// 清空链接</span></span><br><span class="line">        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;watchingUrl&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">`完成观看第 <span class="subst">$&#123;<span class="built_in">Number</span>(i) + <span class="number">1</span>&#125;</span> 个视频!`</span>);</span><br><span class="line">        <span class="comment">// 等待一段时间</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">1500</span>);</span><br><span class="line">        <span class="comment">// 刷新分数数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">        <span class="comment">// 刷新任务数据</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">        <span class="comment">// 任务完成跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">            taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务关闭跳出循环</span></span><br><span class="line">    <span class="keyword">if</span> (!taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 任务完成状况</span></span><br><span class="line">    <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp; !taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">        <span class="title function_">log</span>(<span class="string">&#x27;任务未完成, 继续观看视频!&#x27;</span>);</span><br><span class="line">        <span class="comment">// 创建提示</span></span><br><span class="line">        <span class="title function_">createTip</span>(<span class="string">&#x27;任务未完成, 继续观看看视频!&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">watchVideo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时刷新定时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> scheduleTimer = -<span class="number">1</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新定时任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshScheduleTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清除定时刷新</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="comment">// 剩余定时任务</span></span><br><span class="line">        <span class="keyword">const</span> restList = scheduleList.<span class="title function_">filter</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> !<span class="title function_">isLate</span>(s));</span><br><span class="line">        <span class="comment">// 存在剩余任务</span></span><br><span class="line">        <span class="keyword">if</span> (restList.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> rest = restList[<span class="number">0</span>];</span><br><span class="line">            <span class="title function_">log</span>(<span class="string">`已设置 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">            <span class="comment">// 提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`已设置 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">            <span class="comment">// 时间</span></span><br><span class="line">            <span class="keyword">let</span> time = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 刷新间隔</span></span><br><span class="line">            <span class="keyword">const</span> interval = <span class="number">10</span>;</span><br><span class="line">            scheduleTimer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!(time++ % interval)) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;定时刷新正在运行...&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 到达定时</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_">isNow</span>(rest)) &#123;</span><br><span class="line">                    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">`执行 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">                    <span class="comment">// 提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`执行 <span class="subst">$&#123;rest.time&#125;</span> 的定时任务!`</span>);</span><br><span class="line">                    <span class="comment">// 登录</span></span><br><span class="line">                    <span class="title function_">handleLogin</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 清除定时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearScheduleTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(scheduleTimer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 创建学习提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createTip</span>(<span class="params">text, delay = <span class="number">2</span>, countShow = <span class="literal">false</span>, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tipWrap = $$(<span class="string">&#x27;.egg_tip_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 提前去除</span></span><br><span class="line">    <span class="keyword">const</span> tips = $$(<span class="string">&#x27;.egg_tip&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (tips.<span class="property">length</span>) &#123;</span><br><span class="line">        tips.<span class="title function_">forEach</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> t.<span class="title function_">delay</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 延迟</span></span><br><span class="line">    <span class="keyword">const</span> delayCount = <span class="title function_">ref</span>(delay);</span><br><span class="line">    <span class="comment">// 文字</span></span><br><span class="line">    <span class="keyword">const</span> textContent = <span class="title function_">ref</span>(text);</span><br><span class="line">    <span class="comment">//显示</span></span><br><span class="line">    <span class="keyword">const</span> show = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 延迟显示</span></span><br><span class="line">    <span class="keyword">const</span> delayShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 销毁</span></span><br><span class="line">    <span class="keyword">let</span> destroyed = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 倒计时结束</span></span><br><span class="line">    <span class="keyword">let</span> done = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="keyword">const</span> tip = <span class="title class_">Tip</span>(&#123;</span><br><span class="line">        <span class="attr">text</span>: textContent,</span><br><span class="line">        <span class="attr">count</span>: delayCount,</span><br><span class="line">        show,</span><br><span class="line">        delayShow,</span><br><span class="line">        <span class="attr">countShow</span>: <span class="title function_">ref</span>(countShow),</span><br><span class="line">        <span class="attr">callback</span>: <span class="keyword">async</span> (count) =&gt; &#123;</span><br><span class="line">            callback &amp;&amp; (<span class="keyword">await</span> <span class="title function_">callback</span>(count));</span><br><span class="line">            <span class="comment">// 恢复显示</span></span><br><span class="line">            <span class="keyword">if</span> (delayShow.<span class="property">value</span> &amp;&amp; count === delay) &#123;</span><br><span class="line">                delayShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 倒计时结束</span></span><br><span class="line">            <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                done = <span class="literal">true</span>;</span><br><span class="line">                operate.<span class="title function_">destroy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 操作</span></span><br><span class="line">    <span class="keyword">const</span> operate = &#123;</span><br><span class="line">        <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                <span class="comment">// 隐藏</span></span><br><span class="line">                operate.<span class="title function_">hide</span>();</span><br><span class="line">                <span class="comment">// 销毁</span></span><br><span class="line">                destroyed = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        tip.<span class="property">ele</span>.<span class="title function_">remove</span>();</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">                    &#125;, <span class="number">300</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">hide</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                show.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        show.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">undefined</span>);</span><br><span class="line">                    &#125;, <span class="number">300</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">setText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                textContent.<span class="property">value</span> = text;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">waitCountDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 计时器</span></span><br><span class="line">                <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 结束</span></span><br><span class="line">                    <span class="keyword">if</span> (done) &#123;</span><br><span class="line">                        <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                        <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">100</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">delay</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!destroyed) &#123;</span><br><span class="line">                delayShow.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                delayCount.<span class="property">value</span> += <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(tip.<span class="property">ele</span>, operate);</span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    <span class="title function_">mountElement</span>(tip, tipWrap);</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    operate.<span class="title function_">show</span>();</span><br><span class="line">    <span class="keyword">return</span> operate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshUserInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 已存在信息</span></span><br><span class="line">    <span class="keyword">if</span> (userinfo.<span class="property">nick</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载用户信息...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>();</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; avatarMediaUrl = <span class="string">&#x27;&#x27;</span>, <span class="attr">nick</span>: nickRes &#125; = res;</span><br><span class="line">        <span class="keyword">if</span> (nickRes) &#123;</span><br><span class="line">            <span class="comment">// 设置昵称</span></span><br><span class="line">            userinfo.<span class="property">nick</span> = nickRes;</span><br><span class="line">            <span class="comment">// 设置头像</span></span><br><span class="line">            userinfo.<span class="property">avatar</span> = avatarMediaUrl;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载用户信息失败!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新分数信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshScoreInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载分数信息...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 获取总分</span></span><br><span class="line">    <span class="keyword">const</span> totalScoreRes = <span class="keyword">await</span> <span class="title function_">getTotalScore</span>();</span><br><span class="line">    <span class="comment">// 获取当天总分</span></span><br><span class="line">    <span class="keyword">const</span> todayScoreRes = <span class="keyword">await</span> <span class="title function_">getTodayScore</span>();</span><br><span class="line">    <span class="comment">// 整数值</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(totalScoreRes) &amp;&amp; <span class="title class_">Number</span>.<span class="title function_">isInteger</span>(todayScoreRes)) &#123;</span><br><span class="line">        <span class="comment">// 设置分数</span></span><br><span class="line">        totalScore.<span class="property">value</span> = totalScoreRes;</span><br><span class="line">        todayScore.<span class="property">value</span> = todayScoreRes;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载分数信息失败!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 刷新任务列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">refreshTaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 未登录</span></span><br><span class="line">    <span class="keyword">if</span> (!login.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;用户未登录!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;加载任务进度...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 原始任务进度</span></span><br><span class="line">    <span class="keyword">const</span> taskProgress = <span class="keyword">await</span> <span class="title function_">getTaskList</span>();</span><br><span class="line">    <span class="keyword">if</span> (taskProgress) &#123;</span><br><span class="line">        <span class="comment">// 登录</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">2</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">2</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">LOGIN</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">2</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">2</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 文章选读</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">0</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">0</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">0</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">0</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 视听学习</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">1</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">1</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">need</span> =</span><br><span class="line">            taskProgress[<span class="number">1</span>].<span class="property">dayMaxScore</span> - taskProgress[<span class="number">1</span>].<span class="property">currentScore</span>;</span><br><span class="line">        <span class="comment">// 每日答题</span></span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">currentScore</span> = taskProgress[<span class="number">3</span>].<span class="property">currentScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">dayMaxScore</span> = taskProgress[<span class="number">3</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">need</span> = taskProgress[<span class="number">3</span>].<span class="property">dayMaxScore</span>;</span><br><span class="line">        <span class="comment">// 更新数据</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> taskConfig) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; currentScore, dayMaxScore &#125; = taskConfig[i];</span><br><span class="line">            <span class="comment">// 进度</span></span><br><span class="line">            <span class="keyword">const</span> rate = <span class="title class_">Number</span>(((<span class="number">100</span> * currentScore) / dayMaxScore).<span class="title function_">toFixed</span>(<span class="number">1</span>));</span><br><span class="line">            <span class="comment">// 百分比</span></span><br><span class="line">            taskConfig[i].<span class="property">percent</span> = rate;</span><br><span class="line">            <span class="comment">// 分数</span></span><br><span class="line">            taskConfig[i].<span class="property">score</span> = currentScore;</span><br><span class="line">            <span class="comment">// 完成状态</span></span><br><span class="line">            taskConfig[i].<span class="property">status</span> = rate === <span class="number">100</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重试</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">2000</span>);</span><br><span class="line">    <span class="title function_">refreshTaskList</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Tip</span>(<span class="params">&#123; text, count, show, delayShow, countShow, callback, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchRef</span>([show, delayShow], <span class="function">() =&gt;</span> <span class="string">`egg_tip<span class="subst">$&#123;show.value ? (delayShow.value ? <span class="string">&#x27; active delay&#x27;</span> : <span class="string">&#x27; active&#x27;</span>) : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_text&#x27;</span>,</span><br><span class="line">        &#125;, <span class="title function_">createTextNode</span>(text)),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> countShow.<span class="property">value</span></span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_countdown&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;count.value&#125;</span>s`</span>)))</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">    ], &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 倒计时</span></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">countDown</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">                <span class="comment">// 倒计时回调</span></span><br><span class="line">                <span class="keyword">await</span> <span class="title function_">callback</span>(count.<span class="property">value</span>);</span><br><span class="line">                <span class="comment">// 倒计时结束</span></span><br><span class="line">                <span class="keyword">if</span> (!count.<span class="property">value</span>) &#123;</span><br><span class="line">                    show.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                count.<span class="property">value</span>--;</span><br><span class="line">                <span class="built_in">setTimeout</span>(countDown, <span class="number">1000</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">countDown</span>();</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分隔符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Hr</span>(<span class="params">&#123; text &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_hr_wrap&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr_title&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(text)),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hr&#x27;</span> &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Select</span>(<span class="params">&#123; data, maxlength, placeholder = <span class="string">&#x27;&#x27;</span>, onchange, onblur, value, keep, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> selectData = <span class="title function_">reactive</span>(data.<span class="title function_">map</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (&#123; <span class="attr">selected</span>: <span class="literal">false</span>, <span class="attr">active</span>: <span class="literal">false</span>, <span class="attr">ele</span>: <span class="literal">undefined</span>, ...v &#125;)));</span><br><span class="line">    <span class="keyword">const</span> focus = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> input = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="keyword">const</span> list = <span class="title function_">shallowRef</span>(<span class="literal">undefined</span>);</span><br><span class="line">    <span class="keyword">const</span> valueRef = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    value &amp;&amp;</span><br><span class="line">        <span class="title function_">watch</span>(value, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> item = selectData.<span class="title function_">find</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">value</span> === value.<span class="property">value</span>);</span><br><span class="line">            valueRef.<span class="property">value</span> = item ? item.<span class="property">label</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">                selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (v.<span class="property">selected</span> = <span class="literal">false</span>));</span><br><span class="line">                list.<span class="property">value</span> &amp;&amp; (list.<span class="property">value</span>.<span class="property">scrollTop</span> = <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_select&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, &#123; <span class="attr">value</span>: valueRef &#125;, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_select_input&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">            placeholder,</span><br><span class="line">            maxlength,</span><br><span class="line">            <span class="attr">ref</span>: input,</span><br><span class="line">            <span class="title function_">onfocus</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    focus.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (input.<span class="property">value</span>.<span class="property">value</span> &amp;&amp; valueRef.<span class="property">value</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> index = selectData.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">label</span> === valueRef.<span class="property">value</span>);</span><br><span class="line">                        <span class="keyword">if</span> (index + <span class="number">1</span>) &#123;</span><br><span class="line">                            list.<span class="property">value</span>.<span class="property">scrollTop</span> = selectData[index].<span class="property">ele</span>?.<span class="property">offsetTop</span> || <span class="number">0</span>;</span><br><span class="line">                            selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (v.<span class="property">selected</span> = i === index));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">oninput</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; value &#125; = input.<span class="property">value</span>;</span><br><span class="line">                    <span class="comment">// 文本存在</span></span><br><span class="line">                    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">                        <span class="keyword">const</span> index = selectData.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">label</span>.<span class="title function_">includes</span>(value));</span><br><span class="line">                        <span class="comment">// 存在匹配</span></span><br><span class="line">                        <span class="keyword">if</span> (index + <span class="number">1</span>) &#123;</span><br><span class="line">                            list.<span class="property">value</span>.<span class="property">scrollTop</span> = selectData[index].<span class="property">ele</span>?.<span class="property">offsetTop</span> || <span class="number">0</span>;</span><br><span class="line">                            selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">                                v.<span class="property">active</span> = i === index;</span><br><span class="line">                                v.<span class="property">active</span> &amp;&amp;</span><br><span class="line">                                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                        v.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">                                    &#125;, <span class="number">300</span>);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 清除</span></span><br><span class="line">                    selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (v.<span class="property">active</span> = v.<span class="property">selected</span> = <span class="literal">false</span>));</span><br><span class="line">                    list.<span class="property">value</span>.<span class="property">scrollTop</span> = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onblur</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (list.<span class="property">value</span> &amp;&amp; input.<span class="property">value</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> item = selectData.<span class="title function_">find</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> v.<span class="property">selected</span>);</span><br><span class="line">                    <span class="comment">// 关闭选项</span></span><br><span class="line">                    <span class="keyword">if</span> (item || !input.<span class="property">value</span>.<span class="property">value</span>) &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            focus.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;, <span class="number">100</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 恢复文本</span></span><br><span class="line">                    <span class="keyword">if</span> (item &amp;&amp; input.<span class="property">value</span>.<span class="property">value</span> !== item.<span class="property">label</span>) &#123;</span><br><span class="line">                        input.<span class="property">value</span>.<span class="property">value</span> = item.<span class="property">label</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 保留文本</span></span><br><span class="line">                    <span class="keyword">if</span> (!item &amp;&amp; keep) &#123;</span><br><span class="line">                        input.<span class="property">value</span>.<span class="property">value</span> = valueRef.<span class="property">value</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    onblur &amp;&amp;</span><br><span class="line">                        <span class="title function_">onblur</span>(item ? &#123; <span class="attr">label</span>: item.<span class="property">label</span>, <span class="attr">value</span>: item.<span class="property">value</span> &#125; : <span class="literal">undefined</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_select_list<span class="subst">$&#123;focus.value ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">            <span class="attr">ref</span>: list,</span><br><span class="line">        &#125;, selectData.<span class="title function_">map</span>(<span class="function">(<span class="params">v, index</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [v.<span class="property">selected</span>, v.<span class="property">active</span>], <span class="function">() =&gt;</span> <span class="string">`egg_select_item<span class="subst">$&#123;v.selected ? <span class="string">&#x27; selected&#x27;</span> : v.active ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">            <span class="attr">ref</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> (v.<span class="property">ele</span> = e),</span><br><span class="line">            <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (valueRef.<span class="property">value</span> !== v.<span class="property">label</span>) &#123;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(&#123; <span class="attr">label</span>: v.<span class="property">label</span>, <span class="attr">value</span>: v.<span class="property">value</span> &#125;);</span><br><span class="line">                    selectData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">                        v.<span class="property">selected</span> = i === index;</span><br><span class="line">                        v.<span class="property">selected</span> &amp;&amp; (valueRef.<span class="property">value</span> = v.<span class="property">label</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                focus.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">        &#125;, <span class="title function_">createTextNode</span>(v.<span class="property">label</span>)))),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 答题按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ExamBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_exam_btn<span class="subst">$&#123;examPause.value ? <span class="string">&#x27; manual&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">        <span class="attr">onclick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            examPause.<span class="property">value</span> = !examPause.<span class="property">value</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;examPause.value ? <span class="string">&#x27;开启自动答题&#x27;</span> : <span class="string">&#x27;关闭自动答题&#x27;</span>&#125;</span>`</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务窗口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Frame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 最大化</span></span><br><span class="line">    <span class="keyword">const</span> max = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 容器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_frame_wrap<span class="subst">$&#123;frame.show ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [login.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 同屏任务</span></span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span> &amp;&amp; settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                <span class="comment">// 遮罩</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_frame_mask&#x27;</span> &#125;),</span><br><span class="line">                <span class="comment">// 窗口内容</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_frame_content_wrap <span class="subst">$&#123;max.value ? <span class="string">&#x27; max&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="comment">// 窗口控制</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_frame_controls_wrap&#x27;</span> &#125;, [</span><br><span class="line">                        <span class="comment">// 标题</span></span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_frame_title&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_frame_controls&#x27;</span>,</span><br><span class="line">                        &#125;, [</span><br><span class="line">                            <span class="comment">// 隐藏</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;隐藏&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 隐藏窗口</span></span><br><span class="line">                                    frame.<span class="property">show</span> = <span class="literal">false</span>;</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M863.7 552.5H160.3c-10.6 0-19.2-8.6-19.2-19.2v-41.7c0-10.6 8.6-19.2 19.2-19.2h703.3c10.6 0 19.2 8.6 19.2 19.2v41.7c0 10.6-8.5 19.2-19.1 19.2z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                            <span class="comment">// 改变大小</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;缩放&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    max.<span class="property">value</span> = !max.<span class="property">value</span>;</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M609.52 584.92a35.309 35.309 0 0 1 24.98-10.36c9.37 0 18.36 3.73 24.98 10.36l189.29 189.22-0.07-114.3 0.57-6.35c3.25-17.98 19.7-30.5 37.9-28.85 18.2 1.65 32.12 16.92 32.09 35.2v200.23c-0.05 1.49-0.19 2.97-0.42 4.45l-0.21 1.13c-0.22 1.44-0.55 2.85-0.99 4.24l-0.57 1.62-0.56 1.41a34.163 34.163 0 0 1-7.62 11.36l2.12-2.4-0.14 0.14-0.92 1.06-1.06 1.2-0.57 0.57-0.56 0.57a36.378 36.378 0 0 1-16.23 8.39l-3.53 0.5-4.02 0.35h-199.6l-6.35-0.63c-16.73-3.06-28.9-17.63-28.93-34.64l0.56-6.35c3.07-16.76 17.67-28.93 34.71-28.92l114.29-0.14-189.07-189.1-4.09-4.94c-9.71-14.01-8.01-32.95 4.02-45.02z m-162.06 0c12.06 12.05 13.78 30.99 4.09 45.01l-4.09 4.94-189.15 189.08 114.3 0.14c17.04-0.01 31.65 12.17 34.71 28.92l0.57 6.35c-0.03 17.01-12.19 31.58-28.92 34.64l-6.35 0.63H173.09l-4.23-0.42-3.39-0.49a36.38 36.38 0 0 1-17.36-9.52l-1.06-1.13-0.98-1.13 0.98 1.06-1.97-2.26 0.85 1.06-0.42-0.56a35.137 35.137 0 0 1-3.74-5.64l-1.13-2.68a34.71 34.71 0 0 1-2.11-7.33l-0.28-1.13c-0.21-1.47-0.33-2.96-0.36-4.45V659.78c-0.03-18.28 13.89-33.55 32.09-35.2 18.2-1.65 34.65 10.87 37.9 28.85l0.57 6.35-0.07 114.36 189.29-189.22c13.77-13.77 36.11-13.77 49.88 0h-0.09z m-74.71-471.71l6.35 0.57c16.76 3.06 28.93 17.67 28.92 34.71l-0.63 6.35c-3.07 16.76-17.67 28.93-34.71 28.92l-114.3 0.14 189.15 189.08 4.09 4.94c10.26 15.02 7.42 35.37-6.55 47.01-13.98 11.63-34.51 10.74-47.42-2.07L208.29 233.71l0.07 114.3-0.57 6.35c-3.25 17.98-19.7 30.5-37.9 28.85-18.2-1.65-32.12-16.92-32.09-35.2V147.78c0-1.55 0.14-3.03 0.35-4.51l0.21-1.13c0.24-1.44 0.59-2.85 1.06-4.23a34.97 34.97 0 0 1 8.68-14.39l-2.12 2.4-0.42 0.57 1.55-1.84-0.99 1.06 0.92-0.98 2.26-2.33c3.04-2.73 6.52-4.92 10.3-6.49l2.82-1.06c3.45-1.07 7.04-1.62 10.65-1.62l-3.6 0.14h0.49l1.48-0.14h201.31z m512.91 0l1.41 0.14h0.42c2.43 0.29 4.84 0.79 7.19 1.48l2.82 1.06 2.61 1.2 3.04 1.76c2.09 1.33 4.03 2.89 5.78 4.66l1.13 1.2 0.78 0.98 0.21 0.14 0.49 0.64 2.33 3.17c2.35 3.83 3.98 8.07 4.8 12.49l0.21 1.13c0.21 1.48 0.35 2.96 0.35 4.44v200.37c-0.16 18.13-14.03 33.19-32.08 34.83-18.06 1.64-34.42-10.67-37.83-28.48l-0.57-6.35V233.65L659.54 422.87c-12.9 12.95-33.56 13.91-47.59 2.2-14.04-11.71-16.81-32.2-6.38-47.22l4.02-4.86 189.22-189.08-114.29-0.14c-17.06 0.04-31.71-12.14-34.78-28.92l-0.63-6.35c-0.01-17.04 12.16-31.65 28.93-34.71l6.35-0.57h201.27z m0 0&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                            <span class="comment">// 关闭</span></span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                                <span class="attr">title</span>: <span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 关闭窗口</span></span><br><span class="line">                                    <span class="title function_">closeFrame</span>();</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M453.44 512L161.472 220.032a41.408 41.408 0 0 1 58.56-58.56L512 453.44 803.968 161.472a41.408 41.408 0 0 1 58.56 58.56L570.56 512l291.968 291.968a41.408 41.408 0 0 1-58.56 58.56L512 570.56 220.032 862.528a41.408 41.408 0 0 1-58.56-58.56L453.44 512z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                    <span class="comment">// 窗口内容</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_frame_content&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> frame.<span class="property">src</span></span><br><span class="line">                        ? [</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;iframe&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_frame&#x27;</span>,</span><br><span class="line">                                <span class="attr">src</span>: frame.<span class="property">src</span>,</span><br><span class="line">                                <span class="title function_">ref</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">                                    frame.<span class="property">ele</span> = ele;</span><br><span class="line">                                &#125;,</span><br><span class="line">                            &#125;, <span class="literal">undefined</span>),</span><br><span class="line">                        ]</span><br><span class="line">                        : <span class="literal">undefined</span>)),</span><br><span class="line">                ], &#123;</span><br><span class="line">                    <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="comment">// 隐藏窗口</span></span><br><span class="line">                        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [</span><br><span class="line">                            taskStatus.<span class="property">value</span>,</span><br><span class="line">                            running.<span class="property">value</span>,</span><br><span class="line">                            settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>],</span><br><span class="line">                            settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>],</span><br><span class="line">                        ], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 同屏任务</span></span><br><span class="line">                            <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] &amp;&amp;</span><br><span class="line">                                (taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span> ||</span><br><span class="line">                                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span> ||</span><br><span class="line">                                    running.<span class="property">value</span>)) &#123;</span><br><span class="line">                                <span class="comment">// 设置窗口显示</span></span><br><span class="line">                                frame.<span class="property">show</span> = !settings[<span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>];</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;),</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;), &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 关闭窗口</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [login.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]], <span class="function">() =&gt;</span> login.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>] ? <span class="title function_">closeWin</span>() : <span class="title function_">closeFrame</span>()));</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> login.<span class="property">value</span></span><br><span class="line">            ? <span class="literal">undefined</span></span><br><span class="line">            : <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_login_item&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="comment">// 登录按钮</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                        <span class="comment">// 开始登录</span></span><br><span class="line">                        <span class="title function_">handleLogin</span>();</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;扫码登录&#x27;</span>)),</span><br><span class="line">                <span class="comment">// 窗口</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_login_img_wrap<span class="subst">$&#123;loginQRCodeShow.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;img&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_img&#x27;</span>,</span><br><span class="line">                &#125;)),</span><br><span class="line">            ], &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 未开启定时展示二维码</span></span><br><span class="line">                        <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                            <span class="comment">// 开始登录</span></span><br><span class="line">                            <span class="title function_">handleLogin</span>();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="literal">true</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">InfoItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_info_item&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="comment">// 用户信息</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_userinfo&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="comment">// 头像</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_avatar&#x27;</span> &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> [</span><br><span class="line">                            userinfo.<span class="property">avatar</span></span><br><span class="line">                                ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;img&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">src</span>: userinfo.<span class="property">avatar</span>,</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_avatar_img&#x27;</span>,</span><br><span class="line">                                &#125;)</span><br><span class="line">                                : <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_avatar_nick&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> userinfo.<span class="property">nick</span>.<span class="title function_">substring</span>(<span class="number">1</span>, <span class="number">3</span>)))),</span><br><span class="line">                        ];</span><br><span class="line">                    &#125;)),</span><br><span class="line">                    <span class="comment">// 昵称</span></span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_nick&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> userinfo.<span class="property">nick</span>))),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="comment">// 退出按钮</span></span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_login_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 退出登录</span></span><br><span class="line">                        <span class="title function_">handleLogout</span>();</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;退出&#x27;</span>)),</span><br><span class="line">            ], &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="comment">// 刷新用户信息</span></span><br><span class="line">                    <span class="title function_">refreshUserInfo</span>();</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分数详情</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ScoreItem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 分数显示</span></span><br><span class="line">            <span class="keyword">const</span> scoreShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">// 分数信息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_score_item&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_scoreinfo&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_totalscore&#x27;</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createTextNode</span>(<span class="string">&#x27;总积分&#x27;</span>),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="title function_">createTextNode</span>(totalScore)),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_todayscore&#x27;</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_todayscore_btn&#x27;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;查看分数详情&#x27;</span>,</span><br><span class="line">                        <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            scoreShow.<span class="property">value</span> = !scoreShow.<span class="property">value</span>;</span><br><span class="line">                        &#125;, <span class="number">300</span>),</span><br><span class="line">                        <span class="attr">onblur</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            scoreShow.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createTextNode</span>(<span class="string">&#x27;当天分数&#x27;</span>),</span><br><span class="line">                        <span class="comment">// 当天分数</span></span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="title function_">createTextNode</span>(todayScore)),</span><br><span class="line">                        <span class="comment">// icon</span></span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                            <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                        &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M332.16 883.84a40.96 40.96 0 0 0 58.24 0l338.56-343.04a40.96 40.96 0 0 0 0-58.24L390.4 140.16a40.96 40.96 0 0 0-58.24 58.24L640 512l-307.84 314.24a40.96 40.96 0 0 0 0 57.6z&#x27;</span>,</span><br><span class="line">                        &#125;)),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_score_details<span class="subst">$&#123;scoreShow.value ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27; hide&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                        &#125;, [</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_score_title&#x27;</span> &#125;, [</span><br><span class="line">                                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                                &#125;, [</span><br><span class="line">                                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                        <span class="attr">d</span>: <span class="string">&#x27;M314.81 304.01h415.86v58.91H314.81zM314.81 440.24h415.86v58.91H314.81z&#x27;</span>,</span><br><span class="line">                                    &#125;),</span><br><span class="line">                                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                        <span class="attr">d</span>: <span class="string">&#x27;M814.8 892.74h-8.64l-283.51-182-283.51 182h-8.64A69.85 69.85 0 0 1 160.72 823V188.22a69.85 69.85 0 0 1 69.77-69.77H814.8a69.85 69.85 0 0 1 69.77 69.77V823a69.85 69.85 0 0 1-69.77 69.74zM230.5 177.35a10.87 10.87 0 0 0-10.86 10.86V823a10.86 10.86 0 0 0 5 9.11l298.01-191.42 298.06 191.38a10.86 10.86 0 0 0 5-9.11V188.22a10.87 10.87 0 0 0-10.86-10.86z&#x27;</span>,</span><br><span class="line">                                    &#125;),</span><br><span class="line">                                ]),</span><br><span class="line">                                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_score_title_text&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;积分详情&#x27;</span>)),</span><br><span class="line">                            ]),</span><br><span class="line">                            ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_score_item&#x27;</span> &#125;, [</span><br><span class="line">                                <span class="title function_">createTextNode</span>(task.<span class="property">title</span>),</span><br><span class="line">                                <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                    <span class="attr">class</span>: <span class="string">&#x27;egg_score_detail&#x27;</span>,</span><br><span class="line">                                &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> task.<span class="property">score</span>))),</span><br><span class="line">                            ])),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                ]),</span><br><span class="line">            ]), &#123;</span><br><span class="line">                <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="comment">// 刷新分数信息</span></span><br><span class="line">                    <span class="title function_">refreshScoreInfo</span>();</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置普通项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NomalItem</span>(<span class="params">&#123; title, tip, checked, onchange, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_setting_item&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_label_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;label&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createTextNode</span>(title),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_detail&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: tip,</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;i&#x27;</span>)),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: tip,</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_switch&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">            checked,</span><br><span class="line">            onchange,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置任务项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskItem</span>(<span class="params">&#123; title, tip, checked, percent, currentScore, dayMaxScore, onchange, immutable, &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_task_item&#x27;</span>,</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_label_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title_wrap&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_title&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(title)),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_task_progress_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_task_current&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(currentScore)),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_task_max&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`/<span class="subst">$&#123;dayMaxScore.value&#125;</span>`</span>))),</span><br><span class="line">                ]),</span><br><span class="line">            ]),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_progress&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_track&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_bar&#x27;</span>,</span><br><span class="line">                    <span class="attr">style</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`width: <span class="subst">$&#123;percent.value&#125;</span>%;`</span>),</span><br><span class="line">                &#125;)),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: tip,</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_switch&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;checkbox&#x27;</span>,</span><br><span class="line">            checked,</span><br><span class="line">            onchange,</span><br><span class="line">            <span class="attr">disabled</span>: immutable,</span><br><span class="line">        &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 处理任务设置变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleTaskChange</span> = (<span class="params">e, type, title</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 开关</span></span><br><span class="line">        <span class="keyword">const</span> &#123; checked &#125; = e.<span class="property">target</span>;</span><br><span class="line">        <span class="keyword">if</span> (taskConfig[type].<span class="property">active</span> !== checked) &#123;</span><br><span class="line">            taskConfig[type].<span class="property">active</span> = checked;</span><br><span class="line">            <span class="comment">// 设置</span></span><br><span class="line">            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(taskConfig));</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`<span class="subst">$&#123;title&#125;</span> <span class="subst">$&#123;checked ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 登录加载</span></span><br><span class="line">    <span class="title function_">watch</span>(login, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 加载任务列表</span></span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">refreshTaskList</span>();</span><br><span class="line">            <span class="comment">// 未完成任务</span></span><br><span class="line">            <span class="keyword">if</span> (taskConfig.<span class="title function_">some</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>)) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">                <span class="comment">// 加载完毕</span></span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 任务完毕</span></span><br><span class="line">            taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&#x27;egg_task_list&#x27;</span>,</span><br><span class="line">    &#125;, taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> label.<span class="property">immutable</span></span><br><span class="line">        ? <span class="title class_">TaskItem</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">            <span class="attr">checked</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">active</span>),</span><br><span class="line">            <span class="attr">percent</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">percent</span>),</span><br><span class="line">            <span class="attr">currentScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">currentScore</span>),</span><br><span class="line">            <span class="attr">dayMaxScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">dayMaxScore</span>),</span><br><span class="line">            <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">handleTaskChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">            <span class="attr">immutable</span>: label.<span class="property">immutable</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        : <span class="title class_">TaskItem</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">            <span class="attr">checked</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">active</span>),</span><br><span class="line">            <span class="attr">percent</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">percent</span>),</span><br><span class="line">            <span class="attr">currentScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">currentScore</span>),</span><br><span class="line">            <span class="attr">dayMaxScore</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> label.<span class="property">dayMaxScore</span>),</span><br><span class="line">            <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">handleTaskChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">            &#125;, <span class="number">300</span>),</span><br><span class="line">            <span class="attr">immutable</span>: label.<span class="property">immutable</span>,</span><br><span class="line">        &#125;)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 任务按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TaskBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 学习</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">study</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;开始学习!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 暂停</span></span><br><span class="line">                <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                <span class="comment">// 文章选读</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">READ</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务一: 文章选读&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务一: 文章选读&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 看新闻</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">readNews</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务一: 文章选读已完成!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 视听学习</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">WATCH</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务二: 视听学习&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务二: 视听学习&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 看视频</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">watchVideo</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务二: 视听学习已完成!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 每日答题</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">active</span> &amp;&amp;</span><br><span class="line">                    !taskConfig[<span class="title class_">TaskType</span>.<span class="property">PRACTICE</span>].<span class="property">status</span>) &#123;</span><br><span class="line">                    <span class="title function_">log</span>(<span class="string">&#x27;任务三: 每日答题&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;任务三: 每日答题&#x27;</span>);</span><br><span class="line">                    <span class="comment">// 暂停</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">studyPauseLock</span>();</span><br><span class="line">                    <span class="comment">// 做每日答题</span></span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">doExamPractice</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;任务三: 每日答题已完成!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 暂停任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">pauseTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 继续任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">continueTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 全局暂停</span></span><br><span class="line">                <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pauseStudy&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">START</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@description</span> 开始任务</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">startTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 未完成任务</span></span><br><span class="line">                <span class="keyword">if</span> (taskConfig.<span class="title function_">some</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>)) &#123;</span><br><span class="line">                    <span class="comment">// 开始任务</span></span><br><span class="line">                    taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">START</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// 学习</span></span><br><span class="line">                        <span class="keyword">await</span> <span class="title function_">study</span>();</span><br><span class="line">                        <span class="comment">// 同屏任务</span></span><br><span class="line">                        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>]) &#123;</span><br><span class="line">                            <span class="comment">// 关闭窗口</span></span><br><span class="line">                            <span class="title function_">closeFrame</span>();</span><br><span class="line">                            <span class="comment">// 窗口不存在</span></span><br><span class="line">                            frame.<span class="property">exist</span> = <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                            <span class="comment">// 提示</span></span><br><span class="line">                            <span class="title function_">createTip</span>(err.<span class="property">message</span>);</span><br><span class="line">                            <span class="comment">// 错误</span></span><br><span class="line">                            <span class="title function_">error</span>(err.<span class="property">message</span>);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(err);</span><br><span class="line">                        <span class="comment">// 错误</span></span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 刷新任务</span></span><br><span class="line">                taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>;</span><br><span class="line">                <span class="title function_">log</span>(<span class="string">&#x27;已完成&#x27;</span>);</span><br><span class="line">                <span class="comment">// 创建提示</span></span><br><span class="line">                <span class="title function_">createTip</span>(<span class="string">&#x27;完成学习!&#x27;</span>);</span><br><span class="line">                <span class="comment">// 远程推送</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                    <span class="comment">// 推送</span></span><br><span class="line">                    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">pushModal</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;学习推送&#x27;</span>,</span><br><span class="line">                        <span class="attr">to</span>: userinfo.<span class="property">nick</span>,</span><br><span class="line">                        <span class="attr">content</span>: [</span><br><span class="line">                            <span class="string">&#x27;学习强国, 学习完成!&#x27;</span>,</span><br><span class="line">                            <span class="string">`当天积分:  <span class="subst">$&#123;getHighlightHTML(todayScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                            <span class="string">`总积分: <span class="subst">$&#123;getHighlightHTML(totalScore.value)&#125;</span> 分`</span>,</span><br><span class="line">                            ...taskConfig.<span class="title function_">map</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> <span class="title function_">getProgressHTML</span>(task.<span class="property">title</span>, task.<span class="property">percent</span>)),</span><br><span class="line">                        ],</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                    &#125;, pushToken.<span class="property">value</span>);</span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">`学习推送<span class="subst">$&#123;res ? <span class="string">&#x27;成功&#x27;</span> : <span class="string">&#x27;失败&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已在等待</span></span><br><span class="line">            <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 自动答题</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [taskStatus.<span class="property">value</span>, settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>]], <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="comment">// 加载完毕</span></span><br><span class="line">                <span class="keyword">if</span> (!flag &amp;&amp; taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>) &#123;</span><br><span class="line">                    <span class="comment">// 自动答题</span></span><br><span class="line">                    <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>]) &#123;</span><br><span class="line">                        <span class="comment">// 等待中</span></span><br><span class="line">                        flag = <span class="literal">true</span>;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="keyword">const</span> tip = <span class="title function_">createTip</span>(<span class="string">&#x27;即将自动开始任务&#x27;</span>, <span class="number">5</span>, <span class="literal">true</span>);</span><br><span class="line">                        <span class="comment">// 等待倒计时结束</span></span><br><span class="line">                        <span class="keyword">await</span> tip.<span class="title function_">waitCountDown</span>();</span><br><span class="line">                        <span class="comment">// 再次查看是否开启</span></span><br><span class="line">                        <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>] &amp;&amp;</span><br><span class="line">                            taskStatus.<span class="property">value</span> !== <span class="title class_">TaskStatusType</span>.<span class="property">START</span>) &#123;</span><br><span class="line">                            <span class="comment">// 创建提示</span></span><br><span class="line">                            <span class="title function_">createTip</span>(<span class="string">&#x27;自动开始任务&#x27;</span>);</span><br><span class="line">                            <span class="comment">// 开始任务</span></span><br><span class="line">                            <span class="title function_">startTask</span>();</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 取消等待</span></span><br><span class="line">                        flag = <span class="literal">false</span>;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;已取消自动开始任务!&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 切换开关任务未完成</span></span><br><span class="line">            taskConfig.<span class="title function_">forEach</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [task.<span class="property">active</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (task.<span class="property">active</span> &amp;&amp; !task.<span class="property">status</span>) &#123;</span><br><span class="line">                            taskStatus.<span class="property">value</span> = <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_study_item&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_study_btn<span class="subst">$&#123;taskStatus.value === TaskStatusType.START ? <span class="string">&#x27; loading&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">disabled</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [running.<span class="property">value</span>, taskStatus.<span class="property">value</span>], <span class="function">() =&gt;</span> running.<span class="property">value</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADING</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">FINISH</span>),</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">LOADED</span></span><br><span class="line">                    ? <span class="title function_">debounce</span>(startTask, <span class="number">300</span>)</span><br><span class="line">                    : taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span></span><br><span class="line">                        ? <span class="title function_">debounce</span>(pauseTask, <span class="number">300</span>)</span><br><span class="line">                        : taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span></span><br><span class="line">                            ? <span class="title function_">debounce</span>(continueTask, <span class="number">300</span>)</span><br><span class="line">                            : <span class="literal">undefined</span>),</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;taskStatus.value === TaskStatusType.LOADING</span></span></span><br><span class="line"><span class="subst"><span class="string">                ? <span class="string">&#x27;等待中&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                : taskStatus.value === TaskStatusType.LOADED</span></span></span><br><span class="line"><span class="subst"><span class="string">                    ? <span class="string">&#x27;开始学习&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    : taskStatus.value === TaskStatusType.START</span></span></span><br><span class="line"><span class="subst"><span class="string">                        ? <span class="string">&#x27;正在学习, 点击暂停&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                        : taskStatus.value === TaskStatusType.PAUSE</span></span></span><br><span class="line"><span class="subst"><span class="string">                            ? <span class="string">&#x27;继续学习&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                            : taskStatus.value === TaskStatusType.FINISH</span></span></span><br><span class="line"><span class="subst"><span class="string">                                ? <span class="string">&#x27;已完成&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                                : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时项目</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ScheduleList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list&#x27;</span> &#125;, <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scheduleList.<span class="property">length</span></span><br><span class="line">            ? scheduleList.<span class="title function_">map</span>(<span class="function">(<span class="params">schedule</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_item&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">`egg_schedule_detail_time_wrap<span class="subst">$&#123;isLate(schedule) ? <span class="string">&#x27; inactive&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">                &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_icon&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M810.137703 213.860762c-164.388001-164.4187-431.887404-164.4187-596.277452 0-164.417677 164.388001-164.417677 431.889451 0 596.278475 164.390048 164.417677 431.890474 164.417677 596.277452 0C974.557426 645.750213 974.557426 378.248763 810.137703 213.860762zM767.347131 767.345596c-140.797723 140.829446-369.927237 140.797723-510.693238 0-140.828422-140.797723-140.828422-369.895515 0-510.708588 140.767024-140.783397 369.896538-140.813073 510.693238 0C908.14383 397.420405 908.14383 626.578572 767.347131 767.345596z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M721.450824 521.495258 515.404028 521.495258l0.028653-227.948619c0-15.124466-12.362562-27.458375-27.501354-27.458375s-27.443026 12.33391-27.443026 27.458375l0 235.115855c0 0.835018-1.013073 20.48659 12.094456 34.459836 8.331759 8.809643 20.038382 13.288654 35.148521 13.288654l213.720569 0.031722c15.140839 0 27.472702-12.304234 27.472702-27.474748C748.922503 533.887496 736.620315 521.584286 721.450824 521.495258z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ])),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_time&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(schedule.<span class="property">time</span>)),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_detail_del_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_del_btn&#x27;</span>,</span><br><span class="line">                        <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 定时刷新</span></span><br><span class="line">                            <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                                <span class="title function_">createTip</span>(<span class="string">&#x27;未开启定时刷新!&#x27;</span>);</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// 索引</span></span><br><span class="line">                            <span class="keyword">const</span> index = scheduleList.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s === schedule);</span><br><span class="line">                            <span class="comment">// 删除元素</span></span><br><span class="line">                            scheduleList.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">                            <span class="comment">// 存储</span></span><br><span class="line">                            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(scheduleList));</span><br><span class="line">                            <span class="comment">// 刷新任务</span></span><br><span class="line">                            <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                        &#125;, <span class="number">300</span>),</span><br><span class="line">                    &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M896.22 896.22c14.262-14.263 11.263-40.449-6.583-58.295L230.473 178.76c-17.847-17.847-44.105-20.846-58.295-6.583-14.263 14.19-11.264 40.448 6.583 58.295l659.164 659.164c17.846 17.846 44.032 20.845 58.294 6.582&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M172.178 896.22c-14.263-14.263-11.264-40.449 6.583-58.295L837.925 178.76c17.846-17.847 44.032-20.846 58.294-6.583 14.263 14.19 11.264 40.448-6.582 58.295L230.4 889.637c-17.847 17.846-44.105 20.845-58.295 6.582&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ])),</span><br><span class="line">                ]),</span><br><span class="line">            ]))</span><br><span class="line">            : [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list_none&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                    &#125;, [</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M238.1 520.5c-17.6 0-31.9-14.3-31.9-31.9 0-17.6 14.3-31.9 31.9-31.9h293c17.6 0 31.9 14.3 31.9 31.9 0 17.6-14.3 31.9-31.9 31.9h-293zM238.1 733.6c-17.6 0-31.9-14.3-31.9-31.9s14.3-31.9 31.9-31.9h186.5c17.6 0 31.9 14.3 31.9 31.9s-14.3 31.9-31.9 31.9H238.1zM241.6 314.9c-17.6 0-31.9-14.3-31.9-31.9s14.3-31.9 31.9-31.9h426.1c17.6 0 31.9 14.3 31.9 31.9 0 17.5-14.3 31.7-31.8 31.9H241.6z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M160 926.6c-46.9 0-85.1-38.2-85.1-85.1V149.1c0-46.9 38.2-85.1 85.1-85.1h586c46.9 0 85.1 38.2 85.1 85.1v297.4c0 17.6-14.3 31.9-31.9 31.9-17.6 0-31.9-14.3-31.9-31.9V149.1c0-11.8-9.6-21.4-21.4-21.4H160c-11.8 0-21.4 9.6-21.4 21.4v692.4c0 11.8 9.6 21.4 21.4 21.4h304.5c17.5 0 31.8 14.2 31.9 31.8 0 17.6-14.3 31.8-31.9 31.8H160z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                        <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                            <span class="attr">d</span>: <span class="string">&#x27;M917.2 959.9c-8.5 0-16.5-3.3-22.5-9.3l-78.5-78.5-5.3-0.5-0.6 0.4c-31.7 21.6-68.7 33-107 33-105.2 0-190.8-85.6-190.8-190.8s85.6-190.8 190.8-190.8c105.2 0 190.8 85.6 190.8 190.8 0 38.2-11.4 75.2-33 107l-0.4 0.6 0.5 5.3 78.5 78.5c6 6 9.3 14 9.3 22.5s-3.4 16.5-9.4 22.5c-5.9 6-13.9 9.3-22.4 9.3zM703.4 587c-70.1 0-127.2 57.1-127.2 127.2s57.1 127.2 127.2 127.2 127.2-57.1 127.2-127.2S773.6 587 703.4 587z&#x27;</span>,</span><br><span class="line">                        &#125;),</span><br><span class="line">                    ]),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_list_none_text&#x27;</span>,</span><br><span class="line">                    &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;暂无定时任务&#x27;</span>)),</span><br><span class="line">                ]),</span><br><span class="line">            ];</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 时间输入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TimeInput</span>(<span class="params">&#123; hour, minute, onchange, &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// 小时</span></span><br><span class="line">    <span class="keyword">const</span> hours = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">24</span>).<span class="title function_">fill</span>(<span class="literal">undefined</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">value</span>: i,</span><br><span class="line">        <span class="attr">label</span>: <span class="title function_">formatDateNum</span>(i),</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="comment">// 分钟</span></span><br><span class="line">    <span class="keyword">const</span> minutes = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">60</span>).<span class="title function_">fill</span>(<span class="literal">undefined</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">value</span>: i,</span><br><span class="line">        <span class="attr">label</span>: <span class="title function_">formatDateNum</span>(i),</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">const</span> valueRef = <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> h = hours.<span class="title function_">find</span>(<span class="function">(<span class="params">h</span>) =&gt;</span> h.<span class="property">value</span> === hour.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">const</span> min = minutes.<span class="title function_">find</span>(<span class="function">(<span class="params">min</span>) =&gt;</span> min.<span class="property">value</span> === minute.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">hour</span>: h ? h.<span class="property">value</span> : -<span class="number">1</span>,</span><br><span class="line">            <span class="attr">minute</span>: min ? min.<span class="property">value</span> : -<span class="number">1</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_time_input&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_hour_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: hours,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;00&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">value</span>: hour,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    valueRef.<span class="property">value</span>.<span class="property">hour</span> = value;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">onblur</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">                        valueRef.<span class="property">value</span>.<span class="property">hour</span> = -<span class="number">1</span>;</span><br><span class="line">                        onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_separator&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;:&#x27;</span>)),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_minute_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: minutes,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;00&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">value</span>: minute,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    valueRef.<span class="property">value</span>.<span class="property">minute</span> = value;</span><br><span class="line">                    onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">onblur</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">                        valueRef.<span class="property">value</span>.<span class="property">minute</span> = -<span class="number">1</span>;</span><br><span class="line">                        onchange &amp;&amp; <span class="title function_">onchange</span>(valueRef.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]),</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 设置面板组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SettingsPanel</span>(<span class="params">&#123; show &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// token</span></span><br><span class="line">    <span class="keyword">let</span> token = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">// 小时</span></span><br><span class="line">    <span class="keyword">let</span> hour = <span class="title function_">ref</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 分钟</span></span><br><span class="line">    <span class="keyword">let</span> minute = <span class="title function_">ref</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_settings<span class="subst">$&#123;show.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;版本信息&#x27;</span>)),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createTextNode</span>(<span class="string">`v<span class="subst">$&#123;version&#125;</span>`</span>),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;a&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_settings_version_detail&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;GitHub Xu22Web/tech-study-js&#x27;</span>,</span><br><span class="line">                    <span class="attr">href</span>: <span class="string">&#x27;https://github.com/Xu22Web/tech-study-js&#x27;</span>,</span><br><span class="line">                &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 16 16&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z&#x27;</span>,</span><br><span class="line">                &#125;))),</span><br><span class="line">            ]),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_wrap&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;主题预设&#x27;</span>)),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_colors&#x27;</span> &#125;, [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#fa3333&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;强国红&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;XueXi Red&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#bb2649&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;非凡洋红&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Viva Magenta&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;18-1750&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#35548a&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;经典蓝&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Classic Blue&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;19-4052&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#f36f63&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;活珊瑚橘&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Living Coral&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;16-1546&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#6d5b97&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;紫外光色&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Ultra Violet&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;18-3838&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#86af49&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;草木绿&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Greenery&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;15-0343&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#fc8bab&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;B站粉&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Bilibili Pink&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">value</span>: <span class="string">&#x27;#056de8&#x27;</span>,</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;知乎蓝&#x27;</span>,</span><br><span class="line">                    <span class="attr">detail</span>: <span class="string">&#x27;Zhihu Blue&#x27;</span>,</span><br><span class="line">                    <span class="attr">code</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            ].<span class="title function_">map</span>(<span class="function">(<span class="params">color</span>) =&gt;</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_color_wrap&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_theme_color&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">style</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`color: <span class="subst">$&#123;color.value&#125;</span>;<span class="subst">$&#123;themeColor.value === color.value</span></span></span><br><span class="line"><span class="subst"><span class="string">                    ? <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    : <span class="string">` box-shadow: 0rem 0.4rem 0.1rem 0.1rem <span class="subst">$&#123;color.value&#125;</span>30;`</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: color.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (themeColor.<span class="property">value</span> !== color.<span class="property">value</span>) &#123;</span><br><span class="line">                        themeColor.<span class="property">value</span> = color.<span class="property">value</span>;</span><br><span class="line">                        <span class="comment">// 存储</span></span><br><span class="line">                        <span class="title function_">GM_setValue</span>(<span class="string">&#x27;themeColor&#x27;</span>, themeColor.<span class="property">value</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;)))),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_settings_read_time_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;最大文章时长&#x27;</span>)),</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;40s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;60s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;80s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">value</span>: maxRead,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="attr">keep</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;最大文章时长 已保存!&#x27;</span>);</span><br><span class="line">                    maxRead.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="comment">// 存储</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxRead&#x27;</span>, value);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> maxReadTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxRead&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (maxReadTemp) &#123;</span><br><span class="line">                        maxRead.<span class="property">value</span> = maxReadTemp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_settings_watch_time_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;最大视听时长&#x27;</span>)),</span><br><span class="line">            <span class="title class_">Select</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;40s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">40</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;60s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">60</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;80s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">80</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;100s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">label</span>: <span class="string">&#x27;120s&#x27;</span>,</span><br><span class="line">                        <span class="attr">value</span>: <span class="number">120</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">value</span>: maxWatch,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&#x27;120s&#x27;</span>,</span><br><span class="line">                <span class="attr">maxlength</span>: <span class="number">4</span>,</span><br><span class="line">                <span class="attr">keep</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="title function_">onchange</span>(<span class="params">&#123; value &#125;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 创建提示</span></span><br><span class="line">                    <span class="title function_">createTip</span>(<span class="string">&#x27;最大视听时长 已保存!&#x27;</span>);</span><br><span class="line">                    maxWatch.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="comment">// 存储</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>, value);</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ], &#123;</span><br><span class="line">            <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> maxWatchTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (maxWatchTemp) &#123;</span><br><span class="line">                        maxWatch.<span class="property">value</span> = maxWatchTemp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]</span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token_wrap&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;我的 token&#x27;</span>)),</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;input&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                        <span class="attr">class</span>: <span class="string">&#x27;egg_settings_token_input&#x27;</span>,</span><br><span class="line">                        <span class="attr">placeholder</span>: <span class="string">&#x27;用户 token&#x27;</span>,</span><br><span class="line">                        <span class="attr">maxlength</span>: <span class="number">32</span>,</span><br><span class="line">                        <span class="attr">value</span>: pushToken.<span class="property">value</span>,</span><br><span class="line">                        <span class="attr">onfocus</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> input = e.<span class="property">target</span>;</span><br><span class="line">                            input.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                            <span class="keyword">const</span> btnWrap = $$(<span class="string">&#x27;.egg_settings_submit_btn_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                            btnWrap.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">onblur</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> input = e.<span class="property">target</span>;</span><br><span class="line">                            <span class="comment">// 去除空格</span></span><br><span class="line">                            <span class="keyword">const</span> value = input.<span class="property">value</span>.<span class="title function_">trim</span>();</span><br><span class="line">                            <span class="keyword">if</span> (<span class="regexp">/^[0-9a-z]&#123;32&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">                                token = value;</span><br><span class="line">                                input.<span class="property">value</span> = value;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                token = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            input.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> btnWrap = $$(<span class="string">&#x27;.egg_settings_submit_btn_wrap&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">                                btnWrap.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">                                input.<span class="property">value</span> = pushToken.<span class="property">value</span>;</span><br><span class="line">                            &#125;, <span class="number">200</span>);</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_submit_btn_wrap&#x27;</span> &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;egg_settings_submit_btn&#x27;</span>,</span><br><span class="line">                    <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 创建提示</span></span><br><span class="line">                        <span class="title function_">createTip</span>(<span class="string">&#x27;用户 token 已保存!&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (token !== pushToken.<span class="property">value</span>) &#123;</span><br><span class="line">                            pushToken.<span class="property">value</span> = token;</span><br><span class="line">                            <span class="comment">// 存储</span></span><br><span class="line">                            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;pushToken&#x27;</span>, token);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">300</span>),</span><br><span class="line">                &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;保存&#x27;</span>))),</span><br><span class="line">            ])</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">        <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]</span><br><span class="line">            ? <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule&#x27;</span> &#125;, [</span><br><span class="line">                <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time_wrap&#x27;</span> &#125;, [</span><br><span class="line">                    <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time&#x27;</span> &#125;, [</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_label&#x27;</span> &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;设置时间&#x27;</span>)),</span><br><span class="line">                        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_time_input_wrap&#x27;</span> &#125;, [</span><br><span class="line">                            <span class="title class_">TimeInput</span>(&#123;</span><br><span class="line">                                hour,</span><br><span class="line">                                minute,</span><br><span class="line">                                <span class="title function_">onchange</span>(<span class="params">&#123; hour: h, minute: min &#125;</span>) &#123;</span><br><span class="line">                                    hour.<span class="property">value</span> = h;</span><br><span class="line">                                    minute.<span class="property">value</span> = min;</span><br><span class="line">                                &#125;,</span><br><span class="line">                            &#125;),</span><br><span class="line">                            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_schedule_add_btn&#x27;</span>,</span><br><span class="line">                                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="comment">// 定时刷新</span></span><br><span class="line">                                    <span class="keyword">if</span> (!settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;未开启定时刷新!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">if</span> (hour.<span class="property">value</span> === -<span class="number">1</span> || minute.<span class="property">value</span> === -<span class="number">1</span>) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;时间格式不符合要求!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="comment">// 重复定时存在</span></span><br><span class="line">                                    <span class="keyword">const</span> exists = scheduleList.<span class="title function_">find</span>(<span class="function">(<span class="params">schedule</span>) =&gt;</span> schedule.<span class="property">hour</span> === hour.<span class="property">value</span> &amp;&amp;</span><br><span class="line">                                        schedule.<span class="property">minute</span> === minute.<span class="property">value</span>);</span><br><span class="line">                                    <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">                                        <span class="title function_">createTip</span>(<span class="string">&#x27;设置定时任务重复!&#x27;</span>);</span><br><span class="line">                                        <span class="keyword">return</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="title function_">createTip</span>(<span class="string">&#x27;设置定时任务成功!&#x27;</span>);</span><br><span class="line">                                    <span class="comment">// 添加</span></span><br><span class="line">                                    scheduleList.<span class="title function_">push</span>(&#123;</span><br><span class="line">                                        <span class="attr">hour</span>: hour.<span class="property">value</span>,</span><br><span class="line">                                        <span class="attr">minute</span>: minute.<span class="property">value</span>,</span><br><span class="line">                                        <span class="attr">time</span>: <span class="string">`<span class="subst">$&#123;formatDateNum(hour.value)&#125;</span>:<span class="subst">$&#123;formatDateNum(minute.value)&#125;</span>`</span>,</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                    <span class="comment">// 排序</span></span><br><span class="line">                                    scheduleList.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">hour</span> === b.<span class="property">hour</span></span><br><span class="line">                                        ? a.<span class="property">minute</span> - b.<span class="property">minute</span></span><br><span class="line">                                        : a.<span class="property">hour</span> - b.<span class="property">hour</span>);</span><br><span class="line">                                    <span class="comment">// 存储</span></span><br><span class="line">                                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(scheduleList));</span><br><span class="line">                                    <span class="comment">// 清空</span></span><br><span class="line">                                    hour.<span class="property">value</span> = -<span class="number">1</span>;</span><br><span class="line">                                    minute.<span class="property">value</span> = -<span class="number">1</span>;</span><br><span class="line">                                    <span class="keyword">const</span> inputs = $$(<span class="string">&#x27;.egg_time_input input&#x27;</span>);</span><br><span class="line">                                    inputs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> (i.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>));</span><br><span class="line">                                    <span class="comment">// 刷新任务</span></span><br><span class="line">                                    <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                                &#125;, <span class="number">300</span>),</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">                            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                                <span class="attr">d</span>: <span class="string">&#x27;M801.171 483.589H544V226.418c0-17.673-14.327-32-32-32s-32 14.327-32 32v257.171H222.83c-17.673 0-32 14.327-32 32s14.327 32 32 32H480v257.17c0 17.673 14.327 32 32 32s32-14.327 32-32v-257.17h257.171c17.673 0 32-14.327 32-32s-14.327-32-32-32z&#x27;</span>,</span><br><span class="line">                            &#125;))),</span><br><span class="line">                        ]),</span><br><span class="line">                    ]),</span><br><span class="line">                ]),</span><br><span class="line">                <span class="title class_">ScheduleList</span>(),</span><br><span class="line">            ])</span><br><span class="line">            : <span class="literal">undefined</span>),</span><br><span class="line">    ], &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 刷新token</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 远程推送</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>]) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> tokenTemp = <span class="title function_">GM_getValue</span>(<span class="string">&#x27;pushToken&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (tokenTemp) &#123;</span><br><span class="line">                            pushToken.<span class="property">value</span> = tokenTemp;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 刷新定时任务</span></span><br><span class="line">            <span class="title function_">watch</span>(<span class="function">() =&gt;</span> settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 定时任务打开</span></span><br><span class="line">                <span class="keyword">if</span> (settings[<span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>]) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> scheduleTemp = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title function_">GM_getValue</span>(<span class="string">&#x27;scheduleList&#x27;</span>));</span><br><span class="line">                        <span class="keyword">if</span> (scheduleTemp &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(scheduleTemp)) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> scheduleTemp) &#123;</span><br><span class="line">                                scheduleList[i] = scheduleTemp[i];</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">                    <span class="comment">// 刷新定时任务</span></span><br><span class="line">                    <span class="title function_">refreshScheduleTask</span>();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 清除任务</span></span><br><span class="line">                <span class="title function_">clearScheduleTask</span>();</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 面板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Panel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 运行设置标签</span></span><br><span class="line">    <span class="keyword">const</span> runLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;自动开始&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;启动时, 自动开始任务, 在倒计时结束前自动开始可随时取消; 如果在自动开始前手动开始任务, 此次自动开始将取消&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">AUTO_START</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;同屏任务&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;运行任务时，所有任务均在当前页面以弹窗方式运行&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SAME_TAB</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;静默运行&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;同屏任务时, 不显示任务弹窗静默运行&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SILENT_RUN</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;定时刷新&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;定时刷新页面，重新进行任务，此功能需要长时间占用浏览器&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">SCHEDULE_RUN</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 运行设置标签</span></span><br><span class="line">    <span class="keyword">const</span> examLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;随机作答&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;无答案时, 随机选择或者填入答案, 不保证正确&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">RANDOM_EXAM</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 推送设置标签</span></span><br><span class="line">    <span class="keyword">const</span> pushLabels = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;远程推送&#x27;</span>,</span><br><span class="line">            <span class="attr">tip</span>: <span class="string">&#x27;利用 pushplus 推送, 将登录二维码直接推送到微信公众号&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">SettingType</span>.<span class="property">REMOTE_PUSH</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 处理设置变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleSettingsChange</span> = (<span class="params">e, type, title</span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 开关</span></span><br><span class="line">        <span class="keyword">const</span> &#123; checked &#125; = e.<span class="property">target</span>;</span><br><span class="line">        <span class="keyword">if</span> (settings[type] !== checked) &#123;</span><br><span class="line">            settings[type] = checked;</span><br><span class="line">            <span class="comment">// 设置</span></span><br><span class="line">            <span class="title function_">GM_setValue</span>(<span class="string">&#x27;studySettings&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(settings));</span><br><span class="line">            <span class="comment">// 创建提示</span></span><br><span class="line">            <span class="title function_">createTip</span>(<span class="string">`<span class="subst">$&#123;title&#125;</span> <span class="subst">$&#123;checked ? <span class="string">&#x27;打开&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>&#125;</span>!`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 任务显示</span></span><br><span class="line">    <span class="keyword">const</span> scheduleShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// 面板显示</span></span><br><span class="line">    <span class="keyword">const</span> panelShow = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="string">`egg_panel_wrap<span class="subst">$&#123;hasMobile() ? <span class="string">&#x27; mobile&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>,</span><br><span class="line">    &#125;, <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">        <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_panel<span class="subst">$&#123;panelShow.value ? <span class="string">&#x27; hide&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">    &#125;, [</span><br><span class="line">        <span class="comment">// 登录</span></span><br><span class="line">        <span class="title class_">LoginItem</span>(),</span><br><span class="line">        <span class="comment">// 信息</span></span><br><span class="line">        <span class="title class_">InfoItem</span>(),</span><br><span class="line">        <span class="comment">// 分数</span></span><br><span class="line">        <span class="title class_">ScoreItem</span>(),</span><br><span class="line">        <span class="comment">// 任务部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;任务&#x27;</span> &#125;),</span><br><span class="line">        <span class="title class_">TaskList</span>(),</span><br><span class="line">        <span class="comment">// 运行部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;运行&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_run_list&#x27;</span> &#125;, runLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 答题部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;答题&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_exam_list&#x27;</span> &#125;, examLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 推送部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;推送&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_push_list&#x27;</span> &#125;, pushLabels.<span class="title function_">map</span>(<span class="function">(<span class="params">label</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">NomalItem</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: label.<span class="property">title</span>,</span><br><span class="line">                <span class="attr">tip</span>: label.<span class="property">tip</span>,</span><br><span class="line">                <span class="attr">checked</span>: settings[label.<span class="property">type</span>],</span><br><span class="line">                <span class="attr">onchange</span>: <span class="title function_">debounce</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">handleSettingsChange</span>(e, label.<span class="property">type</span>, label.<span class="property">title</span>);</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="comment">// 提示部分</span></span><br><span class="line">        <span class="title class_">Hr</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;提示&#x27;</span> &#125;),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_tip_list&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title function_">createTextNode</span>(<span class="string">&#x27;专项练习已被移除, 如需使用, 请点击&#x27;</span>),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_tip_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(doExamPaper, <span class="number">300</span>),</span><br><span class="line">                <span class="attr">disabled</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [running.<span class="property">value</span>, taskStatus.<span class="property">value</span>], <span class="function">() =&gt;</span> running.<span class="property">value</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">START</span> ||</span><br><span class="line">                    taskStatus.<span class="property">value</span> === <span class="title class_">TaskStatusType</span>.<span class="property">PAUSE</span>),</span><br><span class="line">            &#125;, <span class="title function_">createTextNode</span>(<span class="string">&#x27;去完成&#x27;</span>)),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="comment">// 按钮集合</span></span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: <span class="string">&#x27;egg_btns_wrap&#x27;</span>,</span><br><span class="line">        &#125;, [</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchRef</span>(<span class="function">() =&gt;</span> [frame.<span class="property">exist</span>, frame.<span class="property">show</span>], <span class="function">() =&gt;</span> <span class="string">`egg_frame_show_btn<span class="subst">$&#123;!frame.exist || frame.show ? <span class="string">&#x27; hide&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;窗口&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 窗口显示</span></span><br><span class="line">                    frame.<span class="property">show</span> = <span class="literal">true</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">d</span>: <span class="string">&#x27;M836.224 106.666667h-490.666667a85.589333 85.589333 0 0 0-85.333333 85.333333V256h-64a85.589333 85.589333 0 0 0-85.333333 85.333333v490.666667a85.589333 85.589333 0 0 0 85.333333 85.333333h490.666667a85.589333 85.589333 0 0 0 85.333333-85.333333V768h64a85.589333 85.589333 0 0 0 85.333333-85.333333V192a85.589333 85.589333 0 0 0-85.333333-85.333333z m-132.266667 725.333333a20.138667 20.138667 0 0 1-21.333333 21.333333h-490.666667a20.138667 20.138667 0 0 1-21.333333-21.333333V341.333333a20.138667 20.138667 0 0 1 21.333333-21.333333h494.933334a20.138667 20.138667 0 0 1 21.333333 21.333333v490.666667z m153.6-149.333333a20.138667 20.138667 0 0 1-21.333333 21.333333h-64V341.333333a85.589333 85.589333 0 0 0-85.333333-85.333333h-362.666667V192a20.138667 20.138667 0 0 1 21.333333-21.333333h490.666667a20.138667 20.138667 0 0 1 21.333333 21.333333z&#x27;</span>,</span><br><span class="line">            &#125;))),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_panel_show_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;面板&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    panelShow.<span class="property">value</span> = !panelShow.<span class="property">value</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">d</span>: <span class="string">&#x27;M332.16 883.84a40.96 40.96 0 0 0 58.24 0l338.56-343.04a40.96 40.96 0 0 0 0-58.24L390.4 140.16a40.96 40.96 0 0 0-58.24 58.24L640 512l-307.84 314.24a40.96 40.96 0 0 0 0 57.6z&#x27;</span>,</span><br><span class="line">            &#125;))),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="title function_">watchEffectRef</span>(<span class="function">() =&gt;</span> <span class="string">`egg_settings_show_btn<span class="subst">$&#123;scheduleShow.value ? <span class="string">&#x27; active&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>),</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;设置&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    scheduleShow.<span class="property">value</span> = !scheduleShow.<span class="property">value</span>;</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M7.25325 705.466473a503.508932 503.508932 0 0 0 75.26742 121.391295 95.499302 95.499302 0 0 0 93.211173 31.07039 168.59902 168.59902 0 0 1 114.526906 16.257763 148.487566 148.487566 0 0 1 71.052444 83.456515 91.163899 91.163899 0 0 0 75.989987 61.538643 578.053784 578.053784 0 0 0 148.969278 0A91.163899 91.163899 0 0 0 662.380873 957.642436a148.487566 148.487566 0 0 1 72.256723-83.456515 168.59902 168.59902 0 0 1 114.406478-16.257763 95.61973 95.61973 0 0 0 93.331601-31.07039 503.508932 503.508932 0 0 0 75.267419-121.391295 84.29951 84.29951 0 0 0-18.545892-94.897163 138.251197 138.251197 0 0 1 0-197.140426 84.29951 84.29951 0 0 0 18.545892-94.897163 503.508932 503.508932 0 0 0-75.869559-121.391295 95.499302 95.499302 0 0 0-93.211173-31.070391A168.59902 168.59902 0 0 1 734.637596 149.812272a148.848849 148.848849 0 0 1-72.256723-83.456515A91.163899 91.163899 0 0 0 586.631741 4.817115a581.907476 581.907476 0 0 0-148.969277 0A91.163899 91.163899 0 0 0 361.311193 66.355757a148.848849 148.848849 0 0 1-71.413728 83.456515 168.59902 168.59902 0 0 1-114.406478 16.257763 95.378874 95.378874 0 0 0-93.3316 31.070391A503.508932 503.508932 0 0 0 7.25325 318.531721a84.29951 84.29951 0 0 0 18.545893 94.897163 140.057615 140.057615 0 0 1 41.30676 98.509999 140.057615 140.057615 0 0 1-41.30676 98.630427A84.29951 84.29951 0 0 0 7.25325 705.466473z m929.462315-349.240828a219.901294 219.901294 0 0 0 0 312.028615c0.842995 0.842995 2.649413 3.010697 1.806418 5.057971a427.398517 427.398517 0 0 1-63.104205 101.520696 9.513802 9.513802 0 0 1-9.032091 2.167702 255.547944 255.547944 0 0 0-173.777418 24.928569 231.823653 231.823653 0 0 0-111.275354 130.302957 6.984817 6.984817 0 0 1-6.021394 4.937543 492.790851 492.790851 0 0 1-126.328837 0 6.984817 6.984817 0 0 1-6.021394-4.937543 231.823653 231.823653 0 0 0-111.275353-130.302957 255.668372 255.668372 0 0 0-120.427872-30.468252 258.919924 258.919924 0 0 0-52.747408 5.539683 9.513802 9.513802 0 0 1-9.03209-2.167702 427.398517 427.398517 0 0 1-63.104205-101.520696c-0.842995-2.047274 0.963423-4.214976 1.806418-5.057971a221.82814 221.82814 0 0 0 64.910623-156.556233 221.707712 221.707712 0 0 0-65.512762-155.713238c-0.842995-0.842995-2.649413-3.010697-1.806418-5.057971a427.398517 427.398517 0 0 1 63.104205-101.520696 9.393374 9.393374 0 0 1 8.911662-2.167701 255.7888 255.7888 0 0 0 173.897847-24.92857 231.823653 231.823653 0 0 0 111.275353-130.302957 6.984817 6.984817 0 0 1 6.021394-4.937543 492.790851 492.790851 0 0 1 126.328837 0 6.984817 6.984817 0 0 1 6.021394 4.937543 231.823653 231.823653 0 0 0 111.275354 130.302957 255.547944 255.547944 0 0 0 173.777418 24.92857 9.513802 9.513802 0 0 1 9.032091 2.167701 423.063113 423.063113 0 0 1 62.983777 101.520696c0.963423 2.047274-0.842995 4.214976-1.68599 5.057971z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M512.086889 305.766366a206.292944 206.292944 0 1 0 206.172516 206.172517 206.413372 206.413372 0 0 0-206.172516-206.172517z m123.197713 206.172517a123.197713 123.197713 0 1 1-123.197713-123.077285 123.318141 123.318141 0 0 1 123.197713 123.077285z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">            ])),</span><br><span class="line">            <span class="title function_">createElementNode</span>(<span class="string">&#x27;button&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_settings_reset_btn&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;重置&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">                <span class="attr">onclick</span>: <span class="title function_">debounce</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 任务配置</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;taskConfig&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 设置</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;studySettings&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 最大阅读</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxRead&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 最大观看</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;maxWatch&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 主题色</span></span><br><span class="line">                    <span class="title function_">GM_setValue</span>(<span class="string">&#x27;themeColor&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 刷新页面</span></span><br><span class="line">                    location.<span class="title function_">reload</span>();</span><br><span class="line">                &#125;, <span class="number">300</span>),</span><br><span class="line">            &#125;, <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;svg&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">viewBox</span>: <span class="string">&#x27;0 0 1024 1024&#x27;</span>,</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;egg_icon&#x27;</span>,</span><br><span class="line">            &#125;, [</span><br><span class="line">                <span class="title function_">createNSElementNode</span>(<span class="string">&#x27;path&#x27;</span>, <span class="literal">undefined</span>, &#123;</span><br><span class="line">                    <span class="attr">d</span>: <span class="string">&#x27;M943.8 484.1c-17.5-13.7-42.8-10.7-56.6 6.8-5.7 7.3-8.5 15.8-8.6 24.4h-0.4c-0.6 78.3-26.1 157-78 223.3-124.9 159.2-356 187.1-515.2 62.3-31.7-24.9-58.2-54-79.3-85.9h77.1c22.4 0 40.7-18.3 40.7-40.7v-3c0-22.4-18.3-40.7-40.7-40.7H105.5c-22.4 0-40.7 18.3-40.7 40.7v177.3c0 22.4 18.3 40.7 40.7 40.7h3c22.4 0 40.7-18.3 40.7-40.7v-73.1c24.2 33.3 53 63.1 86 89 47.6 37.3 101 64.2 158.9 79.9 55.9 15.2 113.5 19.3 171.2 12.3 57.7-7 112.7-24.7 163.3-52.8 52.5-29 98-67.9 135.3-115.4 37.3-47.6 64.2-101 79.9-158.9 10.2-37.6 15.4-76 15.6-114.6h-0.1c-0.3-11.6-5.5-23.1-15.5-30.9zM918.7 135.2h-3c-22.4 0-40.7 18.3-40.7 40.7V249c-24.2-33.3-53-63.1-86-89-47.6-37.3-101-64.2-158.9-79.9-55.9-15.2-113.5-19.3-171.2-12.3-57.7 7-112.7 24.7-163.3 52.8-52.5 29-98 67.9-135.3 115.4-37.3 47.5-64.2 101-79.9 158.8-10.2 37.6-15.4 76-15.6 114.6h0.1c0.2 11.7 5.5 23.2 15.4 30.9 17.5 13.7 42.8 10.7 56.6-6.8 5.7-7.3 8.5-15.8 8.6-24.4h0.4c0.6-78.3 26.1-157 78-223.3 124.9-159.2 356-187.1 515.2-62.3 31.7 24.9 58.2 54 79.3 85.9h-77.1c-22.4 0-40.7 18.3-40.7 40.7v3c0 22.4 18.3 40.7 40.7 40.7h177.3c22.4 0 40.7-18.3 40.7-40.7V175.8c0.1-22.3-18.2-40.6-40.6-40.6z&#x27;</span>,</span><br><span class="line">                &#125;),</span><br><span class="line">            ])),</span><br><span class="line">        ]),</span><br><span class="line">        <span class="comment">// 任务按钮</span></span><br><span class="line">        <span class="title class_">TaskBtn</span>(),</span><br><span class="line">        <span class="title function_">createElementNode</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">undefined</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;egg_settings_item&#x27;</span> &#125;, [</span><br><span class="line">            <span class="title class_">SettingsPanel</span>(&#123; <span class="attr">show</span>: scheduleShow &#125;),</span><br><span class="line">        ]),</span><br><span class="line">    ]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习工具 </tag>
            
            <tag> 日常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git使用指南</title>
      <link href="/2023/01/31/Git%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2023/01/31/Git%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1>Git使用</h1><p><strong>Git是目前世界上最先进的分布式版本控制系统。</strong></p><p><strong>工作原理 / 流程</strong></p><p><img src="https://pic2.zhimg.com/80/v2-3bc9d5f2c49a713c776e69676d7d56c5_1440w.webp" alt="git流程图"></p><h2 id="Git下载与安装">Git下载与安装</h2><p>具体安装教程已有详细博客，不多说，上链接</p><p>[Git下载与安装_pingcode的博客-CSDN博客_git](<a href="https://blog.csdn.net/qq_41521682/article/details/122764915#:~:text=%E7%AC%AC%E4%B8%80%E6%AD%A5">https://blog.csdn.net/qq_41521682/article/details/122764915#:~:text=第一步</a> 下载git (找到自己需要的版本) 第二步 下载 完点击 安装 包进入使用许可声明界面,这里我是选择装在D盘，大家如果嫌麻烦就默认 安装 在C盘 第四步 点击Next进入选择 安装 组件界面 上图红框内的选项是默认勾选的，建议不要动。)</p><h2 id="Git初始配置">Git初始配置</h2><p>​</p><p>​安装完成后，需要对软件进行配置，右键点Git Bash Here, 输入以下指令</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;你的用户名&quot;</span><br><span class="line">git config --global user.email &quot;你的邮箱&quot;</span><br></pre></td></tr></table></figure><p>​解释一下，用户名和邮箱起标识作用，git命令行和Linux指令很相似，<code>--</code>后面加完整名称的单词做参数，<code>-</code>后面则是单词简写</p><h3 id="扩展-git配置的优先级">扩展 git配置的优先级</h3><p>​<code>-- global</code> 是指git配置的位置，位置所管辖的范围约小，配置生效的优先级越高，优先级越高的配置会覆盖掉优先级较低的配置，优先生效<img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202301311730216.png" alt="image-20230131170032912"></p><p>​git的配置基于配置文件，有如下四个配置范围</p><p><img src="https://img.panyanbin.com/img/2021/06/30/1624986904-3edb6dce65621f97c0e649eee007e1e5.png" alt="image-20230131164336991"></p><p>​常用的有三个（<code>local</code>、<code>global</code>、<code>system</code>），worktree基本不使用所以不多说。</p><ul><li><strong>system系统级</strong></li></ul><p>​系统级配置文件含有系统里每位用户及他们所拥有的仓库的配置值。其位置为git的安装目录下的<code>/etc/gitconfig</code>，即如果git的安装目录为<code>D:\Git</code>，则配置文件地址为<code>D:\Git\etc\gitconfig</code>。</p><p><strong>优先度最低，其配置值可被全局级配置和本地级配置的值覆盖</strong>。一般我们很少会使用系统级的配置。</p><ul><li><strong>global全局级</strong></li></ul><p>​全局级配置文件包含当前系统用户的拥有的仓库配置值，每个系统用户的全局级配置相互隔离。全局级别的配置默认保存在当前系统用户的主目录下的 .gitconfig 文件内。Windows通常保存在<code>C:\Users\xxxx\.gitconfig</code>，Linux为<code>/home/xxx/.gitconfig</code>。</p><p><strong>优先度比系统级高，可覆盖系统级的配置值</strong>。全局级的配置平时使用得比较多，比如设置账号和邮箱：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name panyanbin</span><br><span class="line">git config --global user.email me@panyanbin.com</span><br></pre></td></tr></table></figure><ul><li><strong>local本地级</strong></li></ul><p>​本地级别的配置保存在当前仓库下面的 <code>.git\config</code> 文件内，通常 .git 文件夹是隐藏的，Window要在文件管理器的文件夹选项中打开显示隐藏文件夹才可以看到。这里的配置仅对当前仓库有效，不影响其他的仓库。</p><p><strong>优先级别最高，如果全局级别或系统级别的配置里出现了同一配置项，则以本地级别配置内容为准</strong></p><p>​了解这些后，你就可以进行不同优先级和生效范围的配置了</p><h2 id="Git-创建版本库">Git 创建版本库</h2><p>​<code>版本库（repository）</code>,你可以理解为一个目录，它存储了所有你在不同时间上对<code>工作目录</code>中文件的更改，也就是某个时间点上你所提交的<code>工作目录</code>中文件的状态，这个文件状态我们称之为<code>版本</code> ， 以便你能任意在多个版本间跳转（初学者看会有点抽象）</p><p>​创建一个仓库很简单，只要先创建一个目录，这个目录就是你的<code>工作目录</code>（也称<code>工作区</code>），然后在目录中 Git Bash Here,输入指令</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202301311722914.png" alt="image-20230131172231949"></p><p>此时，目录中会生成一个<code>.git</code>文件夹，这个就是<code>版本库</code>，不要随意乱动，以免损坏</p><p><img src="https://ohtoai-images.oss-cn-beijing.aliyuncs.com/imgs/OhtoAi_Blog/202301311724121.png" alt="image-20230131172436286"></p><p>​git记录版本是通过提交（<code>commit</code>）实现的，但并不是每次对文件修改就直接提交这些修改，因为提交后版本就无法删除的永远存在于版本库中了（除非你删掉仓库或者损坏.git文件），git在对文件从修改到提交的过程中增加了一个叫<code>暂存区</code>的概念，为提交的提供了容错的空间</p><p>​<img src="https://www.runoob.com/wp-content/uploads/2015/02/1352126739_7909.jpg" alt=""></p><p>​我们来理解下 Git 工作区、暂存区和版本库概念</p><ul><li>**工作区：**就是你在电脑里能看到的目录。</li><li>**暂存区：**英文叫 stage 或 index。一般存放在 <strong>.git</strong> 目录下的 index 文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。</li><li>**版本库：**工作区有一个隐藏目录 <strong>.git</strong>，这个不算工作区，而是 Git 的版本库</li></ul><p>​提交一个版本，需要首先在<code>工作区</code>中对文件进行修改，然后再添加到<code>暂存区</code>，最后提交到<code>版本库</code>,初学者理解这个流程，方便记忆指令（其实用多了自然也就记住了）</p><p>​下面我们按照这个流程呢来学习git的常用指令</p><h2 id="Git基本操作指令">Git基本操作指令</h2><ul><li>将工作目录的修改提交到暂存区（index）</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//添加一个或多个文件到暂存区（index）</span><br><span class="line"></span><br><span class="line">git add [file1] [file2] .....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 添加所有文件到暂存区</span><br><span class="line"></span><br><span class="line">git add .</span><br></pre></td></tr></table></figure><ul><li>查看暂存区情况</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 日常工具 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
